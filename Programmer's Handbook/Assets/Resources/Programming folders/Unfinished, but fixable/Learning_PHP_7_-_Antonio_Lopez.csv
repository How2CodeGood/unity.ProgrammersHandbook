Larger Text,Smaller Text,Symbol
LearningPHP7,NA,NA
TableofContents,NA,NA
LearningPHP7 ,NA,NA
Credits ,NA,NA
AbouttheAuthor ,NA,NA
AbouttheReviewer ,NA,NA
www.PacktPub.com ,NA,NA
"eBooks,discountoffers,andmore ",NA,NA
Whysubscribe?,NA,NA
Preface ,NA,NA
Whatthisbookcovers ,NA,NA
Whatyouneedforthisbook ,NA,NA
Whothisbookisfor ,NA,NA
Conventions ,NA,NA
Readerfeedback ,NA,NA
Customersupport ,NA,NA
Downloadingtheexamplecode ,NA,NA
Errata ,NA,NA
Piracy ,NA,NA
Questions ,NA,NA
1.SettingUptheEnvironment ,NA,NA
SettinguptheenvironmentwithVagrant ,NA,NA
IntroducingVagrant ,NA,NA
InstallingVagrant ,NA,NA
UsingVagrant ,NA,NA
SettinguptheenvironmentonOSX ,NA,NA
InstallingPHP ,NA,NA
InstallingMySQL ,NA,NA
InstallingNginx ,NA,NA
InstallingComposer ,NA,NA
SettinguptheenvironmentonWindows,NA,NA
InstallingPHP ,NA,NA
InstallingMySQL ,NA,NA
InstallingNginx ,NA,NA
InstallingComposer ,NA,NA
SettinguptheenvironmentonUbuntu ,NA,NA
InstallingPHP ,NA,NA
InstallingMySQL ,NA,NA
InstallingNginx ,NA,NA
Summary ,NA,NA
2.WebApplicationswithPHP ,NA,NA
TheHTTPprotocol ,NA,NA
Asimpleexample ,NA,NA
Partsofthemessage ,NA,NA
URL ,NA,NA
TheHTTPmethod ,NA,NA
Body ,NA,NA
Headers ,NA,NA
Thestatuscode ,NA,NA
Amorecomplexexample ,NA,NA
Webapplications ,NA,NA
"HTML,CSS,andJavaScript ",NA,NA
Webservers ,NA,NA
Howtheywork ,NA,NA
ThePHPbuilt-inserver ,NA,NA
Puttingthingstogether ,NA,NA
Summary ,NA,NA
3.UnderstandingPHPBasics ,NA,NA
PHPfiles ,NA,NA
Variables ,NA,NA
Datatypes ,NA,NA
Operators,NA,NA
Arithmeticoperators ,NA,NA
Assignmentoperators ,NA,NA
Comparisonoperators ,NA,NA
Logicaloperators ,NA,NA
Incrementinganddecrementingoperators ,NA,NA
Operatorprecedence ,NA,NA
Workingwithstrings ,NA,NA
Arrays ,NA,NA
Initializingarrays ,NA,NA
Populatingarrays ,NA,NA
Accessingarrays ,NA,NA
Theemptyandissetfunctions ,NA,NA
Searchingforelementsinanarray ,NA,NA
Orderingarrays ,NA,NA
Otherarrayfunctions ,NA,NA
PHPinwebapplications ,NA,NA
Gettinginformationfromtheuser ,NA,NA
HTMLforms ,NA,NA
Persistingdatawithcookies ,NA,NA
Othersuperglobals ,NA,NA
Controlstructures ,NA,NA
Conditionals ,NA,NA
Switch…case ,NA,NA
Loops ,NA,NA
While ,NA,NA
Do…while ,NA,NA
For ,NA,NA
Foreach ,NA,NA
Functions ,NA,NA
Functiondeclaration ,NA,NA
Functionarguments,NA,NA
Thereturnstatement ,NA,NA
Typehintingandreturntypes ,NA,NA
Thefilesystem ,NA,NA
Readingfiles ,NA,NA
Writingfiles ,NA,NA
Otherfilesystemfunctions ,NA,NA
Summary ,NA,NA
4.CreatingCleanCodewithOOP ,NA,NA
Classesandobjects ,NA,NA
Classproperties ,NA,NA
Classmethods ,NA,NA
Classconstructors ,NA,NA
Magicmethods ,NA,NA
Propertiesandmethodsvisibility ,NA,NA
Encapsulation ,NA,NA
Staticpropertiesandmethods ,NA,NA
Namespaces ,NA,NA
Autoloadingclasses ,NA,NA
Usingthe__autoloadfunction ,NA,NA
Usingthespl_autoload_registerfunction ,NA,NA
Inheritance ,NA,NA
Introducinginheritance ,NA,NA
Overridingmethods ,NA,NA
Abstractclasses ,NA,NA
Interfaces ,NA,NA
Polymorphism ,NA,NA
Traits ,NA,NA
Handlingexceptions ,NA,NA
Thetry…catchblock ,NA,NA
Thefinallyblock ,NA,NA
Catchingdifferenttypesofexceptions,NA,NA
Designpatterns ,NA,NA
Factory ,NA,NA
Singleton ,NA,NA
Anonymousfunctions ,NA,NA
Summary ,NA,NA
5.UsingDatabases ,NA,NA
Introducingdatabases ,NA,NA
MySQL ,NA,NA
Schemasandtables ,NA,NA
Understandingschemas ,NA,NA
Databasedatatypes ,NA,NA
Numericdatatypes ,NA,NA
Stringdatatypes ,NA,NA
Listofvalues ,NA,NA
Dateandtimedatatypes ,NA,NA
Managingtables ,NA,NA
Keysandconstraints ,NA,NA
Primarykeys ,NA,NA
Foreignkeys ,NA,NA
Uniquekeys ,NA,NA
Indexes ,NA,NA
Insertingdata ,NA,NA
Queryingdata ,NA,NA
UsingPDO ,NA,NA
Connectingtothedatabase ,NA,NA
Performingqueries ,NA,NA
Preparedstatements ,NA,NA
Joiningtables ,NA,NA
Groupingqueries ,NA,NA
Updatinganddeletingdata ,NA,NA
Updatingdata,NA,NA
Foreignkeybehaviors ,NA,NA
Deletingdata ,NA,NA
Workingwithtransactions ,NA,NA
Summary ,NA,NA
6.AdaptingtoMVC ,NA,NA
TheMVCpattern ,NA,NA
UsingComposer ,NA,NA
Managingdependencies ,NA,NA
AutoloaderwithPSR-4 ,NA,NA
Addingmetadata ,NA,NA
Theindex.phpfile ,NA,NA
Workingwithrequests ,NA,NA
Therequestobject ,NA,NA
Filteringparametersfromrequests ,NA,NA
Mappingroutestocontrollers ,NA,NA
Therouter ,NA,NA
URLsmatchingwithregularexpressions ,NA,NA
ExtractingtheargumentsoftheURL ,NA,NA
Executingthecontroller ,NA,NA
Mformodel ,NA,NA
Thecustomermodel ,NA,NA
Thebookmodel ,NA,NA
Thesalesmodel ,NA,NA
Vforview ,NA,NA
IntroductiontoTwig ,NA,NA
Thebookview ,NA,NA
Layoutsandblocks ,NA,NA
Paginatedbooklist ,NA,NA
Thesalesview ,NA,NA
Theerrortemplate ,NA,NA
Thelogintemplate,NA,NA
Cforcontroller ,NA,NA
Theerrorcontroller ,NA,NA
Thelogincontroller ,NA,NA
Thebookcontroller ,NA,NA
Borrowingbooks ,NA,NA
Thesalescontroller ,NA,NA
Dependencyinjection ,NA,NA
Whyisdependencyinjectionnecessary? ,NA,NA
Implementingourowndependencyinjector ,NA,NA
Summary ,NA,NA
7.TestingWebApplications ,NA,NA
Thenecessityfortests ,NA,NA
Typesoftests ,NA,NA
Unittestsandcodecoverage ,NA,NA
IntegratingPHPUnit ,NA,NA
Thephpunit.xmlfile ,NA,NA
Yourfirsttest ,NA,NA
Runningtests ,NA,NA
Writingunittests ,NA,NA
Thestartandendofatest ,NA,NA
Assertions ,NA,NA
Expectingexceptions ,NA,NA
Dataproviders ,NA,NA
Testingwithdoubles ,NA,NA
InjectingmodelswithDI ,NA,NA
CustomizingTestCase ,NA,NA
Usingmocks ,NA,NA
Databasetesting ,NA,NA
Test-drivendevelopment ,NA,NA
Theoryversuspractice ,NA,NA
Summary,NA,NA
8.UsingExistingPHPFrameworks ,NA,NA
Reviewingframeworks ,NA,NA
Thepurposeofframeworks ,NA,NA
Themainpartsofaframework ,NA,NA
Otherfeaturesofframeworks ,NA,NA
Authenticationandroles ,NA,NA
ORM ,NA,NA
Cache ,NA,NA
Internationalization ,NA,NA
Typesofframeworks ,NA,NA
Completeandrobustframeworks ,NA,NA
Lightweightandflexibleframeworks ,NA,NA
Anoverviewoffamousframeworks ,NA,NA
Symfony2 ,NA,NA
ZendFramework2 ,NA,NA
Otherframeworks ,NA,NA
TheLaravelframework ,NA,NA
Installation ,NA,NA
Projectsetup ,NA,NA
Addingthefirstendpoint ,NA,NA
Managingusers ,NA,NA
Userregistration ,NA,NA
Userlogin ,NA,NA
Protectedroutes ,NA,NA
Settinguprelationshipsinmodels ,NA,NA
Creatingcomplexcontrollers ,NA,NA
Addingtests ,NA,NA
TheSilexmicroframework ,NA,NA
Installation ,NA,NA
Projectsetup ,NA,NA
Managingconfiguration,NA,NA
Settingthetemplateengine ,NA,NA
Addingalogger ,NA,NA
Addingthefirstendpoint ,NA,NA
Accessingthedatabase ,NA,NA
SilexversusLaravel ,NA,NA
Summary ,NA,NA
9.BuildingRESTAPIs ,NA,NA
IntroducingAPIs ,NA,NA
IntroducingRESTAPIs ,NA,NA
ThefoundationsofRESTAPIs ,NA,NA
HTTPrequestmethods ,NA,NA
GET ,NA,NA
POSTandPUT ,NA,NA
DELETE ,NA,NA
Statuscodesinresponses ,NA,NA
2xx–success ,NA,NA
3xx–redirection ,NA,NA
4xx–clienterror ,NA,NA
5xx–servererror ,NA,NA
RESTAPIsecurity ,NA,NA
Basicaccessauthentication ,NA,NA
OAuth2.0 ,NA,NA
Usingthird-partyAPIs ,NA,NA
Gettingtheapplication’scredentials ,NA,NA
Settinguptheapplication ,NA,NA
Requestinganaccesstoken ,NA,NA
Fetchingtweets ,NA,NA
ThetoolkitoftheRESTAPIdeveloper ,NA,NA
TestingAPIswithbrowsers ,NA,NA
TestingAPIsusingthecommandline ,NA,NA
BestpracticeswithRESTAPIs,NA,NA
Consistencyinyourendpoints ,NA,NA
Documentasmuchasyoucan ,NA,NA
Filtersandpagination ,NA,NA
APIversioning ,NA,NA
UsingHTTPcache ,NA,NA
CreatingaRESTAPIwithLaravel ,NA,NA
SettingOAuth2authentication ,NA,NA
InstallingOAuth2Server ,NA,NA
Settingupthedatabase ,NA,NA
Enablingclient-,NA,NA
credentialsauthentication ,NA,NA
Requestinganaccesstoken ,NA,NA
Preparingthedatabase ,NA,NA
Settingupthemodels ,NA,NA
Designingendpoints ,NA,NA
Addingthecontrollers ,NA,NA
TestingyourRESTAPIs ,NA,NA
Summary ,NA,NA
10.BehavioralTesting ,NA,NA
Behavior-drivendevelopment ,NA,NA
Introducingcontinuousintegration ,NA,NA
Unittestsversusacceptancetests ,NA,NA
TDDversusBDD ,NA,NA
Businesswritingtests ,NA,NA
BDDwithBehat ,NA,NA
IntroducingtheGherkinlanguage ,NA,NA
Definingscenarios ,NA,NA
WritingGiven-When-Thentestcases ,NA,NA
Reusingpartsofscenarios ,NA,NA
Writingstepdefinitions ,NA,NA
Theparameterizationofsteps ,NA,NA
Runningfeaturetests,NA,NA
TestingwithabrowserusingMink ,NA,NA
Typesofwebdrivers ,NA,NA
InstallingMinkwithGoutte ,NA,NA
Interactionwiththebrowser ,NA,NA
Summary ,NA,NA
Index,NA,NA
LearningPHP7,NA,NA
LearningPHP7 ,NA,NA
Copyright©2016PacktPublishing ,NA,NA
"Allrightsreserved.Nopartofthisbookmaybereproduced,storedinaretrievalsystem, ",NA,NA
"ortransmittedinanyformorbyanymeans,withoutthepriorwrittenpermissionofthe ",NA,NA
"publisher,exceptinthecaseofbriefquotationsembeddedincriticalarticlesorreviews.",NA,NA
Everyefforthasbeenmadeinthepreparationofthisbooktoensuretheaccuracyofthe ,NA,NA
"informationpresented.However,theinformationcontainedinthisbookissoldwithout ",NA,NA
"warranty,eitherexpressorimplied.Neithertheauthor,norPacktPublishing,andits ",NA,NA
dealersanddistributorswillbeheldliableforanydamagescausedorallegedtobecaused ,NA,NA
directlyorindirectlybythisbook.,NA,NA
PacktPublishinghasendeavoredtoprovidetrademarkinformationaboutallofth,NA,NA
e ,NA,NA
companiesandproductsmentionedinthisbookbytheappropriateuseofcapitals. ,NA,NA
"However,PacktPublishingcannotguaranteetheaccuracyofthisinformation.",NA,NA
Firstpublished:March2016 ,NA,NA
Productionreference:1210316 ,NA,NA
PublishedbyPacktPublishingLtd.,NA,NA
LiveryPlace ,NA,NA
35LiveryStreet ,NA,NA
"BirminghamB32PB,UK.",NA,NA
ISBN978-1-78588-054-,NA,NA
4 ,NA,NA
www.packtpub.com,NA,NA
Credits ,NA,NA
Author ,NA,NA
AntonioLopez ,NA,NA
Reviewer ,NA,NA
BradBonkoski ,NA,NA
CommissioningEditor ,NA,NA
KunalParikh ,NA,NA
AcquisitionEditors ,NA,NA
NikhilKarkal ,NA,NA
DivyaPoojari ,NA,NA
ContentDevelopmentEdito,NA,NA
r ,NA,NA
RohitKumarSingh ,NA,NA
TechnicalEditor ,NA,NA
TaabishKhan ,NA,NA
CopyEditors ,NA,NA
ShrutiIyer ,NA,NA
SoniaMathur ,NA,NA
ProjectCoordinator ,NA,NA
IzzatContractor ,NA,NA
Proofreader ,NA,NA
SafisEditing ,NA,NA
Indexer ,NA,NA
TejalDaruwaleSoni ,NA,NA
ProductionCoordinator ,NA,NA
MelwynD’sa ,NA,NA
CoverWork ,NA,NA
MelwynD’sa,NA,NA
AbouttheAuthor,NA,NA
AntonioLopez,NA,NA
isasoftwareengineerwithmorethan7yearsofexperience.Hehas ,NA,NA
"workedwithPHPsinceuniversity,whichwas10yearsago,buildingsmallpersonal ",NA,NA
"projects.Later,AntoniostartedhisjourneyaroundEurope,workinginBarcelona,London, ",NA,NA
"Dublin,andbackinBarcelona.Hehasworkedinanumberofdifferentareas,fromweb ",NA,NA
applicationstoRESTAPIsandinternaltools.Antoniolikestospendhissparetimeon ,NA,NA
personalprojectsandstart-upsandhasastrongvocationineducationandteaching.,NA,NA
"Iwouldliketogivethankstomywife,Neri,forsupportingmethroughthewholeprocess ",NA,NA
ofwritingthisbookwithoutgoingcrazy.,NA,NA
AbouttheReviewer,NA,NA
BradBonkoski,NA,NA
"hasbeendevelopingsoftwareforover15years,specializingininternal ",NA,NA
"operations,systems,tools,andautomation.Sometimes,thisroleislooselyreferredtoas ",NA,NA
DevOps.HeleansmoretowardtheDevsideofthismisunderstoodbuzzword.After ,NA,NA
buildinganincidentmanagementsystemandmanagingchangemanagementforYahoo,NA,NA
", Bradbecamemotivatedbymetricsandnowlivesbythemantrathatwhatdoesn’tget ",NA,NA
"measureddoesn’tgetfixed.Today,hegreasesthewheelsofproductivityforShazam.",NA,NA
www.PacktPub.com,NA,NA
"eBooks,discountoffers,andmore",NA,NA
"DidyouknowthatPacktofferseBookversionsofeverybookpublished,withPDFand ",NA,NA
ePubfilesavailable?YoucanupgradetotheeBookversionat,NA,NA
www.PacktPub.com,NA,NA
andas ,NA,NA
"aprintbookcustomer,youareentitledtoadiscountontheeBookcopy.Getintouchwith ",NA,NA
usat,"<
 customercare@packtpub.com
 >",NA
formoredetails.,NA,NA
At,NA,NA
www.PacktPub.com,NA,NA
",youcanalsoreadacollectionoffreetechnicalarticles,signup ",NA,NA
forarangeoffreenewslettersandreceiveexclusivediscountsandoffersonPacktbooks ,NA,NA
andeBooks.,NA,NA
https://www2.packtpub.com/books/subscription/packtlib,NA,NA
DoyouneedinstantsolutionstoyourITquestions?PacktLibisPackt’sonlinedigital ,NA,NA
"booklibrary.Here,youcansearch,access,andreadPackt’sentirelibraryofbooks.",NA,NA
Whysubscribe?,NA,NA
FullysearchableacrosseverybookpublishedbyPackt ,NA,NA
"Copyandpaste,print,andbookmarkcontent ",NA,NA
Ondemandandaccessibleviaawebbrowser,NA,NA
Preface,NA,NA
Thereisnoneedtostatehowmuchweightwebapplicationshaveinourlives.Weuseweb ,NA,NA
"applicationstoknowwhatourfriendsaredoing,togetthelatestnewsaboutpolitics,to ",NA,NA
"checktheresultsofourfavoritefootballteaminagame,orgraduatefromanonline ",NA,NA
"university.Andasyouareholdingthisbook,youalreadyknowthatbuildingthese ",NA,NA
"applicationsisnotajobthatonlyaselectedgroupofgeniusescanperform,andthatit’s ",NA,NA
rathertheopposite.,NA,NA
Thereisn’tonlyonewaytobuildwebapplications;thereareactuallyquitealotof ,NA,NA
"languagesandtechnologieswiththesolepurposeofdoingthis.However,ifthereisone ",NA,NA
"languagethatstandsoutfromtherest,eitherhistoricallyorbecauseitisextremelyeasyto ",NA,NA
"use,itisPHPandallthetoolsofitsecosystem.",NA,NA
"TheInternetisfullofresourcesthatdetailhowtousePHP,sowhybotherreadingthis ",NA,NA
book?That’seasy.WewillnotgiveyouthefulldocumentationofPHPastheofficial ,NA,NA
"websitedoes.OurgoalisnotthatyougetaPHPcertification,butrathertoteachyouwhat ",NA,NA
"youreallyneedinordertobuildwebapplicationsbyyourself.Fromtheverybeginning, ",NA,NA
"wewillusealltheinformationprovidedinordertobuildapplications,soyoucannote ",NA,NA
whyeachpieceofinformationisuseful.,NA,NA
"However,wewillnotstophere.Notonlywillweshowyouwhatthelanguageoffersyou, ",NA,NA
butalsowewilldiscussthebestapproachestowritingcode.Youwilllearnallthe ,NA,NA
"techniquesthatanywebdeveloperhastomaster,fromOOPanddesignpatternssuchas ",NA,NA
"MVC,totesting.YouwillevenworkwiththeexistingPHPframeworksthatbigandsmall ",NA,NA
companiesusefortheirownprojects.,NA,NA
"Inshort,youwillstartajourneyinwhichyouwilllearnhowtomasterwebdevelopment ",NA,NA
ratherthanhowtomasteraprogramminglanguage.Wehopeyouenjoyit.,NA,NA
Whatthisbookcovers,NA,NA
Chapter1,NA,NA
",",NA,NA
SettingUptheEnvironment,NA,NA
",willguideyouthroughtheinstallationofthe ",NA,NA
differentsoftwareneeded.,NA,NA
Chapter2,NA,NA
",",NA,NA
WebApplicationswithPHP,NA,NA
",willbeanintroductiontowhatwebapplications ",NA,NA
areandhowtheyworkinternally.,NA,NA
Chapter3,NA,NA
",",NA,NA
UnderstandingPHPBasics,NA,NA
",willgothroughthebasicelementsofthePHP ",NA,NA
language—fromvariablestocontrolstructures.,NA,NA
Chapter4,NA,NA
",",NA,NA
CreatingCleanCodewithOOP,NA,NA
",willdescribehowtodevelopwebapplications ",NA,NA
followingtheobject-orientedprogrammingparadigm.,NA,NA
Chapter5,NA,NA
",",NA,NA
UsingDatabases,NA,NA
",willexplainhowyoucanuseMySQLdatabasesinyour ",NA,NA
applications.,NA,NA
Chapter6,NA,NA
",",NA,NA
AdaptingtoMVC,NA,NA
",willshowhowtoapplythemostfamouswebdesignpattern, ",NA,NA
"MVC,toyourapplications.",NA,NA
Chapter7,NA,NA
",",NA,NA
TestingWebApplications,NA,NA
",willbeanextensiveintroductiontounittestingwith ",NA,NA
PHPUnit.,NA,NA
Chapter8,NA,NA
",",NA,NA
UsingExistingPHPFrameworks,NA,NA
",willintroduceyoutoexistingPHP ",NA,NA
"frameworksusedbyseveralcompaniesanddevelopers,suchasLaravelandSilex.",NA,NA
Chapter9,NA,NA
",",NA,NA
BuildingRESTAPIs,NA,NA
",willexplainwhatRESTAPIsare,howtousethird-party ",NA,NA
"ones,andhowtobuildyourown.",NA,NA
Chapter10,NA,NA
",",NA,NA
BehavioralTesting,NA,NA
",willintroducetheconceptsofcontinuousintegrationand ",NA,NA
behavioraltestingwithPHPandBehat.,NA,NA
Whatyouneedforthisbook,NA,NA
In,NA,NA
Chapter1,NA,NA
",",NA,NA
SettingUptheEnvironment,NA,NA
",wewillgothroughthedetailsofhowtoinstall ",NA,NA
PHPandtherestoftoolsthatyouneedinordertogothoughtheexamplesofthisbook.,NA,NA
"TheonlythingthatyouneedtostartreadingisacomputerwithWindows,OSX,or ",NA,NA
"Linux,andanInternetconnection.",NA,NA
Whothisbookisfor,NA,NA
ThisbookisforanyonewhowishestowritewebapplicationswithPHP.Youdonotneed ,NA,NA
"tobeacomputersciencegraduateinordertounderstandit.Infact,wewillassumethat ",NA,NA
"youhavenoknowledgeatallofsoftwaredevelopment,neitherwithPHPnorwithany ",NA,NA
otherlanguage.Wewillstartfromtheverybeginningsothateverybodycanfollowthe ,NA,NA
book.,NA,NA
Experiencedreaderscanstilltakeadvantageofthebook.Youcanquicklyreviewthefirst ,NA,NA
"chapterinordertodiscoverthenewfeaturesPHP7comeswith,andthenfocusonthe ",NA,NA
"chaptersthatmightinterestyou.Youdonotneedtoreadthebookfromstarttoend,but ",NA,NA
"insteadkeepitasaguide,inordertorefreshspecifictopicswhenevertheyareneeded.",NA,NA
Conventions,NA,NA
"Inthisbook,youwillfindanumberoftextstylesthatdistinguishbetweendifferentkinds ",NA,NA
ofinformation.Herearesomeexamplesofthesestylesandanexplanationoftheir ,NA,NA
meaning.,NA,NA
"Codewordsintext,databasetablenames,foldernames,filenames,fileextensions, ",NA,NA
"pathnames,dummyURLs,userinput,andTwitterhandlesareshownasfollows:“Now, ",NA,NA
createa,myactions.js,NA
filewiththefollowingcontent.”,NA,NA
Ablockofcodeissetasfollows:,"#special{ 
  
 font-size:30px; 
  
 }",NA
"Whenwewishtodrawyourattentiontoaparticularpartofacodeblock,therelevant ",NA,NA
linesoritemsaresetinbold:,"<head> 
  
 <metacharset=""UTF-8""> 
  
 <title>Yourfirstapp</title> 
  
 <linkrel=""stylesheet""type=""text/css""href=""mystyle.css""> 
 </head>",NA
Anycommand-lineinputoroutputiswrittenasfollows:,$sudoapt-getupdate,NA
Newterms,NA,NA
and,NA,NA
importantwords,NA,NA
"areshowninbold.Wordsthatyouseeonthescreen, ",NA,NA
"forexample,inmenusordialogboxes,appearinthetextlikethis:“Clickon",NA,NA
Next,NA,NA
until ,NA,NA
theendoftheinstallationwizard.”,NA,NA
Note,NA,NA
Warningsorimportantnotesappearinaboxlikethis.,NA,NA
Tip,NA,NA
Tipsandtricksappearlikethis.,NA,NA
Readerfeedback,NA,NA
Feedbackfromourreadersisalwayswelcome.Letusknowwhatyouthinkaboutthis ,NA,NA
book—whatyoulikedordisliked.Readerfeedbackisimportantforusasithelpsus ,NA,NA
developtitlesthatyouwillreallygetthemostoutof.,NA,NA
"Tosendusgeneralfeedback,simplye-mail","<
 feedback@packtpub.com
 >",NA
",andmentionthe ",NA,NA
book’stitleinthesubjectofyourmessage.,NA,NA
Ifthereisatopicthatyouhaveexpertiseinandyouareinterestedineitherwritingor ,NA,NA
"contributingtoabook,seeourauthorguideat",NA,NA
www.packtpub.com/authors,NA,NA
.,NA,NA
Customersupport ,NA,NA
"NowthatyouaretheproudownerofaPacktbook,wehaveanumberofthingstohelp ",NA,NA
youtogetthemostfromyourpurchase.,NA,NA
Downloadingtheexamplecode,NA,NA
Youcandownloadtheexamplecodefilesforthisbookfromyouraccountat ,NA,NA
http://www.packtpub.com,NA,NA
".Ifyoupurchasedthisbookelsewhere,youcanvisit ",NA,NA
http://www.packtpub.com/support,NA,NA
andregistertohavethefilese-,NA,NA
maileddirectlytoyou.,NA,NA
Youcandownloadthecodefilesbyfollowingthesesteps:,NA,NA
1. Loginorregistertoourwebsiteusingyoure-mailaddressandpassword. 2. ,NA,NA
Hoverthemousepointeronthe,NA,NA
SUPPORT,NA,NA
tabatthetop.,NA,NA
3. Clickon,NA,NA
CodeDownloads&Errata,NA,NA
.,NA,NA
4. Enterthenameofthebookinthe,NA,NA
Search,NA,NA
box.,NA,NA
5. Selectthebookforwhichyou’relookingtodownloadthecodefiles. 6. ,NA,NA
Choosefromthedrop-downmenuwhereyoupurchasedthisbookfrom. 7. ,NA,NA
Clickon,NA,NA
CodeDownload,NA,NA
.,NA,NA
"Oncethefileisdownloaded,pleasemakesurethatyouunziporextractthefolderusing ",NA,NA
thelatestversionof:,NA,NA
WinRAR/7-ZipforWindows ,NA,NA
Zipeg/iZip/UnRarXforMac,NA,NA
7-Zip/PeaZipforLinux,NA,NA
Errata,NA,NA
"Althoughwehavetakeneverycaretoensuretheaccuracyofourcontent,mistakesdo ",NA,NA
happen.Ifyoufindamistakeinoneofourbooks—maybeamistakeinthetextorthe code—,NA,NA
"wewouldbegratefulifyoucouldreportthistous.Bydoingso,youcansaveother ",NA,NA
readersfromfrustrationandhelpusimprovesubsequentversionsofthisbook.Ifyoufind ,NA,NA
"anyerrata,pleasereportthembyvisiting",NA,NA
http://www.packtpub.com/submit-errata,NA,NA
", ",NA,NA
"selectingyourbook,clickingonthe",NA,NA
ErrataSubmissionForm,NA,NA
"link,andenteringthe ",NA,NA
"detailsofyourerrata.Onceyourerrataareverified,yoursubmissionwillbeacceptedand ",NA,NA
theerratawillbeuploadedtoourwebsiteoraddedtoanylistofexistingerrataunderthe ,NA,NA
Erratasectionofthattitle.,NA,NA
"Toviewthepreviouslysubmittederrata,goto ",NA,NA
https://www.packtpub.com/books/content/support,NA,NA
andenterthenameofthebooki,NA,NA
nthe searchfield.Therequiredinformationwillappearunderthe,NA,NA
Errata,NA,NA
section.,NA,NA
Piracy,NA,NA
PiracyofcopyrightedmaterialontheInternetisanongoingproblemacrossallmedia.At ,NA,NA
"Packt,wetaketheprotectionofourcopyrightandlicensesveryseriously.Ifyoucome ",NA,NA
"acrossanyillegalcopiesofourworksinanyformontheInternet,pleaseprovideuswith ",NA,NA
thelocationaddressorwebsitenameimmediatelysothatwecanpursuearemedy.,NA,NA
Pleasecontactusat,"<
 copyright@packtpub.com
 >",NA
withalinktothesuspectedpirated ,NA,NA
material.,NA,NA
Weappreciateyourhelpinprotectingourauthorsandourabilitytobringyouvaluable ,NA,NA
content.,NA,NA
Questions ,NA,NA
"Ifyouhaveaproblemwithanyaspectofthisbook,youcancontactusat ","<
 questions@packtpub.com
 >",NA
",andwewilldoourbesttoaddresstheproblem.",NA,NA
Chapter1.SettingUptheEnvironment,NA,NA
"Youareabouttostartajourney—alongone,inwhichyouwilllearnhowtowriteweb ",NA,NA
"applicationswithPHP.However,first,youneedtosetupyourenvironment,something ",NA,NA
"thathasproventobetrickyattimes.ThistaskincludesinstallingPHP7,thelanguageof ",NA,NA
"choiceforthisbook;MySQL,thedatabasethatwewilluseinsomechapters;Nginx,the ",NA,NA
"webserverthatwillallowustovisualizeourapplicationswithabrowser;andComposer, ",NA,NA
thefavoritePHPdependenciesmanagementtool.WewilldoallofthiswithVagrantand ,NA,NA
"alsoonthreedifferentplatforms:Windows,OSX,andUbuntu.",NA,NA
"Inthischapter,youwilllearnabout:",NA,NA
UsingVagranttosetupadevelopmentenvironment ,NA,NA
Settingupyourenvironmentmanuallyonthemainplatforms,NA,NA
SettinguptheenvironmentwithVagrant,NA,NA
"Notsolongago,everytimeyoustartedworkingforanewcompany,youwouldspendan ",NA,NA
"importantpartofyourfirstfewdayssettingupyournewenvironment—thatis,installing ",NA,NA
allthenecessarytoolsonyournewcomputerinordertobeabletocode.Thiswas ,NA,NA
"incrediblyfrustratingbecauseeventhoughthesoftwaretoinstallwasthesame,therewas ",NA,NA
"alwayssomethingthatfailedorwasmissing,andyouwouldspendlesstimebeing ",NA,NA
productive.,NA,NA
IntroducingVagrant,NA,NA
"Luckilyforus,peopletriedtofixthisbigproblem.First,wehavevirtualmachines,which ",NA,NA
"areemulationsofcomputersinsideyourowncomputer.Withthis,wecanhaveLinux ",NA,NA
"insideourMacBook,whichallowsdeveloperstoshareenvironments.Itwasagoodstep, ",NA,NA
"butitstillhadsomeproblems;forexample,VMswerequitebigtomovebetween ",NA,NA
"differentenvironments,andifdeveloperswantedtomakeachange,theyhadtoapplythe ",NA,NA
samechangetoalltheexistingvirtualmachinesintheorganization.,NA,NA
"Aftersomedeliberation,agroupofengineerscameupwithasolutiontotheseissuesand ",NA,NA
wegot,NA,NA
Vagrant,NA,NA
.Thisamazingsoftwareallowsyoutomanagevirtualmachineswith ,NA,NA
simpleconfigurationfiles.Theideaissimple:aconfigurationfilespecifieswhichbase ,NA,NA
virtualmachineweneedtousefromasetofavailableonesonlineandhowyouwouldlike ,NA,NA
"tocustomizeit—thatis,whichcommandsyouwillwanttorunthefirsttimeyoustartthe ",NA,NA
machine—thisiscalled“provisioning”.YouwillprobablygettheVagrantconfiguration ,NA,NA
"fromapublicrepository,andifthisconfigurationeverchanges,youcangetthechanges ",NA,NA
"andreprovisionyourmachine.It’seasy,right?",NA,NA
InstallingVagrant,NA,NA
"IfyoustilldonothaveVagrant,installingitisquiteeasy.Youwillneedtovisitthe ",NA,NA
Vagrantdownloadpageat,NA,NA
https://www.vagrantup.com/downloads.html,NA,NA
andselectth,NA,NA
e ,NA,NA
"operatingsystemthatyouareworkingwith.Executetheinstaller,whichdoesnotrequire ",NA,NA
"anyextraconfiguration,andyouaregoodtogo.",NA,NA
UsingVagrant,NA,NA
UsingVagrantisquiteeasy.Themostimportantpieceisthe,Vagrantfile,NA
file.Thisfile ,NA,NA
containsthenameofthebaseimagewewanttouseandtherestoftheconfigurationthat ,NA,NA
wewanttoapply.Thefollowingcontentistheconfigurationneededinordertogetan ,NA,NA
"UbuntuVMwithPHP7,MySQL,Nginx,andComposer.Saveitas",Vagrantfile,NA
atthe ,NA,NA
rootofthedirectoryfortheexamplesofthisbook.,"VAGRANTFILE_API_VERSION=""2""
  
 Vagrant.configure(VAGRANTFILE_API_VERSION)do|config| 
 config.vm.box=""ubuntu/trusty32"" 
  
 config.vm.network""forwarded_port"",guest:80,host:8080 
 config.vm.provision""shell"",path:""provisioner.sh"" 
  
 end",NA
"Asyoucansee,thefileisquitesmall.Thebaseimage’snameis",ubuntu/trusty32,NA
", ",NA,NA
messagestoourport,8080,NA
willberedirectedtotheport,80,NA
"ofthevirtualmachine,andthe ",NA,NA
provisionwillbebasedonthe,provisioner.sh,NA
"script.Youwillneedtocreatethisfile, ",NA,NA
whichwillbetheonethatcontainsallthesetupofthedifferentcomponentsthatweneed.,NA,NA
Thisiswhatyouneedtoaddtothisfile:,"#!/bin/bash
  
 sudoapt-getinstallpython-software-properties-y 
  
 sudoLC_ALL=en_US.UTF-8add-apt-repositoryppa:ondrej/php-y sudoapt-getupdate 
  
 sudoapt-getinstallphp7.0php7.0-fpmphp7.0-mysql-y sudoapt-get--
 purgeautoremove-y 
  
 sudoservicephp7.0-fpmrestart
  
 sudodebconf-set-selections<<<'mysql-servermysql-server/root_password passwordroot' 
  
 sudodebconf-set-selections<<<'mysql-servermysql-
  
 server/root_password_againpasswordroot' 
  
 sudoapt-get-yinstallmysql-servermysql-client 
  
 sudoservicemysqlstart
  
 sudoapt-getinstallnginx-y 
  
 sudocat>/etc/nginx/sites-available/default<<-EOM server{ 
  
 listen80default_server; 
  
 listen[::]:80default_serveripv6only=on;
  
 root/vagrant; 
  
 indexindex.phpindex.htmlindex.htm;
  
 server_nameserver_domain_or_IP;
  
 location/{ 
  
 try_files\$uri\$uri//index.php?\$query_string; }",NA
"Thefilelooksquitelong,butwewilldoquitealotofstuffwithit.Withthefirstpartof ",NA,NA
"thefile,wewilladdthenecessaryrepositoriestobeabletofetchPHP7,asitdoesnot ",NA,NA
"comewiththeofficialones,andtheninstallit.Then,wewilltrytoinstallMySQL,server ",NA,NA
andclient.Wewillsettherootpasswordonthisprovisioningbecausewecannotintroduce ,NA,NA
"itmanuallywithVagrant.Asthisisadevelopmentmachine,itisnotreallyaproblem,but ",NA,NA
"youcanalwayschangethepasswordonceyouaredone.Finally,wewillinstalland ",NA,NA
configureNginxtolistentotheport,8080,NA
.,NA,NA
"Tostartthevirtualmachine,youneedtoexecutethefollowingcommandinthesame ",NA,NA
directorywhere,Vagrantfile,NA
is:,$vagrantup,NA
"Thefirsttimeyouexecuteit,itwilltakesometimeasitwillhavetodownloadtheimage ",NA,NA
"fromtherepository,andthenitwillexecutethe",provisioner.sh,NA
file.Theoutputshould ,NA,NA
besomethingsimilartothisonefollowedbysomemoreoutputmessages:,NA,NA
"InordertoaccessyournewVM,runthefollowingcommandonthesamedirectorywhere",NA,NA
youhaveyour,Vagrantfile,NA
file:,$vagrantssh,NA
"VagrantwillstartanSSHsessiontotheVM,whichmeansthatyouareinsidetheVM. ",NA,NA
"YoucandoanythingyouwoulddowiththecommandlineofanUbuntusystem.Toexit, ",NA,NA
justpress,NA,NA
Ctrl,NA,NA
+,NA,NA
D,NA,NA
.,NA,NA
SharingfilesfromyourlaptoptotheVMiseasy;justmoveorcopythemtothesame ,NA,NA
directorywhereyour,Vagrantfile,NA
"fileis,andtheywill“magically”appearonthe ",/vagrant,NA
"directoryofyourVM.Theywillbesynchronized,soanychangesthatyoumake ",NA,NA
whileinyourVMwillbereflectedonthefilesofyourlaptop.,NA,NA
"Onceyouhaveawebapplicationandyouwanttotestitthroughawebbrowser, ",NA,NA
rememberthatwewillforwardtheports.Thismeansthatinordertoaccesstheport,80,NA
of ,NA,NA
"yourVM,thecommononeforwebapplications,youwillhavetopointtotheport",8080,NA
on ,NA,NA
yourbrowsers;here’sanexample:,http://localhost:8080,NA
.,NA,NA
SettinguptheenvironmentonOSX,NA,NA
IfyouarenotconvincedwithVagrantandprefertouseaMactodevelopPHP ,NA,NA
"applications,thisisyoursection.InstallingallthenecessarytoolsonaMacmightbeabit ",NA,NA
"tricky,dependingontheversionofyourOSX.Atthetimeofwritingthisbook,Oracle ",NA,NA
hasnotreleasedaMySQLclientthatyoucanuseviathecommandlinethatworkswithEl ,NA,NA
"Capitan,sowewilldescribehowtoinstallanothertoolthatcandoasimilarjob.",NA,NA
InstallingPHP,NA,NA
"IfitisthefirsttimeyouareusingaMactodevelopapplicationsofanykind,youwill ",NA,NA
havetostartbyinstallingXcode.YoucanfindthisapplicationforfreeontheAppStore:,NA,NA
AnotherindispensabletoolforMacusersisBrew.ThisisthepackagemanagerforOSX ,NA,NA
"andwillhelpusinstallPHPwithalmostnopain.Toinstallit,runthefollowingcommand ",NA,NA
onyourcommandline:,"$ruby-e""$(curl-fsSL 
  
 https://raw.githubusercontent.com/Homebrew/install/master/install)""",NA
"IfyoualreadyhaveBrewinstalled,youcanmakesurethateverythingworksfineby ",NA,NA
runningthesetwocommands:,"$brewdoctor 
  
 $brewupdate",NA
"ItistimetoinstallPHP7usingBrew.Todoso,youwilljustneedtorunonecommand,as ",NA,NA
follows:,$brewinstallhomebrew/php/php70,NA
Theresultshouldbeasshowninthefollowingscreenshot:,NA,NA
Makesuretoaddthebinarytoyour,PATH,NA
environmentvariablebyexecutingthis,NA,NA
command:,"$exportPATH=""$(brew--prefixhomebrew/php/php70)/bin:$PATH""",NA
YoucancheckwhetheryourinstallationwassuccessfulbyaskingwhichversionofPHP,NA,NA
yoursystemisusingwiththe,$php–v,NA
command.,NA,NA
InstallingMySQL,NA,NA
"Aspointedoutatthebeginningofthissection,MySQLisatrickyoneforMacusers.You ",NA,NA
needtodownloadtheMySQLserverinstallerandMySQLWorkbenchastheclient.The ,NA,NA
MySQLserverinstallercanbefoundat,NA,NA
https://dev.mysql.com/downloads/mysql/,NA,NA
.You ,NA,NA
"shouldfindalistofdifferentoptions,asshownhere:",NA,NA
Theeasiestwaytogoistodownload,NA,NA
DMGArchive,NA,NA
.Youwillbeaskedtologinwith ,NA,NA
"yourOracleaccount;youcancreateoneifyoudonothaveany.Afterthis,thedownload ",NA,NA
"willstart.AswithanyDMGpackage,justdouble-clickonitandgothroughtheoptions—",NA,NA
"inthiscase,justclickon",NA,NA
Next,NA,NA
"allthetime.Becarefulbecauseattheendoftheprocess, ",NA,NA
youwillbepromptedwithamessagesimilartothis:,NA,NA
"Makeanoteofit;otherwise,youwillhavetoresettherootpassword.Thenextoneis ",NA,NA
"MySQLWorkbench,whichyoucanfindat",NA,NA
http://www.mysql.com/products/workbenc,NA,NA
h/,NA,NA
". Theprocessisthesame;youwillbeaskedtologin,andthenyouwillgetaDMGfile.",NA,NA
Clickon,NA,NA
Next,NA,NA
"untiltheendoftheinstallationwizard.Oncedone,youcanlaunchthe ",NA,NA
application;itshouldlooksimilartothis:,NA,NA
InstallingNginx,NA,NA
"InordertoinstallNginx,wewilluseBrew,aswedidwithPHP.Thecommandisthe ",NA,NA
following:,$brewinstallnginx,NA
"IfyouwanttomakeNginxstarteverytimeyoustartyourlaptop,runthefollowing ",NA,NA
command:,$ln-sfv/usr/local/opt/nginx/*.plist~/Library/LaunchAgents,NA
"IfyouhavetochangetheconfigurationofNginx,youwillfindthefilein ",/usr/local/etc/nginx/nginx.conf,NA
".Youcanchangethings,suchastheportthatNginx ",NA,NA
islisteningtoortherootdirectorywhereyourcodeis(thedefaultdirectoryis ,/usr/local/Cellar/nginx/1.8.1/html/,NA
).RemembertorestartNginxtoapplythe ,NA,NA
changeswiththe,sudonginx,NA
command.,NA,NA
InstallingComposer ,NA,NA
InstallingComposerisaseasyasdownloadingitwiththe,curl,NA
command;movethe ,NA,NA
binaryto,/usr/local/bin/,NA
withthefollowingtwocommands:,"$curl-sShttps://getcomposer.org/installer|php 
 $mvcomposer.phar/usr/local/bin/composer",NA
SettinguptheenvironmentonWindows,NA,NA
"Eventhoughitisnotveryprofessionaltopicksidesbasedonpersonalopinions,itiswell ",NA,NA
knownamongdevelopershowharditcanbetouseWindowsasadevelopermachine.,NA,NA
Theyprovetobeextremelytrickywhenitcomestoinstallingallthesoftwaresincethe ,NA,NA
"installationmodeisalwaysverydifferentfromOSXandLinuxsystems,andquiteoften, ",NA,NA
"therearedependencyorconfigurationproblems.Inaddition,thecommandlinehas ",NA,NA
"differentinterpretersthanUnixsystems,whichmakesthingsabitmoreconfusing.Thisis ",NA,NA
whymostdeveloperswouldrecommendyouuseavirtualmachinewithLinuxifyouonly ,NA,NA
haveaWindowsmachineatyourdisposal.,NA,NA
"However,tobefair,PHP7istheexceptiontotherule.Itissurprisinglysimpletoinstallit, ",NA,NA
"soifyouarereallycomfortablewithyourWindowsandwouldprefernottouseVagrant, ",NA,NA
hereyouhaveashortexplanationonhowtosetupyourenvironment.,NA,NA
InstallingPHP,NA,NA
"InordertoinstallPHP7,youwillfirstdownloadtheinstallerfromtheofficialwebsite. ",NA,NA
"Forthis,goto",NA,NA
http://windows.php.net/download,NA,NA
.Theoptionsshouldbesimilartothe ,NA,NA
followingscreenshot:,NA,NA
Choose,NA,NA
x86ThreadSafe,NA,NA
forWindows32-bitor,NA,NA
x64ThreadSafe,NA,NA
forthe64-bitone. ,NA,NA
"Oncedownloaded,uncompressitin",C:\php7,NA
".Yes,thatisit!",NA,NA
InstallingMySQL,NA,NA
InstallingMySQLisalittlemorecomplex.Downloadtheinstallerfrom ,NA,NA
http://dev.mysql.com/downloads/installer/,NA,NA
andexecuteit.Afteracceptingthelic,NA,NA
"ense agreement,youwillgetawindowsimilartothefollowingone:",NA,NA
Forthepurposesofthebook—andactuallyforanydevelopmentenvironment—you ,NA,NA
shouldgoforthefirstoption:,NA,NA
DeveloperDefault,NA,NA
".Keepgoingforward,leavingallthe ",NA,NA
"defaultoptions,untilyougetawindowsimilartothis:",NA,NA
"Dependingonyourpreferences,youcaneitherjustsetapasswordfortherootuser,which ",NA,NA
"isenoughasitisonlyadevelopmentmachine,oryoucanaddanextrauserbyclickingon ",NA,NA
AddUser,NA,NA
".Makesuretosetthecorrectname,password,andpermissions.Ausernamed ",test,NA
withadministrationpermissionsshouldlooksimilartothefollowingscreenshot:,NA,NA
"Fortherestoftheinstallationprocess,youcanselectallthedefaultoptions.",NA,NA
InstallingNginx,NA,NA
"TheinstallationforNginxisalmostidenticaltothePHP7one.First,downloadtheZIP ",NA,NA
filefrom,NA,NA
http://nginx.org/en/download.html,NA,NA
".Atthetimeofwriting,theversionsavaila",NA,NA
ble areasfollows:,NA,NA
Youcansafelydownloadthemainlineversion1.9.10oralateroneifitisstable.Oncethe ,NA,NA
"fileisdownloaded,uncompressitin",C:\nginx,NA
andrunthefollowingcommandstostart ,NA,NA
thewebserver:,"$cdnginx 
  
 $startnginx",NA
InstallingComposer,NA,NA
"Tofinishwiththesetup,weneedtoinstallComposer.Togofortheautomaticinstallation, ",NA,NA
justdownloadtheinstallerfrom,NA,NA
https://getcomposer.org/Composer-Setup.exe,NA,NA
.Once ,NA,NA
"downloaded,executeitinordertoinstallComposeronyoursystemandtoupdateyour ",PATH,NA
environmentvariable.,NA,NA
SettinguptheenvironmentonUbuntu,NA,NA
"SettingupyourenvironmentonUbuntuistheeasiestofthethreeplatforms.Infact,you ",NA,NA
couldtakethe,provisioner.sh,NA
scriptfromthe,NA,NA
SettinguptheenvironmentwithVagrant ,NA,NA
"sectionandexecuteitonyourlaptop.Thatshoulddothetrick.However,justincaseyou ",NA,NA
alreadyhavesomeofthetoolsinstalledoryouwanttohaveasenseofcontrolonwhatis ,NA,NA
"goingon,wewilldetaileachstep.",NA,NA
InstallingPHP,NA,NA
TheonlythingtoconsiderinthissectionistoremoveanypreviousPHPversionsonyour ,NA,NA
"system.Todoso,youcanrunthefollowingcommand:",$sudoapt-get-ypurgephp.*,NA
ThenextstepistoaddthenecessaryrepositoriesinordertofetchthecorrectPHPversion. ,NA,NA
Thecommandstoaddandupdatethemare:,"$sudoapt-getinstallpython-software-properties 
  
 $sudoLC_ALL=en_US.UTF-8add-apt-repositoryppa:ondrej/php-y $sudoapt-
 getupdate",NA
"Finally,weneedtoinstallPHP7togetherwiththedriverforMySQL.Forthis,just ",NA,NA
executethefollowingthreecommands:,"$sudoapt-getinstallphp7.0php7.0-fpmphp7.0-mysql-y $sudoapt-get--
 purgeautoremove-y 
  
 $sudoservicephp7.0-fpmstart",NA
InstallingMySQL,NA,NA
InstallingMySQLmanuallycanbeslightlydifferentthanwiththeVagrantscript.Aswe ,NA,NA
"caninteractwiththeconsole,wedonothavetospecifytherootpasswordpreviously; ",NA,NA
"instead,wecanforceMySQLtopromptforit.Runthefollowingcommandandkeepin ",NA,NA
mindthattheinstallerwillaskyouforthepassword:,$sudoapt-get-yinstallmysql-servermysql-client,NA
"Oncedone,ifyouneedtostarttheMySQLserver,youcandoitwiththefollowing ",NA,NA
command:,$sudoservicemysqlstart,NA
InstallingNginx,NA,NA
Thefirstthingthatyouneedtoknowisthatyoucanonlyhaveonewebserverlisteningon ,NA,NA
thesameport.Asport,80,NA
"isthedefaultoneforwebapplications,ifyouarerunning ",NA,NA
"ApacheonyourUbuntumachine,youwillnotbeabletostartanNginxwebserver ",NA,NA
listeningonthesameport,80,NA
".Tofixthis,youcaneitherchangetheportsforNginxor ",NA,NA
"Apache,stopApache,oruninstallit.Eitherway,theinstallationcommandforNginxisas ",NA,NA
follows:,$sudoapt-getinstallnginx–y,NA
"Now,youwillneedtoenableasitewithNginx.Thesitesarefilesunder ",/etc/nginx/sites-available,NA
".Thereisalreadyonefilethere,",default,NA
",whichyoucan ",NA,NA
safelyreplacewiththefollowingcontent:,"server{ 
  
 listen80default_server; 
  
 listen[::]:80default_serveripv6only=on;
  
 root/var/www/html; 
  
 indexindex.phpindex.htmlindex.htm;
  
 server_nameserver_domain_or_IP;
  
 location/{ 
  
 try_files$uri$uri//index.php?$query_string; }
  
 location~\.php${ 
  
 try_files$uri/index.php=404; 
  
 fastcgi_split_path_info^(.+\.php)(/.+)$; 
  
 fastcgi_passunix:/var/run/php/php7.0-fpm.sock; 
  
 fastcgi_indexindex.php; 
  
 fastcgi_paramSCRIPT_FILENAME$document_root$fastcgi_script_name; includefastcgi_params; 
  
 } 
  
 }",NA
Thisconfigurationbasicallypointstherootdirectoryofyourwebapplicationtothe ,/var/www/html,NA
"directory.Youcanchoosetheonethatyouprefer,butmakesurethatithas ",NA,NA
therightpermissions.Italsolistensontheport,80,NA
",whichyoucanchangewiththeoneyou ",NA,NA
prefer;justkeepthisinmindthatwhenyoutrytoaccessyourapplicationviaabrowser.,NA,NA
"Finally,toapplyallthechanges,runthefollowingcommand:",$sudoservicenginxrestart,NA
Tip,NA,NA
Downloadingtheexamplecode,NA,NA
Youcandownloadtheexamplecodefilesforthisbookfromyouraccountat ,NA,NA
http://www.packtpub.com,NA,NA
".Ifyoupurchasedthisbookelsewhere,youcanvisit ",NA,NA
http://www.packtpub.com/support,NA,NA
andregistertohavethefilese-,NA,NA
maileddirectlytoyou.,NA,NA
Youcandownloadthecodefilesbyfollowingthesesteps:,NA,NA
Loginorregistertoourwebsiteusingyoure-mailaddressandpassword. ,NA,NA
Hoverthemousepointeronthe,NA,NA
SUPPORT,NA,NA
tabatthetop.,NA,NA
Clickon,NA,NA
CodeDownloads&Errata,NA,NA
.,NA,NA
Enterthenameofthebookinthe,NA,NA
Search,NA,NA
box.,NA,NA
Selectthebookforwhichyou’relookingtodownloadthecodefiles. ,NA,NA
Choosefromthedrop-downmenuwhereyoupurchasedthisbookfrom. ,NA,NA
Clickon,NA,NA
CodeDownload,NA,NA
.,NA,NA
"Oncethefileisdownloaded,pleasemakesurethatyouunziporextractthefolderusing ",NA,NA
thelatestversionof:,NA,NA
WinRAR/7-ZipforWindows ,NA,NA
Zipeg/iZip/UnRarXforMac ,NA,NA
7-Zip/PeaZipforLinux,NA,NA
Summary,NA,NA
"Inthischapter,youlearnedhoweasyitistosetupadevelopmentenvironmentusing ",NA,NA
"Vagrant.Ifthisdidnotconvinceyou,youstillgotthechancetosetupallthetools ",NA,NA
"manually.Eitherway,nowyouareabletoworkonthenextchapters.",NA,NA
"Inthenextchapter,wewilltakealookattheideaofwebapplicationswithPHP,going ",NA,NA
"fromtheprotocolsusedtohowthewebserverservesrequests,thussettingthefoundation ",NA,NA
forthefollowingchapters.,NA,NA
Chapter2.WebApplicationswithPHP,NA,NA
"Webapplicationsareacommonthinginourlives,andtheyareusuallyveryuserfriendly; ",NA,NA
"usersdonotneedtounderstandhowtheyworkbehindthescenes.Asadeveloper,though, ",NA,NA
youneedtounderstandhowyourapplicationworksinternally.,NA,NA
"Inthischapter,youwilllearnabout:",NA,NA
HTTPandhowwebapplicationsmakeuseofit ,NA,NA
Webapplicationsandhowtobuildasimpleone ,NA,NA
WebserversandhowtolaunchyourPHPbuilt-inwebserver,NA,NA
TheHTTPprotocol,NA,NA
IfyouchecktheRFC2068standardat,NA,NA
https://tools.ietf.org/html/rfc2068,NA,NA
",youwillseeth",NA,NA
"at itsdescriptionisalmostendless.Luckily,whatyouneedtoknowaboutthisprotocol,at ",NA,NA
"leastforstarters,iswayshorter.",NA,NA
HTTP,NA,NA
standsfor,NA,NA
HyperTextTransferProtocol,NA,NA
".Asanyotherprotocol,thegoalisto ",NA,NA
"allowtwoentitiesornodestocommunicatewitheachother.Inordertoachievethis,the ",NA,NA
"messagesneedtobeformattedinawaythattheybothunderstand,andtheentitiesmust ",NA,NA
followsomepre-establishedrules.,NA,NA
Asimpleexample,NA,NA
Thefollowingdiagramshowsaverybasicinterchangeofmessages:,NA,NA
AsimpleGETrequest,NA,NA
Donotworryifyoudonotunderstandalltheelementsinthisdiagram;wewilldescribe ,NA,NA
"themshortly.Inthisrepresentation,therearetwoentities:",NA,NA
sender,NA,NA
and,NA,NA
receiver,NA,NA
.The ,NA,NA
"sendersendsamessagetothereceiver.Thismessage,whichstartsthecommunication,is ",NA,NA
"calledtherequest.Inthiscase,themessageisaGETrequest.Thereceiverreceivesthe ",NA,NA
"message,processesit,andgeneratesasecondmessage:theresponse.Inthiscase,the ",NA,NA
"responseshowsa200statuscode,meaningthattherequestwasprocessedsuccessfully.",NA,NA
"HTTPisstateless;thatis,ittreatseachrequestindependently,unrelatedtoanyprevious ",NA,NA
"one.Thismeansthatwiththisrequestandresponsesequence,thecommunicationis ",NA,NA
finished.Anynewrequestswillnotbeawareofthisspecificinterchangeofmessages.,NA,NA
Partsofthemessage,NA,NA
AnHTTPmessagecontainsseveralparts.Wewilldefineonlythemostimportantofthem.,NA,NA
URL,NA,NA
TheURLofthemessageisthedestinationofthemessage.Therequestwillcontainthe ,NA,NA
"receiver’sURL,andtheresponsewillcontainthesender’s.",NA,NA
"Asyoumightknow,theURLcancontainextraparameters,knownasaquerystring.This ",NA,NA
"isusedwhenthesenderwantstoaddextradata.Forexample,considerthisURL: ",http://myserver.com/greeting?name=Alex,NA
.ThisURLcontainsoneparameter:,name,NA
withthevalue,Alex,NA
.ItcouldnotberepresentedaspartoftheURL ,http://myserver.com/greeting,NA
",sothesenderchosetoadditattheendofit.Youwill ",NA,NA
seelaterthatthisisnottheonlywaythatwecanaddextrainformationintoamessage.,NA,NA
TheHTTPmethod,NA,NA
TheHTTPmethodistheverbofthemessage.Itidentifieswhatkindofactionthesender ,NA,NA
wantstoperformwiththismessage.ThemostcommononesareGETandPOST.,NA,NA
GET,NA,NA
":Thisasksthereceiveraboutsomething,andthereceiverusuallysendsthis ",NA,NA
"informationback.Themostcommonexampleisaskingforawebpage,wherethe ",NA,NA
receiverwillrespondwiththeHTMLcodeoftherequestedpage.,NA,NA
POST,NA,NA
:Thismeansthatthesenderwantstoperformanactionthatwillupdatethe ,NA,NA
"datathatthereceiverisholding.Forexample,thesendercanaskthereceiverto ",NA,NA
updatehisprofilename.,NA,NA
"Thereareothermethods,suchas",NA,NA
PUT,NA,NA
",",NA,NA
DELETE,NA,NA
",or",NA,NA
OPTION,NA,NA
",buttheyarelessusedin ",NA,NA
"webdevelopment,althoughtheyplayacrucialroleinRESTAPIs,whichwillbe ",NA,NA
explainedin,NA,NA
Chapter9,NA,NA
",",NA,NA
BuildingRESTAPIs,NA,NA
.,NA,NA
Body,NA,NA
Thebodypartisusuallypresentinresponsemessageseventhougharequestmessagecan ,NA,NA
containittoo.Thebodyofthemessagecontainsthecontentofthemessageitself;for ,NA,NA
"example,iftheuserrequestedawebpage,thebodyoftheresponsewouldconsistofthe ",NA,NA
HTMLcodethatrepresentsthispage.,NA,NA
"Soon,wewilldiscusshowtherequestcanalsocontainabody,whichisusedtosendextra ",NA,NA
"informationaspartoftherequest,suchasformparameters.",NA,NA
Thebodycancontaintextinanyformat;itcanbeanHTMLtextthatrepresentsaweb ,NA,NA
"page,plaintext,thecontentofanimage,JSON,andsoon.",NA,NA
Headers,NA,NA
TheheadersonanHTTPmessagearethemetadatathatthereceiverneedsinorderto ,NA,NA
"understandthecontentofthemessage.Therearealotofheaders,andyouwillseesome ",NA,NA
oftheminthisbook.,NA,NA
Headersconsistofamapofkey-valuepairs.Thefollowingcouldbetheheadersofa,NA,NA
request:,"Accept:text/html 
  
 Cookie:name=Richard",NA
"Thisrequesttellsthereceiver,whichisaserver,thatitwillaccepttextasHTML,whichis ",NA,NA
thecommonwayofrepresentingawebpage;andthatithasacookienamedRichard.,NA,NA
Thestatuscode,NA,NA
Thestatuscodeispresentinresponses.Itidentifiesthestatusoftherequestwitha ,NA,NA
"numericcodesothatbrowsersandothertoolsknowhowtoreact.Forexample,ifwetry ",NA,NA
"toaccessaURLthatdoesnotexist,theservershouldreplywithastatuscode404.Inthis ",NA,NA
"way,thebrowserknowswhathappenedwithoutevenlookingatthecontentofthe ",NA,NA
response.,NA,NA
Commonstatuscodesare:,NA,NA
200,NA,NA
:Therequestwassuccessful ,NA,NA
401,NA,NA
:Unauthorized;theuserdoesnothavepermissiontoseethisresource ,NA,NA
404,NA,NA
:Pagenotfound ,NA,NA
500,NA,NA
:Internalservererror;somethingwronghappenedontheserversideanditcould ,NA,NA
notberecovered,NA,NA
Amorecomplexexample,NA,NA
ThefollowingdiagramshowsaPOSTrequestanditsresponse:,NA,NA
AmorecomplexPOSTrequest,NA,NA
"Inthisexchangeofmessages,wecanseetheotherimportantmethod,POST,inaction.In ",NA,NA
"thiscase,thesendertriestosendarequestinordertoupdatesomeentity’sdata.The ",NA,NA
messagecontainsacookieIDwiththevalue,NA,NA
84,NA,NA
",whichmayidentifytheentitytoupdate. ",NA,NA
Italsocontainstwoparametersinthebody:,name,NA
and,age,NA
.Thisisthedatathatthereceiver ,NA,NA
hastoupdate.,NA,NA
Tip,NA,NA
Submittingwebforms,NA,NA
Representingtheparametersaspartofthebodyisacommonwaytosendinformation ,NA,NA
"whensubmittingaform,butnottheonlyone.YoucanaddaquerystringtotheURL,add ",NA,NA
"JSONtothebodyofthemessage,andsoon.",NA,NA
"Theresponsehasastatuscodeof200,meaningthattherequestwasprocessed ",NA,NA
"successfully.Inaddition,theresponsealsocontainsabody,thistimeformattedasJSON, ",NA,NA
whichrepresentsthenewstatusoftheupdatedentity.,NA,NA
Webapplications,NA,NA
"Maybeyouhavenoticedthatintheprevioussections,Iusedthenotveryintuitivetermsof ",NA,NA
senderandreceiverastheydonotrepresentanyspecificscenariothatyoumightknowbut ,NA,NA
ratheralloftheminagenericway.Themainreasonforthischoiceofterminologyistotry ,NA,NA
toseparateHTTPfromwebapplications.YouwillseeattheendofthebookthatHTTPis ,NA,NA
usedformorethanjustwebsites.,NA,NA
"Ifyouarereadingthisbook,youalreadyknowwhatawebapplicationis.Alternatively, ",NA,NA
"maybeyouknowitbyotherterms,suchaswebsiteorwebpage.Let’strytogivesome ",NA,NA
definitions.,NA,NA
A,NA,NA
webpage,NA,NA
isasingledocumentwithcontent.Itcontainslinksthatopenotherwebpages ,NA,NA
withdifferentcontent.,NA,NA
A,NA,NA
website,NA,NA
isthesetofwebpagesthatusuallyliveinthesameserverandarerelatedto ,NA,NA
eachother.,NA,NA
A,NA,NA
webapplication,NA,NA
"isjustapieceofsoftwarethatrunsonaclient,whichisusuallya ",NA,NA
"browser,andcommunicateswitha",NA,NA
server,NA,NA
.Aserverisaremotemachinethatreceives ,NA,NA
"requestsfromaclient,processesthem,andgeneratesaresponse.Thisresponsewillgo ",NA,NA
"backtotheclient,generallyrenderedbythebrowserinordertodisplayittotheuser.",NA,NA
"Eventhoughthisisoutofthescopeofthisbook,youmaybeinterestedtoknowthatnot ",NA,NA
"onlybrowserscanactasclients,generatingrequestsandsendingthemtotheservers;even ",NA,NA
serverscanbetheonestakingtheinitiativeofsendingmessagestothebrowsers.,NA,NA
"So,whatisthedifferencebetweenawebsiteandawebapplication?Well,theweb ",NA,NA
"applicationcanbeasmallpartofabiggerwebsitewithaspecificfunctionality.Also,not ",NA,NA
allwebsitesarewebapplicationsasawebapplicationalwaysdoessomethingbuta ,NA,NA
websitecanjustdisplayinformation.,NA,NA
"HTML,CSS,andJavaScript",NA,NA
Webapplicationsarerenderedbythebrowsersothattheusercanseeitscontent.Todo ,NA,NA
"this,theserverneedstosendthecontentofthepageordocument.Thedocumentuses ",NA,NA
"HTMLtodescribeitselementsandhowtheyareorganized.Elementscanbelinks, ",NA,NA
"buttons,inputfields,andsoon.Asimpleexampleofawebpagelookslikethis:","<!DOCTYPEhtml> 
  
 <htmllang=""en""> 
  
 <head> 
  
 <metacharset=""UTF-8""> 
  
 <title>Yourfirstapp</title> 
  
 </head> 
  
 <body> 
  
 <aid=""special""class=""link""href=""http://yourpage.com"">Yourpage</a> 
 <aclass=""link""href=""http://theirpage.com"">Theirpage</a> 
  
 </body> 
  
 </html>",NA
"Let’sfocusonthehighlightedcode.Asyoucansee,wearedescribingtwo",<a>,NA
linkswith ,NA,NA
"someproperties.Bothlinkshaveaclass,adestination,andatext.Thefirstonealso ",NA,NA
containsanID.Savethiscodeintoafilenamed,index.html,NA
andexecuteit.Youwillsee ,NA,NA
howyourdefaultbrowseropensaverysimplepagewithtwolinks.,NA,NA
"Ifwewanttoaddsomestyles,orchangethecolor,size,andpositionofthelinks,weneed ",NA,NA
toaddCSS.CSSdescribeshowelementsfromtheHTMLaredisplayed.Thereareseveral ,NA,NA
"waystoincludeCSS,butthebestapproachistohaveitinaseparatedfileandthen ",NA,NA
referenceitfromtheHTML.Let’supdateour,<head>,NA
sectionasshowninthefollowing code:,"<head> 
  
 <metacharset=""UTF-8""> 
  
 <title>Yourfirstapp</title> 
  
 <linkrel=""stylesheet""type=""text/css""href=""mystyle.css""> 
 </head>",NA
"Now,let’screateanew",mystyle.css,NA
fileinthesamefolderwiththefollowingcontent:,".link{ 
  
 color:green; 
  
 font-weight:bold; 
  
 }
  
 #special{ 
  
 font-size:30px; 
  
 }",NA
ThisCSSfilecontainstwostyledefinitions:oneforthe,link,NA
classandoneforthe ,special,NA
"ID.Theclassstylewillbeappliedtoboththelinksastheybothdefinethisclass, ",NA,NA
anditsetsthemasgreenandbold.TheIDstylethatincreasesthefontofthelinkisonly ,NA,NA
appliedtothefirstlink.,NA,NA
"Finally,inordertoaddbehaviortoourwebpage,weneedtoaddJSorJavaScript.JSisa",NA,NA
"programminglanguagethatwouldneedanentirebookforitself,andinfact,thereare ",NA,NA
"quitealotofthem.Ifyouwanttogiveitachance,werecommendthefreeonlinebook ",NA,NA
EloquentJavaScript,NA,NA
",",NA,NA
MarijnHaverbeke,NA,NA
",whichyoucanfindat ",NA,NA
http://eloquentjavascript.net/,NA,NA
".AswithCSS,thebestapproachwouldbetoaddaseparat",NA,NA
e fileandthenreferenceitfromourHTML.Updatethe,<body>,NA
sectionwiththefollowing ,NA,NA
highlightedcode:,"<body> 
  
 <aid=""special""class=""link""href=""http://yourpage.com"">Yourpage</a> 
 <aclass=""link""href=""http://theirpage.com"">Theirpage</a> 
  
 <scriptsrc=""myactions.js""></script> 
  
 </body>",NA
"Now,createa",myactions.js,NA
filewiththefollowingcontent:,"document.getElementById(""special"").onclick=function(){ 
 alert(""Youclickedme?""); 
  
 }",NA
TheJSfileaddsafunctionthatwillbecalledwhenthe,special,NA
linkisclickedon.This ,NA,NA
functionjustpopsupanalert.Youcansaveallyourchangesandrefreshthebrowserto ,NA,NA
seehowitlooksnowandhowthelinksbehave.,NA,NA
Note,NA,NA
DifferentwaysofincludingJS,NA,NA
YoumightnoticethatweincludedtheCSSfilereferenceattheendofthe,<head>,NA
section ,NA,NA
andJSattheendof,<body>,NA
.YoucanactuallyincludeJSinboththe,<head>,NA
andthe ,<body>,NA
;justbearinmindthatthescriptwillbeexecutedassoonasitisincluded.Ifyour ,NA,NA
"scriptreferencesfieldsthatarenotyetdefinedorotherJSfilesthatwillbeincludedlater, ",NA,NA
JSwillfail.,NA,NA
"Congratulations!Youjustwroteyourveryfirstwebpage.Notimpressed?Well,thenyou ",NA,NA
"arereadingthecorrectbook!YouwillhavethechancetoworkwithmoreHTML,CSS, ",NA,NA
"andJSduringthebook,eventhoughthebookfocusesespeciallyonPHP.",NA,NA
Webservers,NA,NA
"So,itisabouttimethatyoulearnwhatthosefamouswebserversare.Awebserverisno ",NA,NA
morethanapieceofsoftwarerunningonamachineandlisteningtorequestsfroma ,NA,NA
"specificport.Usually,thisportis",80,NA
",butitcanbeanyotherthatisavailable.",NA,NA
Howtheywork,NA,NA
Thefollowingdiagramrepresentstheflowofrequest-responseontheserverside:,NA,NA
Request-responseflowontheserverside,NA,NA
Thejobofawebserveristorouteexternalrequeststothecorrectapplicationsothatthey ,NA,NA
"canbeprocessed.Oncetheapplicationreturnsaresponse,thewebserverwillsendthis ",NA,NA
responsetotheclient.Let’stakeacloselookatallthesteps:,NA,NA
"1. Theclient,whichisabrowser,sendsarequest.Thiscanbeofanytype—GETor ",NA,NA
POST—andcontainanythingaslongasitisvalid.,NA,NA
"2. Theserverreceivestherequest,whichpointstoaport.Ifthereisawebserver ",NA,NA
"listeningonthisport,thewebserverwillthentakecontrolofthesituation.",NA,NA
3. Thewebserverdecideswhichwebapplication—usuallyafileinthefilesystem—,NA,NA
"needstoprocesstherequest.Inordertodecide,thewebserverusuallyconsidersthe ",NA,NA
"pathoftheURL;forexample,",http://myserver.com/app1/hi,NA
wouldtrytopassthe ,NA,NA
requesttothe,app1,NA
"application,whereveritisinthefilesystem.However,another ",NA,NA
scenariowouldbe,http://app1.myserver.com/hi,NA
",whichwouldalsogotothesame ",NA,NA
"application.Therulesareveryflexible,anditisuptoboththewebserverandthe ",NA,NA
userastohowtosetthem.,NA,NA
"4. Thewebapplication,afterreceivingarequestfromthewebserver,generatesa ",NA,NA
responseandsendsittothewebserver.,NA,NA
5. Thewebserversendstheresponsetotheindicatedport.,NA,NA
6. Theresponsefinallyarrivestotheclient.,NA,NA
ThePHPbuilt-inserver,NA,NA
"Therearepowerfulwebserversthatsupporthighloadsoftraffic,suchasApacheor ",NA,NA
"Nginx,whicharefairlysimpletoinstallandmanage.Forthepurposeofthisbook,though, ",NA,NA
wewillusesomethingevensimpler:aPHPbuilt-inserver.Thereasontousethisisthat ,NA,NA
"youwillnotneedextrapackageinstallations,configurations,andheadachesasitcomes ",NA,NA
"withPHP.Withjustonecommand,youwillhaveawebserverrunningonyourmachine.",NA,NA
Note,NA,NA
Productionwebservers,NA,NA
"NotethatthePHPbuilt-inwebserverisgoodfortestingpurposes,butitishighly ",NA,NA
recommendednottouseitinproductionenvironments.Ifyouhavetosetupaserverthat ,NA,NA
"needstobepublicandyourapplicationiswritteninPHP,Ihighlyrecommendyouto ",NA,NA
chooseeitheroftheclassics:Apache(,NA,NA
http://httpd.apache.org,NA,NA
)orNginx ,NA,NA
(,NA,NA
https://www.nginx.com,NA,NA
").Bothcanrunalmostonanyserver,arefreeandeasytoinstall ",NA,NA
"andconfigure,and,moreimportantly,haveahugecommunitythatwillsupportyouon ",NA,NA
virtuallyanyproblemyoumightencounter.,NA,NA
"Finally,handson!Let’strytocreateourveryfirstwebpageusingthebuilt-inserver.For ",NA,NA
"this,createan",index.php,NA
fileinsideyour,workspace,NA
"directory—forexample, ",Documents/workspace/index.php,NA
.Thecontentofthisfileshouldbe:,"<?php 
  
 echo'helloworld';",NA
"Now,openyourcommandline,gotoyour",workspace,NA
"directory,probablybyrunningthe ",cdDocuments/workspace,NA
"command,andrunthefollowingcommand:",$php-Slocalhost:8000,NA
"Thecommandlinewillpromptyouwithsomeinformation,themostimportantonebeing ",NA,NA
"whatislistening,whichshouldbe",localhost:8000,NA
"asspecified,andhowtostopit, ",NA,NA
usuallybypressing,NA,NA
Ctrl,NA,NA
+,NA,NA
C,NA,NA
.Donotclosethecommandlineasitwillstopthewebserver too.,NA,NA
"Now,let’sopenabrowserandgoto",http://localhost:8000,NA
.Youshouldseea,NA,NA
hello ,NA,NA
world,NA,NA
"messageonawhitepage.Yay,success!Ifyouareinterested,youcancheckyour ",NA,NA
"commandline,andyouwillseelogentriesofeachrequestyouaresendingviayour ",NA,NA
browser.,NA,NA
"So,howdoesitreallywork?Well,ifyoucheckagaininthepreviousdiagram,the",php-S,NA
"commandstartedawebserver—inourcase,listeningtoport",8000,NA
insteadof,80,NA
".Also, ",NA,NA
PHPknowsthatthewebapplicationcodewillbeonthesamedirectorythatyoustarted ,NA,NA
thewebserver:your,workspace,NA
".Therearemorespecificoptions,butbydefault,PHPwill ",NA,NA
trytoexecutethe,index.php,NA
fileinyour,workspace,NA
.,NA,NA
Puttingthingstogether,NA,NA
Let’strytoincludeourfirstproject(,index.html,NA
withitsCSSandJSfiles)aspartofthe built-,NA,NA
"inserver.Todothis,youjustneedtoopenthecommandlineandgotothedirectory ",NA,NA
inwhichthesefilesareandstartthewebserverwith,php-Slocalhost:8000,NA
.Ifyou ,NA,NA
check,localhost:8000,NA
"inyourbrowser,youwillseeourtwo-linkpage,asisexpected.",NA,NA
Let’snowmoveournew,index.php,NA
filetothesamedirectory.Youdonotneedtorestart ,NA,NA
yourwebserver;PHPwillknowaboutthechangesautomatically.Gotoyourbrowserand ,NA,NA
refreshthepage.Youshouldnowseethe,NA,NA
helloworld,NA,NA
messageinsteadofthelinks.What ,NA,NA
happenedhere?,NA,NA
"Ifyoudonotchangethedefaultoptions,PHPwillalwaystrytofindan",index.php,NA
filein ,NA,NA
"thedirectoryinwhichyoustartedthewebserver.Ifthisisnotfound,PHPwilltrytofind ",NA,NA
an,index.html,NA
"file.Previously,weonlyhadthe",index.html,NA
"file,soPHPfailedtofind ",index.php,NA
".Nowthatitcanfinditsfirstoption,",index.php,NA
",itwillloadit.",NA,NA
Ifwewanttoseeour,index.html,NA
"filefromthebrowser,wecanalwaysspecifyitinthe ",NA,NA
URLlike,http://localhost:8000/index.html,NA
.Ifthewebservernoticesthatyouare ,NA,NA
"tryingtoaccessaspecificfile,itwilltrytoloaditinsteadofthedefaultoptions.",NA,NA
"Finally,ifwetrytoaccessafilethatisnotonourfilesystem,thewebserverwillreturna ",NA,NA
"responsewithstatuscode404—thatis,notfound.Wecanseethiscodeifweopenthe ",NA,NA
Developertools,NA,NA
sectionofourbrowserandgotothe,NA,NA
Network,NA,NA
section.,NA,NA
Tip,NA,NA
Developertoolsareyourfriends,NA,NA
"Asawebdeveloper,youwillfindveryfewtoolsmoreusefulthanthedevelopertoolsof ",NA,NA
"yourbrowser.Itchangesfrombrowsertobrowser,butallofthebignames,suchas ",NA,NA
"ChromeorFirefox,haveit.Itisveryimportantthatyougetfamiliarwithhowtouseitas ",NA,NA
itallowsyoutodebugyourapplicationsfromtheclientside.,NA,NA
Iwillintroduceyoutosomeofthesetoolsduringthecourseofthisbook.,NA,NA
Summary,NA,NA
"Inthischapter,youlearnedwhatHTTPisandhowwebapplicationsuseitinorderto ",NA,NA
interactwiththeserver.Youalsonowknowhowwebserversworkandhowtolauncha ,NA,NA
"lightbuilt-inserverwithPHP.Finally,youtookthefirststepstowardbuildingyourfirst ",NA,NA
webapplication.Congratulations!,NA,NA
"Inthenextchapter,wewilltakealookatthebasicsofPHPsothatyoucanstartbuilding ",NA,NA
simpleapplications.,NA,NA
Chapter3.UnderstandingPHPBasics,NA,NA
Learninganewlanguageisnoteasy.Youneedtounderstandnotonlythesyntaxofthe ,NA,NA
"language,butalsoitsgrammaticalrules,thatis,whenandwhytouseeachelementofthe ",NA,NA
"language.Luckilyforyou,somelanguagescomefromthesameroot.Forexample, ",NA,NA
"SpanishandFrenchareRomancelanguages,astheybothevolvedfromspokenLatin;that ",NA,NA
"meansthatthesetwolanguagessharealotofrules,andifyoualreadyknowFrench, ",NA,NA
learningSpanishbecomesmucheasier.,NA,NA
Programminglanguagesarequitethesame.Ifyoualreadyknowanotherprogramming ,NA,NA
"language,itwillbeveryeasyforyoutogothroughthischapter.Ifthisisyourfirsttime ",NA,NA
"though,youwillneedtounderstandallthosegrammaticalrulesfromscratch,andso,it ",NA,NA
mighttakesomemoretime.Butfearnot!Weareheretohelpyouinthisendeavor.,NA,NA
"Inthischapter,youwilllearnaboutthefollowing:",NA,NA
PHPfiles ,NA,NA
"Variables,strings,arrays,andoperatorsinPHP ",NA,NA
PHPinwebapplications ,NA,NA
ControlstructuresinPHP ,NA,NA
FunctionsinPHP,NA,NA
ThePHPfilesystem,NA,NA
PHPfiles,NA,NA
"Fromnowon,wewillworkonyour",index.php,NA
"file,soyoucanjuststartthewebserver, ",NA,NA
andgoto,http://localhost:8080,NA
toseetheresults.,NA,NA
"YoumighthavealreadynoticedthatinordertowritePHPcode,youhavetostartthefile ",NA,NA
with,<?php,NA
".Thereareotheroptions,andyoucanalsofinishthefilewith",?>,NA
",butnoneof ",NA,NA
themareneeded.WhatisimportanttoknowisthatyoucanmixPHPcodewithother ,NA,NA
"content,likeHTML,CSS,orJavaScript,inyourPHPfileassoonasyouenclosethePHP ",NA,NA
bitswiththe,<?php?>,NA
tags.,"<?php 
  
 echo'helloworld'; 
  
 ?> 
  
 byeworld",NA
"Ifyouchecktheresultoftheprecedingcodesnippetinyourbrowser,youwillseethatit ",NA,NA
"printsbothmessages,",NA,NA
helloworld,NA,NA
and,NA,NA
byeworld,NA,NA
.Thereasonwhythishappensissimple: ,NA,NA
youalreadyknowthatthePHPcodethereprintsthe,NA,NA
helloworld,NA,NA
message.Whathappens ,NA,NA
nextisthatanythingoutsidethePHPtagswillbeinterpretedasis.IfthereisanHTML ,NA,NA
"codeforinstance,itwouldnotbeprintedasis,butwillbeinterpretedbythebrowser.",NA,NA
Youwilllearnin,NA,NA
Chapter6,NA,NA
",",NA,NA
AdaptingtoMVC,NA,NA
",whyitisusuallyabadideatomixPHP ",NA,NA
"andHTML.Fornow,assumingthatitisbad,let’strytoavoidit.Forthat,youcaninclude ",NA,NA
onefilefromanotherPHPfileusinganyoneofthesefourfunctions:,include,NA
:Thiswilltrytofindandincludethespecifiedfileeachtimeitisinvoked.If ,NA,NA
"thefileisnotfound,PHPwillthrowawarning,butwillcontinuewiththeexecution. ",require,NA
:Thiswilldothesameas,include,NA
",butPHPwillthrowanerrorinsteadofa ",NA,NA
warningifthefileisnotfound.,include_once,NA
:Thisfunctionwilldowhat,include,NA
"does,butitwillincludethefile ",NA,NA
onlythefirsttimethatitisinvoked.Subsequentcallswillbeignored.,require_once,NA
:Thisworksthesameas,require,NA
",butitwillincludethefileonlythe ",NA,NA
firsttimethatitisinvoked.Subsequentcallswillbeignored.,NA,NA
"Eachfunctionhasitsownusage,soitisnotrighttosaythatoneisbetterthantheother.",NA,NA
"Justthinkcarefullywhatyourscenariois,andthendecide.Forexample,let’stryto ",NA,NA
includeour,index.html,NA
filefromour,index.php,NA
filesuchthatwedonotmixPHPwith ,NA,NA
"HTML,buthavethebestofbothworlds:","<?php 
  
 echo'helloworld'; 
  
 require'index.html';",NA
Wechose,require,NA
"asweknowthefileisthere—andifitisnot,wearenotinterestedin ",NA,NA
"continuingtheexecution.Moreover,asitissomeHTMLcode,wemightwanttoincludeit ",NA,NA
"multipletimes,sowedidnotchoosethe",require_once,NA
option.Youcantrytorequirea ,NA,NA
"filethatdoesnotexist,andseewhatthebrowsersays.",NA,NA
PHPdoesnotconsideremptylines;youcanaddasmanyasyouwanttomakeyourcode,NA,NA
"easiertoread,anditwillnothaveanyrepercussiononyourapplication.Anotherelement ",NA,NA
"thathelpsinwritingunderstandablecode,andwhichisignoredbyPHP,iscomments.",NA,NA
Let’sseebothinaction: ,"<?php 
  
 /* 
  
 *Thisisthefirstfileloadedbythewebserver.
  
 *Itprintssomemessagesandhtmlfromotherfiles.
  
 */ 
  
 //let'sprintamessagefromphp 
  
 echo'helloworld'; 
  
 //andthenincludetherestofhtml 
  
 require'index.html';",NA
"Thecodedoesthesamejobasthepreviousone,butnoweveryonewilleasilyunderstand ",NA,NA
whatwearetryingtodo.Wecanseetwotypesofcomments:single-linecommentsand ,NA,NA
multiple-linecomments.Thefirsttypeconsistsofasinglelinestartingwith,//,NA
",andthe ",NA,NA
secondtypeenclosesmultiplelineswithin,/*,NA
and,*/,NA
.Westarteachcommentedlinewith ,NA,NA
"anasterisk,butthatiscompletelyoptional.",NA,NA
Variables,NA,NA
Variableskeepavalueforfuturereference.Thisvaluecanchangeifwewantitto;thatis ,NA,NA
whytheyarecalledvariables.Let’stakealookattheminanexample.Savethiscodein ,NA,NA
your,index.php,NA
file:,"<?php 
  
 $a=1; 
  
 $b=2; 
  
 $c=$a+$b; 
  
 echo$c;//3",NA
"Inthisprecedingpieceofcode,wehavethreevariables:",$a,NA
hasvalue,1,NA
",",$b,NA
has,2,NA
",and",$c,NA
containsthesumof,$a,NA
and,$b,NA
",hence,",$c,NA
equals3.Yourbrowsershouldprintthevalueof ,NA,NA
thevariable,$c,NA
",whichis3.",NA,NA
"Assigningavaluetoavariablemeanstogiveitavalue,anditisdonewiththeequalssign ",NA,NA
"asshowninthepreviousexample.Ifyoudidnotassignavaluetoavariable,wewillgeta ",NA,NA
noticefromPHPwhenitchecksitscontents.Anoticeisjustamessagetellingusthat ,NA,NA
"somethingisnotexactlyright,butitisaminorproblemandyoucancontinuewiththe ",NA,NA
"execution.Thevalueofanunassignedvariablewillbenull,thatis,nothing.",NA,NA
PHPvariablesstartwiththe,$,NA
signfollowedbythevariablename.Avalidvariablename ,NA,NA
"startswithaletteroranunderscorefollowedbyanycombinationofletters,numbers, ",NA,NA
and/orunderscores.Itiscasesensitive.Let’sseesomeexamples:,"<?php 
  
 $_some_value='abc';//valid 
  
 $1number=12.3;//notvalid!
  
 $some$signs%='&^%';//notvalid!
  
 $go_2_home=""ok"";//valid 
  
 $go_2_Home='no';//thisisadifferentvariable 
 $isThisCamelCase=true;//camelcase",NA
Rememberthateverythingafter,//,NA
"isacomment,andisthusignoredbyPHP.",NA,NA
"Inthispieceofcode,wecanseethatvariablenameslike",$_some_value,NA
and,$go_2_home,NA
arevalid.,$1number,NA
and,$some$signs%,NA
"arenotvalidastheystartwithanumber,orthey ",NA,NA
"containinvalidsymbols.Asnamesarecasesensitive,",$go_2_home,NA
and,$go_2_Home,NA
are ,NA,NA
"twodifferentvariables.Finally,weshowtheCamelCaseconvention,whichisthe ",NA,NA
preferredoptionamongmostdevelopers.,NA,NA
Datatypes,NA,NA
"Wecanassignmorethanjustnumberstovariables.PHPhaseightprimitivetypes,butfor ",NA,NA
"now,wewillfocusonitsfourscalartypes:",NA,NA
Booleans,NA,NA
:Thesetakejusttrueorfalsevalues ,NA,NA
Integers,NA,NA
":Thesearenumericvalueswithoutadecimalpoint,forexample,2or5 ",NA,NA
Floatingpointnumbersorfloats,NA,NA
":Thesearenumberswithadecimalpoint,for ",NA,NA
"example,2.3 ",NA,NA
Strings,NA,NA
:Theseareconcatenationsofcharacterswhicharesurroundedbyeithersingl,NA,NA
"e ordoublequotes,like‘this’or“that”",NA,NA
"EventhoughPHPdefinesthesetypes,itallowstheusertoassigndifferenttypesofdatato ",NA,NA
thesamevariable.Checkthefollowingcodetoseehowitworks:,"<?php 
  
 $number=123; 
  
 var_dump($number); 
  
 $number='abc'; 
  
 var_dump($number);",NA
"Ifyouchecktheresultonyourbrowser,youwillseethefollowing:","int(123)string(3)""abc""",NA
Thecodefirstassignsthevalue,123,NA
tothevariable,$number,NA
.As,123,NA
"isaninteger,thetype ",NA,NA
ofthevariablewillbeinteger,int,NA
.Thatiswhatweseewhenprintingthecontentofthe ,NA,NA
variablewith,var_dump,NA
".Afterthat,weassignanothervaluetothesamevariable,thistime ",NA,NA
"astring.Whenprintingthenewcontent,weseethatthetypeofthevariablechangedfrom ",NA,NA
"integertostring,yetPHPdidnotcomplainatanytime.Thisiscalled",NA,NA
typejuggling,NA,NA
.,NA,NA
Let’scheckanotherpieceofcode:,"<?php 
  
 $a=""1""; 
  
 $b=2; 
  
 var_dump($a+$b);//3 
  
 var_dump($a.$b);//12",NA
Youalreadyknowthatthe,+,NA
operatorreturnsthesumoftwonumericvalues.Youwillsee ,NA,NA
laterthatthe,.,NA
"operatorconcatenatestwostrings.Thus,theprecedingcodeassignsastring ",NA,NA
"andanintegertotwovariables,andthentriestoaddandconcatenatethem.",NA,NA
"Whentryingtoaddthem,PHPknowsthatitneedstwonumericvalues,andsoittriesto ",NA,NA
"adaptthestringtoaninteger.Inthiscase,itiseasyasthestringrepresentsavalidnumber. ",NA,NA
Thatisthereasonwhyweseethefirstresultasaninteger3(,NA,NA
1+2,NA,NA
).,NA,NA
"Inthelastline,weareperformingastringconcatenation.Wehaveanintegerin",$b,NA
",so ",NA,NA
PHPwillfirsttrytoconvertittoastring—whichis“2”—andthenconcatenateitwiththe ,NA,NA
"otherstring,“1”.Theresultisthestring“12”.",NA,NA
Note,NA,NA
Typejuggling ,NA,NA
PHPtriestoconvertthedatatypeofavariableonlywhenthereisacontextwherethetype ,NA,NA
ofvariableneededisdifferent.ButPHPdoesnotchangethevalueandtypeofthevariable ,NA,NA
"itself.Instead,itwilltakethevalueandtrytotransformit,leavingthevariableintact.",NA,NA
Operators,NA,NA
"Usingvariablesisnice,butifwecannotmaketheminteractwitheachother,thereis ",NA,NA
nothingmuchwecando.,NA,NA
Operators,NA,NA
areelementsthattakesomeexpressions—,NA,NA
operands—,NA,NA
andperformactionsonthemtogetaresult.Themostcommonexamplesofoperators ,NA,NA
"arearithmeticoperators,whichyoualreadysawpreviously.",NA,NA
An,NA,NA
expression,NA,NA
"isalmostanythingthathasavalue.Variables,numbers,ortextare ",NA,NA
"examplesofexpressions,butyouwillseethattheycangetwaymorecomplicated. ",NA,NA
"Operatorsexpectexpressionsofaspecifictype,forexample,arithmeticoperatorsexpect ",NA,NA
"eitherintegersorfloats.Butasyoualreadyknow,PHPtakescareoftransformingthe ",NA,NA
typesoftheexpressionsgivenwheneverpossible.,NA,NA
Let’stakealookatthemostimportantgroupsofoperators.,NA,NA
Arithmeticoperators,NA,NA
"Arithmeticoperatorsareveryintuitive,asyoualreadyknow.Addition,subtraction, ",NA,NA
"multiplication,anddivision(",+,NA
",",-,NA
",",*,NA
",and",/,NA
)doastheirnamessay.Modulus(,%,NA
)givesthe ,NA,NA
remainderofthedivisionoftwooperands.Exponentiation(,**,NA
)raisesthefirstoperandto ,NA,NA
"thepowerofthesecond.Finally,negation(",-,NA
)negatestheoperand.Thislastoneisthe ,NA,NA
onlyarithmeticoperatorthattakesjustoneoperand.,NA,NA
Let’sseesomeexamples:,"<?php 
  
 $a=10; 
  
 $b=3; 
  
 var_dump($a+$b);//13 
  
 var_dump($a-$b);//7 
  
 var_dump($a*$b);//30 
  
 var_dump($a/$b);//3.333333…
  
 var_dump($a%$b);//1 
  
 var_dump($a**$b);//1000 
  
 var_dump(-$a);//-10",NA
"Asyoucansee,theyarequiteeasytounderstand!",NA,NA
Assignmentoperators,NA,NA
"Youalreadyknowthisonetoo,aswehavebeenusingitinourexamples.Theassignment ",NA,NA
operatorassignstheresultofanexpressiontoavariable.Nowyouknowthatan ,NA,NA
"expressioncanbeassimpleasanumber,or,forexample,theresultofaseriesof ",NA,NA
arithmeticoperations.Thefollowingexampleassignstheresultofanexpressiontoa ,NA,NA
variable:,"<?php 
  
 $a=3+4+5-2; 
  
 var_dump($a);//10",NA
Thereareaseriesofassignmentoperatorsthatworkasshortcuts.Youcanbuildthem ,NA,NA
combininganarithmeticoperatorandtheassignmentoperator.Let’sseesomeexamples:,"$a=13; 
  
 $a+=14;//sameas$a=$a+14; 
  
 var_dump($a); 
  
 $a-=2;//sameas$a=$a-2; 
  
 var_dump($a); 
  
 $a*=4;//sameas$a=$a*4; 
  
 var_dump($a);",NA
Comparisonoperators,NA,NA
Comparisonoperatorsareoneofthemostusedgroupsofoperators.Theytaketwo ,NA,NA
"operandsandcomparethem,returningtheresultofthecomparisonusuallyasaBoolean, ",NA,NA
"thatis,",true,NA
or,false,NA
.,NA,NA
Therearefourcomparisonsthatareveryintuitive:,<,NA
"(lessthan),",<=,NA
"(lessorequalto),",>,NA
"(greaterthan),and",>=,NA
(greaterthanorequalto).Thereisalsothespecialoperator,<=>,NA
(spaceship)thatcomparesboththeoperandsandreturnsanintegerinsteadofaBoolean. ,NA,NA
Whencomparing,NA,NA
a,NA,NA
with,NA,NA
b,NA,NA
",theresultwillbelessthan0if",NA,NA
a,NA,NA
islessthan,NA,NA
b,NA,NA
",0if",NA,NA
a,NA,NA
equals,NA,NA
b,NA,NA
", ",NA,NA
andgreaterthan0if,NA,NA
a,NA,NA
isgreaterthan,NA,NA
b,NA,NA
.Let’sseesomeexamples:,"<?php 
  
 var_dump(2<3);//true 
  
 var_dump(3<3);//false 
  
 var_dump(3<=3);//true 
  
 var_dump(4<=3);//false 
  
 var_dump(2>3);//false 
  
 var_dump(3>=3);//true 
  
 var_dump(3>3);//false 
  
 var_dump(1<=>2);//intlessthan0 var_dump(1<=>1);//0 
  
 var_dump(3<=>2);//intgreaterthan0",NA
"Therearecomparisonoperatorstoevaluateiftwoexpressionsareequalornot,butyou ",NA,NA
needtobecarefulwithtypejuggling.The,==,NA
(equals)operatorevaluatestwoexpressions ,NA,NA
after,NA,NA
"typejuggling,thatis,itwilltrytotransformbothexpressionstothesametype,and ",NA,NA
"thencomparethem.Instead,the",===,NA
(identical)operatorevaluatestwoexpressions,NA,NA
witho,NA,NA
ut ,NA,NA
"typejuggling,soeveniftheylookthesame,iftheyarenotofthesametype,the ",NA,NA
comparisonwillreturn,false,NA
.Thesameappliesto,!=,NA
or,<>,NA
(notequalto)and,!==,NA
(not identical):,"<?php 
  
 $a=3; 
  
 $b='3'; 
  
 $c=5; 
  
 var_dump($a==$b);//true 
  
 var_dump($a===$b);//false 
  
 var_dump($a!=$b);//false 
  
 var_dump($a!==$b);//true 
  
 var_dump($a==$c);//false 
  
 var_dump($a<>$c);//true",NA
Youcanseethatwhenaskingifastringandanintegerthatrepresentthesamenumberare ,NA,NA
"equal,itrepliesaffirmatively;PHPfirsttransformsbothtothesametype.Ontheother ",NA,NA
"hand,whenaskediftheyareidentical,itrepliestheyarenotastheyareofdifferenttypes.",NA,NA
Logicaloperators,NA,NA
Logicaloperatorsapplyalogicoperation—alsoknownasabinaryoperation—toits ,NA,NA
"operands,returningaBooleanresponse.Themostusedonesare",!,NA
"(not),",&&,NA
"(and),and",||,NA
(or).,&&,NA
willreturn,true,NA
onlyifbothoperandsevaluateto,true,NA
.,||,NA
willreturn,true,NA
ifany ,NA,NA
orbothoftheoperandsare,true,NA
.,!,NA
"willreturnthenegatedvalueoftheoperand,thatis, ",true,NA
iftheoperandis,false,NA
or,false,NA
iftheoperandis,true,NA
.Let’sseesomeexamples:,"<?php 
  
 var_dump(true&&true);//true 
  
 var_dump(true&&false);//false 
  
 var_dump(true||false);//true 
  
 var_dump(false||false);//false 
  
 var_dump(!false);//true",NA
Incrementinganddecrementingoperators,NA,NA
Incrementing/decrementingoperatorsarealsoshortcutslike,+=,NA
or,-=,NA
",andtheyonlywork ",NA,NA
"onvariables.Therearefourofthem,andtheyneedspecialattention.We’vealreadyseen ",NA,NA
thefirsttwo:,++,NA
":Thisoperatorontheleftofthevariablewillincreasethevariableby1,andthen ",NA,NA
"returntheresult.Ontheright,itwillreturnthecontentofthevariable,andafterthat ",NA,NA
increaseitby1.,--,NA
:Thisoperatorworksthesameas,++,NA
butdecreasesthevalueby1insteadof ,NA,NA
increasingby1.,NA,NA
Let’sseeanexample:,"<?php 
  
 $a=3; 
  
 $b=$a++;//$bis3,$ais4 
  
 var_dump($a,$b); 
  
 $b=++$a;//$aand$bare5 
  
 var_dump($a,$b);",NA
"Intheprecedingcode,onthefirstassignmentto",$b,NA
",weuse",$a++,NA
.Theoperatoronthe ,NA,NA
rightwillreturnfirstthevalueof,$a,NA
",whichis",3,NA
",assignitto",$b,NA
",andonlythenincrease",$a,NA
"by1.Inthesecondassignment,theoperatorontheleftfirstincreases",$a,NA
"by1,changesthe ",NA,NA
valueof,$a,NA
to,5,NA
",andthenassignsthatvalueto",$b,NA
.,NA,NA
Operatorprecedence,NA,NA
"Youcanaddmultipleoperatorstoanexpressiontomakeitaslongasitneedstobe,but ",NA,NA
"youneedtobecarefulassomeoperatorshavehigherprecedencethanothers,andthus,the ",NA,NA
orderofexecutionmightnotbetheoneyouexpect.Thefollowingtableshowstheorder ,NA,NA
ofprecedenceoftheoperatorsthatwe’vestudieduntilnow:,"Operator
  
  
 Type
  
  
   
   
  
  
 **
  
  
 Arithmetic
  
  
   
   
  
  
 ++
 ,
 --
  
  
 Increasing/decreasi
 ng
  
  
   
   
  
  
 !
  
  
 Logical
  
  
   
   
  
  
 *
 ,
 /
 ,
 %
  
  
 Arithmetic
  
  
   
   
  
  
 +
 ,
 -
  
  
 Arithmetic
  
  
   
   
  
  
 <
 ,
 <=
 ,
 >
 ,
 >=
  
  
 Comparison
  
  
   
   
  
  
 ==
 ,
 !=
 ,
 ===
 ,
 !==
  
  
 Comparison
  
  
  
 &&
  
  
 Logical
  
  
   
   
  
  
 ||
  
  
 Logical
  
  
   
   
  
  
 =
 ,
 +=
 ,
 -=
 ,
 *=
 ,
 /=
 ,
 %=
 ,
 **=
  
  
 Assignment",NA
Theprecedingtableshowsusthattheexpression,NA,NA
3+2*3,NA,NA
willfirstevaluatetheproduct,NA,NA
2*3 ,NA,NA
"andthenthesum,sotheresultis9ratherthan15.Ifyouwanttoperformoperationsina ",NA,NA
"specificorder,differentfromthenaturalorderofprecedence,youcanforceitbyenclosing ",NA,NA
"theoperationwithinparentheses.Hence,",NA,NA
(3+2)*3,NA,NA
willfirstperformthesumandthenthe ,NA,NA
"product,givingtheresult15thistime.",NA,NA
Let’sseesomeexamplestoclarifythisquitetrickysubject:,"<?php 
  
 $a=1; 
  
 $b=3; 
  
 $c=true; 
  
 $d=false; 
  
 $e=$a+$b>5||$c;//true 
  
 var_dump($e); 
  
 $f=$e==true&&!$d;//true 
  
 var_dump($f); 
  
 $g=($a+$b)*2+3*4;//20 
  
 var_dump($g);",NA
"Thisprecedingexamplecouldbeendless,andstillnotbeabletocoverallthescenarios ",NA,NA
"youcanimagine,solet’skeepitsimple.Inthefirsthighlightedline,wehavea ",NA,NA
"combinationofarithmetic,comparison,andlogicaloperators,plustheassignment",NA,NA
"operator.Astherearenoparentheses,theorderistheonedetailedintheprevioustable. ",NA,NA
"Theoperatorwiththehighestpreferenceisthesum,soweperformitfirst:",$a,NA
+,$b,NA
equals ,NA,NA
"4.Thenextoneisthecomparisonoperator,so",NA,NA
4>5,NA,NA
",whichis",false,NA
".Finally,thelogical ",NA,NA
"operator,",false,NA
||,$c,NA
(,$c,NA
is,true,NA
)resultsin,true,NA
.,NA,NA
Thesecondexamplemightneedabitmoreexplanation.Thefirstoperatorweseeinthe ,NA,NA
"tableisthenegation,soweresolveit.",!$d,NA
is,!false,NA
",soitis",true,NA
".Theexpressionisnow, ",$e,NA
==,true,NA
&&,true,NA
.Firstweneedtosolvethecomparison,$e,NA
==,true.,NA
Knowingthat,$e,NA
is,true,NA
",thecomparisonresultsin",true,NA
".Thefinaloperationthenisthelogicalend,andit ",NA,NA
resultsin,true,NA
.,NA,NA
Trytoworkoutthelastexamplebyyourselftogetsomepractice.Donotbeafraidifyou ,NA,NA
"thinkwearenotcoveringoperatorsenough.Duringthenextfewsections,wewillseea ",NA,NA
lotofexamples.,NA,NA
Workingwithstrings,NA,NA
Workingwithstringsinreallifeisreallyeasy.Actionslike,NA,NA
Checkifthisstringcontains ,NA,NA
this,NA,NA
or,NA,NA
Tellmehowmanytimesthischaracterappears,NA,NA
areveryeasytoperform.Butwhen ,NA,NA
"programming,stringsareconcatenationsofcharactersthatyoucannotseeatoncewhen ",NA,NA
"searchingforsomething.Instead,youhavetolookonebyoneandkeeptrackofwhatthe ",NA,NA
"contentis.Inthisscenario,thosereallyeasyactionsarenotthateasyanymore.",NA,NA
"Luckilyforyou,PHPbringsawholesetofpredefinedfunctionsthathelpyouin ",NA,NA
interactingwithstrings.Youcanfindtheentirelistoffunctionsat ,NA,NA
http://php.net/manual/en/ref.strings.php,NA,NA
",butwewillonlycovertheonesthatareused",NA,NA
the most.Let’slookatsomeexamples:,"<?php
  
 $text='Howcanaclamcraminacleancreamcan?';
  
 echostrlen($text);//45 
  
 $text=trim($text); 
  
 echo$text;//Howcanaclamcraminacleancreamcan?
  
 echostrtoupper($text);//HOWCANACLAMCRAMINACLEANCREAMCAN? 
 echostrtolower($text);//howcanaclamcraminacleancreamcan?
  
 $text=str_replace('can','could',$text); 
  
 echo$text;//Howcouldaclamcraminacleancreamcould?
  
 echosubstr($text,2,6);//wcoul 
  
 var_dump(strpos($text,'can'));//false 
 var_dump(strpos($text,'could'));//4",NA
"Intheprecedinglongpieceofcode,weareplayingwithastringwithdifferentfunctions:",strlen,NA
:Thisfunctionreturnsthenumberofcharactersthatthestringcontains. ,trim,NA
":Thisfunctionreturnsthestring,removingalltheblankspacestotheleftandto ",NA,NA
theright.,strtoupper,NA
and,strtolower,NA
:Thesefunctionsreturnthestringwithallthecharacters ,NA,NA
inupperorlowercaserespectively.,str_replace,NA
:Thisfunctionreplacesalloccurrencesofagivenstringbythe ,NA,NA
replacementstring.,substr,NA
:Thisfunctionextractsthestringcontainedbetweenthepositionsspecifiedby ,NA,NA
"parameters,withthefirstcharacterbeingatposition0.",strpos,NA
:Thisfunctionshowsthepositionofthefirstoccurrenceofthegivenstring.It ,NA,NA
returns,false,NA
ifthestringcannotbefound.,NA,NA
"Additionally,thereisanoperatorforstrings(",.,NA
)whichconcatenatestwostrings(ortwo ,NA,NA
variablestransformedtoastringwhenpossible).Usingitisreallysimple:inthefollowing ,NA,NA
"example,thelaststatementwillconcatenateallthestringsandvariablesformingthe ",NA,NA
"sentence,",NA,NA
IamHiroNakamura!,NA,NA
.,"<?php 
  
 $firstname='Hiro'; 
  
 $surname='Nakamura';",NA
"Anotherthingtonoteaboutstringsisthewaytheyarerepresented.Sofar,wehavebeen ",NA,NA
"enclosingthestringswithinsinglequotes,butyoucanalsoenclosethemwithindouble ",NA,NA
"quotes.Thedifferenceisthatwithinsinglequotes,astringisexactlyasitisrepresented, ",NA,NA
"butwithindoublequotes,somerulesareappliedbeforeshowingthefinalresult.Thereare ",NA,NA
twoelementsthatdoublequotestreatdifferentlythansinglequotes:escapecharactersan,NA,NA
d variableexpansions.,NA,NA
Escapecharacters,NA,NA
:Thesearespecialcharactersthancannotberepresentedeasily.,NA,NA
"Examplesofescapecharactersarenewlinesortabs.Torepresentthem,weuse ",NA,NA
"escapesequences,whicharetheconcatenationofabackslash(",\,NA
)followedbysome ,NA,NA
"othercharacter.Forexample,",\n,NA
"representsanewline,and",\t,NA
representsatabulation. ,NA,NA
Variableexpanding,NA,NA
":Thisallowsyoutoincludevariablereferencesinsidethestring, ",NA,NA
andPHPreplacesthembytheircurrentvalue.Youhavetoincludethe,$,NA
signtoo.,NA,NA
Havealookatthefollowingexample:,"<?php 
  
 $firstname='Hiro'; 
  
 $surname='Nakamura'; 
  
 echo""Mynameis$firstname$surname.\nIamamasteroftimeandspace.
  
 \""Yatta!\"""";",NA
Theprecedingpieceofcodewillprintthefollowinginthebrowser:,"MynameisHiroNakamura.
  
 Iamamasteroftimeandspace.""Yatta!""",NA
"Here,",\n,NA
insertedanewline.,"\""",NA
"addedthedoublequotes(youneedtoescapethemtoo,as ",NA,NA
"PHPwouldunderstandthatyouwanttoendyourstring),andthevariables",$firstname,NA
and,$surname,NA
werereplacedbytheirvalues.,NA,NA
Arrays,NA,NA
Ifyouhavesomeexperiencewithotherprogramminglanguagesordatastructuresin ,NA,NA
"general,youmightbeawareoftwodatastructuresthatareverycommonanduseful:",NA,NA
lists ,NA,NA
and,NA,NA
maps,NA,NA
".Alistisanorderedsetofelements,whereasamapisasetofelements ",NA,NA
identifiedbykeys.Let’sseeanexample:,"List:[""Harry"",""Ron"",""Hermione""]
  
 Map:{ 
  
 ""name"":""JamesPotter"", 
  
 ""status"":""dead"" 
  
 }",NA
Thefirstelementisalistofnamesthatcontainsthreevalues:,Harry,NA
",",Ron,NA
",and",Hermione,NA
. ,NA,NA
"Thesecondoneisamap,anditdefinestwovalues:",JamesPotter,NA
and,dead,NA
.Eachofthese ,NA,NA
twovaluesisidentifiedwithakey:,name,NA
and,status,NA
respectively.,NA,NA
"InPHP,wedonothavelistsandmaps;wehavearrays.Anarrayisadatastructurethat ",NA,NA
"implementsboth,alistandamap.",NA,NA
Initializingarrays,NA,NA
"Youhavedifferentoptionsforinitializinganarray.Youcaninitializeanemptyarray,or ",NA,NA
youcaninitializeanarraywithdata.Therearedifferentwaysofwritingthesamedata ,NA,NA
witharraystoo.Let’sseesomeexamples:,"<?php 
  
 $empty1=[]; 
  
 $empty2=array(); 
  
 $names1=['Harry','Ron','Hermione']; 
  
 $names2=array('Harry','Ron','Hermione'); $status1=[ 
  
 'name'=>'JamesPotter', 
  
 'status'=>'dead' 
  
 ]; 
  
 $status2=array( 
  
 'name'=>'JamesPotter', 
  
 'status'=>'dead' 
  
 );",NA
"Intheprecedingexample,wedefinethelistandmapfromtheprevioussection.",$names1,NA
and,$names2,NA
"areexactlythesamearray,justusingadifferentnotation.Thesamehappens ",NA,NA
with,$status1,NA
and,$status2,NA
".Finally,",$empty1,NA
and,$empty2,NA
aretwowaysofcreatingan ,NA,NA
emptyarray.,NA,NA
"Lateryouwillseethatlistsarehandledlikemaps.Internally,thearray",$names1,NA
"isamap, ",NA,NA
"anditskeysareorderednumbers.Inthiscase,anotherinitializationfor",$names1,NA
thatleads ,NA,NA
tothesamearraycouldbeasfollows:,"$names1=[ 
  
 0=>'Harry', 
  
 1=>'Ron', 
  
 2=>'Hermione' 
  
 ];",NA
"Keysofanarraycanbeanyalphanumericvalue,likestringsornumbers.Valuesofan ",NA,NA
"arraycanbeanything:strings,numbers,Booleans,otherarrays,andsoon.Youcouldhave ",NA,NA
somethinglikethefollowing:,"<?php 
  
 $books=[ 
  
 '1984'=>[ 
  
 'author'=>'GeorgeOrwell', 
  
 'finished'=>true, 
  
 'rate'=>9.5 
  
 ], 
  
 'RomeoandJuliet'=>[ 
  
 'author'=>'WilliamShakespeare', 'finished'=>false 
  
 ] 
  
 ];",NA
Thisarrayisalistthatcontainstwoarrays—maps.Eachmapcontainsdifferentvalueslike ,NA,NA
"strings,doubles,andBooleans.",NA,NA
Populatingarrays,NA,NA
"Arraysarenotimmutable,thatis,theycanchangeafterbeinginitialized.Youcanchange ",NA,NA
thecontentofanarrayeitherbytreatingitasamaporasalist.Treatingitasamapmeans ,NA,NA
"thatyouspecifythekeythatyouwanttooverride,whereastreatingitasalistmeans ",NA,NA
appendinganotherelementtotheendofthearray:,"<?php 
  
 $names=['Harry','Ron','Hermione']; $status=[ 
  
 'name'=>'JamesPotter', 
  
 'status'=>'dead' 
  
 ]; 
  
 $names[]='Neville'; 
  
 $status['age']=32; 
  
 print_r($names,$status);",NA
"Intheprecedingexample,thefirsthighlightedlineappendsthename",Neville,NA
tothelistof ,NA,NA
"names,hencethelistwilllooklike",NA,NA
"[‘Harry’,‘Ron’,‘Hermione’,‘Neville’]",NA,NA
.Thesecond ,NA,NA
changeactuallyaddsanewkey-valuetothearray.Youcanchecktheresultfromyour ,NA,NA
browserbyusingthefunction,print_r,NA
.Itdoessomethingsimilarto,var_dump,NA
",just ",NA,NA
withoutthetypeandsizeofeachvalue.,NA,NA
Note,NA,NA
print_randvar_dumpinabrowser,NA,NA
"Whenprintingthecontentofanarray,itisusefultoseeonekey-valueperline,butifyou ",NA,NA
"checkyourbrowser,youwillseethatitdisplaysthewholearrayinoneline.Thathappens ",NA,NA
"becausewhatthebrowsertriestodisplayisHTML,anditignoresnewlinesor ",NA,NA
"whitespaces.TocheckthecontentofthearrayasPHPwantsyoutoseeit,checkthe ",NA,NA
sourcecodeofthepage—youwillseetheoptionbyright-clickingonthepage.,NA,NA
"Ifyouneedtoremoveanelementfromthearray,insteadofaddingorupdatingone,you ",NA,NA
canusethe,unset,NA
function:,"<?php 
  
 $status=[ 
  
 'name'=>'JamesPotter', 
  
 'status'=>'dead' 
  
 ]; 
  
 unset($status['status']); 
  
 print_r($status);",NA
Thenew,$status,NA
arraycontainsthekeynameonly.,NA,NA
Accessingarrays,NA,NA
"Accessinganarrayisaseasyasspecifyingthekeyaswhenyouwereupdatingit.Forthat, ",NA,NA
youneedtounderstandhowlistswork.Youalreadyknowthatlistsaretreatedinternally ,NA,NA
"asamapwithnumerickeysinorder.Thefirstkeyisalways0;so,anarraywith",NA,NA
n ,NA,NA
elementswillhavekeysfrom0to,NA,NA
n-1,NA,NA
.,NA,NA
"Youcanaddanykeytoagivenarray,evenifitpreviouslyconsistedofnumericentries. ",NA,NA
"Theproblemariseswhenaddingnumerickeys,andlater,youtrytoappendanelementto ",NA,NA
thearray.Whatdoyouthinkwillhappen?,"<?php 
  
 $names=['Harry','Ron','Hermione']; 
 $names['badguy']='Voldemort'; 
  
 $names[8]='Snape'; 
  
 $names[]='McGonagall'; 
  
 print_r($names);",NA
Theresultofthatlastpieceofcodeisasfollows:,"Array 
  
 ( 
  
 [0]=>Harry 
  
 [1]=>Ron 
  
 [2]=>Hermione 
  
 [badguy]=>Voldemort 
  
 [8]=>Snape 
  
 [9]=>McGonagall 
  
 )",NA
"Whentryingtoappendavalue,PHPinsertsitafterthelastnumerickey,inthiscase",8,NA
.,NA,NA
"Youmight’vealreadyfigureditoutbyyourself,butyoucanalwaysprintanypartofthe ",NA,NA
arraybyspecifyingitskey:,"<?php 
  
 $names=['Harry','Ron','Hermione']; 
 print_r($names[1]);//prints'Ron'",NA
"Finally,tryingtoaccessakeythatdoesnotexistinanarraywillreturnyouanulland ",NA,NA
"throwanotice,asPHPidentifiesthatyouaredoingsomethingwronginyourcode.","<?php 
  
 $names=['Harry','Ron','Hermione']; 
  
 var_dump($names[4]);//nullandaPHPnotice",NA
Theemptyandissetfunctions,NA,NA
Therearetwousefulfunctionsforenquiringaboutthecontentofanarray.Ifyouwantto ,NA,NA
"knowifanarraycontainsanyelementatall,youcanaskifitisemptywiththe",empty,NA
"function.Thatfunctionactuallyworkswithstringstoo,anemptystringbeingastringwith ",NA,NA
nocharacters(‘‘).The,isset,NA
"functiontakesanarrayposition,andreturns",true,NA
or,false,NA
dependingonwhetherthatpositionexistsornot:,"<?php 
  
 $string=''; 
  
 $array=[]; 
  
 $names=['Harry','Ron','Hermione']; 
 var_dump(empty($string));//true 
  
 var_dump(empty($array));//true 
  
 var_dump(empty($names));//false 
  
 var_dump(isset($names[2]));//true 
 var_dump(isset($names[3]));//false",NA
"Intheprecedingexample,wecanseethatanarraywithnoelementsorastringwithno ",NA,NA
characterswillreturn,true,NA
"whenaskedifitisempty,and",false,NA
otherwise.Whenweuse ,isset($names[2]),NA
"tocheckiftheposition2ofthearrayexists,weget",true,NA
",asthereisa ",NA,NA
valueforthatkey:,Hermione,NA
".Finally,",isset($names[3]),NA
evaluatesto,false,NA
asthekey3 ,NA,NA
doesnotexistinthatarray.,NA,NA
Searchingforelementsinanarray,NA,NA
"Probably,oneofthemostusedfunctionswitharraysis",in_array,NA
.Thisfunctiontakestwo ,NA,NA
"values,thevaluethatyouwanttosearchforandthearray.Thefunctionreturns",true,NA
ifthe ,NA,NA
valueisinthearrayand,false,NA
"otherwise.Thisisveryuseful,becausealotoftimeswhat ",NA,NA
"youwanttoknowfromalistoramapisifitcontainsanelement,ratherthanknowing ",NA,NA
thatitdoesoritslocation.,NA,NA
Evenmoreusefulsometimesis,array_search,NA
.Thisfunctionworksinthesameway ,NA,NA
"exceptthatinsteadofreturningaBoolean,itreturnsthekeywherethevalueisfound,or ",false,NA
otherwise.Let’sseebothfunctions:,"<?php 
  
 $names=['Harry','Ron','Hermione']; 
  
 $containsHermione=in_array('Hermione',$names); 
 var_dump($containsHermione);//true 
  
 $containsSnape=in_array('Snape',$names); 
  
 var_dump($containsSnape);//false 
  
 $wheresRon=array_search('Ron',$names); 
  
 var_dump($wheresRon);//1 
  
 $wheresVoldemort=array_search('Voldemort',$names); 
 var_dump($wheresVoldemort);//false",NA
Orderingarrays,NA,NA
"Anarraycanbesortedindifferentways,sotherearealotofchancesthattheorderthat ",NA,NA
"youneedisdifferentfromthecurrentone.Bydefault,thearrayissortedbytheorderin ",NA,NA
"whichtheelementswereaddedtoit,butyoucansortanarraybyitskeyorbyitsvalue, ",NA,NA
"bothascendinganddescending.Furthermore,whensortinganarraybyitsvalues,youcan ",NA,NA
choosetopreservetheirkeysortogeneratenewonesasalist.,NA,NA
Thereisacompletelistofthesefunctionsontheofficialdocumentationwebsiteat ,NA,NA
http://php.net/manual/en/array.sorting.php,NA,NA
",butherewewilldisplaythemostimpo",NA,NA
rtant ones:,"Name
  
 Sortsby 
  
 Maintainskeyassociatio
 n 
  
 Orderofsort
  
   
  
  
  
  
 sort
  
 Value
  
 No
  
 Lowtohigh
  
   
  
  
  
  
 rsort
  
 Value
  
 No
  
 Hightolow
  
   
  
  
  
  
 asort
  
 Value
  
 Yes
  
 Lowtohigh
  
   
  
  
  
  
 arsort
  
  
 Value
  
 Yes
  
 Hightolow
  
   
  
  
  
  
 ksort
  
 Key
  
 Yes
  
 Lowtohigh
  
   
  
  
  
  
 krsort
  
  
 Key
  
 Yes
  
 Hightolow",NA
"Thesefunctionsalwaystakeoneargument,thearray,andtheydonotreturnanything. ",NA,NA
"Instead,theydirectlysortthearraywepasstothem.Let’sseesomeofthem:","<?php 
  
 $properties=[ 
  
 'firstname'=>'Tom', 
  
 'surname'=>'Riddle', 
  
 'house'=>'Slytherin' 
  
 ]; 
  
 $properties1=$properties2=$properties3=$properties; 
 sort($properties1); 
  
 var_dump($properties1); 
  
 asort($properties3); 
  
 var_dump($properties3); 
  
 ksort($properties2); 
  
 var_dump($properties2);",NA
"Okay,thereisalotgoingoninthelastexample.Firstofall,weinitializeanarraywith ",NA,NA
somekeyvaluesandassignitto,$properties,NA
.Thenwecreatethreevariablesthatare ,NA,NA
copiesoftheoriginalarray—thesyntaxshouldbeintuitive.Whydowedothat?Because ,NA,NA
"ifwesorttheoriginalarray,wewillnothavetheoriginalcontentanymore.Thisisnot ",NA,NA
"whatwewantinthisspecificexample,aswewanttoseehowthedifferentsortfunctions ",NA,NA
"affectthesamearray.Finally,weperformthreedifferentsorts,andprinteachofthe ",NA,NA
results.Thebrowsershouldshowyousomethinglikethefollowing:,NA,NA
"Thefirstfunction,",sort,NA
",ordersthevaluesalphabetically.Also,ifyoucheckthekeys,now ",NA,NA
"theyarenumericasinalist,insteadoftheoriginalkeys.Instead,",asort,NA
ordersthevalues ,NA,NA
"inthesameway,butkeepstheassociationofkey-values.Finally,",ksort,NA
ordersthe ,NA,NA
"elementsbytheirkeys,alphabetically.",NA,NA
Tip,NA,NA
Howtoremembersomanyfunctionnames,NA,NA
PHPhasalotoffunctionhelpersthatwillsaveyoufromwritingcustomizedfunctionsby ,NA,NA
"yourself,forexample,itprovidesyouwithupto13differentsortingfunctions.Andyou ",NA,NA
"canalwaysrelyontheofficialdocumentation.But,ofcourse,youwouldliketowritecode ",NA,NA
"withoutgoingbackandforthfromthedocs.So,herearesometipstorememberwhateach ",NA,NA
sortingfunctiondoes:,NA,NA
An,a,NA
inthenamemeans,NA,NA
associative,NA,NA
",andthus,willpreservethekey-value ",NA,NA
association.,NA,NA
An,r,NA
inthenamemeans,NA,NA
reverse,NA,NA
",sotheorderwillbefromhightolow. ",NA,NA
A,k,NA
means,NA,NA
key,NA,NA
",sothesortingwillbebasedonthekeysinsteadofthevalues.",NA,NA
Otherarrayfunctions,NA,NA
"Therearearound80differentfunctionsrelatedtoarrays.Asyoucanimagine,youwill ",NA,NA
"neverevenhearaboutsomeofthem,astheyhaveveryspecificpurposes.Thecomplete ",NA,NA
listcanbefoundat,NA,NA
http://php.net/manual/en/book.array.php,NA,NA
.,NA,NA
Wecangetalistofthekeysofthearraywith,array_keys,NA
",andalistofitsvalueswith ",array_values,NA
:,"<?php 
  
 $properties=[ 
  
 'firstname'=>'Tom', 
  
 'surname'=>'Riddle', 
  
 'house'=>'Slytherin' 
  
 ]; 
  
 $keys=array_keys($properties); 
  
 var_dump($keys); 
  
 $values=array_values($properties); 
  
 var_dump($values);",NA
Wecangetthenumberofelementsinanarraywiththe,count,NA
function:,"<?php 
  
 $names=['Harry','Ron','Hermione']; 
 $size=count($names); 
  
 var_dump($size);//3",NA
Andwecanmergetwoormorearraysintoonewith,array_merge,NA
:,"<?php 
  
 $good=['Harry','Ron','Hermione']; 
 $bad=['Dudley','Vernon','Petunia']; 
 $all=array_merge($good,$bad); 
  
 var_dump($all);",NA
Thelastexamplewillprintthefollowingarray:,"array(6){ 
  
 [0]=> 
  
 string(5)""Harry"" 
  
 [1]=> 
  
 string(3)""Ron"" 
  
 [2]=> 
  
 string(8)""Hermione"" 
  
 [3]=> 
  
 string(6)""Dudley"" 
  
 [4]=> 
  
 string(6)""Vernon"" 
  
 [5]=> 
  
 string(7)""Petunia"" 
  
 }",NA
"Asyoucansee,thekeysofthesecondarrayarenowdifferent,asoriginally,boththe ",NA,NA
"arrayshadthesamenumerickeys,andanarraycannothavetwovaluesforthesamekey.",NA,NA
PHPinwebapplications,NA,NA
"EventhoughthemainpurposeofthischapteristoshowyouthebasicsofPHP,doingitin ",NA,NA
"areference-manualkindofawayisnotinterestingenough,andifweweretocopy-paste ",NA,NA
"whattheofficialdocumentationsays,youmightaswellgothereandreaditbyyourself.",NA,NA
Keepinginmindthemainpurposeofthisbookandyourmaingoalistowriteweb ,NA,NA
"applicationswithPHP,letusshowyouhowtoapplyeverythingyouarelearningassoon ",NA,NA
"aspossible,beforeyougettoobored.",NA,NA
"Inordertodothat,wewillnowstartonajourneytowardsbuildinganonlinebookstore. ",NA,NA
"Attheverybeginning,youmightnotseetheusefulnessofit,butthatisjustbecause ",NA,NA
we’vestillnotshownallthatPHPcando.,NA,NA
Gettinginformationfromtheuser,NA,NA
"Let’sstartbybuildingahomepage.Inthispage,wearegoingtofigureoutiftheuseris ",NA,NA
lookingforabookorjustwalkingby.Howdowefindthatout?Theeasiestwayrightnow ,NA,NA
"istoinspecttheURLthattheuserusedtoaccessourapplication,andextractsome ",NA,NA
informationfromthere.,NA,NA
Savethiscontentasyour,index.php,NA
:,"<?php 
  
 $looking=isset($_GET['title'])||isset($_GET['author']); 
 ?> 
  
 <!DOCTYPEhtml> 
  
 <htmllang=""en""> 
  
 <head> 
  
 <metacharset=""UTF-8""> 
  
 <title>Bookstore</title> 
  
 </head> 
  
 <body> 
  
 <p>Youlookin'?<?phpecho(int)$looking;?></p> 
  
 <p>Thebookyouarelookingforis</p> 
  
 <ul> 
  
 <li><b>Title</b>:<?phpecho$_GET['title'];?></li> 
 <li><b>Author</b>:<?phpecho$_GET['author'];?></li> </ul> 
  
 </body> 
  
 </html>",NA
"Nowaccessthelink,","http://localhost:8000/?author=HarperLee&title=ToKilla 
 Mockingbird",NA
.Youwillseethatthepageprintssomeoftheinformationthatyoupassedon ,NA,NA
totheURL.,NA,NA
"Foreachrequest,PHPstoresalltheparametersthatcomefromthequerystringinanarray ",NA,NA
called,$_GET,NA
".Eachkeyofthearrayisthenameoftheparameter,anditsassociatedvalue ",NA,NA
isthevalueoftheparameter.So,$_GET,NA
containstwoentries:,$_GET['author'],NA
contains ,HarperLee,NA
and,$_GET['title'],NA
hasthevalue,ToKillaMockingbird,NA
.,NA,NA
"Inthefirsthighlightedline,weassignaBooleanvaluetothevariable",$looking,NA
.Ifeither ,$_GET['title'],NA
or,$_GET['author'],NA
"exists,thatvariablewillbe",true,NA
",otherwise",false,NA
. ,NA,NA
"Justafterthat,weclosethePHPtagandthenweprintsomeHTML,butasyoucansee, ",NA,NA
weareactuallymixingtheHTMLwithsomePHPcode.,NA,NA
Anotherinterestinglinehereisthesecondhighlightedone.Beforeprintingthecontentof ,$looking,NA
",wecastthevalue.",NA,NA
Casting,NA,NA
meansforcingPHPtotransformatypeofvalueto ,NA,NA
anotherone.CastingaBooleantoanintegermeansthattheresultantvaluewillbe,1,NA
ifthe ,NA,NA
Booleanis,true,NA
or,0,NA
iftheBooleanis,false,NA
.As,$looking,NA
is,true,NA
since,$_GET,NA
contains ,NA,NA
"validkeys,thepageshowsa“1”.",NA,NA
"Ifwetrytoaccessthesamepagewithoutsendinganyinformation,asin ",http://localhost:8000,NA
",thebrowserwillsay",NA,NA
Areyoulookingforabook?0,NA,NA
. ,NA,NA
"DependingonthesettingsofyourPHPconfiguration,youwillseetwonoticemessages ",NA,NA
complainingthatyouaretryingtoaccesskeysofthearraythatdonotexist.,NA,NA
Note,NA,NA
Castingversustypejuggling,NA,NA
"WealreadyknowthatwhenPHPneedsaspecifictypeofvariable,itwilltrytotransform ",NA,NA
"it,whichiscalledtypejuggling.ButPHPisquiteflexible,sosometimes,youhavetobe ",NA,NA
theonespecifyingthetypethatyouneed.Whenprintingsomethingwith,echo,NA
",PHPtries ",NA,NA
totransformeverythingitgetsintostrings.SincethestringversionoftheBoolean,false,NA
"isanemptystring,thatwouldnotbeusefulforourapplication.CastingtheBooleantoan ",NA,NA
"integerfirstassuresthatwewillseeavalue,evenifitisjusta0.",NA,NA
HTMLforms,NA,NA
HTMLformsareoneofthemostpopularwaysofcollectinginformationfromtheuser. ,NA,NA
Theyconsistofaseriesoffields—called,input,NA
intheHTMLworld—andafinal,submit,NA
"button.InHTML,the",form,NA
tagcontainstwoattributes:,action,NA
pointswheretheformwill ,NA,NA
"besubmitted,and",method,NA
",whichspecifiestheHTTPmethodthattheformwilluse(GET ",NA,NA
orPOST).Let’sseehowitworks.Savethefollowingcontentas,login.html,NA
andgoto ,http://localhost:8000/login.html,NA
.,"<!DOCTYPEhtml> 
  
 <htmllang=""en""> 
  
 <head> 
  
 <metacharset=""UTF-8""> 
  
 <title>Bookstore-Login</title> 
  
 </head> 
  
 <body> 
  
 <p>Enteryourdetailstologin:</p> 
  
 <formaction=""authenticate.php""method=""post""> 
 <label>Username</label> 
  
 <inputtype=""text""name=""username""/> 
  
 <label>Password</label> 
  
 <inputtype=""password""name=""password""/> 
 <inputtype=""submit""value=""Login""/> 
  
 </form> 
  
 </body> 
  
 </html>",NA
"Theformdefinedintheprecedingcodecontainstwofields,onefortheusernameandone ",NA,NA
forthepassword.Youcanseethattheyareidentifiedbytheattributename.Ifyoutryto ,NA,NA
"submitthisform,thebrowserwillshowyoua",NA,NA
PageNotFound,NA,NA
"message,asitistryingto ",NA,NA
access,http://localhost:8000/authenticate.php,NA
andthewebservercannotfindit.,NA,NA
Let’screateitthen:,"<?php 
  
 $submitted=!empty($_POST); 
  
 ?> 
  
 <!DOCTYPEhtml> 
  
 <htmllang=""en""> 
  
 <head> 
  
 <metacharset=""UTF-8""> 
  
 <title>Bookstore</title> 
  
 </head> 
  
 <body> 
  
 <p>Formsubmitted?<?phpecho(int)$submitted;?></p> 
  
 <p>Yourlogininfois</p> 
  
 <ul> 
  
 <li><b>username</b>:<?phpecho$_POST['username'];?></li> 
 <li><b>password</b>:<?phpecho$_POST['password'];?></li> </ul> 
  
 </body> 
  
 </html>",NA
Aswith,$_GET,NA
",",$_POST,NA
isanarraythatcontainstheparametersreceivedbyPOST.Inthis,NA,NA
"precedingpieceofcode,wefirstaskifthatarrayisnotempty—notethe",!,NA
operator. ,NA,NA
"Afterwards,wejustdisplaytheinformationreceived,justasin",index.php,NA
.Noticethatthe ,NA,NA
keysofthe,$_POST,NA
arrayarethevaluesfortheargumentnameofeachinputfield.,NA,NA
Persistingdatawithcookies,NA,NA
Whenwewantthebrowsertoremembersomedatalikewhetheryouareloggedinornot ,NA,NA
"onyourwebapplication,yourbasicinfo,andsoon,weuse",NA,NA
cookies,NA,NA
.Cookiesarestoredon ,NA,NA
theclientsideandaresenttotheserverwhenmakingarequestasheaders.AsPHPis ,NA,NA
"orientedtowardswebapplications,itallowsyoutomanagecookiesinaveryeasyway.",NA,NA
TherearefewthingsyouneedtoknowaboutcookiesandPHP.Youcanwritecookies ,NA,NA
withthe,setcookie,NA
functionthatacceptsseveralarguments:,NA,NA
Avalidnameforthecookieasastring.,NA,NA
Thevalueofthecookie—onlystringsorvaluesthatcanbecastedtoastring.This ,NA,NA
"parameterisoptional,andifnotset,PHPwillactuallyremovethecookie.",NA,NA
"Expirationtimeasatimestamp.Ifnotset,thecookiewillberemovedoncethe ",NA,NA
browserisclosed.,NA,NA
Note,NA,NA
Timestamps,NA,NA
"Computersusedifferentwaysfordescribingdatesandtimes,andaverycommonone, ",NA,NA
"especiallyonUnixsystems,istheuseoftimestamps.Theyrepresentthenumberof ",NA,NA
"secondspassedsinceJanuary1,1970.Forexample,thetimestampthatrepresentsOctober ",NA,NA
"4,2015at6:30p.m.wouldbe1,443,954,637,whichisthenumberofsecondssincethat ",NA,NA
date.,NA,NA
YoucangetthecurrenttimestampwithPHPusingthe,time,NA
function.,NA,NA
"Thereareotherargumentsrelatedtosecurity,buttheyareoutofthescopeofthissection.",NA,NA
Alsonotethatyoucanonlysetcookiesifthereisnopreviousoutputfromyour ,NA,NA
"application,thatis,beforeHTML,",echo,NA
"calls,andanyothersimilarfunctionsthatsend ",NA,NA
someoutput.,NA,NA
"Toreadthecookiesthattheclientsendstous,wejustneedtoaccessthearray,",$_COOKIE,NA
. ,NA,NA
"Itworksastheothertwoarrays,sothekeysofthearraywillbethenameofthecookies ",NA,NA
andthevalueofthearraywillbetheirvalues.,NA,NA
Averycommonusageforcookiesisauthenticatingtheuser.Thereareseveraldifferent ,NA,NA
"waysofdoingso,dependingonthelevelofsecurityyouneedforyourapplication.Let’s ",NA,NA
trytoimplementoneverysimple—albeitinsecureone(donotuseitforliveweb ,NA,NA
"applications).LeavingtheHTMLintact,updatethePHPpartofyour",authenticate.php,NA
filewiththefollowingcontent:,"<?php 
  
 setcookie('username',$_POST['username']); 
 $submitted=!empty($_POST); 
  
 ?>",NA
Dothesamewiththe,body,NA
taginyour,index.php,NA
:,"<body> 
  
 <p>Youare<?phpecho$_COOKIE['username'];?></p>",NA
Ifyouaccess,http://localhost:8000/login.html,NA
"again,trytologin,openanewtab(in ",NA,NA
"thesamebrowser),andgotothehomepageat",http://localhost:8000,NA
",youwillseehow ",NA,NA
thebrowserstillremembersyourusername.,NA,NA
Othersuperglobals,$_GET,NA
",",$_POST,NA
",and",$_COOKIE,NA
arespecialvariablescalled,NA,NA
superglobals,NA,NA
.Thereareother ,NA,NA
"superglobalstoo,like",$_SERVER,NA
or,$_ENV,NA
",whichwillgiveyouextrainformation.Thefirst ",NA,NA
"oneshowsyouinformationaboutheaders,pathsaccessed,andotherinformationrelatedt",NA,NA
o ,NA,NA
therequest.Thesecondonecontainstheenvironmentvariablesofthemachinewhereyour ,NA,NA
applicationisrunning.Youcanseethefulllistofthesearraysandtheirelementsat ,NA,NA
http://php.net/manual/es/language.variables.superglobals.php,NA,NA
.,NA,NA
"Ingeneral,usingsuperglobalsisuseful,sinceitallowsyoutogetinformationfromthe ",NA,NA
"user,thebrowser,therequest,andsoon.Thisisofimmeasurablevaluewhenwritingweb ",NA,NA
applicationsthatneedtointeractwiththeuser.Butwithgreatpowercomesgreat ,NA,NA
"responsibility,andyoushouldbeverycarefulwhenusingthesearrays.Mostofthose ",NA,NA
"valuescomefromtheusersthemselves,whichcouldleadtosecurityissues.",NA,NA
Controlstructures,NA,NA
"Sofar,ourfileshavebeenexecutedlinebyline.Duetothat,wehavebeengettingnotices ",NA,NA
"onsomescenarios,suchaswhenthearraydoesnotcontainwhatwearelookingfor. ",NA,NA
Woulditnotbeniceifwecouldchoosewhichlinestoexecute?Controlstructurestothe ,NA,NA
rescue!,NA,NA
A,NA,NA
controlstructure,NA,NA
islikeatrafficdiversionsign.Itdirectstheexecutionflowdepending ,NA,NA
"onsomepredefinedconditions.Therearedifferentcontrolstructures,butwecan ",NA,NA
categorizethemin,NA,NA
conditionals,NA,NA
and,NA,NA
loops,NA,NA
.Aconditionalallowsustochoosewhetherto ,NA,NA
executeastatementornot.Aloopexecutesastatementasmanytimesasyouneed.Let’s ,NA,NA
takealookateachoneofthem.,NA,NA
Conditionals,NA,NA
"AconditionalevaluatesaBooleanexpression,thatis,somethingthatreturnsavalue.Ifthe ",NA,NA
expressionis,true,NA
",itwillexecuteeverythinginsideitsblockofcode.Ablockofcodeisa ",NA,NA
groupofstatementsenclosedby,{},NA
.Let’sseehowitworks:,"<?php 
  
 echo""Beforetheconditional.""; 
  
 if(4>3){ 
  
 echo""Insidetheconditional.""; 
  
 } 
  
 if(3>4){ 
  
 echo""Thiswillnotbeprinted.""; 
  
 } 
  
 echo""Aftertheconditional."";",NA
"Intheprecedingpieceofcode,weusetwoconditionals.Aconditionalisdefinedbythe ",NA,NA
keyword,if,NA
followedbyaBooleanexpressioninparenthesesandbyablockofcode.If ,NA,NA
theexpressionis,true,NA
",itwillexecutetheblock,otherwiseitwillskipit.",NA,NA
Youcanincreasethepowerofconditionalsbyaddingthekeyword,else,NA
.ThistellsPHPto ,NA,NA
executesomeblockofcodeifthepreviousconditionswerenotsatisfied.Let’sseean ,NA,NA
example:,"if(2>3){ 
  
 echo""Insidetheconditional.""; 
  
 }else{ 
  
 echo""Insidetheelse.""; 
  
 }",NA
Theprecedingexamplewillexecutethecodeinsidethe,else,NA
astheconditionofthe,if,NA
wasnotsatisfied.,NA,NA
"Finally,youcanalsoaddan",elseif,NA
keywordfollowedbyanotherconditionandablockof ,NA,NA
codetocontinueaskingPHPformoreconditions.Youcanaddasmany,elseif,NA
asyou ,NA,NA
needafteran,if,NA
.Ifyouaddan,else,NA
",ithastobethelastoneofthechainofconditions. ",NA,NA
AlsokeepinmindthatassoonasPHPfindsaconditionthatresolvesto,true,NA
",itwillstop ",NA,NA
evaluatingtherestofconditions.,"<?php 
  
 if(4>5){ 
  
 echo""Notprinted""; 
  
 }elseif(4>4){ 
  
 echo""Notprinted""; 
  
 }elseif(4==4){ 
  
 echo""Printed.""; 
  
 }elseif(4>2){ 
  
 echo""Notevaluated.""; 
  
 }else{ 
  
 echo""Notevaluated.""; 
  
 } 
  
 if(4==4){ 
  
 echo""Printed"";",NA
"Inthelastexample,thefirstconditionthatevaluatesto",true,NA
isthehighlightedone.After ,NA,NA
"that,PHPdoesnotevaluateanymoreconditionsuntilanew",if,NA
starts.,NA,NA
"Withthisknowledge,let’strytocleanupourapplicationabit,executingstatementsonly ",NA,NA
whenneeded.Copythiscodetoyour,index.php,NA
file:,"<!DOCTYPEhtml> 
  
 <htmllang=""en""> 
  
 <head> 
  
 <metacharset=""UTF-8""> 
  
 <title>Bookstore</title> 
  
 </head> 
  
 <body> 
  
 <p> 
  
 <?php 
  
 if(isset($_COOKIE[username'])){ 
  
 echo""Youare"".$_COOKIE['username']; 
  
 }else{ 
  
 echo""Youarenotauthenticated.""; 
  
 } 
  
 ?> 
  
 </p> 
  
 <?php 
  
 if(isset($_GET['title'])&&isset($_GET['author'])){ 
  
 ?> 
  
 <p>Thebookyouarelookingforis</p> 
  
 <ul> 
  
 <li><b>Title</b>:<?phpecho$_GET['title'];?></li> 
 <li><b>Author</b>:<?phpecho$_GET['author'];?></li> </ul> 
  
 <?php 
  
 }else{ 
  
 ?> 
  
 <p>Youarenotlookingforabook?</p> 
  
 <?php 
  
 } 
  
 ?> 
  
 </body> 
  
 </html>",NA
"Inthisnewcode,wehavemixedconditionalsandHTMLcodeintwodifferentways.The ",NA,NA
"firstoneopensaPHPtag,andaddsan",if…else,NA
clausethatwillprintwhetherweare ,NA,NA
authenticatedornotwithan,echo,NA
".NoHTMLismergedwithintheconditionals,which ",NA,NA
makesitclear.,NA,NA
"Thesecondoption—thesecondhighlightedblock—showsanugliersolution,but ",NA,NA
"sometimesnecessary.WhenyouhavetoprintalotofHTMLcode,",echo,NA
"isnotthathandy, ",NA,NA
"anditisbettertoclosethePHPtag,printallHTMLyouneed,andthenopenthetagagain.",NA,NA
Youcandothateveninsidethecodeblockofan,if,NA
clauseasyoucanseeinthecode.,NA,NA
Note,NA,NA
MixingPHPandHTML,NA,NA
"Ifyoufeelthatthelastfileweeditedlooksratherugly,youareright.MixingPHPand ",NA,NA
"HTMLisconfusing,andyoushouldavoidit.In",NA,NA
Chapter6,NA,NA
",",NA,NA
AdaptingtoMVC,NA,NA
",wewillsee ",NA,NA
howtodothingsproperly.,NA,NA
Let’seditour,authenticate.php,NA
"filetoo,asitistryingtoaccessthe",$_POST,NA
entriesthat ,NA,NA
mightnotbethere.Thenewcontentofthefilewouldbeasfollows:,"<?php 
  
 $submitted=isset($_POST['username'])&&isset($_POST['password']); if($submitted){ 
  
 setcookie('username',$_POST['username']); 
  
 } 
  
 ?> 
  
 <!DOCTYPEhtml> 
  
 <htmllang=""en""> 
  
 <head> 
  
 <metacharset=""UTF-8""> 
  
 <title>Bookstore</title> 
  
 </head> 
  
 <body> 
  
 <?phpif($submitted):?> 
  
 <p>Yourlogininfois</p> 
  
 <ul> 
  
 <li><b>username</b>:<?phpecho$_POST['username'];?></li> 
 <li><b>password</b>:<?phpecho$_POST['password'];?></li> </ul> 
  
 <?phpelse:?> 
  
 <p>Youdidnotsubmitanything.</p> 
  
 <?phpendif;?> 
  
 </body> 
  
 </html>",NA
"Thiscodealsocontainsconditionals,whichwealreadyknow.Wearesettingavariableto ",NA,NA
"knowifwesubmittedaloginornot,andsetthecookiesifso.Butthehighlightedlines ",NA,NA
showyouanewwayofincludingconditionalswithHTML.Thismakesthecodemore ,NA,NA
"readablewhenworkingwithHTMLcode,avoidingtheuseof",{},NA
",andinsteadusing",:,NA
and ,endif,NA
".Bothsyntaxesarecorrect,andyoushouldusetheonethatyouconsidermore ",NA,NA
readableineachcase.,NA,NA
Switch…case,NA,NA
Anothercontrolstructuresimilarto,if…else,NA
is,switch…case,NA
.Thisstructureevaluatesonly ,NA,NA
"oneexpression,andexecutestheblockdependingonitsvalue.Let’sseeanexample:","<?php 
  
 switch($title){ 
  
 case'HarryPotter': 
  
 echo""Nicestory,abittoolong.""; break; 
  
 case'LordoftheRings': 
  
 echo""Aclassic!""; 
  
 break; 
  
 default: 
  
 echo""Dunnothatone.""; 
  
 break; 
  
 }",NA
The,switch,NA
"clausetakesanexpression,inthiscaseavariable,andthendefinesaseriesof ",NA,NA
"cases.Whenthecasematchesthecurrentvalueoftheexpression,PHPexecutesthecode ",NA,NA
insideit.AssoonasPHPfindsa,break,NA
"statement,itexitsthe",switch…case,NA
.Incasenone ,NA,NA
"ofthecasesaresuitablefortheexpression,PHPexecutesthedefault,ifthereisone,but ",NA,NA
thatisoptional.,NA,NA
Youalsoneedtoknowthatbreaksaremandatoryifyouwanttoexitthe,switch…case,NA
.If ,NA,NA
"youdonotspecifyany,PHPwillkeeponexecutingstatements,evenifitencountersa ",NA,NA
"newcase.Let’sseeasimilarexample,butwithoutthebreaks:","<?php 
  
 $title='Twilight'; 
  
 switch($title){ 
  
 case'HarryPotter': 
  
 echo""Nicestory,abittoolong.""; case'Twilight': 
  
 echo'Uh…'; 
  
 case'LordoftheRings': 
  
 echo""Aclassic!""; 
  
 default: 
  
 echo""Dunnothatone.""; 
  
 }",NA
"Ifyoutestthiscodeinyourbrowser,youwillseethatitprints",NA,NA
Uh…Aclassic!Dunno ,NA,NA
thatone,NA,NA
".PHPfoundthatthesecondcaseisvalid,soitexecutesitscontent.Butasthere ",NA,NA
"arenobreaks,itkeepsonexecutinguntiltheend.Thismightbethedesiredbehavior ",NA,NA
"sometimesbutnotusually,sobecarefulwhenusingit!",NA,NA
Loops,NA,NA
Loops,NA,NA
"arecontrolstructuresthatallowyoutoexecutecertainstatementsseveraltimes,as ",NA,NA
"manytimesasyouneed.Youmightusetheminseveraldifferentscenarios,butthemost ",NA,NA
"commononeiswheninteractingwitharrays.Forexample,imagineyouhaveanarray ",NA,NA
"withelements,butyoudonotknowwhatisinit.Youwanttoprintallitselements,soyou ",NA,NA
loopthroughallofthem.,NA,NA
"Therearefourtypesofloops.Eachofthemhasitsownusecases,butingeneral,youcan ",NA,NA
transformonetypeofloopintoanother.Let’slookatthemclosely.,NA,NA
While,NA,NA
The,while,NA
loopisthesimplestoftheloops.Itexecutesablockofcodeuntilthe ,NA,NA
expressiontoevaluatereturns,false,NA
.Let’sseeoneexample:,"<?php 
  
 $i=1; 
  
 while($i<4){ 
  
 echo$i.""""; 
  
 $i++; 
  
 }",NA
"Intheprecedingexample,wedefineavariablewithvalue",1,NA
.Thenwehavea,while,NA
clause ,NA,NA
inwhichtheexpressiontoevaluateis,$i<4,NA
.Thisloopexecutesthecontentoftheblock ,NA,NA
ofcodeuntilthatexpressionis,false,NA
".Asyoucansee,insidetheloopweareincrementing ",NA,NA
thevalueof,$i,NA
"by1eachtime,sotheloopendsafter4iterations.Checktheoutputofthat ",NA,NA
"scriptandyouwillsee“0123”.Thelastvalueprintedis3,soatthattimethevalueof",$i,NA
"was3.Afterthat,weincreaseditsvalueto4,sowhenthe",while,NA
clauseevaluatesif,"$i< 
 4",NA
",theresultis",false,NA
.,NA,NA
Note,NA,NA
Whilesandinfiniteloops,NA,NA
Oneofthemostcommonproblemswiththe,while,NA
loopsiscreatinganinfiniteloop.If ,NA,NA
youdonotaddanycodeinsidethe,while,NA
loopthatupdatesanyofthevariablesconsidered ,NA,NA
inthe,while,NA
expressionsuchthatitcanbe,false,NA
"atsomepoint,PHPwillneverexitthe loop!",NA,NA
Do…while,NA,NA
The,do…while,NA
loopisverysimilarto,while,NA
inthesensethatitevaluatesanexpression ,NA,NA
"eachtime,andwillexecutetheblockofcodeuntilthatexpressionis",false,NA
.Theonly ,NA,NA
"differenceisthatwhenthisexpressionisevaluated,the",while,NA
clauseevaluatesthe ,NA,NA
"expressionbeforeexecutingthecode,sosometimes,wemightnotevenentertheloopif ",NA,NA
theexpressionevaluatesto,false,NA
"theveryfirsttime.Ontheotherhand,",do…while,NA
"evaluatestheexpressionafteritexecutesitsblockofcode,soeveniftheexpressionis ",false,NA
"fromtheverybeginning,theloopwillbeexecutedatleastonce.",<?php,NA
Theprecedingpieceofcodedefinestwoloopswiththesameexpressionandblockof ,NA,NA
"code,butifyouexecutethem,youwillseethatonlythecodeinsidethe",do…while,NA
is ,NA,NA
"executed.Inbothcases,theexpressionis",false,NA
"sincethebeginning,so",while,NA
doesnot ,NA,NA
"evenentertheloop,whereasthe",do…while,NA
entersthelooponce.,NA,NA
For,NA,NA
The,for,NA
"loopisthemostcomplexofthefourloops.Itdefinesaninitializationexpression, ",NA,NA
"anexitcondition,andtheendofaniterationexpression.WhenPHPfirstencountersthe ",NA,NA
"loop,itexecuteswhatisdefinedastheinitializationexpression.Then,itevaluatestheexit ",NA,NA
conditionandifitresolvesto,true,NA
",itenterstheloop.Afterexecutingeverythinginside ",NA,NA
"theloop,itexecutestheendoftheiterationexpression.Oncedone,itevaluatestheend ",NA,NA
"conditionagain,goingthroughtheloopcodeandtheendoftheiterationexpression,until ",NA,NA
itevaluatesto,false,NA
".Asalways,anexamplewillclarifyit:","<?php 
  
 for($i=1;$i<10;$i++){ 
  
 echo$i.""""; 
  
 }",NA
Theinitializationexpressionis,$i=1,NA
",andisexecutedonlythefirsttime.Theexit ",NA,NA
conditionis,$i<10,NA
",anditisevaluatedatthebeginningofeachiteration.Theendofthe ",NA,NA
iterationexpressionis,$i++,NA
",whichisexecutedattheendofeachiteration.Thisexample ",NA,NA
printsthenumbersfrom1to9.Anothermorecommonusageofthe,for,NA
loopiswith arrays:,"<?php 
  
 $names=['Harry','Ron','Hermione']; 
 for($i=0;$i<count($names);$i++){ echo$names[$i].""""; 
  
 }",NA
"Inthisexample,wehaveanarrayofnames.Sinceitisdefinedasalist,itskeyswillbe0, ",NA,NA
"1,and2.Theloopinitializesthevariable",$i,NA
"to0,andititeratesuntilthevalueof",$i,NA
isnot ,NA,NA
"lessthanthenumberofelementsinthearray,thatis,3.Inthefirstiteration,",$i,NA
"is0,inthe ",NA,NA
"second,itis1,andinthethirdoneitisequalto2.When",$i,NA
"is3,itwillnotentertheloop, ",NA,NA
astheexitconditionevaluatesto,false,NA
.,NA,NA
"Oneachiteration,weprintthecontentoftheposition",$i,NA
"ofthearray,hencetheresultof ",NA,NA
thiscodewillbeallthreenamesinthearray.,NA,NA
Tip,NA,NA
Becarefulwithexitconditions,NA,NA
"Itisverycommontosetanexitconditionthatisnotexactlywhatweneed,especiallywith ",NA,NA
"arrays.Rememberthatarraysstartwith0iftheyarealist,soanarrayofthreeelements ",NA,NA
"willhaveentriesof0,1,and2.Definingtheexitconditionas",$i<=count($array),NA
will ,NA,NA
"causeanerrorinyourcode,aswhen",$i,NA
"is3,italsosatisfiestheexitconditionandwilltry ",NA,NA
"toaccessthekey3,whichdoesnotexist.",NA,NA
Foreach,NA,NA
"Thelast,butnotleast,typeofloopis",foreach,NA
".Thisloopisexclusiveforarrays,andit ",NA,NA
"allowsyoutoiterateanarrayentirely,evenifyoudonotknowitskeys.Therearetwo ",NA,NA
"optionsforthesyntax,asyoucanseeinthefollowingexamples:","<?php 
  
 $names=['Harry','Ron','Hermione']; 
 foreach($namesas$name){ 
  
 echo$name.""""; 
  
 } 
  
 foreach($namesas$key=>$name){ echo$key.""-
 >"".$name.""""; }",NA
The,foreach,NA
loopacceptsanarray—inthiscase,$names,NA
—anditspecifiesavariablewhich ,NA,NA
willcontainthevalueoftheentryofthearray.Youcanseethatwedonotneedtospecify ,NA,NA
"anyendcondition,asPHPwillknowwhenthearrayhasbeeniterated.Optionally,youcan ",NA,NA
"specifyavariablethatcontainsthekeyofeachiteration,asinthesecondloop.",NA,NA
The,foreach,NA
"loopsarealsousefulwithmaps,wherethekeysarenotnecessarilynumeric. ",NA,NA
TheorderinwhichPHPiteratesthearraywillbethesameorderthatyouusedtoinsertthe ,NA,NA
contentsinthearray.,NA,NA
Let’susesomeloopsinourapplication.Wewanttoshowtheavailablebooksinourhome ,NA,NA
"page.Wehavethelistofbooksinanarray,sowewillhavetoiterateallofthemwitha ",foreach,NA
"loop,printingsomeinformationfromeachone.Appendthefollowingcodetothe ",body,NA
tagin,index.php,NA
:,"<?phpendif; 
  
 $books=[ 
  
 [ 
  
 'title'=>'ToKillAMockingbird', 'author'=>'HarperLee', 
  
 'available'=>true, 
  
 'pages'=>336, 
  
 'isbn'=>9780061120084 
  
 ], 
  
 [ 
  
 'title'=>'1984', 
  
 'author'=>'GeorgeOrwell', 
  
 'available'=>true, 
  
 'pages'=>267,",NA
Thehighlightedcodeshowsa,foreach,NA
loopusingthe,:,NA
"notationaswell,whichisbetter ",NA,NA
whenmixingitwithHTML.Ititeratesallofthe,$books,NA
"array,andforeachbook,itprints ",NA,NA
"someinformationasanHTMLlist.Noticealsothatwehaveaconditionalinsidealoop, ",NA,NA
"whichisperfectlyfine.Ofcourse,thisconditionalwillbeexecutedforeachentryinthe ",NA,NA
"array,soyoushouldkeeptheblockofcodeofyourloopsassimpleaspossible.",NA,NA
Functions,NA,NA
"Afunctionisareusableblockofcodethat,givenaninput,performssomeactionsand, ",NA,NA
"optionally,returnssomeresult.Youalreadyknowseveralpredefinedfunctionslike",empty,NA
", ",in_array,NA
",or",var_dump,NA
.ThosefunctionscomewithPHPsoyoudonothavetoreinvent ,NA,NA
"thewheel,butyoucancreateyourownveryeasily.Youcandefinefunctionswhenyou ",NA,NA
"identifyportionsofyourapplicationthathavetobeexecutedseveraltimes,orjustto ",NA,NA
encapsulatesomefunctionality.,NA,NA
Functiondeclaration,NA,NA
"Declaringafunctionmeanswritingitdownsoitcanbeusedlater.Afunctionhasaname, ",NA,NA
"takessomearguments,andhasablockofcode.Optionally,itcandefinewhatkindof ",NA,NA
valueistobereturned.Thenameofthefunctionhastofollowthesamerulesasvariable ,NA,NA
"names,thatis,ithastostartwithaletteroranunderscore,andcancontainanyletters, ",NA,NA
"numbers,orunderscore.Itcannotbeareservedword.",NA,NA
Let’sseeasimpleexample:,"functionaddNumbers($a,$b){ 
  
 $sum=$a+$b; 
  
 return$sum; 
  
 } 
  
 $result=addNumbers(2,3);",NA
Theprecedingfunction’snameis,addNumbers,NA
",andittakestwoarguments:",$a,NA
and,$b,NA
.The ,NA,NA
blockofcodedefinesanewvariable,$sum,NA
",whichisthesumofbotharguments,andthen ",NA,NA
returnsitscontentwith,return,NA
".Inordertousethisfunction,youjustneedtocallitbyits ",NA,NA
"namewhilesendingalltherequiredarguments,asshowninthehighlightedline.",NA,NA
PHPdoesnotsupport,NA,NA
overloadedfunctions,NA,NA
.Overloadingreferstotheabilityofdeclaring ,NA,NA
"twoormorefunctionswiththesamenamebutdifferentarguments.Asyoucansee,you ",NA,NA
"candeclaretheargumentswithoutknowingwhattheirtypesare,soPHPwouldnotbe ",NA,NA
abletodecidewhichfunctiontouse.,NA,NA
Anotherimportantthingtonoteisthe,NA,NA
variablescope,NA,NA
.Wearedeclaringavariable,$sum,NA
"insidetheblockofcode,sooncethefunctionends,thevariablewillnotbeaccessibleany ",NA,NA
more.Thatmeansthatthescopeofvariablesdeclaredinsidethefunctionisjustthe ,NA,NA
"functionitself.Furthermore,ifyouhadavariable",$sum,NA
"declaredoutsidethefunction,it ",NA,NA
wouldnotbeaffectedatallsincethefunctioncannotaccessthatvariableunlesswesendit ,NA,NA
asanargument.,NA,NA
Functionarguments,NA,NA
Afunctiongetsinformationfromoutsideviaarguments.Youcandefineanynumberof ,NA,NA
arguments—including0(none).Theseargumentsneedatleastanamesotheycanbeused ,NA,NA
insidethefunction;therecannotbetwoargumentswiththesamename.Wheninvoking ,NA,NA
"thefunction,youneedtosendtheargumentsinthesameorderasdeclared.",NA,NA
Afunctionmaycontain,NA,NA
optionalarguments,NA,NA
",thatis,youarenotforcedtoprovideavalue ",NA,NA
"forthosearguments.Whendeclaringthefunction,youneedtoprovideadefaultvaluefor ",NA,NA
"thosearguments.So,incasetheuserdoesnotprovideavalue,thefunctionwillusethe ",NA,NA
defaultone.,"functionaddNumbers($a,$b,$printResult=false){ 
 $sum=$a+$b; 
  
 if($printResult){ 
  
 echo'Theresultis'.$sum; 
  
 } 
  
 return$sum; 
  
 }
  
 $sum1=addNumbers(1,2); 
  
 $sum1=addNumbers(3,4,false); 
  
 $sum1=addNumbers(5,6,true);//itwillprinttheresult",NA
Thisnewfunctioninthelastexampletakestwomandatoryargumentsandanoptional ,NA,NA
one.Thedefaultvalueoftheoptionalargumentis,false,NA
",anditisthenusednormally ",NA,NA
insidethefunction.Thefunctionwillprinttheresultofthesumiftheuserprovides,true,NA
"asthethirdargument,whichhappensonlythethirdtimethatthefunctionisinvoked.For ",NA,NA
"thefirsttwo,",$printResult,NA
issetto,false,NA
.,NA,NA
Theargumentsthatthefunctionreceivesarejustcopiesofthevaluesthattheuser ,NA,NA
"provided.Thatmeansthatifyoumodifytheseargumentsinsidethefunction,itwillnot ",NA,NA
affecttheoriginalvalues.Thisfeatureisknownassendingargumentsbyvalue.Let’ssee ,NA,NA
anexample:,"functionmodify($a){ 
  
 $a=3; 
  
 }
  
 $a=2; 
  
 modify($a); 
  
 var_dump($a);//prints2",NA
Wearedeclaringavariable,$a,NA
withvalue,2,NA
",andthencallingthe",modify,NA
methodsending ,NA,NA
that,$a,NA
.The,modify,NA
methodmodifiestheargument,$a,NA
",settingitsvalueto",3,NA
",butthisdoes ",NA,NA
notaffecttheoriginalvalueof,$a,NA
",whichremains",2,NA
asyoucanseefrom,var_dump,NA
.,NA,NA
Ifwhatyouwantistoactuallychangethevalueoftheoriginalvariableusedinthe ,NA,NA
"invocation,youneedtopasstheargumentbyreference.Todothat,youaddanampersand ",NA,NA
(,&,NA
)beforetheargumentwhendeclaringthefunction:,functionmodify(&$a){,NA
"Now,oninvokingthefunction",modify,NA
",",$a,NA
willalwaysbe,3,NA
.,NA,NA
Note,NA,NA
Argumentsbyvalueversusbyreference,NA,NA
"PHPallowsyoutodoit,andinfact,somenativefunctionsofPHPuseargumentsby ",NA,NA
"reference.Rememberthearraysortingfunctions?Theydidnotreturnthesortedarray,bu",NA,NA
t sortedthearrayprovidedinstead.Butusingargumentsbyreferenceisawayofconfusing ,NA,NA
"developers.Usually,whensomeoneusesafunction,theyexpectaresult,andtheydonot ",NA,NA
wanttheargumentsprovidedbythemtobemodified.Sotrytoavoidit;peoplewillbe ,NA,NA
grateful!,NA,NA
Thereturnstatement,NA,NA
Youcanhaveasmany,return,NA
"statementsasyouwantinsideyourfunction,butPHPwill ",NA,NA
exitthefunctionassoonasitfindsone.Thatmeansthatifyouhavetwoconsecutive ,return,NA
"statements,thesecondonewillneverbeexecuted.Still,havingmultiple",return,NA
statementscanbeusefuliftheyareinsideconditionals.Addthisfunctioninsideyour ,functions.php,NA
file:,"functionloginMessage(){ 
  
 if(isset($_COOKIE['username'])){ 
  
 return""Youare"".$_COOKIE['username']; }else{ 
  
 return""Youarenotauthenticated.""; 
  
 } 
  
 }",NA
Andlet’susethelastexampleinyour,index.php,NA
filebyreplacingthehighlightedcontent ,NA,NA
"(notethattosavesometrees,Ireplacedmostofthecodethatwasnotchangedatallwith ",//…,NA
):,"//...
  
 <body> 
  
 <p><?phpechologinMessage();?></p> 
  
 <?phpif(isset($_GET['title'])&&isset($_GET['author'])):?> //...",NA
"Additionally,youcanomitthe",return,NA
statementifyoudonotwantthefunctiontoreturn ,NA,NA
"anything.Inthiscase,thefunctionwillendonceitreachestheendoftheblockofcode.",NA,NA
Typehintingandreturntypes,NA,NA
"WiththereleaseofPHP7,thelanguageallowsthedevelopertobemorespecificabout ",NA,NA
whatfunctionsaregettingandreturning.Youcan—alwaysoptionally—specifythetypeof ,NA,NA
argumentthatthefunctionneeds(,NA,NA
typehinting,NA,NA
"),andthetypeofresultthefunctionwill ",NA,NA
return(,NA,NA
returntype,NA,NA
).Let’sfirstseeanexample:,"<?php
  
 declare(strict_types=1);
  
 functionaddNumbers(int$a,int$b,bool$printSum):int{ 
 $sum=$a+$b; 
  
 if($printSum){ 
  
 echo'Thesumis'.$sum; 
  
 } 
  
 return$sum; 
  
 }
  
 addNumbers(1,2,true); 
  
 addNumbers(1,'2',true);//itfailswhenstrict_typesis1 
 addNumbers(1,'something',true);//italwaysfails",NA
"Thisprecedingfunctionstatesthattheargumentsneedtobeinteger,integer,andBoolean, ",NA,NA
"andthattheresultwillbeaninteger.Now,youknowthatPHPhastypejuggling,soitcan ",NA,NA
"usuallytransformavalueofonetypetoitsequivalentvalueofanothertype,forexample, ",NA,NA
thestring“2”canbeusedasinteger2.TostopPHPfromusingtypejugglingwiththe ,NA,NA
"argumentsandresultsoffunctions,youcandeclarethedirective",strict_types,NA
asshown ,NA,NA
inthefirsthighlightedline.Thisdirectivehastobedeclaredatthetopofeachfilewhere ,NA,NA
youwanttoenforcethisbehavior.,NA,NA
Thethreeinvocationsworkasfollows:,NA,NA
"ThefirstinvocationsendstwointegersandaBoolean,whichiswhatthefunction ",NA,NA
"expects,soregardlessofthevalueof",strict_types,NA
",itwillalwayswork.",NA,NA
"Thesecondinvocationsendsaninteger,astring,andaBoolean.Thestringhasa ",NA,NA
"validintegervalue,soifPHPwasallowedtousetypejuggling,theinvocationwould ",NA,NA
"resolvejustnormally.Butinthisexample,itwillfailbecauseofthedeclarationatthe ",NA,NA
topofthefile.,NA,NA
Thethirdinvocationwillalwaysfailasthestring“something”cannotbetransformed ,NA,NA
intoavalidinteger.,NA,NA
Let’strytouseafunctionwithinourproject.Inour,index.php,NA
",wehavea",foreach,NA
loop ,NA,NA
thatiteratesthebooksandprintsthem.Thecodeinsidetheloopiskindofhardto ,NA,NA
"understandasitisamixofHTMLwithPHP,andthereisaconditionaltoo.Let’stryto ",NA,NA
"abstractthelogicinsidetheloopintoafunction.First,createthenew",functions.php,NA
file ,NA,NA
withthefollowingcontent:,"<?php 
  
 functionprintableTitle(array$book):string{ 
  
 $result='<i>'.$book['title'].'</i>-'.$book['author'];",NA
"Thisfilewillcontainourfunctions.Thefirstone,",printableTitle,NA
",takesanarray ",NA,NA
"representingabook,andbuildsastringwithanicerepresentationofthebookinHTML. ",NA,NA
"Thecodeisthesameasbefore,justencapsulatedinafunction.",NA,NA
Now,index.php,NA
willhavetoincludethe,functions.php,NA
"file,andthenusethefunction ",NA,NA
insidetheloop.Let’sseehow:,"<?phprequire_once'functions.php'?> 
  
 <!DOCTYPEhtml> 
  
 <htmllang=""en"">
  
 //...
  
 ?> 
  
 <ul> 
  
 <?phpforeach($booksas$book):?> 
  
 <li><?phpechoprintableTitle($book);?></li> 
 <?phpendforeach;?> 
  
 </ul>
  
 //...",NA
"Well,nowourlooplookswaycleaner,right?Also,ifweneedtoprintthetitleofthebook ",NA,NA
"somewhereelse,wecanreusethefunctioninsteadofduplicatingcode!",NA,NA
Thefilesystem,NA,NA
"Asyoumighthavealreadynoticed,PHPcomeswithalotofnativefunctionsthathelpyou ",NA,NA
tomanagearraysandstringsinaneasierwayascomparedtootherlanguages.The ,NA,NA
filesystemisanotherofthoseareaswherePHPtriedtomakeitaseasyaspossible.Thelist ,NA,NA
"offunctionsextendstoover80differentones,sowewillcoverherejusttheonesthatyou ",NA,NA
aremorelikelytouse.,NA,NA
Readingfiles,NA,NA
"Inourcode,wedefinealistofbooks.Sofar,wehaveonlythreebooks,butyoucanguess ",NA,NA
"thatifwewanttomakethisapplicationuseful,thelistwillgrowwaymore.Storingthe ",NA,NA
"informationinsideyourcodeisnotpracticalatall,sowehavetostartthinkingabout ",NA,NA
externalizingit.,NA,NA
"Ifwethinkintermsofseparatingthecodefromthedata,thereisnoneedtokeepusing ",NA,NA
PHParraystodefinethebooks.Usingalesslanguage-restrictivesystemwillallowpeople ,NA,NA
"whodonotknowPHPtoeditthecontentofthefile.Therearemanysolutionsforthis,like ",NA,NA
"CSVorXMLfiles,butnowadays,oneofthemostusedsystemstorepresentdatainweb ",NA,NA
applicationsisJSON.PHPallowsyoutoconvertarraystoJSONandviceversausingjust ,NA,NA
acoupleoffunctions:,json_encode,NA
and,json_decode,NA
".Easy,right?",NA,NA
Savethefollowinginto,books.json,NA
:,"[ 
  
 { 
  
 ""title"":""ToKillAMockingbird"", 
  
 ""author"":""HarperLee"", 
  
 ""available"":true, 
  
 ""pages"":336, 
  
 ""isbn"":9780061120084 
  
 }, 
  
 { 
  
 ""title"":""1984"", 
  
 ""author"":""GeorgeOrwell"", 
  
 ""available"":true, 
  
 ""pages"":267, 
  
 ""isbn"":9780547249643 
  
 }, 
  
 { 
  
 ""title"":""OneHundredYearsOfSolitude"", 
 ""author"":""GabrielGarciaMarquez"", 
  
 ""available"":false, 
  
 ""pages"":457, 
  
 ""isbn"":9785267006323 
  
 } 
  
 ]",NA
"TheprecedingcodesnippetisaJSONrepresentationofourarrayinPHP.Now,let’sread ",NA,NA
thisinformationwiththefunction,file_get_contents,NA
",andtransformittoaPHParray ",NA,NA
with,json_decode,NA
.Replacethearraywiththesetwolines:,"$booksJson=file_get_contents('books.json'); 
 $books=json_decode($booksJson,true);",NA
"Withjustonefunction,weareabletostoreallthecontentfromtheJSONfileinavariable ",NA,NA
"asastring.Withthefunction,wetransformthisJSONstringintoanarray.Thesecond ",NA,NA
argumentin,json_decode,NA
"tellsPHPtotransformittoanarray,otherwiseitwoulduse ",NA,NA
"objects,whichwehavenotcoveredasyet.",NA,NA
"WhenreferencingfileswithinPHPfunctions,youneedtoknowwhethertouseabsolute",NA,NA
"orrelativepaths.Whenusingrelativepaths,PHPwilltrytofindthefileinsidethesame ",NA,NA
"directorywherethePHPscriptis.Ifnotfound,PHPwilltrytofinditinotherdirectories ",NA,NA
definedinthe,include_path,NA
"directive,butthatissomethingyouwouldliketoavoid. ",NA,NA
"Instead,youcoulduseabsolutepaths,whichisawaytomakesurethereferencewillnot ",NA,NA
bemisunderstood.Let’sseetwoexamples:,"$booksJson=file_get_contents('/home/user/bookstore/books.json'); 
 $booksJson=file_get_contents(__DIR__,'/books.json');",NA
Theconstant,__DIR__,NA
"containsthedirectorynameofthecurrentPHPfile,andifwe ",NA,NA
"prefixittothenameofourfile,wewillhaveanabsolutepath.Infact,eventhoughyou ",NA,NA
"mightthinkthatwritingdownthewholepathbyyourselfisbetter,using",__DIR__,NA
allows ,NA,NA
youtomoveyourapplicationanywhereelsewithoutneedingtochangeanythinginthe ,NA,NA
"code,asitscontentwillalwaysmatchthedirectoryofthescript,whereasthehardcoded ",NA,NA
pathfromthefirstexamplewillnotbevalidanymore.,NA,NA
Writingfiles,NA,NA
Let’saddsomefunctionalitytoourapplication.Imaginethatwewanttoallowtheuserto ,NA,NA
"takethebookthatheorsheislookingfor,butonlyifitisavailable.Ifyouremember,we ",NA,NA
"identifythebookbythequerystring.Thatisnotverypractical,solet’shelptheuserby ",NA,NA
"addinglinkstothelistofbooks,sowhenyouclickonalink,thequerystringwillcontain ",NA,NA
thatbook’sinformation.,"<?phprequire_once'functions.php'?> 
  
 <!DOCTYPEhtml> 
  
 <htmllang=""en""> 
  
 <head> 
  
 <metacharset=""UTF-8""> 
  
 <title>Bookstore</title> 
  
 </head> 
  
 <body> 
  
 <p><?phpechologinMessage();?></p> 
  
 <?php 
  
 $booksJson=file_get_contents('books.json'); 
  
 $books=json_decode($booksJson,true); 
  
 if(isset($_GET['title'])){ 
  
 echo'<p>Lookingfor<b>'.$_GET['title'].'</b></p>'; }else{ 
  
 echo'<p>Youarenotlookingforabook?</p>'; 
  
 } 
  
 ?> 
  
 <ul> 
  
 <?phpforeach($booksas$book):?> 
  
 <li> 
  
 <ahref=""?title=<?phpecho$book['title'];?>""> 
 <?phpechoprintableTitle($book);?> 
  
 </a> 
  
 </li> 
  
 <?phpendforeach;?> 
  
 </ul> 
  
 </body> 
  
 </html>",NA
"Ifyoutrytheprecedingcodeinyourbrowser,youwillseethatthelistcontainslinks,and ",NA,NA
"byclickingonthem,thepagerefresheswiththenewtitleaspartofthequerystring.Let’s ",NA,NA
"nowcheckifthebookisavailableornot,andifitis,let’supdateitsavailablefieldto ",false,NA
.Addthefollowingfunctioninyour,functions.php,NA
:,"functionbookingBook(array&$books,string$title):bool{ 
 foreach($booksas$key=>$book){ 
  
 if($book['title']==$title){ 
  
 if($book['available']){ 
  
 $books[$key]['available']=false; 
  
 returntrue; 
  
 }else{ 
  
 returnfalse; 
  
 } 
  
 } 
  
 }",NA
Wehavetopayattentionasthecodestartsgettingcomplex.Thisfunctiontakesanarray ,NA,NA
"ofbooksandatitle,andreturnsaBoolean,being",true,NA
ifitcouldbookitor,false,NA
ifnot. ,NA,NA
"Moreover,thearrayofbooksispassedbyreference,whichmeansthatallchangestothat ",NA,NA
"arraywillaffecttheoriginalarraytoo.Eventhoughwediscouragedthispreviously,inthis ",NA,NA
"case,itisareasonableapproach.",NA,NA
"Weiteratethewholearrayofbooks,askingeachtimeifthetitleofthecurrentbook ",NA,NA
matchestheonewearelookingfor.Onlyifthatis,true,NA
",wewillcheckifthebookis ",NA,NA
"availableornot.Ifitis,wewillupdatetheavailabilityto",false,NA
andreturn,true,NA
",meaning ",NA,NA
"thatwebookedthebook.Ifthebookisnotavailable,wewilljustreturn",false,NA
.,NA,NA
"Finally,notethat",foreach,NA
defines,$key,NA
and,$book,NA
.Wedosobecausethe,$book,NA
variableis ,NA,NA
acopyofthe,$books,NA
"array,andifweeditit,theoriginalonewillnotbeaffected.Instead, ",NA,NA
"weaskforthekeyofthatbooktoo,sowheneditingthearray,weuse",$books[$key],NA
insteadof,$book,NA
.,NA,NA
Wecanusethisfunctionfromthe,index.php,NA
file:,"//...
  
 echo'<p>Lookingfor<b>'.$_GET['title'].'</b></p>'; 
 if(bookingBook($books,$_GET['title'])){ 
  
 echo'Booked!'; 
  
 }else{ 
  
 echo'Thebookisnotavailable…'; 
  
 } 
  
 }else{ 
  
 //...",NA
"Tryitoutinyourbrowser.Byclickingonanavailablebook,youwillgetthe",NA,NA
Booked!,NA,NA
message.Wearealmostdone!Wearejustmissingthelastpart:persistthisinformation ,NA,NA
"backtothefilesystem.Inordertodothat,wehavetoconstructthenewJSONcontentand ",NA,NA
thentowriteitbacktothe,books.json,NA
"file.Ofcourse,let’sdothatonlyifthebookwas available.","functionupdateBooks(array$books){ 
  
 $booksJson=json_encode($books); 
  
 file_put_contents(__DIR__.'/books.json',$booksJson); }",NA
The,json_encode,NA
functiondoestheoppositeof,json_decode,NA
:ittakesanarray—orany ,NA,NA
othervariable—andtransformsittoJSON.The,file_put_contents,NA
functionisusedto ,NA,NA
"writetothefilereferencedasthefirstargument,thecontentsentasthesecondargument. ",NA,NA
Wouldyouknowhowtousethisfunction?,"//...
  
 if(bookingBook($books,$_GET['title'])){ echo'Booked!'; 
  
 updateBooks($books); 
  
 }else{ 
  
 echo'Thebookisnotavailable…';",NA
Note,NA,NA
Filesversusdatabases,NA,NA
"StoringinformationinJSONfilesisbetterthanhavingitinyourcode,butitisstillnotthe ",NA,NA
bestoption.In,NA,NA
Chapter5,NA,NA
",",NA,NA
UsingDatabases,NA,NA
",youwilllearnhowtostoredataofthe ",NA,NA
"applicationinadatabase,whichisawaybettersolution.",NA,NA
Otherfilesystemfunctions,NA,NA
"Ifyouwanttomakeyourapplicationmorerobust,youcouldcheckthatthe",books.json,NA
"fileexists,thatyouhavereadandwritepermission,and/orthatthepreviouscontentwasa ",NA,NA
validJSON.YoucanusesomePHPfunctionsforthat:,file_exists,NA
":Thisfunctiontakesthepathofthefile,andreturnsaBoolean:",true,NA
whenthefileexistsand,false,NA
otherwise.,is_writable,NA
:Thisfunctionworksthesameas,file_exists,NA
",butcheckswhetherthe ",NA,NA
fileiswritableornot.,NA,NA
Youcanfindthefulllistoffunctionsat,NA,NA
http://uk1.php.net/manual/en/book.filesystem.p,NA,NA
hp,NA,NA
. ,NA,NA
"Youcanfindfunctionstomove,copy,orremovefiles,createdirectories,givepermissions ",NA,NA
"andownership,andsoon.",NA,NA
Summary,NA,NA
"Inthischapter,wewentthroughallthebasicsofproceduralPHPwhilewritingsimple ",NA,NA
examplesinordertopracticethem.Younowknowhowtousevariablesandarrayswith ,NA,NA
"controlstructuresandfunctions,howtogetinformationfromHTTPrequests,andhowto ",NA,NA
interactwiththefilesystemamongotherthings.,NA,NA
"Inthenextchapter,wewillstudytheotherandmostusedparadigm:OOP.Thatisonestep ",NA,NA
closertowritingcleanandwell-structuredapplications.,NA,NA
Chapter4.CreatingCleanCodewith,NA,NA
OOP,NA,NA
"Whenapplicationsstartgrowing,representingmorecomplexdatastructuresbecomes ",NA,NA
"necessary.Primitivetypeslikeintegers,strings,orarraysarenotenoughwhenyouwantto ",NA,NA
"associatespecificbehaviortodata.Morethanhalfacenturyago,computerscientists ",NA,NA
startedusingtheconceptofobjectstorefertotheencapsulationofpropertiesand ,NA,NA
functionalitythatrepresentedanobjectinreallife.,NA,NA
"Nowadays,OOPisoneofthemostusedprogrammingparadigms,andyouwillbegladto ",NA,NA
knowthatPHPsupportsit.KnowingOOPisnotjustamatterofknowingthesyntaxofthe ,NA,NA
"language,butknowingwhenandhowtouseit.Butdonotworry,afterthischapteranda ",NA,NA
"bitofpractice,youwillbecomeaconfidentOOPdeveloper.",NA,NA
"Inthischapter,youwilllearnaboutthefollowing:",NA,NA
Classesandobjects ,NA,NA
"Visibility,staticproperties,andmethod",NA,NA
s ,NA,NA
Namespaces ,NA,NA
Autoloadingclasses,NA,NA
"Inheritance,interfaces,andtraits ",NA,NA
Handlingexceptions ,NA,NA
Designpatterns ,NA,NA
Anonymousfunctions,NA,NA
Classesandobjects,NA,NA
Objects,NA,NA
arerepresentationsofreal-lifeelements.Eachobjecthasasetofattributesthat ,NA,NA
"differentiatesitfromtherestoftheobjectsofthesameclass,andiscapableofasetof ",NA,NA
actions.A,NA,NA
class,NA,NA
"isthedefinitionofwhatanobjectlookslikeandwhatitcando,likea ",NA,NA
patternforobjects.,NA,NA
"Let’stakeourbookstoreexample,andthinkofthekindofreal-lifeobjectsitcontains.We ",NA,NA
"storebooks,andletpeopletakethemiftheyareavailable.Wecouldthinkoftwotypesof ",NA,NA
objects:booksandcustomers.Wecandefinethesetwoclassesasfollows:,"<?php
  
 classBook{ 
  
 }
  
 classCustomer{ 
  
 }",NA
Aclassisdefinedbythekeyword,class,NA
followedbyavalidclassname—thatfollowsthe ,NA,NA
"samerulesasanyotherPHPlabel,likevariablenames—andablockofcode.Butifwe ",NA,NA
"wanttohaveaspecificbook,thatis,anobject",Book,NA
—orinstanceoftheclass,Book,NA
—we ,NA,NA
"havetoinstantiateit.Toinstantiateanobject,weusethekeyword",new,NA
followedbythe ,NA,NA
"nameoftheclass.Weassigntheinstancetoavariable,asifitwasaprimitivetype:","$book=newBook(); 
  
 $customer=newCustomer();",NA
"Youcancreateasmanyinstancesasyouneed,aslongasyouassignthemtodifferent ",NA,NA
variables:,"$book1=newBook(); 
  
 $book2=newBook();",NA
Classproperties,NA,NA
"Let’sthinkaboutthepropertiesofbooksfirst:theyhaveatitle,anauthor,andanISBN. ",NA,NA
Theycanalsobeavailableorunavailable.Writethefollowingcodeinside,Book.php,NA
:,"<?php
  
 classBook{ 
  
 public$isbn; 
  
 public$title; 
  
 public$author; 
  
 public$available; 
  
 }",NA
Thisprecedingsnippetdefinesaclassthatrepresentsthepropertiesthatabookhas.Do ,NA,NA
notbotherabouttheword,public,NA
;wewillexplainwhatitmeanswhentalkingabout ,NA,NA
"visibilityinthenextsection.Fornow,justthinkofpropertiesasvariablesinsidetheclass. ",NA,NA
Wecanusethesevariablesinobjects.Tryaddingthiscodeattheendofthe,Book.php,NA
file:,"$book=newBook(); 
  
 $book->title=""1984""; 
  
 $book->author=""GeorgeOrwell""; 
  
 $book->available=true; 
  
 var_dump($book);",NA
"Printingtheobjectshowsthevalueofeachofitsproperties,inawaysimilartotheway ",NA,NA
arraysdowiththeirkeys.Youcanseethatpropertieshaveatypeatthemomentof ,NA,NA
"printing,butwedidnotdefinethistypeexplicitly;instead,thevariabletookthetypeof ",NA,NA
thevalueassigned.Thisworksexactlythesamewaythatnormalvariablesdo.,NA,NA
"Whencreatingmultipleinstancesofanobjectandassigningvaluestotheirproperties, ",NA,NA
"eachobjectwillhavetheirownvalues,soyouwillnotoverridethem.Thenextbitofcode ",NA,NA
showsyouhowthisworks:,"$book1=newBook(); 
  
 $book1->title=""1984""; 
  
 $book2=newBook(); 
  
 $book2->title=""ToKillaMockingbird""; 
 var_dump($book1,$book2);",NA
Classmethods,NA,NA
Methods,NA,NA
"arefunctionsdefinedinsideaclass.Likefunctions,methodsgetsomearguments ",NA,NA
"andperformsomeactions,optionallyreturningavalue.Theadvantageofmethodsisthat ",NA,NA
"theycanusethepropertiesoftheobjectthatinvokedthem.Thus,callingthesamemethod ",NA,NA
intwodifferentobjectsmighthavetwodifferentresults.,NA,NA
"EventhoughitisusuallyabadideatomixHTMLwithPHP,forthesakeoflearning,let’s ",NA,NA
addamethodinourclass,Book,NA
thatreturnsthebookasinouralreadyexistingfunction ,printableTitle,NA
:,"<?php
  
 classBook{ 
  
 public$isbn; 
  
 public$title; 
  
 public$author; 
  
 public$available;
  
 publicfunctiongetPrintableTitle():string{ $result='<i>'.$this-
 >title 
  
 .'</i>-'.$this->author; 
  
 if(!$this->available){ 
  
 $result.='<b>Notavailable</b>'; } 
  
 return$result; 
  
 } 
  
 }",NA
"Aswithproperties,weaddthekeyword",public,NA
"atthebeginningofthefunction,butother ",NA,NA
"thanthat,therestlooksjustasanormalfunction.Theotherspecialbitistheuseof",$this,NA
: ,NA,NA
"itrepresentstheobjectitself,andallowsyoutoaccessthepropertiesandmethodsofthat ",NA,NA
"sameobject.Notehowwerefertothetitle,author,andavailableproperties.",NA,NA
Youcanalsoupdatethevaluesofthecurrentobjectfromoneofitsfunctions.Let’susethe ,NA,NA
availablepropertyasanintegerthatshowsthenumberofunitsavailableinsteadofjusta ,NA,NA
"Boolean.Withthat,wecanallowmultiplecustomerstoborrowdifferentcopiesofthe ",NA,NA
"samebook.Let’saddamethodtogiveonecopyofabooktoacustomer,updatingthe ",NA,NA
numberofunitsavailable:,"publicfunctiongetCopy():bool{ 
  
 if($this->available<1){ 
  
 returnfalse; 
  
 }else{ 
  
 $this->available--; 
  
 returntrue; 
  
 } 
  
 }",NA
"Inthisprecedingmethod,wefirstcheckifwehaveatleastoneavailableunit.Ifwedo ",NA,NA
"not,wereturn",false,NA
toletthemknowthattheoperationwasnotsuccessful.Ifwedohave ,NA,NA
"aunitforthecustomer,wedecreasethenumberofavailableunits,andthenreturn",true,NA
",",NA,NA
lettingthemknowthattheoperationwassuccessful.Let’sseehowyoucanusethisclass:,"<?php 
  
 $book=newBook(); 
  
 $book->title=""1984""; 
  
 $book->author=""GeorgeOrwell""; 
  
 $book->isbn=9785267006323; 
  
 $book->available=12;
  
 if($book->getCopy()){ 
  
 echo'Here,yourcopy.'; 
  
 }else{ 
  
 echo'Iamafraidthatbookisnotavailable.'; }",NA
"Whatwouldthislastpieceofcodeprint?Exactly,",NA,NA
"Here,yourcopy.",NA,NA
Butwhatwouldbe ,NA,NA
"thevalueofthepropertyavailable?Itwouldbe11,whichistheresultoftheinvocationof ",getCopy,NA
.,NA,NA
Classconstructors,NA,NA
Youmighthavenoticedthatitlookslikeapaintoinstantiatethe,Book,NA
"class,andsetallits ",NA,NA
"valueseachtime.Whatifourclasshas30propertiesinsteadoffour?Well,hopefully,you ",NA,NA
"willneverdothat,asitisverybadpractice.Still,thereisawaytomitigatethatpain: ",NA,NA
constructors,NA,NA
.,NA,NA
Constructorsarefunctionsthatareinvokedwhensomeonecreatesanewinstanceofthe ,NA,NA
"class.Theylooklikenormalmethods,withtheexceptionthattheirnameisalways ",__construct,NA
",andthattheydonothavea",return,NA
"statement,astheyalwayshavetoreturn ",NA,NA
thenewinstance.Let’sseeanexample:,"publicfunction__construct(int$isbn,string$title,string$author,int $available){ 
  
 $this->isbn=$isbn; 
  
 $this->title=$title; 
  
 $this->author=$author; 
  
 $this->available=$available; 
  
 }",NA
"Theconstructortakesfourarguments,andthenassignsthevalueofoneofthearguments ",NA,NA
toeachofthepropertiesoftheinstance.Toinstantiatethe,Book,NA
"class,weusethe following:","$book=newBook(""1984"",""GeorgeOrwell"",9785267006323,12);",NA
Thisobjectisexactlythesameastheobjectwhenwesetthevaluetoeachofitsproperties ,NA,NA
"manually.Butthisonelookscleaner,right?Thisdoesnotmeanyoucannotsetnewvalues ",NA,NA
"tothisobjectmanually,itjusthelpsyouinconstructingnewobjects.",NA,NA
"Asaconstructorisstillafunction,itcanusedefaultarguments.Imaginethatthenumber ",NA,NA
"ofunitswillusuallybe0whencreatingtheobject,andlater,thelibrarianwilladdunits ",NA,NA
whenavailable.Wecouldsetadefaultvaluetothe,$available,NA
argumentofthe ,NA,NA
"constructor,soifwedonotsendthenumberofunitswhencreatingtheobject,theobject ",NA,NA
willbeinstantiatedwithitsdefaultvalue:,"publicfunction__construct( 
  
 int$isbn, 
  
 string$title, 
  
 string$author, 
  
 int$available=0 
  
 ){ 
  
 $this->isbn=$isbn; 
  
 $this->title=$title; 
  
 $this->author=$author; 
  
 $this->available=$available; 
  
 }",NA
Wecouldusetheprecedingconstructorintwodifferentways:,"$book1=newBook(""1984"",""GeorgeOrwell"",9785267006323,12); 
 $book2=newBook(""1984"",""GeorgeOrwell"",9785267006323);",NA
willsetthenumberofunitsavailableto,12,NA
",whereas",$book2,NA
willsetittothe ,NA,NA
defaultvalueof0.Butdonottrustme;tryitbyyourself!,NA,NA
Magicmethods,NA,NA
Thereisaspecialgroupofmethodsthathaveadifferentbehaviorthanthenormalones.,NA,NA
Thosemethodsarecalled,NA,NA
magicmethods,NA,NA
",andtheyusuallyaretriggeredbythe ",NA,NA
"interactionoftheclassorobject,andnotbyinvocations.Youhavealreadyseenoneof ",NA,NA
"them,theconstructoroftheclass,",__construct,NA
".Thismethodisnotinvokeddirectly,but ",NA,NA
ratherusedwhencreatinganewinstancewith,new,NA
.Youcaneasilyidentifymagic ,NA,NA
"methods,becausetheystartwith",__,NA
.Thefollowingaresomeofthemostusedmagic ,NA,NA
methods:,__toString,NA
:Thismethodisinvokedwhenwetrytocastanobjecttoastring.Ittakes ,NA,NA
"noparameters,anditisexpectedtoreturnastring.",__call,NA
:ThisisthemethodthatPHPcallswhenyoutrytoinvokeamethodonaclass ,NA,NA
thatdoesnotexist.Itgetsthenameofthemethodasastringandthelistof ,NA,NA
"parametersusedintheinvocationasanarray,throughtheargument.",__get,NA
:Thisisaversionof,__call,NA
forproperties.Itgetsthenameofthepropertythat ,NA,NA
"theuserwastryingtoaccessthroughparameters,anditcanreturnanything.",NA,NA
Youcouldusethe,__toString,NA
methodtoreplacethecurrent,getPrintableTitle,NA
method ,NA,NA
inour,Book,NA
"class.Todothat,justchangethenameofthemethodasfollows:","publicfunction__toString(){ 
  
 $result='<i>'.$this->title.'</i>-'.$this->author; if(!$this->available){ 
  
 $result.='<b>Notavailable</b>'; 
  
 } 
  
 return$result; 
  
 }",NA
"Totrytheprecedingcode,youcanjustaddthefollowingsnippetthatcreatesanobject ",book,NA
"andthencastsittoastring,invokingthe",__toString,NA
method:,"$book=newBook(1234,'title','author'); 
  
 $string=(string)$book;//title-authorNotavailable",NA
"Asthenamesuggests,thosearemagicmethods,somostofthetimetheirfeatureswill ",NA,NA
"looklikemagic.Forobviousreasons,wepersonallyencouragedeveloperstouse ",NA,NA
constructorsandmaybe,__toString,NA
",butbecarefulaboutwhentousetherest,asyou ",NA,NA
mightmakeyourcodequiteunpredictableforpeoplenotfamiliarwithit.,NA,NA
Propertiesandmethodsvisibility,NA,NA
"Sofar,allthepropertiesandmethodsdefinedinour",Book,NA
classweretaggedas,public,NA
. ,NA,NA
"Thatmeansthattheyareaccessibletoanyone,ormoreprecisely,fromanywhere.Thisis ",NA,NA
calledthe,NA,NA
visibility,NA,NA
"ofthepropertyormethod,andtherearethreetypesofvisibility.Inthe ",NA,NA
"orderofbeingmorerestrictivetoless,theyareasfollows:",private,NA
:Thistypeallowsaccessonlytomembersofthesameclass.IfAandBare ,NA,NA
"instancesoftheclassC,AcanaccessthepropertiesandmethodsofB.",protected,NA
:Thistypeallowsaccesstomembersofthesameclassandinstancesfrom ,NA,NA
classesthatinheritfromthatoneonly.Youwillseeinheritanceinthenextsection.,public,NA
:Thistypereferstoapropertyormethodthatisaccessiblefromanywhere. ,NA,NA
Anyclassesorcodeingeneralfromoutsidetheclasscanaccessit.,NA,NA
"Inordertoshowsomeexamples,let’sfirstcreateasecondclassinourapplication.Save ",NA,NA
thisintoa,Customer.php,NA
file:,"<?php
  
 classCustomer{ 
  
 private$id; 
  
 private$firstname; 
  
 private$surname; 
  
 private$email;
  
 publicfunction__construct( 
  
 int$id, 
  
 string$firstname, 
  
 string$surname, 
  
 string$email 
  
 ){ 
  
 $this->id=$id; 
  
 $this->firstname=$firstname; $this-
 >surname=$surname; 
  
 $this->email=$email; 
  
 } 
  
 }",NA
"Thisclassrepresentsacustomer,anditspropertiesconsistofthegeneralinformationthat ",NA,NA
"thebookstoresusuallyknowabouttheircustomers.Butforsecurityreasons,wecannotlet ",NA,NA
"everybodyknowaboutthepersonaldataofourcustomers,soweseteverypropertyas ",private,NA
.,NA,NA
"Sofar,wehavebeenaddingthecodetocreateobjectsinthesame",Book.php,NA
"file,butsince ",NA,NA
"nowwehavetwoclasses,itseemsnaturaltoleavetheclassesintheirrespectivefiles,and ",NA,NA
createandplaywithobjectsinaseparatefile.Let’snamethisthirdfile,init.php,NA
.Inorder ,NA,NA
"toinstantiateobjectsofagivenclass,PHPneedstoknowwheretheclassis.Forthat,just ",NA,NA
includethefilewith,require_once,NA
.,"<?php
  
 require_once__DIR__.'/Book.php';",NA
"Youdonotneedtoincludethefileseverysingletime.Onceyouincludethem,PHPwill ",NA,NA
"knowwheretofindtheclasses,eventhoughyourcodeisinadifferentfile.",NA,NA
Note,NA,NA
Conventionsforclasses,NA,NA
"Whenworkingwithclasses,youshouldknowthattherearesomeconventionsthat ",NA,NA
everyonetriestofollowinordertoensurecleancodewhichiseasytomaintain.Themost ,NA,NA
importantonesareasfollows:,NA,NA
Eachclassshouldbeinafilenamedthesameastheclassalongwiththe,.php,NA
extension ,NA,NA
"ClassnamesshouldbeinCamelCase,thatis,eachwordshouldstartwithan ",NA,NA
"uppercaseletter,followedbytherestofthewordinlowercase ",NA,NA
Afileshouldcontainonlythecodeofoneclass ,NA,NA
"Insideaclass,youshouldfirstplacetheproperties,thentheconstructor,andfinally, ",NA,NA
therestofthemethods,NA,NA
"Toshowhowvisibilityworks,let’strythefollowingcode:","$book1->available=2;//OK 
  
 $customer1->id=3;//Error!",NA
Wealreadyknowthatthepropertiesofthe,Book,NA
"class’objectsarepublic,andtherefore, ",NA,NA
editablefromoutside.Butwhentryingtochangeavaluefrom,Customer,NA
",PHPcomplains, ",NA,NA
asitspropertiesareprivate.,NA,NA
Encapsulation,NA,NA
"Whenworkingwithobjects,oneofthemostimportantconceptsyouhavetoknowand ",NA,NA
applyis,NA,NA
encapsulation,NA,NA
.Encapsulationtriestogroupthedataoftheobjectwithits ,NA,NA
methodsinanattempttohidetheinternalstructureoftheobjectfromtherestofthe ,NA,NA
"world.Insimplewords,youcouldsaythatyouuseencapsulationifthepropertiesofan ",NA,NA
"objectareprivate,andtheonlywaytoupdatethemisthroughpublicmethods.",NA,NA
Thereasonforusingencapsulationistomakeiteasierforadevelopertomakechangesto ,NA,NA
theinternalstructureoftheclasswithoutdirectlyaffectingtheexternalcodethatusesthat ,NA,NA
"class.Forexample,imaginethatour",Customer,NA
"class,thatnowhastwopropertiestodefine ",NA,NA
itsname—,firstname,NA
and,surname,NA
"—hastochange.Fromnowon,weonlyhaveone ",NA,NA
"propertynamethatcontainsboth.Ifwewereaccessingitspropertiesstraightaway,we ",NA,NA
shouldchangeallofthoseaccesses!,NA,NA
"Instead,ifwesetthepropertiesasprivateandenabletwopublicmethods,",getFirstname,NA
and,getSurname,NA
",evenifwehavetochangetheinternalstructureoftheclass,wecould ",NA,NA
justchangetheimplementationofthosetwomethods—whichisatoneplaceonly—and ,NA,NA
therestofthecodethatusesourclasswillnotbeaffectedatall.Thisconceptisalso ,NA,NA
knownas,NA,NA
informationhiding,NA,NA
.,NA,NA
Theeasiestwaytoimplementthisideaisbysettingallthepropertiesoftheclassas ,NA,NA
privateandenablingtwomethodsforeachoftheproperties:onewillgetthecurrentvalue ,NA,NA
(alsoknownas,NA,NA
getter,NA,NA
"),andtheotherwillallowyoutosetanewvalue(knownas",NA,NA
setter,NA,NA
). ,NA,NA
That’satleastthemostcommonandeasywaytoencapsulatedata.,NA,NA
"Butlet’sgoonestepfurther:whendefiningaclass,thinkofthedatathatyouwantthe ",NA,NA
"usertobeabletochangeandtoretrieve,andonlyaddsettersandgettersforthem.For ",NA,NA
"example,customersmightchangetheire-mailaddress,buttheirname,surname,andID ",NA,NA
remainsthesameoncewecreatethem.Thenewdefinitionoftheclasswouldlooklikethe ,NA,NA
following:,"<?php
  
 classCustomer{ 
  
 private$id; 
  
 private$name; 
  
 private$surname; 
  
 private$email;
  
 publicfunction__construct( 
  
 int$id, 
  
 string$firstname, 
  
 string$surname, 
  
 string$email 
  
 ){ 
  
 $this->id=$id; 
  
 $this->firstname=$firstname; $this-
 >surname=$surname; 
  
 $this->email=$email; 
  
 }",NA
"Ontheotherhand,ourbooksalsoremainalmostthesame.Theonlychangepossibleisthe ",NA,NA
numberofavailableunits.Butweusuallytakeoraddonebookatatimeinsteadofsetting ,NA,NA
"thespecificnumberofunitsavailable,soasetterhereisnotreallyuseful.Wealreadyhave ",NA,NA
the,getCopy,NA
methodthattakesonecopywhenpossible;let’saddan,addCopy,NA
"method,plus ",NA,NA
therestofthegetters:,"<?php
  
 classBook{ 
  
 private$isbn; 
  
 private$title; 
  
 private$author; 
  
 private$available;
  
 publicfunction__construct( 
  
 int$isbn, 
  
 string$title, 
  
 string$author, 
  
 int$available=0 
  
 ){ 
  
 $this->isbn=$isbn; 
  
 $this->title=$title; 
  
 $this->author=$author; 
  
 $this->available=$available; } 
  
 publicfunctiongetIsbn():int{ 
  
 return$this->isbn; 
  
 } 
  
 publicfunctiongetTitle():string{ return$this->title; 
  
 } 
  
 publicfunctiongetAuthor():string{ return$this-
 >author; 
  
 } 
  
 publicfunctionisAvailable():bool{ return$this-
 >available; 
  
 }",NA
"Whenthenumberofclassesinyourapplication,andwithit,thenumberofrelationships ",NA,NA
"betweenclassesincreases,itishelpfultorepresenttheseclassesinadiagram.Let’scall ",NA,NA
"thisdiagramaUMLdiagramofclasses,orjustanhierarchictree.Thehierarchictreefor ",NA,NA
ourtwoclasseswouldlookasfollows:,NA,NA
"Weonlyshowpublicmethods,astheprotectedorprivateonescannotbecalledfrom ",NA,NA
"outsidetheclass,andthus,theyarenotusefulforadeveloperwhojustwantstousethese ",NA,NA
classesexternally.,NA,NA
Staticpropertiesandmethods,NA,NA
"Sofar,allthepropertiesandmethodswerelinkedtoaspecificinstance;sotwodifferent ",NA,NA
instancescouldhavetwodifferentvaluesforthesameproperty.PHPallowsyoutohave ,NA,NA
propertiesandmethodslinkedtotheclassitselfratherthantotheobject.Theseproperties ,NA,NA
andmethodsaredefinedwiththekeyword,static,NA
.,privatestatic$lastId=0;,NA
Addtheprecedingpropertytothe,Customer,NA
class.ThispropertyshowsthelastID ,NA,NA
"assignedtoauser,andisusefulinordertoknowtheIDthatshouldbeassignedtoanew ",NA,NA
user.Let’schangetheconstructorofourclassasfollows:,"publicfunction__construct( 
  
 int$id, 
  
 string$name, 
  
 string$surname, 
  
 string$email 
  
 ){ 
  
 if($id==null){ 
  
 $this->id=++self::$lastId; 
  
 }else{ 
  
 $this->id=$id; 
  
 if($id>self::$lastId){ 
  
 self::$lastId=$id; 
  
 } 
  
 } 
  
 $this->name=$name; 
  
 $this->surname=$surname; 
  
 $this->email=$email; 
  
 }",NA
"Notethatwhenreferringtoastaticproperty,wedonotusethevariable",$this,NA
".Instead,we ",NA,NA
use,self::,NA
",whichisnottiedtoanyinstancebuttotheclassitself.Inthislastconstructor, ",NA,NA
"wehavetwooptions.WeareeitherprovidedwithanIDvaluethatisnotnull,orwesenda ",NA,NA
"nullinitsplace.WhenthereceivedIDisnull,weusethestaticproperty",$lastId,NA
toknow ,NA,NA
"thelastIDused,increaseitbyone,andassignittotheproperty",$id,NA
.IfthelastIDwe ,NA,NA
"insertedwas5,thiswillupdatethestaticpropertyto6,andthenassignittotheinstance ",NA,NA
"property.Nexttimewecreateanewcustomer,the",$lastId,NA
staticpropertywillbe6.,NA,NA
"Instead,ifwegetavalidIDaspartofthearguments,weassignit,andcheckifthe ",NA,NA
assigned,$id,NA
isgreaterthanthestatic,$lastId,NA
".Ifitis,weupdateit.Let’sseehowwe ",NA,NA
wouldusethis:,"$customer1=newCustomer(3,'John','Doe','johndoe@mail.com'); 
 $customer2=newCustomer(null,'Mary','Poppins','mp@mail.com'); 
 $customer3=newCustomer(7,'James','Bond','007@mail.com');",NA
"Intheprecedingexample,",$customer1,NA
"specifiesthathisIDis3,probablybecauseheisan ",NA,NA
existingcustomerandwantstokeepthesameID.ThatsetsbothhisIDandthelaststatic ,NA,NA
"IDto3.Whencreatingthesecondcustomer,wedonotspecifytheID,sotheconstructor ",NA,NA
"willtakethelastID,increaseitby1,andassignittothecustomer.So",$customer2,NA
will,NA,NA
"havetheID4,andthelatestIDwillbe4too.Finally,oursecretagentknowswhathe ",NA,NA
"wants,soheforcesthesystemtohavetheIDas7.ThelatestIDwillbeupdatedto7too.",NA,NA
Anotherbenefitofstaticpropertiesandmethodsisthatwedonotneedanobjecttouse ,NA,NA
"them.Youcanrefertoastaticpropertyormethodbyspecifyingthenameoftheclass, ",NA,NA
followedby,::,NA
",andthenameoftheproperty/method.Thatis,ofcourse,ifthevisibility ",NA,NA
"rulesallowyoutodothat,which,inthiscase,itdoesnot,asthepropertyisprivate.Let’s ",NA,NA
addapublicstaticmethodtoretrievethelastID:,"publicstaticfunctiongetLastId():int{ returnself::$lastId; 
  
 }",NA
"Youcanreferenceiteitherusingtheclassnameoranexistinginstance,fromanywherein ",NA,NA
thecode:,"Customer::getLastId(); 
  
 $customer1::getLastId();",NA
Namespaces,NA,NA
"Youknowthatyoucannothavetwoclasseswiththesamename,sincePHPwouldnot ",NA,NA
"knowwhichoneisbeingreferredtowhencreatinganewobject.Tosolvethisissue,PHP ",NA,NA
allowstheuseof,NA,NA
namespaces,NA,NA
",whichactaspathsinafilesystem.Inthisway,youcan ",NA,NA
"haveasmanyclasseswiththesamenameasyouneed,aslongastheyarealldefinedin ",NA,NA
"differentnamespaces.Itisworthnotingthat,eventhoughnamespacesandthefilepath ",NA,NA
"willusuallybethesame,thisisenforcedbythedeveloperratherthanbythelanguage;you ",NA,NA
couldactuallyuseanynamespacethathasnothingtodowiththefilesystem.,NA,NA
"Specifyinganamespacehastobethefirstthingthatyoudoinafile.Inordertodothat, ",NA,NA
usethe,namespace,NA
keywordfollowedbythenamespace.Eachsectionofthenamespaceis ,NA,NA
separatedby,\,NA
",asifitwasadifferentdirectory.Ifyoudonotspecifythenamespace,the ",NA,NA
"classwillbelongtothebasenamespace,orroot.Atthebeginningofbothfiles—",Book.php,NA
and,Customer.php,NA
—addthefollowing:,"<?php
  
 namespaceBookstore\Domain;",NA
Theprecedinglineofcodesetsthenamespaceofourclassesas,Bookstore\Domain,NA
.The ,NA,NA
fullnameofourclassesthenis,Bookstore\Domain\Book,NA
and ,Bookstore\Domain\Customer,NA
.Ifyoutrytoaccessthe,init.php,NA
"filefromyourbrowser, ",NA,NA
youwillseeanerrorsayingthateithertheclass,Book,NA
ortheclass,Customer,NA
werenot ,NA,NA
"found.Butweincludedthefiles,right?ThathappensbecausePHPthinksthatyouare ",NA,NA
tryingtoaccess,\Book,NA
and,\Customer,NA
"fromtheroot.Donotworry,thereareseveralways ",NA,NA
toamendthis.,NA,NA
"Onewaywouldbetospecifythefullnameoftheclasseswhenreferencingthem,thatis, ",NA,NA
using,$customer=newBookstore\Domain\Book();,NA
insteadof,$book=newBook();,NA
. ,NA,NA
"Butthatdoesnotsoundpractical,doesit?",NA,NA
Anotherwaywouldbetosaythatthe,init.php,NA
filebelongstothe,BookStore\Domain,NA
namespace.Thatmeansthatallthereferencestoclassesinside,init.php,NA
willhavethe ,BookStore\Domain,NA
"prefixedtothem,andyouwillbeabletouse",Book,NA
and,Customer,NA
.The ,NA,NA
downsideofthissolutionisthatyoucannoteasilyreferenceotherclassesfromother ,NA,NA
"namespaces,asanyreferencetoaclasswillbeprefixedwiththatnamespace.",NA,NA
Thebestsolutionistousethekeyword,use,NA
.Thiskeywordallowsyoutospecifyafull ,NA,NA
"classnameatthebeginningofthefile,andthenusethesimplenameoftheclassinthe ",NA,NA
restofthatfile.Let’sseeanexample:,"<?php
  
 useBookstore\Domain\Book; 
  
 useBookstore\Domain\Customer;
  
 require_once__DIR__.'/Book.php'; 
  
 require_once__DIR__.'/Customer.php'; //...",NA
"Intheprecedingfile,eachtimethatwereference",Book,NA
or,Customer,NA
",PHPwillknowthat ",NA,NA
"weactuallywanttousethefullclassname,thatis,with",Bookstore\Domain\,NA
prefixedto ,NA,NA
"it.Thissolutionallowsyoutohaveacleancodewhenreferencingthoseclasses,andatthe ",NA,NA
"sametime,tobeabletoreferenceclassesfromothernamespacesifneeded.",NA,NA
Butwhatifyouwanttoincludetwodifferentclasseswiththesamenameinthesamefile? ,NA,NA
Ifyousettwo,use,NA
"statements,PHPwillnotknowwhichonetochoose,sowestillhave ",NA,NA
"thesameproblemasbefore!Tofixthat,eitheryouusethefullclassname—with ",NA,NA
"namespace—eachtimeyouwanttoreferenceanyoftheclasses,oryouusealiases.",NA,NA
Imaginethatwehavetwo,Book,NA
"classes,thefirstoneinthenamespace",Bookstore\Domain,NA
andthesecondonein,Library\Domain,NA
".Tosolvetheconflict,youcoulddoasfollows:","useBookstore\Domain\Book; 
  
 useLibrary\Domain\BookasLibraryBook;",NA
Thekeyword,as,NA
"setsanaliastothatclass.Inthatfile,wheneveryoureferencetheclass ",LibraryBook,NA
",youwillactuallybereferencingtheclass",Library\Domain\Book,NA
.Andwhen ,NA,NA
referencing,Book,NA
",PHPwilljustusetheonefrom",Bookstore,NA
.Problemsolved!,NA,NA
Autoloadingclasses,NA,NA
"Asyoualreadyknow,inordertouseaclass,youneedtoincludethefilethatdefinesit.So ",NA,NA
"far,wehavebeenincludingthefilesmanually,asweonlyhadacoupleofclassesandused ",NA,NA
theminonefile.Butwhathappenswhenweuseseveralclassesinseveralfiles?There ,NA,NA
"mustbeasmarterway,right?Indeedthereis.",NA,NA
Autoloading,NA,NA
totherescue!,NA,NA
AutoloadingisaPHPfeaturethatallowsyourprogramtosearchandloadfiles ,NA,NA
automaticallygivensomesetofpredefinedrules.Eachtimeyoureferenceaclassthat ,NA,NA
"PHPdoesnotknowabout,itwillaskthe",NA,NA
autoloader,NA,NA
.Iftheautoloadercanfigureout ,NA,NA
"whichfilethatclassisin,itwillloadit,andtheexecutionoftheprogramwillcontinueas ",NA,NA
"normal.Ifitdoesnot,PHPwillstoptheexecution.",NA,NA
"So,whatistheautoloader?ItisnomorethanaPHPfunctionthatgetsaclassnameasa ",NA,NA
"parameter,anditisexpectedtoloadafile.Therearetwowaysofimplementingan ",NA,NA
autoloader:eitherbyusingthe,__autoload,NA
functionorthe,spl_autoload_register,NA
one.,NA,NA
Usingthe__autoloadfunction,NA,NA
Definingafunctionnamed,__autoload,NA
tellsPHPthatthefunctionistheautoloaderthatit ,NA,NA
mustuse.Youcouldimplementaneasysolution:,"function__autoload($classname){ 
  
 $lastSlash=strpos($classname,'\\')+1; 
  
 $classname=substr($classname,$lastSlash); 
 $directory=str_replace('\\','/',$classname); 
 $filename=__DIR__.'/'.$directory.'.php'; require_once($filename); 
  
 }",NA
OurintentionistokeepallPHPfilesin,src,NA
",thatis,thesource.Insidethisdirectory,the ",NA,NA
directorytreewillemulatethenamespacetreeoftheclassesexcludingthefirstsection ,BookStore,NA
",whichisusefulasanamespacebutnotnecessaryasadirectory.Thatmeans ",NA,NA
thatour,Book,NA
"class,withfullclassname",BookStore\Domain\Book,NA
",willbein ",src/Domain/Book.php,NA
.,NA,NA
"Inordertoachievethat,our",__autoload,NA
functiontriestofindthefirstoccurrenceofthe ,NA,NA
backslash,\,NA
with,strpos,NA
",andthenextractsfromthatpositionuntiltheendwith",substr,NA
. ,NA,NA
"This,inpractice,justremovesthefirstsectionofthenamespace,",BookStore,NA
".Afterthat, ",NA,NA
wereplaceall,\,NA
by,/,NA
"sothatthefilesystemcanunderstandthepath.Finally,we ",NA,NA
"concatenatethecurrentdirectory,theclassnameasadirectory,andthe",.php,NA
extension.,NA,NA
"Beforetryingthat,remembertocreatethe",src/Domain,NA
directoryandmovethetwoclasses ,NA,NA
"insideit.Also,tomakesurethatwearetestingtheautoloader,savethefollowingasyour ",init.php,NA
",andgoto",http://localhost:8000/init.php,NA
:,"<?php
  
 useBookstore\Domain\Book; 
  
 useBookstore\Domain\Customer;
  
 function__autoload($classname){ 
  
 $lastSlash=strpos($classname,'\\')+1; 
  
 $classname=substr($classname,$lastSlash); 
  
 $directory=str_replace('\\','/',$classname); 
 $filename=__DIR__.'/src/'.$directory.'.php' require_once($filename); 
  
 }
  
 $book1=newBook(""1984"",""GeorgeOrwell"",9785267006323,12); 
 $customer1=newCustomer(5,'John','Doe','johndoe@mail.com');",NA
"Thebrowserdoesnotcomplainnow,andthereisnoexplicit",require_once,NA
.Also ,NA,NA
rememberthatthe,__autoload,NA
"functionhastobedefinedonlyonce,notineachfile.So ",NA,NA
"fromnowon,whenyouwanttouseyourclasses,assoonastheclassisinanamespace ",NA,NA
"andfilethatfollowstheconvention,youonlyneedtodefinethe",use,NA
statement.Way ,NA,NA
"cleanerthanbefore,right?",NA,NA
Usingthespl_autoload_registerfunction,NA,NA
The,__autoload,NA
"solutionlooksprettygood,butithasasmallproblem:whatifourcodeis ",NA,NA
"socomplexthatwedonothaveonlyoneconvention,andweneedmorethanone ",NA,NA
implementationofthe,__autoload,NA
function?Aswecannotdefinetwofunctionswiththe ,NA,NA
"samename,weneedawaytotellPHPtokeepalistofpossibleimplementationsofthe ",NA,NA
"autoloader,soitcantryallofthemuntiloneworks.",NA,NA
Thatisthejobof,spl_autoload_register,NA
.Youdefineyourautoloaderfunctionwitha ,NA,NA
"validname,andtheninvokethefunction",spl_autoload_register,NA
",sendingthenameof ",NA,NA
yourautoloaderasanargument.Youcancallthisfunctionasmanytimesasthedifferent ,NA,NA
"autoloadersyouhaveinyourcode.Infact,evenifyouhaveonlyoneautoloader,using ",NA,NA
thissystemisstillabetteroptionthanthe,__autoload,NA
"one,asyoumakeiteasierfor ",NA,NA
someoneelsewhohastoaddanewautoloaderlater:,"functionautoloader($classname){ 
  
 $lastSlash=strpos($classname,'\\')+1; 
  
 $classname=substr($classname,$lastSlash); 
 $directory=str_replace('\\','/',$classname); 
 $filename=__DIR__.'/'.$directory.'.php'; require_once($filename); 
  
 } 
  
 spl_autoload_register('autoloader');",NA
Inheritance,NA,NA
Wehavepresentedtheobject-orientedparadigmasthepanaceaforcomplexdata ,NA,NA
"structures,andeventhoughwehaveshownthatwecandefineobjectswithpropertiesand ",NA,NA
"methods,anditlooksprettyandfancy,itisnotsomethingthatwecouldnotsolvewith ",NA,NA
"arrays.Encapsulationwasonefeaturethatmadeobjectsmoreusefulthanarrays,buttheir ",NA,NA
truepowerliesininheritance.,NA,NA
Introducinginheritance,NA,NA
InheritanceinOOPistheabilitytopasstheimplementationoftheclassfromparentsto ,NA,NA
"children.Yes,classescanhaveparents,andthetechnicalwayofreferringtothisfeatureis ",NA,NA
thataclass,NA,NA
extends,NA,NA
"fromanotherclass.Whenextendingaclass,wegetalltheproperties ",NA,NA
"andmethodsthatarenotdefinedasprivate,andthechildclasscanusethemasifthey ",NA,NA
wereitsown.Thelimitationisthataclasscanonlyextendfromoneparent.,NA,NA
"Toshowanexample,let’sconsiderour",Customer,NA
class.Itcontainstheproperties ,firstname,NA
",",surname,NA
",",email,NA
",and",id,NA
".Acustomerisactuallyaspecifictypeofperson,one ",NA,NA
"thatisregisteredinoursystem,sohe/shecangetbooks.Buttherecanbeothertypesof ",NA,NA
"personsinoursystem,likelibrarianorguest.Andallofthemwouldhavesomecommon ",NA,NA
"propertiestoallpeople,thatis,",firstname,NA
and,surname,NA
.Soitwouldmakesenseifwe ,NA,NA
createa,Person,NA
"class,andmakethe",Customer,NA
classextendfromit.Thehierarchictree ,NA,NA
wouldlookasfollows:,NA,NA
Notehow,Customer,NA
isconnectedto,Person,NA
.Themethodsin,Person,NA
arenotdefinedin ,Customer,NA
",astheyareimplicitfromtheextension.Nowsavethenewclassin ",src/Domain/Person.php,NA
",followingourconvention:","<?php
  
 namespaceBookstore\Domain;
  
 classPerson{ 
  
 protected$firstname; 
  
 protected$surname;
  
 publicfunction__construct(string$firstname,string$surname){ $this->firstname=$firstname; 
  
 $this->surname=$surname; 
  
 }
  
 publicfunctiongetFirstname():string{ return$this->firstname; 
  
 }",NA
Theclassdefinedintheprecedingcodesnippetdoesnotlookspecial;wehavejust ,NA,NA
"definedtwoproperties,aconstructorandtwogetters.Notethoughthatwedefinedthe ",NA,NA
"propertiesasprotected,becauseifwedefinedthemasprivate,thechildrenwouldnotbe ",NA,NA
abletoaccessthem.Nowwecanupdateour,Customer,NA
classbyremovingtheduplicate ,NA,NA
propertiesanditsgetters:,"<?php
  
 namespaceBookstore\Domain;
  
 classCustomerextendsPerson{ 
  
 privatestatic$lastId=0; 
  
 private$id; 
  
 private$email;
  
 publicfunction__construct( 
  
 int$id, 
  
 string$name, 
  
 string$surname, 
  
 string$email 
  
 ){ 
  
 if(empty($id)){ 
  
 $this->id=++self::$lastId; }else{ 
  
 $this->id=$id; 
  
 if($id>self::$lastId){ self::$lastId=$id; } 
  
 } 
  
 $this->name=$name; 
  
 $this->surname=$surname; 
  
 $this->email=$email; 
  
 }
  
 publicstaticfunctiongetLastId():int{ returnself::$lastId; 
  
 }
  
 publicfunctiongetId():int{ 
  
 return$this->id; 
  
 }
  
 publicfunctiongetEmail():string{ return$this->email; 
  
 }
  
 publicfunctionsetEmail($email):string{ $this->email=$email; 
  
 } 
  
 }",NA
Notethenewkeyword,extends,NA
;ittellsPHPthatthisclassisachildofthe,Person,NA
class. ,NA,NA
Asboth,Person,NA
and,Customer,NA
"areinthesamenamespace,youdonothavetoaddany",use,NA
"statement,butiftheywerenot,youshouldletitknowhowtofindtheparent.Thiscode ",NA,NA
"worksfine,butwecanseethatthereisabitofduplicationofcode.Theconstructorofthe ",Customer,NA
classisdoingthesamejobastheconstructorofthe,Person,NA
class!Wewilltryto ,NA,NA
fixitreallysoon.,NA,NA
"Inordertoreferenceamethodorpropertyoftheparentclassfromthechild,youcanuse ",$this,NA
"asifthepropertyormethodwasinthesameclass.Infact,youcouldsayitactually ",NA,NA
is.ButPHPallowsyoutoredefineamethodinthechildclassthatwasalreadypresentin ,NA,NA
"theparent.Ifyouwanttoreferencetheparent’simplementation,youcannotuse",$this,NA
",as ",NA,NA
"PHPwillinvoketheoneinthechild.ToforcePHPtousetheparent’smethod,usethe ",NA,NA
keyword,parent::,NA
insteadof,$this,NA
.Updatetheconstructorofthe,Customer,NA
classas follows:,"publicfunction__construct( 
  
 int$id, 
  
 string$firstname, 
  
 string$surname, 
  
 string$email 
  
 ){ 
  
 parent::__construct($firstname,$surname); 
 if(empty($id)){ 
  
 $this->id=++self::$lastId; 
  
 }else{ 
  
 $this->id=$id; 
  
 if($id>self::$lastId){ 
  
 self::$lastId=$id; 
  
 } 
  
 } 
  
 $this->email=$email; 
  
 }",NA
"Thisnewconstructordoesnotduplicatecode.Instead,itcallstheconstructoroftheparent ",NA,NA
class,Person,NA
",sending",$firstname,NA
and,$surname,NA
",andlettingtheparentdowhatitalready ",NA,NA
"knowshowtodo.Weavoidcodeduplicationand,ontopofthat,wemakeiteasierforany ",NA,NA
futurechangestobemadeintheconstructorof,Person,NA
.Ifweneedtochangethe ,NA,NA
implementationoftheconstructorof,Person,NA
",wewillchangeitinoneplaceonly,instead ",NA,NA
ofinallthechildren.,NA,NA
Overridingmethods,NA,NA
"Assaidbefore,whenextendingfromaclass,wegetallthemethodsoftheparentclass. ",NA,NA
"Thatisimplicit,sotheyarenotactuallywrittendowninsidethechild’sclass.Whatwould ",NA,NA
happenifyouimplementanothermethodwiththesamesignatureand/orname?Youwill ,NA,NA
be,NA,NA
overridingthemethod,NA,NA
.,NA,NA
"Aswedonotneedthisfeatureinourclasses,let’sjustaddsomecodeinour",init.php,NA
file ,NA,NA
"toshowthisbehavior,andthenyoucanjustremoveit.Let’sdefineaclass",Pops,NA
",aclass ",Child,NA
"thatextendsfromtheparent,anda",sayHi,NA
methodinbothofthem:,"classPops{ 
  
 publicfunctionsayHi(){ 
  
 echo""Hi,Iampops.""; 
  
 } 
  
 }
  
 classChildextendsPops{ 
  
 publicfunctionsayHi(){ 
  
 echo""Hi,Iamachild.""; 
  
 } 
  
 }
  
 $pops=newPops(); 
  
 $child=newChild(); 
  
 echo$pops->sayHi();//Hi,Iampops. echo$child-
 >sayHi();//Hi,IamChild.",NA
"Thehighlightedcodeshowsyouthatthemethodhasbeenoverridden,sowheninvokingit ",NA,NA
"fromachild’spointofview,wewillbeusingitratherthantheoneinheritedfromits ",NA,NA
father.Butwhathappensifwewanttoreferencetheinheritedonetoo?Youcanalways ,NA,NA
referenceitwiththekeyword,parent,NA
.Let’sseehowitworks:,"classChildextendsPops{ 
  
 publicfunctionsayHi(){ 
  
 echo""Hi,Iamachild.""; 
  
 parent::sayHi(); 
  
 } 
  
 }
  
 $child=newChild(); 
  
 echo$child->sayHi();//Hi,IamChild.HiIampops.",NA
Nowthechildissaying,hi,NA
"forbothhimselfandhisfather.Itseemsveryeasyandhandy, ",NA,NA
"right?Well,thereisarestriction.Imaginethat,asinreallife,thechildwasveryshy,and ",NA,NA
hewouldnotsayhitoeverybody.Wecouldtrytosetthevisibilityofthemethodas ,NA,NA
"protected,butseewhathappens:","classChildextendsPops{ 
  
 protectedfunctionsayHi(){ 
  
 echo""Hi,Iamachild.""; 
  
 } 
  
 }",NA
"Whentryingthiscode,evenwithouttryingtoinstantiateit,youwillgetafatalerror ",NA,NA
"complainingabouttheaccesslevelofthatmethod.Thereasonisthatwhenoverriding,the ",NA,NA
methodhastohaveatleastasmuchvisibilityastheoneinherited.Thatmeansthatifwe ,NA,NA
"inheritaprotectedone,wecanoverrideitwithanotherprotectedorapublicone,but ",NA,NA
neverwithaprivateone.,NA,NA
Abstractclasses ,NA,NA
Rememberthatyoucanextendonlyfromoneparentclasseachtime.Thatmeansthat ,Customer,NA
canonlyextendfrom,Person,NA
.Butifwewanttomakethishierarchictreemore ,NA,NA
"complex,wecancreatechildrenclassesthatextendfrom",Customer,NA
",andthoseclasseswill ",NA,NA
extendimplicitlyfrom,Person,NA
too.Let’screatetwotypesofcustomer:basicandpremium. ,NA,NA
Thesetwocustomerswillhavethesamepropertiesandmethodsfrom,Customer,NA
andfrom ,Person,NA
",plusthenewonesthatweimplementineachoneofthem.",NA,NA
Savethefollowingcodeas,src/Domain/Customer/Basic.php,NA
: ,"<?php 
  
 namespaceBookstore\Domain\Customer; 
  
 useBookstore\Domain\Customer; 
  
 classBasicextendsCustomer{ 
  
 publicfunctiongetMonthlyFee():float{ 
  
 return5.0; 
  
 } 
  
 publicfunctiongetAmountToBorrow():int{ 
  
 return3; 
  
 } 
  
 publicfunctiongetType():string{ 
  
 return'Basic'; 
  
 } 
  
 }",NA
Andthefollowingcodeas,src/Domain/Customer/Premium.php,NA
: ,"<?php 
  
 namespaceBookstore\Domain\Customer; 
  
 useBookstore\Domain\Customer; 
  
 classPremiumextendsCustomer{ 
  
 publicfunctiongetMonthlyFee():float{ 
  
 return10.0; 
  
 } 
  
 publicfunctiongetAmountToBorrow():int{ 
  
 return10; 
  
 } 
  
 publicfunctiongetType():string{ 
  
 return'Premium'; 
  
 } 
  
 }",NA
Thingstonoteintheprecedingtwocodesarethatweextendfrom,Customer,NA
intwo,NA,NA
"differentclasses,anditisperfectlylegal—wecanextendfromclassesindifferent ",NA,NA
"namespaces.Withthisaddition,thehierarchictreefor",Person,NA
wouldlookasfollows:,NA,NA
"Wedefinethesamemethodsinthesetwoclasses,buttheirimplementationsaredifferent.",NA,NA
"Theaimofthisapproachistousebothtypesofcustomersindistinctively,without ",NA,NA
"knowingwhichoneitiseachtime.Forexample,wecouldtemporallyhavethefollowing ",NA,NA
codeinour,init.php,NA
.Remembertoaddthe,use,NA
statementtoimporttheclass,Customer,NA
if ,NA,NA
youdonothaveit.,"functioncheckIfValid(Customer$customer,array$books):bool{ return$customer-
 >getAmountToBorrow()>=count($books); }",NA
Theprecedingfunctionwouldtellusifagivencustomercouldborrowallthebooksinthe ,NA,NA
array.Noticethatthetypehintingofthemethodsays,Customer,NA
",withoutspecifyingwhich ",NA,NA
one.Thiswillacceptobjectsthatareinstancesof,Customer,NA
oranyclassthatextendsfrom ,Customer,NA
",thatis,",Basic,NA
or,Premium,NA
".Lookslegit,right?Let’strytouseitthen:","$customer1=newBasic(5,'John','Doe','johndoe@mail.com'); 
 var_dump(checkIfValid($customer1,[$book1]));//ok 
  
 $customer2=newCustomer(7,'James','Bond','james@bond.com'); 
 var_dump(checkIfValid($customer2,[$book1]));//fails",NA
"Thefirstinvocationworksasexpected,butthesecondonefails,eventhoughweare ",NA,NA
sendinga,Customer,NA
object.Theproblemarisesbecausetheparentdoesnotknowabout ,NA,NA
any,getAmountToBorrow,NA
method!Italsolooksdangerousthatwerelyonthechildrento ,NA,NA
alwaysimplementthatmethod.Thesolutionliesinusingabstractclasses.,NA,NA
An,NA,NA
abstractclass,NA,NA
isaclassthatcannotbeinstantiated.Itssolepurposeistomakesure ,NA,NA
thatitschildrenarecorrectlyimplemented.Declaringaclassasabstractisdonewiththe ,NA,NA
keyword,abstract,NA
",followedbythedefinitionofanormalclass.Wecanalsospecifythe",NA,NA
"methodsthatthechildrenareforcedtoimplement,withoutimplementingtheminthe ",NA,NA
"parentclass.Thosemethodsarecalledabstractmethods,andaredefinedwiththekeyword ",abstract,NA
"atthebeginning.Ofcourse,therestofthenormalmethodscanstaytheretoo, ",NA,NA
andwillbeinheritedbyitschildren:,"<?php 
  
 abstractclassCustomerextendsPerson{ 
 //...
  
 abstractpublicfunctiongetMonthlyFee(); 
 abstractpublicfunctiongetAmountToBorrow(); 
 abstractpublicfunctiongetType(); 
  
 //...
  
 }",NA
"Theprecedingabstractionsolvesbothproblems.First,wewillnotbeabletosendany ",NA,NA
instanceoftheclass,Customer,NA
",becausewecannotinstantiateit.Thatmeansthatallthe ",NA,NA
objectsthatthe,checkIfValid,NA
methodisgoingtoacceptareonlythechildrenfrom ,Customer,NA
".Ontheotherhand,declaringabstractmethodsforcesallthechildrenthatextend ",NA,NA
"theclasstoimplementthem.Withthat,wemakesurethatallobjectswillimplement ",getAmountToBorrow,NA
",andourcodeissafe.",NA,NA
Thenewhierarchictreewilldefinethethreeabstractmethodsin,Customer,NA
",andwillomit ",NA,NA
"themforitschildren.Itistruethatweareimplementingtheminthechildren,butasthey ",NA,NA
areenforcedby,Customer,NA
",andthankstoabstraction,wearesurethatallclassesextending ",NA,NA
"fromitwillhavetoimplementthem,andthatitissafetodoso.Let’sseehowthisisdone:",NA,NA
"Withthelastnewaddition,your",init.php,NA
fileshouldfail.Thereasonisthatitistryingto ,NA,NA
instantiatetheclass,Customer,NA
",butnowitisabstract,soyoucannot.Instantiateaconcrete ",NA,NA
"class,thatis,onethatisnotabstract,tosolvetheproblem.",NA,NA
Interfaces,NA,NA
An,NA,NA
interface,NA,NA
isanOOPelementthatgroupsasetoffunctiondeclarationswithout ,NA,NA
"implementingthem,thatis,itspecifiesthename,returntype,andarguments,butnotthe ",NA,NA
"blockofcode.Interfacesaredifferentfromabstractclasses,sincetheycannotcontainany ",NA,NA
"implementationatall,whereasabstractclassescouldmixbothmethoddefinitionsand ",NA,NA
"implementedones.Thepurposeofinterfacesistostatewhataclasscando,butnothowit ",NA,NA
isdone.,NA,NA
"Fromourcode,wecanidentifyapotentialusageofinterfaces.Customershavean ",NA,NA
"expectedbehavior,butitsimplementationchangesdependingonthetypeofcustomer.So, ",Customer,NA
couldbeaninterfaceinsteadofanabstractclass.Butasaninterfacecannot ,NA,NA
"implementanyfunction,norcanitcontainproperties,wewillhavetomovetheconcrete ",NA,NA
codefromthe,Customer,NA
"classtosomewhereelse.Fornow,let’smoveituptothe",Person,NA
class.Editthe,Person,NA
classasshown:,"<?php
  
 namespaceBookstore\Domain;
  
 classPerson{
  
 privatestatic$lastId=0; 
  
 protected$id; 
  
 protected$firstname; 
  
 protected$surname; 
  
 protected$email;
  
 publicfunction__construct( 
  
 int$id, 
  
 string$firstname, 
  
 string$surname, 
  
 string$email 
  
 ){ 
  
 $this->firstname=$firstname; $this-
 >surname=$surname; 
  
 $this->email=$email;
  
 if(empty($id)){ 
  
 $this->id=++self::$lastId; }else{ 
  
 $this->id=$id; 
  
 if($id>self::$lastId){ self::$lastId=$id; } 
  
 } 
  
 }
  
 publicfunctiongetFirstname():string{ return$this->firstname; 
  
 } 
  
 publicfunctiongetSurname():string{",NA
Note,NA,NA
Complicatingthingsmorethannecessary,NA,NA
"Interfacesareveryuseful,butthereisalwaysaplaceandatimeforeverything.Asour ",NA,NA
"applicationisverysimpleduetoitsdidacticnature,thereisnorealplaceforthem.The ",NA,NA
abstractclassalreadydefinedintheprevioussectionisthebestapproachforourscenario.,NA,NA
"Butjustforthesakeofshowinghowinterfaceswork,wewillbeadaptingourcodeto ",NA,NA
them.,NA,NA
"Donotworrythough,asmostofthecodethatwearegoingtointroducenowwillbe ",NA,NA
replacedbybetterpracticesonceweintroducedatabasesandtheMVCpatternin,NA,NA
Chapter ,NA,NA
5,NA,NA
",",NA,NA
UsingDatabases,NA,NA
",and",NA,NA
Chapter6,NA,NA
",",NA,NA
AdaptingtoMVC,NA,NA
.,NA,NA
"Whenwritingyourownapplications,donottrytocomplicatethingsmorethannecessary. ",NA,NA
Itisacommonpatterntoseeverycomplexcodefromdevelopersthattrytoshowupall ,NA,NA
theskillstheyhaveinaverysimplescenario.Useonlythenecessarytoolstoleaveclean ,NA,NA
"codethatiseasytomaintain,andofcourse,thatworksasexpected.",NA,NA
Changethecontentof,Customer.php,NA
withthefollowing:,"<?php
  
 namespaceBookstore\Domain;
  
 interfaceCustomer{ 
  
 publicfunctiongetMonthlyFee():float; 
 publicfunctiongetAmountToBorrow():int; 
 publicfunctiongetType():string; 
  
 }",NA
Notethataninterfaceisverysimilartoanabstractclass.Thedifferencesarethatitis ,NA,NA
definedwiththekeyword,interface,NA
",andthatitsmethodsdonothavetheword ",abstract,NA
".Interfacescannotbeinstantiated,sincetheirmethodsarenotimplementedas ",NA,NA
withabstractclasses.Theonlythingyoucandowiththemismakeaclasstoimplement ,NA,NA
them.,NA,NA
Implementing,NA,NA
"aninterfacemeansimplementingallthemethodsdefinedinit,likewhenwe ",NA,NA
"extendedanabstractclass.Ithasallthebenefitsoftheextensionofabstractclasses,such ",NA,NA
"asbelongingtothattype—usefulwhentypehinting.Fromthedeveloper’spointofview,",NA,NA
usingaclassthatimplementsaninterfaceislikewritingacontract:youensurethatyour ,NA,NA
"classwillalwayshavethemethodsdeclaredintheinterface,regardlessofthe ",NA,NA
"implementation.Becauseofthat,interfacesonlycareaboutpublicmethods,whicharethe ",NA,NA
onesthatotherdeveloperscanuse.Theonlychangeyouneedtomakeinyourcodeisto ,NA,NA
replacethekeywords,extends,NA
by,implements,NA
:,classBasicimplementsCustomer{,NA
"So,whywouldsomeoneuseaninterfaceifwecouldalwaysuseanabstractclassthatnot ",NA,NA
"onlyenforcestheimplementationofmethods,butalsoallowsinheritingcodeaswell?The ",NA,NA
"reasonisthatyoucanonlyextendfromoneclass,butyoucanimplementmultiple ",NA,NA
instancesatthesametime.Imaginethatyouhadanotherinterfacethatdefinedpayers. ,NA,NA
"Thiscouldidentifysomeonethathastheabilitytopaysomething,regardlessofwhatitis.",NA,NA
Savethefollowingcodein,src/Domain/Payer.php,NA
:,"<?php
  
 namespaceBookstore\Domain;
  
 interfacePayer{ 
  
 publicfunctionpay(float$amount); 
  
 publicfunctionisExtentOfTaxes():bool; }",NA
Nowourbasicandpremiumcustomerscanimplementboththeinterfaces.Thebasic ,NA,NA
customerwilllooklikethefollowing:,"//...
  
 useBookstore\Domain\Customer; 
  
 useBookstore\Domain\Person;
  
 classBasicextendsPersonimplementsCustomer{ 
 publicfunctiongetMonthlyFee():float{ //...",NA
Andthepremiumcustomerwillchangeinthesameway:,"//...
  
 useBookstore\Domain\Customer; 
  
 useBookstore\Domain\Person;
  
 classPremiumextendsPersonimplementsCustomer{ 
 publicfunctiongetMonthlyFee():float{ 
  
 //...",NA
Youshouldseethatthiscodewouldnolongerwork.Thereasonisthatalthoughwe ,NA,NA
"implementasecondinterface,themethodsarenotimplemented.Addthesetwomethods ",NA,NA
tothebasiccustomerclass:,"publicfunctionpay(float$amount){ 
  
 echo""Paying$amount.""; 
  
 }
  
 publicfunctionisExtentOfTaxes():bool{",NA
Addthesetwomethodstothepremiumcustomerclass:,"publicfunctionpay(float$amount){ 
  
 echo""Paying$amount.""; 
  
 }
  
 publicfunctionisExtentOfTaxes():bool{ returntrue; 
  
 }",NA
Ifyouknowthat,NA,NA
all,NA,NA
"customerswillhavetobepayers,youcouldevenmakethe",Customer,NA
interfacetoinheritfromthe,Payer,NA
interface:,interfaceCustomerextendsPayer{,NA
Thischangedoesnotaffecttheusageofourclassesatall.Otherdeveloperswillseethat ,NA,NA
ourbasicandpremiumcustomersinheritfrom,Payer,NA
and,Customer,NA
",andsotheycontain ",NA,NA
"allthenecessarymethods.Thattheseinterfacesareindependent,ortheyextendfromeach ",NA,NA
otherissomethingthatwillnotaffecttoomuch.,NA,NA
"Interfacescanonlyextendfromotherinterfaces,andclassescanonlyextendfromother ",NA,NA
"classes.Theonlywaytomixthemiswhenaclassimplementsaninterface,butneither ",NA,NA
"doesaclassextendfromaninterface,nordoesaninterfaceextendfromaclass.Butfrom ",NA,NA
"thepointofviewoftypehinting,theycanbeusedinterchangeably.",NA,NA
"Tosummarizethissectionandmakethingsclear,let’sshowwhatthehierarchictreelooks ",NA,NA
"likeafterallthenewadditions.Asinabstractclasses,themethodsdeclaredinaninterface ",NA,NA
areshownintheinterfaceratherthanineachoftheclassesthatimplementit.,NA,NA
Polymorphism,NA,NA
Polymorphism,NA,NA
isanOOPfeaturethatallowsustoworkwithdifferentclassesthat ,NA,NA
implementthesameinterface.Itisoneofthebeautiesofobject-orientedprogramming.It ,NA,NA
"allowsthedevelopertocreateacomplexsystemofclassesandhierarchictrees,butoffers ",NA,NA
asimplewayofworkingwiththem.,NA,NA
"Imaginethatwehaveafunctionthat,givenapayer,checkswhetheritisexemptoftaxes ",NA,NA
"ornot,andmakesitpaysomeamountofmoney.Thispieceofcodedoesnotreallymind ",NA,NA
"ifthepayerisacustomer,alibrarian,orsomeonewhohasnothingtodowiththe ",NA,NA
bookstore.Theonlythingthatitcaresaboutisthatthepayerhastheabilitytopay.The ,NA,NA
functioncouldbeasfollows:,"functionprocessPayment(Payer$payer,float$amount){ if($payer-
 >isExtentOfTaxes()){ 
  
 echo""Whataluckyone…""; 
  
 }else{ 
  
 $amount*=1.16; 
  
 } 
  
 $payer->pay($amount); 
  
 }",NA
"Youcouldsendbasicorpremiumcustomerstothisfunction,andthebehaviorwillbe ",NA,NA
"different.But,asbothimplementthe",Payer,NA
"interface,bothobjectsprovidedarevalid ",NA,NA
"types,andbotharecapableofperformingtheactionsneeded.",NA,NA
The,checkIfValid,NA
functiontakesacustomerandalistofbooks.Wealreadysawthat ,NA,NA
sendinganykindofcustomermakesthefunctionworkasexpected.Butwhathappensif ,NA,NA
wesendanobjectoftheclass,Librarian,NA
",whichextendsfrom",Payer,NA
?As,Payer,NA
doesnot ,NA,NA
knowabout,Customer,NA
"(itisrathertheotherwayaround),thefunctionwillcomplainasthe ",NA,NA
typehintingisnotaccomplished.,NA,NA
OneusefulfeaturethatcomeswithPHPistheabilitytocheckwhetheranobjectisan ,NA,NA
instanceofaspecificclassorinterface.Thewaytouseitistospecifythevariable ,NA,NA
followedbythekeyword,instanceof,NA
andthenameoftheclassorinterface.Itreturnsa ,NA,NA
"Boolean,whichis",true,NA
iftheobjectisfromaclassthatextendsorimplementsthe ,NA,NA
"specifiedone,or",false,NA
otherwise.Let’sseesomeexamples:,"$basic=newBasic(1,""name"",""surname"",""email""); 
 $premium=newPremium(2,""name"",""surname"",""email""); 
 var_dump($basicinstanceofBasic);//true 
  
 var_dump($basicinstanceofPremium);//false 
  
 var_dump($premiuminstanceofBasic);//false 
  
 var_dump($premiuminstanceofPremium);//true 
  
 var_dump($basicinstanceofCustomer);//true 
  
 var_dump($basicinstanceofPerson);//true 
  
 var_dump($basicinstanceofPayer);//true",NA
Remembertoaddallthe,use,NA
"statementsforeachoftheclassorinterface,otherwisePHP ",NA,NA
willunderstandthatthespecifiedclassnameisinsidethenamespaceofthefile.,NA,NA
Traits,NA,NA
"Sofar,youhavelearnedthatextendingfromclassesallowsyoutoinheritcode(properties ",NA,NA
"andmethodimplementations),butithasthelimitationofextendingonlyfromoneclass ",NA,NA
"eachtime.Ontheotherhand,youcanuseinterfacestoimplementmultiplebehaviors ",NA,NA
"fromthesameclass,butyoucannotinheritcodeinthisway.Tofillthisgap,thatis,tobe ",NA,NA
"abletoinheritcodefrommultipleplaces,youhavetraits.",NA,NA
Traits,NA,NA
"aremechanismsthatallowyoutoreusecode,“inheriting”,orrathercopy-pasting ",NA,NA
"code,frommultiplesourcesatthesametime.Traits,asabstractclassesorinterfaces, ",NA,NA
cannotbeinstantiated;theyarejustcontainersoffunctionalitythatcanbeusedfromother ,NA,NA
classes.,NA,NA
"Ifyouremember,wehavesomecodeinthe",Person,NA
classthatmanagestheassignmentof ,NA,NA
"IDs.Thiscodeisnotreallypartofaperson,butratherpartofanIDsystemthatcouldbe ",NA,NA
usedbysomeotherentitythathastobeidentifiedwithIDstoo.Onewaytoextractthis ,NA,NA
functionalityfrom,Person,NA
"—andwearenotsayingthatitisthebestwaytodoso,butfor ",NA,NA
"thesakeofseeingtraitsinaction,wechoosethisone—istomoveittoatrait.",NA,NA
"Todefineatrait,doasifyouweredefiningaclass,justusethekeyword",trait,NA
insteadof ,class,NA
".Defineitsnamespace,addthe",use,NA
"statementsneeded,declareitspropertiesand ",NA,NA
"implementitsmethods,andplaceeverythinginafilethatfollowsthesameconventions.",NA,NA
Addthefollowingcodetothe,src/Utils/Unique.php,NA
file:,"<?php
  
 namespaceBookstore�tils;
  
 traitUnique{ 
  
 privatestatic$lastId=0; 
  
 protected$id;
  
 publicfunctionsetId(int$id){ 
 if(empty($id)){ 
  
 $this->id=++self::$lastId; }else{ 
  
 $this->id=$id; 
  
 if($id>self::$lastId){ self::$lastId=$id; } 
  
 } 
  
 }
  
 publicstaticfunctiongetLastId():int{ returnself::$lastId; 
  
 } 
  
 publicfunctiongetId():int{ 
  
 return$this->id; 
  
 } 
  
 }",NA
"Observethatthenamespaceisnotthesameasusual,sincewearestoringthiscodeina",NA,NA
"differentfile.Thisisamatterofconventions,butyouareentirelyfreetousethefile ",NA,NA
"structurethatyouconsiderbetterforeachcase.Inthiscase,wedonotthinkthatthistrait ",NA,NA
"represents“businesslogic”likecustomersandbooksdo;instead,itrepresentsautilityfor ",NA,NA
managingtheassignmentofIDs.,NA,NA
WeincludeallthecoderelatedtoIDsfrom,Person,NA
".Thatincludestheproperties,the ",NA,NA
"getters,andthecodeinsidetheconstructor.Asthetraitcannotbeinstantiated,wecannot ",NA,NA
"addaconstructor.Instead,weaddeda",setId,NA
methodthatcontainsthecode.When ,NA,NA
"constructinganewinstancethatusesthistrait,wecaninvokethis",setId,NA
methodtosetthe ,NA,NA
IDbasedonwhattheusersendsasanargument.,NA,NA
Theclass,Person,NA
willhavetochangetoo.WehavetoremoveallreferencestoIDsandwe ,NA,NA
"willhavetodefinesomehowthattheclassisusingthetrait.Todothat,weusethe ",NA,NA
keyword,use,NA
",likeinnamespaces,butinsidetheclass.Let’sseewhatitwouldlooklike:","<?php
  
 namespaceBookstore\Domain;
  
 useBookstore�tils�nique;
  
 classPerson{ 
  
 useUnique;
  
 protected$firstname; 
  
 protected$surname; 
  
 protected$email;
  
 publicfunction__construct( 
  
 int$id, 
  
 string$firstname, 
  
 string$surname, 
  
 string$email 
  
 ){ 
  
 $this->firstname=$firstname; $this-
 >surname=$surname; 
  
 $this->email=$email; 
  
 $this->setId($id); 
  
 }
  
 publicfunctiongetFirstname():string{ return$this->firstname; 
  
 } 
  
 publicfunctiongetSurname():string{ return$this->surname; 
  
 } 
  
 publicfunctiongetEmail():string{ 
  
 return$this->email; 
  
 } 
  
 publicfunctionsetEmail(string$email){ $this->email=$email; 
  
 } 
  
 }",NA
Weaddthe,useUnique;,NA
statementtolettheclassknowthatitisusingthetrait.We ,NA,NA
"removeeverythingrelatedtoIDs,eveninsidetheconstructor.WestillgetanIDasthefirst ",NA,NA
"argumentoftheconstructor,butweaskthemethod",setId,NA
fromthetraittodoeverything ,NA,NA
forus.Notethatwerefertothatmethodwith,$this,NA
",asifthemethodwasinsidetheclass. ",NA,NA
Theupdatedhierarchictreewouldlooklikethefollowing(notethatwearenotaddingall ,NA,NA
themethodsforalltheclassesorinterfacesthatarenotinvolvedintherecentchangesin ,NA,NA
ordertokeepthediagramassmallandreadableaspossible):,NA,NA
"Let’sseehowitworks,eventhoughitdoessointhewaythatyouprobablyexpect.Add ",NA,NA
thiscodeintoyour,init.php,NA
"file,includethenecessary",use,NA
"statements,andexecuteitin ",NA,NA
yourbrowser:,"$basic1=newBasic(1,""name"",""surname"",""email""); 
 $basic2=newBasic(null,""name"",""surname"",""email""); var_dump($basic1-
 >getId());//1 
  
 var_dump($basic2->getId());//2",NA
"Theprecedingcodeinstantiatestwocustomers.ThefirstofthemhasaspecificID, ",NA,NA
whereasthesecondoneletsthesystemchooseanIDforit.Theresultisthatthesecond ,NA,NA
"basiccustomerhastheID2.Thatistobeexpected,asbothcustomersarebasic.Butwhat ",NA,NA
wouldhappenifthecustomersareofdifferenttypes?,"$basic=newBasic(1,""name"",""surname"",""email""); 
  
 $premium=newPremium(null,""name"",""surname"",""email""); var_dump($basic-
 >getId());//1 
  
 var_dump($premium->getId());//2",NA
"TheIDsarestillthesame.Thatistobeexpected,asthetraitisincludedinthe",Person,NA
"class,sothestaticproperty",$lastId,NA
willbesharedacrossalltheinstancesoftheclass ,Person,NA
",including",Basic,NA
and,Premium,NA
customers.Ifyouusedthetraitfrom,Basic,NA
and ,Premium,NA
customerinsteadof,Person,NA
"(butyoushouldnot),youwouldhavethefollowing",NA,NA
result:,"var_dump($basic->getId());//1 
  
 var_dump($premium->getId());//1",NA
Eachclasswillhaveitsownstaticproperty.All,Basic,NA
instanceswillsharethesame ,$lastId,NA
",differentfromthe",$lastId,NA
of,Premium,NA
instances.Thisshouldmakeclearthatthe ,NA,NA
"staticmembersintraitsarelinkedtowhicheverclassusesthem,ratherthanthetraititself. ",NA,NA
Thatcouldalsobereflectedontestingthefollowingcodewhichusesouroriginalscenario ,NA,NA
wherethetraitisusedfrom,Person,NA
:,"$basic=newBasic(1,""name"",""surname"",""email""); 
  
 $premium=newPremium(null,""name"",""surname"",""email""); 
 var_dump(Person::getLastId());//2 
  
 var_dump(Unique::getLastId());//0 
  
 var_dump(Basic::getLastId());//2 
  
 var_dump(Premium::getLastId());//2",NA
"Ifyouhaveagoodeyeforproblems,youmightstartthinkingaboutsomepotentialissues ",NA,NA
aroundtheusageoftraits.Whathappensifweusetwotraitsthatcontainthesame ,NA,NA
method?Orwhathappensifyouuseatraitthatcontainsamethodthatisalready ,NA,NA
implementedinthatclass?,NA,NA
"Ideally,youshouldavoidrunningintothesekindsofsituations;theyarewarninglightsfor ",NA,NA
"possiblebaddesign.Butastherewillalwaysbeextraordinarycases,let’sseesome ",NA,NA
isolatedexamplesonhowtheywouldbehave.,NA,NA
Thescenariowherethetraitandtheclassimplementthesamemethodiseasy.Themethod ,NA,NA
"implementedexplicitlyintheclassistheonewithmoreprecedence,followedbythe ",NA,NA
"methodimplementedinthetrait,andfinally,themethodinheritedfromtheparentclass.",NA,NA
Let’sseehowitworks.Takeforexamplethefollowingtraitandclassdefinitions:,"<?php
  
 traitContract{ 
  
 publicfunctionsign(){ 
  
 echo""Signingthecontract.""; 
  
 } 
  
 }
  
 classManager{ 
  
 useContract;
  
 publicfunctionsign(){ 
  
 echo""Signinganewplayer.""; 
  
 } 
  
 }",NA
Bothimplementthe,sign,NA
"method,whichmeansthatwehavetoapplytheprecedencerules ",NA,NA
definedpreviously.Themethoddefinedintheclasstakesprecedenceovertheonefrom ,NA,NA
"thetrait,sointhiscase,theexecutedmethodwillbetheonefromtheclass:","$manager=newManager(); 
  
 $manager->sign();//Signinganewplayer.",NA
Themostcomplicatedscenariowouldbeonewhereaclassusestwotraitswiththesame ,NA,NA
"method.Therearenorulesthatsolvetheconflictautomatically,soyouhavetosolveit ",NA,NA
explicitly.Checkthefollowingcode:,"<?php
  
 traitContract{ 
  
 publicfunctionsign(){ 
  
 echo""Signingthecontract.""; 
  
 } 
  
 }
  
 traitCommunicator{ 
  
 publicfunctionsign(){ 
  
 echo""Signingtothewaitress.""; } 
  
 }
  
 classManager{ 
  
 useContract,Communicator; 
  
 }
  
 $manager=newManager(); 
  
 $manager->sign();",NA
"Theprecedingcodethrowsafatalerror,asbothtraitsimplementthesamemethod.To ",NA,NA
"choosetheoneyouwanttouse,youhavetousetheoperator",insteadof,NA
".Touseit,state ",NA,NA
"thetraitnameandthemethodthatyouwanttouse,followedby",insteadof,NA
andthetrait ,NA,NA
"thatyouarerejectingforuse.Optionally,usethekeyword",as,NA
toaddanaliaslikewedid ,NA,NA
withnamespacessothatyoucanuseboththemethods:,"classManager{ 
  
 useContract,Communicator{ 
  
 Contract::signinsteadofCommunicator; 
 Communicator::signasmakeASign; 
  
 } 
  
 }
  
 $manager=newManager(); 
  
 $manager->sign();//Signingthecontract.
  
 $manager->makeASign();//Signingtothewaitress.",NA
Youcanseehowwedecidedtousethemethodof,Contract,NA
insteadof,Communicator,NA
",but ",NA,NA
"addedthealiassothatbothmethodsareavailable.Hopefully,youcanseethateventhe ",NA,NA
"conflictscanbesolved,andtherearespecificcaseswherethereisnothingtodobutdeal ",NA,NA
"withthem;ingeneral,theylooklikeabadsign—nopunintended.",NA,NA
Handlingexceptions,NA,NA
"Itdoesnotmatterhoweasyandintuitiveyourapplicationisdesignedtobe,therewillbe ",NA,NA
"badusagefromtheuserorjustrandomerrorsofconnectivity,andyourcodehastobe ",NA,NA
readytohandlethesescenariossothattheuserexperienceisagoodaspossible.Wecall ,NA,NA
thesescenarios,NA,NA
exceptions,NA,NA
:anelementofthelanguagethatidentifiesacasethatisnotas ,NA,NA
weexpected.,NA,NA
Thetry…catchblock,NA,NA
"Yourcodecanthrowexceptionsmanuallywheneveryouthinkitnecessary.Forexample, ",NA,NA
takethe,setId,NA
methodfromthe,Unique,NA
"trait.Thankstotypehinting,weareenforcingthe ",NA,NA
"IDtobeanumericone,butthatisasfarasitgoes.Whatwouldhappenifsomeonetriesto ",NA,NA
"setanIDthatisanegativenumber?Thecoderightnowallowsittogothrough,but ",NA,NA
"dependingonyourpreferences,youwouldliketoavoidit.Thatwouldbeagoodplacefor ",NA,NA
anexceptiontohappen.Let’sseehowwewouldaddthischeckandconsequentexception:,"publicfunctionsetId($id){ 
  
 if($id<0){ 
  
 thrownew\Exception('Idcannotbenegative.'); 
 } 
  
 if(empty($id)){ 
  
 $this->id=++self::$lastId; 
  
 }else{ 
  
 $this->id=$id; 
  
 if($id>self::$lastId){ 
  
 self::$lastId=$id; 
  
 } 
  
 } 
  
 }",NA
"Asyoucansee,exceptionsareobjectsoftheclassexception.Rememberaddingthe ",NA,NA
"backslashtothenameoftheclass,unlessyouwanttoincludeitwith",useException;,NA
at ,NA,NA
thetopofthefile.Theconstructorofthe,Exception,NA
"classtakessomeoptionalarguments, ",NA,NA
thefirstoneofthembeingthemessageoftheexception.Instancesoftheclass,Exception,NA
donothingbythemselves;theyhavetobethrowninordertobenoticedbytheprogram.,NA,NA
"Let’stryforcingourprogramtothrowthisexception.Inordertodothat,let’strytocreate ",NA,NA
acustomerwithanegativeID.Inyour,init.php,NA
"file,addthefollowing:","$basic=newBasic(-1,""name"",""surname"",""email"");",NA
"Ifyoutryitnowinyourbrowser,PHPwillthrowafatalerrorsayingthattherewasan ",NA,NA
"uncaughtexception,whichistheexpectedbehavior.ForPHP,anexceptionissomething ",NA,NA
"fromwhatitcannotrecover,soitwillstopexecution.Thatisfarfromideal,asyouwould ",NA,NA
"liketojustdisplayanerrormessagetotheuser,andletthemtryagain.",NA,NA
Youcan—andshould—captureexceptionsusingthe,try…catch,NA
blocks.Youinsertthe ,NA,NA
codethatmightthrowanexceptioninthe,try,NA
"blockandifanexceptionhappens,PHPwill ",NA,NA
jumptothe,catch,NA
block.Let’sseehowitworks:,"publicfunctionsetId(int$id){ 
  
 try{ 
  
 if($id<0){ 
  
 thrownewException('Idcannotbenegative.'); } 
  
 if(empty($id)){ 
  
 $this->id=++self::$lastId; 
  
 }else{ 
  
 $this->id=$id;",NA
"Ifwetestthelastcodesnippetinourbrowser,wewillseethemessageprintedfromthe ",catch,NA
block.Callingthe,getMessage,NA
methodonanexceptioninstancewillgiveusthe ,NA,NA
message—thefirstargumentwhencreatingtheobject.Butrememberthattheargumentof ,NA,NA
"theconstructorisoptional;so,donotrelyonthemessageoftheexceptiontoomuchifyou ",NA,NA
"arenotsurehowitisgenerated,asitmightbeempty.",NA,NA
"Notethataftertheexceptionisthrown,nothingelseinsidethe",try,NA
blockisexecuted;PHP ,NA,NA
goesstraighttothe,catch,NA
"block.Additionally,theblockgetsanargument,whichisthe ",NA,NA
"exceptionthrown.Here,typehintingismandatory—youwillseewhyverysoon.Naming ",NA,NA
theargumentas,$e,NA
"isawidelyusedconvention,eventhoughitisnotagoodpracticeto ",NA,NA
usepoordescriptivenamesforvariables.,NA,NA
"Beingabitcritical,sofar,thereisnotanyrealadvantagetobeseeninusingexceptionsin ",NA,NA
thisexample.Asimple,if…else,NA
"blockwoulddoexactlythesamejob,right?Butthereal ",NA,NA
"powerofexceptionsliesintheabilitytobepropagatedacrossmethods.Thatis,the ",NA,NA
exceptionthrownonthe,setId,NA
"method,ifnotcaptured,willbepropagatedtowhereverthe ",NA,NA
"methodwasinvoked,allowingustocaptureitthere.Thisisveryuseful,asdifferentplaces ",NA,NA
"inthecodemightwanttohandletheexceptioninadifferentway.Toseehowthisisdone, ",NA,NA
let’sremovethe,try…catch,NA
insertedin,setId,NA
",andplacethefollowingpieceofcodein ",NA,NA
your,init.php,NA
"file,instead:","try{ 
  
 $basic=newBasic(-1,""name"",""surname"",""email""); 
  
 }catch(Exception$e){ 
  
 echo'Somethinghappenedwhencreatingthebasiccustomer:' .$e->getMessage(); 
  
 }",NA
Theprecedingexampleshowshowusefulitistocatchpropagatedexceptions:wecanbe ,NA,NA
"morespecificofwhathappens,asweknowwhattheuserwastryingtodowhenthe ",NA,NA
"exceptionwasthrown.Inthiscase,weknowthatweweretryingtocreatethecustomer, ",NA,NA
butthisexceptionmighthavebeenthrownwhentryingtoupdatetheIDofanexisting ,NA,NA
"customer,whichwouldneedadifferenterrormessage.",NA,NA
Thefinallyblock,NA,NA
Thereisathirdblockthatyoucanusewhendealingwithexceptions:the,finally,NA
block. ,NA,NA
Thisblockisaddedafterthe,try…catch,NA
"one,anditisoptional.Infact,the",catch,NA
blockis ,NA,NA
optionaltoo;therestrictionisthata,try,NA
mustbefollowedbyatleastoneofthem.Soyou ,NA,NA
couldhavethesethreescenarios:,"//scenario1:thewholetry-catch-finally try{ 
  
 //codethatmightthrowanexception }catch(Exception$e){ 
  
 //codethatdealswiththeexception }finally{ 
  
 //finallyblock 
  
 }
  
 //scenario2:try-finallywithoutcatch try{ 
  
 //codethatmightthrowanexception }finally{ 
  
 //finallyblock 
  
 }
  
 //scenario3:try-catchwithoutfinally try{ 
  
 //codethatmightthrowanexception }catch(Exception$e){ 
  
 //codethatdealswiththeexception }",NA
Thecodeinsidethe,finally,NA
blockisexecutedwheneitherthe,try,NA
orthe,catch,NA
blocksare ,NA,NA
"executedcompletely.So,ifwehaveascenariowherethereisnoexception,afterallthe ",NA,NA
codeinsidethe,try,NA
"blockisexecuted,PHPwillexecutethecodeinside",finally,NA
.Onthe ,NA,NA
"otherhand,ifthereisanexceptionthrowninsidethe",try,NA
"block,PHPwilljumptothe ",catch,NA
"block,andafterexecutingeverythingthere,itwillexecutethe",finally,NA
blocktoo.,NA,NA
"Inordertotestthisfunctionality,let’simplementafunctionthatcontainsa","try…catch…finall
 y",NA
"block,tryingtocreateacustomerwithagivenID(throughanargument),and ",NA,NA
loggingalltheactionsthattakeplace.Youcanaddthefollowingcodesnippetintoyour ,init.php,NA
file:,"functioncreateBasicCustomer($id) 
  
 { 
  
 try{ 
  
 echo""\nTryingtocreateanewcustomer.\n""; 
  
 returnnewBasic($id,""name"",""surname"",""email""); 
  
 }catch(Exception$e){ 
  
 echo""Somethinghappenedwhencreatingthebasiccustomer:"" .$e->getMessage().""\n""; 
  
 }finally{ 
  
 echo""Endoffunction.\n""; 
  
 } 
  
 }",NA
"Ifyoutrythis,yourbrowserwillshowyouthefollowingoutput—remembertodisplaythe ",NA,NA
sourcecodeofthepagetoseeitformattedprettily:,NA,NA
"Theresultmightnotbetheoneyouexpected.Thefirsttimeweinvokethefunction,we ",NA,NA
"areabletocreatetheobjectwithoutanissue,andthatmeansweexecutethe",return,NA
"statement.Inanormalfunction,thisshouldbetheendofit,butsinceweareinsidethe ",try…catch…finally,NA
"block,westillneedtoexecutethe",finally,NA
code!Thesecond ,NA,NA
"examplelooksmoreintuitive,jumpingfromthe",try,NA
tothe,catch,NA
",andthentothe",finally,NA
block.,NA,NA
The,finally,NA
blockisveryusefulwhendealingwithexpensiveresourceslikedatabase ,NA,NA
connections.In,NA,NA
Chapter5,NA,NA
",",NA,NA
UsingDatabases,NA,NA
",youwillseehowtousethem.Dependingon ",NA,NA
"thetypeofconnection,youwillhavetocloseitafteruseforallowingotherusersto ",NA,NA
connect.The,finally,NA
"blockisusedforclosingthoseconnections,regardlessofwhether ",NA,NA
thefunctionthrowsanexceptionornot.,NA,NA
Catchingdifferenttypesofexceptions,NA,NA
"Exceptionshavealreadybeenprovenuseful,butthereisstilloneimportantfeatureto ",NA,NA
"show:catchingdifferenttypesofexceptions.Asyoualreadyknow,exceptionsare ",NA,NA
instancesoftheclass,Exception,NA
",andaswithanyotherclass,theycanbeextended.The ",NA,NA
"maingoalofextendingfromthisclassistocreatedifferenttypesofexceptions,butwe ",NA,NA
"willnotaddanylogicinside—eventhoughyoucan,ofcourse.Let’screateaclassthat ",NA,NA
extendsfrom,Exception,NA
",andwhichidentifiesexceptionsrelatedtoinvalidIDs.Putthis ",NA,NA
codeinsidethe,src/Exceptions/InvalidIdException.php,NA
file:,"<?php
  
 namespaceBookstore\Exceptions;
  
 useException;
  
 classInvalidIdExceptionextendsException{ 
  
 publicfunction__construct($message=null){ 
 $message=$message?:'Invalididprovided.'; parent::__construct($message); 
  
 } 
  
 }",NA
The,InvalidIdException,NA
classextendsfromtheclass,Exception,NA
",andsoitcanbethrown ",NA,NA
"asone.Theconstructoroftheclasstakesanoptionalargument,",$message,NA
.Thefollowing ,NA,NA
twolinesinsideitcontaininterestingcode:,NA,NA
The,?:,NA
"operatorisashorterversionofaconditional,andworkslikethis:the ",NA,NA
expressionontheleftisreturnedifitdoesnotevaluateto,false,NA
",otherwise,the ",NA,NA
expressionontherightwillbereturned.Whatwewanthereistousethemessage ,NA,NA
"givenbytheuser,oradefaultoneincasetheuserdoesnotprovideany.Formore ",NA,NA
"informationandusages,youcanvisitthePHPdocumentationat ",NA,NA
http://php.net/manual/en/language.operators.comparison.php,NA,NA
.,parent::__construct,NA
"willinvoketheparent’sconstructor,thatis,theconstructorof ",NA,NA
theclass,Exception,NA
".Asyoualreadyknow,thisconstructorgetsthemessageofthe ",NA,NA
"exceptionasthefirstargument.Youcouldarguethat,asweareextendingfromthe ",Exception,NA
"class,wedonotreallyneedtocallanyfunctions,aswecaneditthe ",NA,NA
propertiesoftheclassstraightaway.Thereasonforavoidingthisistolettheparent ,NA,NA
"classmanageitsownproperties.Imaginethat,forsomereason,inafutureversionof ",NA,NA
"PHP,",Exception,NA
changesthenameofthepropertyforthemessage.Ifyoumodifyit ,NA,NA
"directly,youwillhavetochangethatinyourcode,butifyouusetheconstructor,you ",NA,NA
havenothingtofear.Internalimplementationsaremorelikelytochangethanexternal ,NA,NA
interfaces.,NA,NA
Wecanusethisnewexceptioninsteadofthegenericone.Replaceitinyour,Unique,NA
trait ,NA,NA
asfollows:,thrownewInvalidIdException('Idcannotbeanegativenumber.');,NA
Youcanseethatwearestillsendingamessage:thatisbecausewewanttobeevenmore,NA,NA
"specific.Buttheexceptionwouldworkaswellwithoutone.Tryyourcodeagain,andyou ",NA,NA
willseethatnothingchanges.,NA,NA
Nowimaginethatwehaveaverysmalldatabaseandwecannotallowmorethan50users. ,NA,NA
"Wecancreateanewexceptionthatidentifiesthiscase,let’ssay,as ",src/Exceptions/ExceededMaxAllowedException.php,NA
:,"<?php
  
 namespaceBookstore\Exceptions;
  
 useException;
  
 classExceededMaxAllowedExceptionextendsException{ 
 publicfunction__construct($message=null){ 
 $message=$message?:'Exceededmaxallowed.'; parent::__construct($message); 
  
 } 
  
 }",NA
"Let’smodifyourtraitinordertocheckforthiscase.WhensettinganID,ifthisIDis ",NA,NA
"greaterthan50,wecanassumethatwe’vereachedthemaximumnumberofusers:","publicfunctionsetId(int$id){ 
  
 if($id<0){ 
  
 thrownewInvalidIdException( 
  
 'Idcannotbeanegativenumber.' ); 
  
 } 
  
 if(empty($id)){ 
  
 $this->id=++self::$lastId; 
  
 }else{ 
  
 $this->id=$id; 
  
 if($id>self::$lastId){ 
  
 self::$lastId=$id; 
  
 } 
  
 } 
  
 if($this->id>50){ 
  
 thrownewExceededMaxAllowedException( 
 'Maxnumberofusersis50.' 
  
 ); 
  
 } 
  
 }",NA
Nowtheprecedingfunctionthrowstwodifferentexceptions:,InvalidIdException,NA
and ,ExceededMaxAllowedException,NA
".Whencatchingthem,youmightwanttobehaveina ",NA,NA
differentwaydependingonthetypeofexceptioncaught.Rememberhowyouhaveto ,NA,NA
declareanargumentinyour,catch,NA
"block?Well,youcanaddasmany",catch,NA
blocksas ,NA,NA
"needed,specifyingadifferentexceptionclassineachofthem.Thecodecouldlooklike ",NA,NA
this:,"functioncreateBasicCustomer(int$id) 
  
 { 
  
 try{",NA
"Ifyoutrythiscode,youshouldseethefollowingoutput:",NA,NA
Notethatwecatchthreeexceptionshere:ourtwonewexceptionsandthegenericone. ,NA,NA
Thereasonfordoingthisisthatitmighthappenthatsomeotherpieceofcodethrowsan ,NA,NA
"exceptionofadifferenttypethantheoneswedefined,andweneedtodefinea",catch,NA
blockwiththegeneric,Exception,NA
"classtogetit,asallexceptionswillextendfromit.Of ",NA,NA
"course,thisisabsolutelyoptional,andifyoudonotdoit,theexceptionwillbejust ",NA,NA
propagated.,NA,NA
Bearinmindtheorderofthe,catch,NA
blocks.PHPtriestousethe,catch,NA
blocksintheorder ,NA,NA
"thatyoudefinedthem.So,ifyourfirstcatchisfor",Exception,NA
",therestoftheblockswill ",NA,NA
"beneverexecuted,asallexceptionsextendfromthatclass.Tryitwiththefollowingcode:","try{ 
  
 echo""\nTryingtocreateanewcustomerwithid$id.\n""; 
 returnnewBasic($id,""name"",""surname"",""email""); }catch(Exception$e){ 
  
 echo'Unknownexception:'.$e->getMessage().""\n""; }catch(InvalidIdException$e){ 
  
 echo""Youcannotprovideanegativeid.\n""; 
  
 }catch(ExceededMaxAllowedException$e){ 
  
 echo""Nomorecustomersareallowed.\n""; 
  
 }",NA
Theresultthatyougetfromthebrowserwillalwaysbefromthefirstcatch:,NA,NA
Designpatterns,NA,NA
"DevelopershavebeencreatingcodesincewaybeforetheappearanceofwithInternet,and ",NA,NA
"theyhavebeenworkingonanumberofdifferentareas,notjustwebapplications.Because ",NA,NA
"ofthat,alotofpeoplehavealreadyhadtoconfrontsimilarscenarios,carryingthe ",NA,NA
"experienceofpreviousattemptsforfixingthesamething.Inshort,itmeansthatalmost ",NA,NA
"surely,someonehasalreadydesignedagoodwayofsolvingtheproblemthatyouare ",NA,NA
facingnow.,NA,NA
"Alotofbookshavebeenwrittentryingtogroupsolutionstocommonproblems,also ",NA,NA
knownas,NA,NA
designpatterns,NA,NA
.Designpatternsarenotalgorithmsthatyoucopyandpasteinto ,NA,NA
"yourprogram,showinghowtofixsomethingstep-by-step,butratherrecipesthatshow ",NA,NA
"you,inaheuristicway,howtolookfortheanswer.",NA,NA
"Studyingthemisessentialifyouwanttobecomeaprofessionaldeveloper,notonlyfor ",NA,NA
"solvingproblems,butalsoforcommunicatingwithotherdevelopers.Itisverycommonto ",NA,NA
"getananswerlike“Youcoulduseafactoryhere”,whendiscussingyourprogramdesign.",NA,NA
"Itsavesalotoftimeknowingwhatafactoryis,ratherthanexplainingthepatterneach ",NA,NA
timesomeonementionsit.,NA,NA
"Aswesaid,thereareentirebooksthattalkaboutdesignpatterns,andwehighly ",NA,NA
recommendyoutohavealookatsomeofthem.Thegoalofthissectionistoshowyou ,NA,NA
"whatadesignpatternisandhowyoucanuseit.Additionally,wewillshowyousomeof ",NA,NA
"themostcommondesignpatternsusedwithPHPwhenwritingwebapplications, ",NA,NA
"excludingtheMVCpattern,whichwewillstudyin",NA,NA
Chapter6,NA,NA
",",NA,NA
AdaptingtoMVC,NA,NA
.,NA,NA
"Otherthanbooks,youcouldalsovisittheopensourceproject",NA,NA
DesignPatternsPHP,NA,NA
at ,NA,NA
http://designpatternsphp.readthedocs.org/en/latest/README.html,NA,NA
.Thereisago,NA,NA
"od collectionofthem,andtheyareimplementedinPHP,soitwouldbeeasierforyouto ",NA,NA
adapt.,NA,NA
Factory,NA,NA
A,NA,NA
factory,NA,NA
"isadesignpatternofthecreationalgroup,whichmeansthatitallowsyouto ",NA,NA
"createobjects.Youmightthinkthatwedonotneedsuchathing,ascreatinganobjectisas ",NA,NA
easyasusingthe,new,NA
"keyword,theclass,anditsarguments.Butlettingtheuserdothatis ",NA,NA
dangerousfordifferentreasons.Apartfromtheincreaseddifficultycausedbyusing,new,NA
whenunittestingourcode(youwilllearnaboutunittestingin,NA,NA
Chapter7,NA,NA
",",NA,NA
TestingWeb ,NA,NA
Applications,NA,NA
"),alotofcouplingtoogetsaddedintoourcode.",NA,NA
"Whenwediscussedencapsulation,youlearnedthatitisbettertohidetheinternal ",NA,NA
"implementationofaclass,andyoucouldconsidertheconstructoraspartofit.Thereason ",NA,NA
"isthattheuserneedstoknowatalltimeshowtocreateobjects,includingwhatthe ",NA,NA
argumentsoftheconstructorare.Andwhatifwewanttochangeourconstructortoaccept ,NA,NA
differentarguments?Weneedtogoonebyonetoalltheplaceswherewehavecreated ,NA,NA
objectsandupdatethem.,NA,NA
Anotherreasonforusingfactoriesistomanagedifferentclassesthatinheritasuperclass ,NA,NA
"orimplementthesameinterface.Asyouknow,thankstopolymorphism,youcanuseone ",NA,NA
"objectwithoutknowingthespecificclassthatitinstantiates,aslongasyouknowthe ",NA,NA
interfacebeingimplemented.Itmightsohappenthatyourcodeneedstoinstantiatean ,NA,NA
"objectthatimplementsaninterfaceanduseit,buttheconcreteclassoftheobjectmaynot ",NA,NA
beimportantatall.,NA,NA
Thinkaboutourbookstoreexample.Wehavetwotypesofcustomers:basicandpremium. ,NA,NA
"Butformostofthecode,wedonotreallycarewhattypeofcustomeraspecificinstance ",NA,NA
"is.Infact,weshouldimplementourcodetouseobjectsthatimplementthe",Customer,NA
"interface,beingunawareofthespecifictype.So,ifwedecideinthefuturetoaddanew ",NA,NA
"type,aslongasitimplementsthecorrectinterface,ourcodewillworkwithoutanissue. ",NA,NA
"But,ifthatisthecase,whatdowedowhenweneedtocreateanewcustomer?Wecannot ",NA,NA
"instantiateaninterface,solet’susethefactorypattern.Addthefollowingcodeinto ",src/Domain/Customer/CustomerFactory.php,NA
:,"<?php
  
 namespaceBookstore\Domain\Customer;
  
 useBookstore\Domain\Customer;
  
 classCustomerFactory{ 
  
 publicstaticfunctionfactory( 
  
 string$type, 
  
 int$id, 
  
 string$firstname, 
  
 string$surname, 
  
 string$email 
  
 ):Customer{ 
  
 switch($type){ 
  
 case'basic': 
  
 returnnewBasic($id,$firstname,$surname,$email); case'premium':",NA
"Thefactoryintheprecedingcodeislessthanidealfordifferentreasons.Inthefirstone, ",NA,NA
weusea,switch,NA
",andaddacaseforalltheexistingcustomertypes.Twotypesdonot ",NA,NA
"makemuchdifference,butwhatifwehave19?Let’strytomakethisfactorymethodabit ",NA,NA
moredynamic.,"publicstaticfunctionfactory( 
  
 string$type, 
  
 int$id, 
  
 string$firstname, 
  
 string$surname, 
  
 string$email 
  
 ):Customer{ 
  
 $classname=__NAMESPACE__.'\\'.ucfirst($type); if(!class_exists($classname)){ 
  
 thrownew\InvalidArgumentException('Wrongtype.'); } 
  
 returnnew$classname($id,$firstname,$surname,$email); 
 }",NA
"Yes,youcandowhatwedidintheprecedingcodeinPHP.Instantiatingclasses ",NA,NA
"dynamically,thatis,usingthecontentofavariableasthenameoftheclass,isoneofthe ",NA,NA
"thingsthatmakesPHPsoflexible…anddangerous.Usedwrongly,itwillmakeyourcode ",NA,NA
"horriblydifficulttoreadandmaintain,sobecarefulaboutit.Notetootheconstant ",__NAMESPACE__,NA
",whichcontainsthenamespaceofthecurrentfile.",NA,NA
"Nowthisfactorylookscleaner,anditisalsoverydynamic.Youcouldaddmorecustomer ",NA,NA
"typesand,aslongastheyareinsidethecorrectnamespaceandimplementtheinterface, ",NA,NA
"thereisnothingtochangeonthefactoryside,norintheusageofthefactory.",NA,NA
"Inordertouseit,let’schangeour",init.php,NA
"file.Youcanremoveallourtests,andjust ",NA,NA
"leavetheautoloadercode.Then,addthefollowing:","CustomerFactory::factory('basic',2,'mary','poppins', 'mary@poppins.com'); 
  
 CustomerFactory::factory('premium',null,'james','bond', 'james@bond.com');",NA
Thefactorydesignpatterncanbeascomplexasyouneed.Therearedifferentvariantsof ,NA,NA
"it,andeachonehasitsownplaceandtime,butthegeneralideaisalwaysthesame.",NA,NA
Singleton,NA,NA
"Ifsomeonewithabitofexperiencewithdesignpatterns,orwebdevelopmentingeneral, ",NA,NA
"readsthetitleofthissection,theywillprobablystarttearingtheirhairoutandclaiming ",NA,NA
thatsingletonistheworstexampleofadesignpattern.Butjustbearwithme.,NA,NA
"Whenexplaininginterfaces,Iaddedanoteabouthowdeveloperstendtocomplicatetheir ",NA,NA
codetoomuchjustsotheycanuseallthetoolstheyknow.Usingdesignpatternsisoneof ,NA,NA
"thecaseswherethishappens.Theyhavebeensofamous,andpeopleclaimedthatgood ",NA,NA
"useofthemisdirectlylinkedtogreatdevelopers,thateverybodythatlearnsthemtriesto ",NA,NA
usethemabsolutelyeverywhere.,NA,NA
ThesingletonpatternisprobablythemostinfamousofthedesignpatternsusedinPHPfor ,NA,NA
"webdevelopment.Thispatternhasaveryspecificpurpose,andwhenthatisthecase,the ",NA,NA
patternprovestobeveryuseful.Butthispatternissoeasytoimplementthatdevelopers ,NA,NA
"continuouslytrytoaddsingletonseverywhere,turningtheircodeintosomething ",NA,NA
"unmaintainable.Itisforthisreasonthatpeoplecallthisananti-pattern,somethingthat ",NA,NA
shouldbeavoidedratherthanused.,NA,NA
"Idoagreewiththispointofview,butIstillthinkthatyoushouldbeveryfamiliarwith ",NA,NA
"thisdesignpattern.Eventhoughyoushouldavoiditsoveruse,peoplestilluseit ",NA,NA
"everywhere,andtheyrefertoitcountlesstimes,soyoushouldbeinapositiontoeither ",NA,NA
agreewiththemorratherhaveenoughreasonstodiscouragethemtouseit.Havingsaid ,NA,NA
"that,let’sseewhattheaimofthesingletonpatternis.",NA,NA
Theideaissimple:singletonsareusedwhenyouwantoneclasstoalwayshaveone ,NA,NA
"uniqueinstance.Everytime,andeverywhereyouusethatclass,ithastobethroughthe ",NA,NA
"sameinstance.Thereasonistoavoidhavingtoomanyinstancesofsomeheavyresource, ",NA,NA
ortokeepalwaysthesamestateeverywhere—tobeglobal.Examplesofthisaredatabase ,NA,NA
connectionsorconfigurationhandlers.,NA,NA
"Imaginethatinordertorun,ourapplicationneedssomeconfiguration,suchascredentials ",NA,NA
"forthedatabase,URLsofspecialendpoints,directorypathsforfindinglibrariesor ",NA,NA
"importantfiles,andsoon.Whenyoureceivearequest,thefirstthingyoudoistoloadthis ",NA,NA
"configurationfromthefilesystem,andthenyoustoreitasanarrayorsomeotherdata ",NA,NA
structure.Savethefollowingcodeasyour,src/Utils/Config.php,NA
file:,"<?php
  
 namespaceBookstore�tils;
  
 useBookstore\Exceptions\NotFoundException;
  
 classConfig{ 
  
 private$data;
  
 publicfunction__construct(){ 
  
 $json=file_get_contents(__DIR__.'/../../config/app.json'); $this->data=json_decode($json,true); 
  
 }",NA
"Asyoucansee,thisclassusesanewexception.Createitunder ",src/Utils/NotFoundException.php,NA
:,"<?php
  
 namespaceBookstore\Exceptions;
  
 useException;
  
 classNotFoundExceptionextendsException{ }",NA
"Also,theclassreadsafile,",config/app.json,NA
.YoucouldaddthefollowingJSONmap insideit:,"{ 
  
 ""db"":{ 
  
 ""user"":""Luke"", 
  
 ""password"":""Skywalker"" 
  
 } 
  
 }",NA
"Inordertousethisconfiguration,let’saddthefollowingcodeintoyour",init.php,NA
file.,"$config=newConfig(); 
  
 $dbConfig=$config->get('db'); 
  
 var_dump($dbConfig);",NA
"Thatseemsaverygoodwaytoreadconfiguration,right?Butpayattentiontothe ",NA,NA
highlightedline.Weinstantiatethe,Config,NA
"object,hence,wereadafile,transformits ",NA,NA
"contentsfromJSONtoarray,andstoreit.Whatifthefilecontainshundredsoflines ",NA,NA
insteadofjustsix?Youshouldnoticethenthatinstantiatingthisclassisveryexpensive.,NA,NA
Youdonotwanttoreadthefilesandtransformthemintoarrayseachtimeyouaskfor ,NA,NA
"somedatafromyourconfiguration.Thatiswaytooexpensive!But,forsure,youwill ",NA,NA
"needtheconfigurationarrayinverydifferentplacesofyourcode,andyoucannotcarry ",NA,NA
"thisarrayeverywhereyougo.Ifyouunderstoodstaticpropertiesandmethods,youcould ",NA,NA
arguethatimplementingastaticarrayinsidetheobjectshouldfixtheproblem.You ,NA,NA
"instantiateitonce,andthenjustcallastaticmethodthatwillaccessanalreadypopulated ",NA,NA
"staticproperty.Theoretically,weskiptheinstantiation,right?","<?php
  
 namespaceBookstore�tils;
  
 useBookstore\Exceptions\NotFoundException;",NA
"Thisseemstobeagoodidea,butitishighlydangerous.Howcanyoubeabsolutelysure ",NA,NA
"thatthearrayhasalreadybeenpopulated?Andhowcanyoubesurethat,evenusinga ",NA,NA
"staticcontext,theuserwillnotkeepinstantiatingthisclassagainandagain?Thatiswhere ",NA,NA
singletonscomeinhandy.,NA,NA
Implementingasingletonimpliesthefollowingpoints:,NA,NA
"1. Maketheconstructoroftheclassprivate,soabsolutelynoonefromoutsidetheclass ",NA,NA
caneverinstantiatethatclass.,NA,NA
2. Createastaticpropertynamed,$instance,NA
",whichwillcontainaninstanceofitself—",NA,NA
"thatis,inour",Config,NA
"class,the",$instance,NA
propertywillcontainaninstanceofthe ,NA,NA
class,Config,NA
.,NA,NA
"3. Createastaticmethod,",getInstance,NA
",whichwillcheckif",$instance,NA
"isnull,andifit ",NA,NA
"is,itwillcreateanewinstanceusingtheprivateconstructor.Eitherway,itwillreturn ",NA,NA
the,$instance,NA
property.,NA,NA
Let’sseewhatthesingletonclasswouldlooklike:,"<?php
  
 namespaceBookstore�tils;
  
 useBookstore\Exceptions\NotFoundException;
  
 classConfig{ 
  
 private$data; 
  
 privatestatic$instance;
  
 privatefunction__construct(){ 
  
 $json=file_get_contents(__DIR__.'/../config/app.json'); $this->data=json_decode($json,true); 
  
 }
  
 publicstaticfunctiongetInstance(){ 
 if(self::$instance==null){ 
  
 self::$instance=newConfig();",NA
"Ifyourunthiscoderightnow,itwillthrowyouanerror,astheconstructorofthisclassis ",NA,NA
private.Firstachievementunlocked!Let’susethisclassproperly:,"$config=Config::getInstance(); 
  
 $dbConfig=$config->get('db'); 
  
 var_dump($dbConfig);",NA
Doesitconvinceyou?Itprovestobeveryhandyindeed.ButIcannotemphasizethis ,NA,NA
"enough:becarefulwhenyouusethisdesignpattern,asithasvery,very,specificuse ",NA,NA
cases.Avoidfallingintothetrapofimplementingiteverywhere!,NA,NA
Anonymousfunctions,NA,NA
Anonymousfunctions,NA,NA
",or",NA,NA
lambdafunctions,NA,NA
",arefunctionswithoutaname.Astheydo ",NA,NA
"nothaveaname,inordertobeabletoinvokethem,weneedtostorethemasvariables.It ",NA,NA
"mightbestrangeatthebeginning,buttheideaisquitesimple.Atthispointoftime,wedo ",NA,NA
"notreallyneedanyanonymousfunction,solet’sjustaddthecodeinto",init.php,NA
",andthen ",NA,NA
removeit:,"$addTaxes=function(array&$book,$index,$percentage){ 
 $book['price']+=round($percentage*$book['price'],2); };",NA
Thisprecedinganonymousfunctiongetsassignedtothevariable,$addTaxes,NA
.Itexpects ,NA,NA
threearguments:,$book,NA
"(anarrayasareference),",$index,NA
"(notused),and",$percentage,NA
. ,NA,NA
"Thefunctionaddstaxestothepricekeyofthebook,roundedto2decimalplaces(",round,NA
isanativePHPfunction).Donotmindtheargument,$index,NA
",itisnotusedinthisfunction, ",NA,NA
"butforcedbyhowwewilluseit,asyouwillsee.",NA,NA
"Youcouldinstantiatealistofbooksasanarray,iteratethem,andthencallthisfunction ",NA,NA
eachtime.Anexamplecouldbeasfollows:,"$books=[ 
  
 ['title'=>'1984','price'=>8.15], 
  
 ['title'=>'DonQuijote','price'=>12.00], 
 ['title'=>'Odyssey','price'=>3.55] 
  
 ]; 
  
 foreach($booksas$index=>$book){ 
  
 $addTaxes($book,$index,0.16); 
  
 } 
  
 var_dump($books);",NA
"Inordertousethefunction,youjustinvokeitasif",$addTaxes,NA
containedthenameofthe ,NA,NA
functiontobeinvoked.Therestofthefunctionworksasifitwasanormalfunction:it ,NA,NA
"receivesarguments,itcanreturnavalue,andithasascope.Whatisthebenefitof ",NA,NA
definingitinthisway?Onepossibleapplicationwouldbetouseitasa,NA,NA
callable,NA,NA
.A ,NA,NA
callableisavariabletypethatidentifiesafunctionthatPHPcancall.Yousendthis ,NA,NA
"callablevariableasanargument,andthefunctionthatreceivesitcaninvokeit.Takethe ",NA,NA
"PHPnativefunction,",array_walk,NA
".Itgetsanarray,acallable,andsomeextraarguments. ",NA,NA
"PHPwilliteratethearray,andforeachelement,itwillinvokethecallablefunction(just ",NA,NA
likethe,foreach,NA
"loop).So,youcanreplacethewholeloopbyjustthefollowing:","array_walk($books,$addTaxes,0.16);",NA
Thecallablethat,array_walk,NA
receivesneedstotakeatleasttwoarguments:thevalueand ,NA,NA
"theindexofthecurrentelementofthearray,andthus,the",$index,NA
argumentthatwewere ,NA,NA
"forcedtoimplementpreviously.Itcanoptionallytakeextraarguments,whichwillbethe ",NA,NA
extraargumentssentto,array_walk,NA
"—inthiscase,the0.16as",$percentage,NA
.,NA,NA
"Actually,anonymousfunctionsarenottheonlycallableinPHP.Youcansendnormal ",NA,NA
functionsandevenclassmethods.Let’sseehow:,NA,NA
"Intheprecedingexample,youcanseehowwecanuseeachcaseasacallable.Fornormal ",NA,NA
"methods,justsendthenameofthemethodasastring.Forstaticmethodsofaclass,send ",NA,NA
anarraywiththenameoftheclassinawaythatPHPunderstands(eitherthefullname ,NA,NA
"includingnamespace,oraddingthe",use,NA
"keywordbeforehand),andthenameofthe ",NA,NA
"method,bothasstrings.Touseanormalmethodofaclass,youneedtosendanarraywith ",NA,NA
aninstanceofthatclassandthemethodnameasastring.,NA,NA
"OK,soanonymousfunctionscanbeusedascallable,justasanyotherfunctionormethod ",NA,NA
can.Sowhatissospecialaboutthem?Oneofthethingsisthatanonymousfunctionsare ,NA,NA
"variables,andsotheyhavealltheadvantages—ordisadvantages—thatavariablehas.",NA,NA
"Thatincludesscope—thatis,thefunctionisdefinedinsideascope,andassoonasthis ",NA,NA
"scopeends,thefunctionwillnolongerbeaccessible.Thatcanbeusefulifyourfunctionis ",NA,NA
"extremelyspecifictothatbitofcode,andthereisnowayyouwillwanttoreuseit ",NA,NA
"somewhereelse.Moreover,asitisnameless,youwillnothaveconflictswithanyother ",NA,NA
existingfunction.,NA,NA
Thereisanotherbenefitinusinganonymousfunctions:inheritingvariablesfromthe ,NA,NA
"parentscope.Whenyoudefineananonymousfunction,youcanspecifysomevariable ",NA,NA
fromthescopewhereitisdefinedwiththekeyword,use,NA
",anduseitinsidethefunction. ",NA,NA
"Thevalueofthevariablewillbetheoneithadatthemomentofdeclaringthefunction,",NA,NA
evenifitisupdatedlater.Let’sseeanexample:,"$percentage=0.16; 
  
 $addTaxes=function(array&$book,$index)use($percentage){ if(isset($book['price'])){ 
  
 $book['price']+=round($percentage*$book['price'],2); } 
  
 }; 
  
 $percentage=100000; 
  
 array_walk($books,$addTaxes); 
  
 var_dump($books);",NA
Theprecedingexampleshowsyouhowtousethekeyword,use,NA
.Evenwhenweupdate ,$percentage,NA
"afterdefiningthefunction,theresultshowsyouthatthetaxeswereonly ",NA,NA
"16%.Thisisuseful,asitliberatesyoufromhavingtosend",$percentage,NA
everywhereyou ,NA,NA
wanttousethefunction,$addTaxes,NA
.Ifthereisascenariowhereyoureallyneedtohave ,NA,NA
"theupdatedvalueoftheusedvariables,youcandeclarethemasareferenceasyouwould ",NA,NA
withanormalfunction’sargument:,"$percentage=0.16; 
  
 $addTaxes=function(array&$book,$index)use(&$percentage){ if(isset($book['price'])){ 
  
 $book['price']+=round($percentage*$book['price'],2); } 
  
 };
  
 array_walk($books,$addTaxes,0.16); 
  
 var_dump($books);
  
 $percentage=100000; 
  
 array_walk($books,$addTaxes,0.16); 
  
 var_dump($books);",NA
"Inthislastexample,thefirst",array_walk,NA
"usedtheoriginalvalue0.16,asthatwasstillthe ",NA,NA
"valueofthevariable.Butonthesecondcall,",$percentage,NA
"hadalreadychanged,andit ",NA,NA
affectedtheresultoftheanonymousfunction.,NA,NA
Summary,NA,NA
"Inthischapter,youhavelearnedwhatobject-orientedprogrammingis,andhowtoapplyit ",NA,NA
"toourwebapplicationforcreatingacleancode,whichiseasytomaintain.Youalsoknow ",NA,NA
"howtomanageexceptionsproperly,thedesignpatternsthatareusedthemost,andhowto ",NA,NA
useanonymousfunctionswhennecessary.,NA,NA
"Inthenextchapter,wewillexplainhowtomanagethedataofyourapplicationusing ",NA,NA
databasessothatyoucancompletelyseparatedatafromcode.,NA,NA
Chapter5.UsingDatabases,NA,NA
"Dataisprobablythecornerstoneofmostwebapplications.Sure,yourapplicationhasto ",NA,NA
"bepretty,fast,error-free,andsoon,butifsomethingisessentialtousers,itiswhatdata ",NA,NA
"youcanmanageforthem.Fromthis,wecanextractthatmanagingdataisoneofthemost ",NA,NA
importantthingsyouhavetoconsiderwhendesigningyourapplication.,NA,NA
"Managingdataimpliesnotonlystoringread-onlyfilesandreadingthemwhenneeded,as ",NA,NA
"weweredoingsofar,butalsoadding,fetching,updating,andremovingindividualpieces ",NA,NA
"ofinformation.Forthis,weneedatoolthatcategorizesourdataandmakesthesetasks ",NA,NA
"easierforus,andthisiswhendatabasescomeintoplay.",NA,NA
"Inthischapter,youwilllearnabout:",NA,NA
Schemasandtables ,NA,NA
Manipulatingandqueryingdata ,NA,NA
UsingPDOtoconnectyourdatabasewithPHP ,NA,NA
Indexingyourdata ,NA,NA
Constructingcomplexqueriesinjoiningtables,NA,NA
Introducingdatabases,NA,NA
"Databasesaretoolstomanagedata.Thebasicfunctionsofadatabaseareinserting, ",NA,NA
"searching,updating,anddeletingdata,eventhoughmostdatabasesystemsdomorethan ",NA,NA
this.Databasesareclassifiedintotwodifferentcategoriesdependingonhowtheystore ,NA,NA
data:relationalandnonrelationaldatabases.,NA,NA
"Relationaldatabasesstructuredatainaverydetailedway,forcingtheusertouseadefined ",NA,NA
"formatandallowingthecreationofconnections—thatis,relations—betweendifferent ",NA,NA
piecesofinformation.Nonrelationaldatabasesaresystemsthatstoredatainamore ,NA,NA
"relaxedway,asthoughtherewerenoapparentstructure.Eventhoughwiththesevery ",NA,NA
"vaguedefinitionsyoucouldassumethateverybodywouldliketouserelationaldatabases, ",NA,NA
bothsystemsareveryuseful;itjustdependsonhowyouwanttousethem.,NA,NA
"Inthisbook,wewillfocusonrelationaldatabasesastheyarewidelyusedinsmallweb ",NA,NA
"applications,inwhichtherearenothugeamountsofdata.Thereasonisthatusuallythe ",NA,NA
"applicationcontainsdatathatisinterrelated;forexample,ourapplicationcouldstore ",NA,NA
"sales,whicharecomposedofcustomersandbooks.",NA,NA
MySQL,NA,NA
MySQLhasbeenthefavoritechoiceofPHPdevelopersforquitealongtime.Itisa ,NA,NA
relationaldatabasesystemthatusesSQLasthelanguagetocommunicatewiththesystem. ,NA,NA
"SQLisusedinquiteafewothersystems,whichmakesthingseasierincaseyouneedto ",NA,NA
switchdatabasesorjustneedtounderstandanapplicationwithadifferentdatabasethan ,NA,NA
"theoneyouareusedto.TherestofthechapterwillbefocusedonMySQL,butitwillbe ",NA,NA
helpfulforyouevenifyouchooseadifferentSQLsystem.,NA,NA
"InordertouseMySQL,youneedtoinstalltwoapplications:theserverandtheclient.You ",NA,NA
mightrememberserver-clientapplicationsfrom,NA,NA
Chapter2,NA,NA
",",NA,NA
WebApplicationswithPHP,NA,NA
.,NA,NA
"TheMySQLserverisaprogramthatlistensforinstructionsorqueriesfromclients, ",NA,NA
"executesthem,andreturnsaresult.Youneedtostarttheserverinordertoaccessthe ",NA,NA
database;takealookat,NA,NA
Chapter1,NA,NA
",",NA,NA
SettingUptheEnvironment,NA,NA
",onhowtodothis.The ",NA,NA
clientisanapplicationthatallowsyoutoconstructinstructionsandsendthemtothe ,NA,NA
"server,anditistheonethatyouwilluse.",NA,NA
Note,NA,NA
GUIversuscommandline,NA,NA
TheGraphicalUserInterface,NA,NA
(,NA,NA
GUI,NA,NA
)isverycommonwhenusingadatabase.Ithelps ,NA,NA
"youinconstructinginstructions,andyoucanevenmanagedatawithoutthemusingjust ",NA,NA
"visualtables.Ontheotherhand,command-lineclientsforceyoutowriteallthe ",NA,NA
"commandsbyhand,buttheyarelighterthanGUIs,fastertostart,andforceyouto ",NA,NA
"rememberhowtowriteSQL,whichyouneedwhenyouwriteyourapplicationsinPHP. ",NA,NA
"Also,ingeneral,almostanymachinewithadatabasewillhaveaMySQLclientbutmight ",NA,NA
nothaveagraphicalapplication.,NA,NA
Youcanchoosetheonethatyouaremorecomfortablewithasyouwillusuallyworkwith ,NA,NA
"yourownmachine.However,keepinmindthatabasicknowledgeofthecommandline ",NA,NA
willsaveyourlifeonseveraloccasions.,NA,NA
"Inordertoconnecttheclientwithaserver,youneedtoprovidesomeinformationon ",NA,NA
wheretoconnectandthecredentialsfortheusertouse.Ifyoudonotcustomizeyour ,NA,NA
"MySQLinstallation,youshouldatleasthavearootuserwithnopassword,whichisthe ",NA,NA
"onewewilluse.Youcouldthinkthatthisseemstobeahorriblesecurityhole,anditmight ",NA,NA
"beso,butyoushouldnotbeabletoconnectusingthisuserifyoudonotconnectfromthe ",NA,NA
samemachineonwhichtheserveris.Themostcommonargumentsthatyoucanuseto ,NA,NA
provideinformationwhenstartingtheclientare:,-u<name>,NA
":Thisspecifiestheuser—inourcase,",root,NA
.,-p<password>,NA
":Withoutaspace,thisspecifiesthepassword.Aswedonothavea ",NA,NA
"passwordforouruser,wedonotneedtoprovidethis.",-h<host>,NA
":Thisspecifieswheretoconnect.Bydefault,theclientconnectstothe ",NA,NA
"samemachine.Asthisisourcase,thereisnoneedtospecifyany.Ifyouhadto,you ",NA,NA
couldspecifyeitheranIPaddressorahostname.,<schemaname>,NA
:Thisspecifiesthenameoftheschematouse.Wewillexplainina,NA,NA
bitwhatthismeans.,NA,NA
"Withtheserules,youshouldbeabletoconnecttoyourdatabasewiththe",mysql-uroot,NA
command.Youshouldgetanoutputverysimilartothefollowingone:,"$mysql-uroot 
  
 WelcometotheMySQLmonitor.Commandsendwith;or\g.
  
 YourMySQLconnectionidis2 
  
 Serverversion:5.1.73Sourcedistribution
  
 Copyright(c)2000,2013,Oracleand/oritsaffiliates.Allrights reserved.
  
 OracleisaregisteredtrademarkofOracleCorporationand/orits 
 affiliates.Othernamesmaybetrademarksoftheirrespective owners.
  
 Type'help;'or'\h'forhelp.Type'\c'toclearthecurrentinput statement.
  
 mysql>",NA
Theterminalwillshowyoutheversionoftheserverandsomeusefulinformationabout ,NA,NA
"howtousetheclient.Fromnowon,thecommandlinewillstartwith",mysql>,NA
insteadof ,NA,NA
"yournormalprompt,showingyouthatyouareusingtheMySQLclient.Inorderto ",NA,NA
"executequeries,justtypethequery,enditwithasemicolon,andpress",NA,NA
Enter,NA,NA
.Theclient ,NA,NA
"willsendthequerytotheserverandwillshowtheresultofit.Toexittheclient,youcan ",NA,NA
eithertype,\q,NA
andpress,NA,NA
Enter,NA,NA
orpress,NA,NA
Ctrl,NA,NA
+,NA,NA
D,NA,NA
",eventhoughthislastoptionwilldepend ",NA,NA
onyouroperatingsystem.,NA,NA
Schemasandtables,NA,NA
Relationaldatabasesystemsusuallyhavethesamestructure.Theystoredataindifferent ,NA,NA
databasesor,NA,NA
schemas,NA,NA
",whichseparatethedatafromdifferentapplications.Theseschem",NA,NA
as arejustcollectionsof,NA,NA
tables,NA,NA
.Tablesaredefinitionsofspecificdatastructuresandare ,NA,NA
composedof,NA,NA
fields,NA,NA
.Afieldisabasicdatatypethatdefinesthesmallestcomponentof ,NA,NA
"informationasthoughtheyweretheatomsofthedata.So,schemasaregroupoftables ",NA,NA
thatarecomposedoffields.Let’slookateachoftheseelements.,NA,NA
Understandingschemas,NA,NA
"Asdefinedbefore,schemasordatabases—inMySQL,theyaresynonyms—are ",NA,NA
"collectionsoftableswithacommoncontext,usuallybelongingtothesameapplication.",NA,NA
"Actually,therearenorestrictionsaroundthis,andyoucouldhaveseveralschemas ",NA,NA
"belongingtothesameapplicationifneeded.However,forsmallwebapplications,asitis ",NA,NA
"ourcase,wewillhavejustoneschema.",NA,NA
Yourserverprobablyalreadyhassomeschemas.Theyusuallycontainthemetadata ,NA,NA
"neededforMySQLinordertooperate,andwehighlyrecommendthatyoudonotmodify ",NA,NA
"them.Instead,let’sjustcreateourownschema.Schemasarequitesimpleelements,and ",NA,NA
theyonlyhaveamandatorynameandanoptionalcharset.Thenameidentifiesthe ,NA,NA
"schema,andthecharsetdefineswhichtypeofcodificationor“alphabet”thestringsshould ",NA,NA
follow.Asthedefaultcharsetis,latin1,NA
",ifyoudonotneedtochangeit,youdonotneed ",NA,NA
tospecifyit.,NA,NA
Use,CREATESCHEMA,NA
followedbythenameoftheschemainordertocreatetheschemathat ,NA,NA
"wewilluseforourbookstore.Thenamehastoberepresentative,solet’snameit ",bookstore,NA
.Remembertoendyourlinewithasemicolon.Takealookatthefollowing:,"mysql>CREATESCHEMAbookstore; 
  
 QueryOK,1rowaffected(0.00sec)",NA
"Ifyouneedtorememberhowaschemawascreated,youcanuse",SHOWCREATESCHEMA,NA
to ,NA,NA
"seeitsdescription,asfollows:","mysql>SHOWCREATESCHEMAbookstore\G 
  
 ***************************1.row*************************** 
  
 Database:bookstore 
  
 CreateDatabase:CREATEDATABASE`bookstore`/*!40100DEFAULTCHARACTERSET latin1*/ 
  
 1rowinset(0.00sec)",NA
"Asyoucansee,weendedthequerywith",\G,NA
insteadofasemicolon.Thistellstheclientto ,NA,NA
formattheresponseinadifferentwaythanthesemicolondoes.Whenusingacommandof ,NA,NA
the,SHOWCREATE,NA
"family,werecommendthatyouenditwith",\G,NA
togetabetter ,NA,NA
understanding.,NA,NA
Tip,NA,NA
Shouldyouuseuppercaseorlowercase?,NA,NA
"Whenwritingqueries,youmightnotethatweuseduppercaseforkeywordsandlowercase ",NA,NA
"foridentifiers,suchasnamesofschemas.Thisisjustaconventionwidelyusedinorderto ",NA,NA
"makeitclearwhatispartofSQLandwhatisyourdata.However,MySQLkeywordsare case-",NA,NA
"insensitive,soyoucoulduseanycaseindistinctively.",NA,NA
Alldatamustbelongtoaschema.Therecannotbedatafloatingaroundoutsideall ,NA,NA
"schemas.Thisway,youcannotdoanythingunlessyouspecifytheschemayouwantto ",NA,NA
"use.Inordertodothis,justafterstartingyourclient,usethe",USE,NA
keywordfollowedbythe ,NA,NA
"nameoftheschema.Optionally,youcouldtelltheclientwhichschematousewhen",NA,NA
"connectingtoit,asfollows:","mysql>USEbookstore; 
  
 Databasechanged",NA
Ifyoudonotrememberwhatthenameofyourschemaisorwanttocheckwhichother ,NA,NA
"schemasareinyourserver,youcanrunthe",SHOWSCHEMAS;,NA
"commandtogetalistofthem, ",NA,NA
asfollows:,"mysql>SHOWSCHEMAS; 
  
 +--------------------+ 
  
 |Database| 
  
 +--------------------+ 
  
 |information_schema| 
  
 |bookstore| 
  
 |mysql| 
  
 |test| 
  
 +--------------------+ 
  
 4rowsinset(0.00sec)",NA
Databasedatatypes,NA,NA
"AsinPHP,MySQLalsohasdatatypes.Theyareusedtodefinewhichkindofdataafield ",NA,NA
"cancontain.AsinPHP,MySQLisquiteflexiblewithdatatypes,transformingthemfrom ",NA,NA
"onetypetotheotherifneeded.Therearequiteafewofthem,butwewillexplainthemost ",NA,NA
importantones.Wehighlyrecommendthatyouvisittheofficialdocumentationrelatedto ,NA,NA
datatypesat,NA,NA
http://dev.mysql.com/doc/refman/5.7/en/data-,NA,NA
types.html,NA,NA
ifyouwanttobuild applicationswithmorecomplexdatastructures.,NA,NA
Numericdatatypes,NA,NA
"Numericdatacanbecategorizedasintegersordecimalnumbers.Forintegers,MySQL ",NA,NA
usesthe,INT,NA
"datatypeeventhoughthereareversionstostoresmallernumbers,suchas ",TINYINT,NA
",",SMALLINT,NA
",or",MEDIUMINT,NA
",orbiggernumbers,suchas",BIGINT,NA
.Thefollowing ,NA,NA
"tableshowswhatthesizesofthedifferentnumerictypesare,soyoucanchoosewhichone ",NA,NA
tousedependingonyoursituation:,"Type
  
  
 Size/precision
  
   
   
  
 TINYINT
  
  
 -128to127
  
   
   
  
 SMALLINT
   
 -32,768to32,767
  
   
   
  
 MEDIUMINT
  
  
  
 -8,388,608to8,388,607
  
   
   
  
 INT
  
  
 -2,147,483,648to2,147,483,647
  
   
   
  
 BIGINT
  
  
 -
 9,223,372,036,854,775,808to9,223,372,036,854,775,80
 7",NA
"Numerictypescanbedefinedassignedbydefaultorunsigned;thatis,youcanallowor ",NA,NA
notallowthemtocontainnegativevalues.Ifanumerictypeisdefinedas,UNSIGNED,NA
",the ",NA,NA
rangeofnumbersthatitcantakeisdoubledasitdoesnotneedtosavespacefornegative ,NA,NA
numbers.,NA,NA
"Fordecimalnumberswehavetwotypes:approximatevalues,whicharefastertoprocess ",NA,NA
"butarenotexactsometimes,andexactvaluesthatgiveyouexactprecisiononthedecimal ",NA,NA
"value.Forapproximatevaluesorthefloating-pointtype,wehave",FLOAT,NA
and,DOUBLE,NA
.For ,NA,NA
exactvaluesorthefixed-pointtypewehave,DECIMAL,NA
.,NA,NA
MySQLallowsyoutospecifythenumberofdigitsanddecimalpositionsthatthenumber ,NA,NA
"cantake.Forexample,tospecifyanumberthatcancontainsfivedigitsanduptotwoof ",NA,NA
"themcanbedecimal,wewillusethe","FLOAT(5,2)",NA
"notation.Thisisusefulasaconstraint, ",NA,NA
asyouwillnotewhenwecreatetableswithprices.,NA,NA
Stringdatatypes,NA,NA
Eventhoughthereareseveraldatatypesthatallowyoutostorefromsinglecharactersto ,NA,NA
"bigchunksoftextorbinarycode,itisoutsidethescopeofthischapter.Inthissection,we ",NA,NA
willintroduceyoutothreetypes:,CHAR,NA
",",VARCHAR,NA
",and",TEXT,NA
.,NA,NA
isadatatypethatallowsyoutostoreanexactnumberofcharacters.Youneedto ,NA,NA
"specifyhowlongthestringwillbeonceyoudefinethefield,andfromthispointon,all ",NA,NA
valuesforthisfieldhavetobeofthislength.Onepossibleusageinourapplicationscould ,NA,NA
bewhenstoringtheISBNofthebookasweknowitisalways13characterslong.,VARCHAR,NA
"orvariablecharisadatatypethatallowsyoutostorestringsupto65,535 ",NA,NA
"characterslong.Youdonotneedtospecifyhowlongtheyneedtobe,andyoucaninsert ",NA,NA
"stringsofdifferentlengthswithoutanissue.Ofcourse,thefactthatthistypeisdynamic ",NA,NA
"makesitslowertoprocesscomparedwiththepreviousone,butafterafewtimesyou ",NA,NA
knowhowlongastringwillalwaysbe.YoucouldtellMySQLthatevenifyouwantto ,NA,NA
"insertstringsofdifferentlengths,themaximumlengthwillbeadeterminednumber.This ",NA,NA
"willhelpitsperformance.Forexample,namesareofdifferentlengths,butyoucansafely ",NA,NA
"assumethatnonamewillbelongerthan64characters,soyourfieldcouldbedefinedas ",VARCHAR(64),NA
.,NA,NA
"Finally,",TEXT,NA
isadatatypeforreallybigstrings.Youcoulduseitifyouwanttostorelong ,NA,NA
"commentsfromusers,articles,andsoon.Aswith",INT,NA
",therearedifferentversionsofthis ",NA,NA
datatype:,TINYTEXT,NA
",",TEXT,NA
",",MEDIUMTEXT,NA
",and",LONGTEXT,NA
.Eveniftheyareveryimportantin ,NA,NA
"almostanywebapplicationwithuserinteraction,wewillnotusetheminours.",NA,NA
Listofvalues,NA,NA
"InMySQL,youcanforceafieldtohaveasetofvalidvalues.Therearetwotypesof ",NA,NA
them:,ENUM,NA
",whichallowsexactlyoneofthepossiblepredefinedvalues,and",SET,NA
",which ",NA,NA
allowsanynumberofthepredefinedvalues.,NA,NA
"Forexample,inourapplication,wehavetwotypesofcustomers:basicandpremium.If ",NA,NA
"wewanttostoreourcustomersinadatabase,thereisachancethatoneofthefieldswill ",NA,NA
"bethetypeofcustomer.Asacustomerhastobeeitherbasicorpremium,agoodsolution ",NA,NA
wouldbetodefinethefieldasanenumas,"ENUM(""basic"",""premium"")",NA
".Inthisway,we ",NA,NA
willmakesurethatallcustomersstoredinourdatabasewillbeofacorrecttype.,NA,NA
"Althoughenumsarequitecommontouse,theuseofsetsislesswidespread.Itisusuallya ",NA,NA
"betterideatouseanextratabletodefinethevaluesofthelist,asyouwillnotewhenwe ",NA,NA
talkaboutforeignkeysinthischapter.,NA,NA
Dateandtimedatatypes,NA,NA
DateandtimetypesarethemostcomplexdatatypesinMySQL.Eventhoughtheideais ,NA,NA
"simple,thereareseveralfunctionsandedgecasesaroundthesetypes.Wecannotgo ",NA,NA
"throughallofthem,sowewilljustexplainthemostcommonuses,whicharetheoneswe ",NA,NA
willneedforourapplication.,DATE,NA
"storesdates—thatis,acombinationofday,month,andyear.",TIME,NA
storestimes—that ,NA,NA
"is,acombinationofhour,minute,andsecond.",DATETIME,NA
aredatatypesforbothdateand ,NA,NA
"time.Foranyofthesedatatypes,youcanprovidejustastringspecifyingwhatthevalue ",NA,NA
"is,butyouneedtobecarefulwiththeformatthatyouuse.Eventhoughyoucanalways ",NA,NA
"specifytheformatthatyouareenteringthedatain,youcanjustenterthedatesortimesin ",NA,NA
"thedefaultformat—forexample,2014-12-31fordates,14:34:50fortime,and2014-12-",NA,NA
31,NA,NA
14:34:50forthedateandtime.,NA,NA
Afourthtypeis,TIMESTAMP,NA
".Thistypestoresaninteger,whichistherepresentationofthe ",NA,NA
"secondsfromJanuary1,1970,whichisalsoknownastheUnixtimestamp.Thisisavery ",NA,NA
"usefultypeasinPHP,itisreallyeasytogetthecurrentUnixtimestampwiththe",now(),NA
"function,andtheformatforthisdatatypeisalwaysthesame,soitissafertoworkwithit. ",NA,NA
Thedownsideisthattherangeofdatesthatitcanrepresentislimitedascomparedtoother ,NA,NA
types.,NA,NA
Therearesomefunctionsthathelpyoumanagethesetypes.Thesefunctionsextract ,NA,NA
"specificpartsofthewholevalue,returnthevaluewithadifferentformat,addorsubtract ",NA,NA
"dates,andsoon.Let’stakealookatashortlistofthem:","Functionname
  
 Description
  
  
   
  
  
  
 DAY()
 ,
 MONTH()
 ,and
 YEAR()
  
 Extractsthespecificvaluefortheday,month,oryearfromthe
 DATE
 or
 DATETIME 
 providedvalue.
  
  
   
  
  
  
 HOUR()
 ,
 MINUTE()
 ,and 
 SECOND()
  
 Extractsthespecificvalueforthehour,minute,orsecondfromthe
 TIME
 or
 DATETIME 
 providedvalue.
  
  
   
  
  
  
 CURRENT_DATE()
 and 
 CURRENT_TIME()
  
 Returnsthecurrentdateorcurrenttime.
  
  
   
  
  
  
 NOW()
  
 Returnsthecurrentdateandtime.
  
  
   
  
  
  
 DATE_FORMAT()
  
 Returnsthe
 DATE
 ,
 TIME
 or
 DATETIME
 valuewiththespecifiedformat.
  
  
   
  
  
  
 DATE_ADD()
  
 Addsthespecifiedintervaloftimetoagivendateortimetype.",NA
Donotworryifyouareconfusedonhowtouseanyofthesefunctions;wewillusethem ,NA,NA
"duringtherestofthebookaspartofourapplication.Also,anextensivelistofallthetypes ",NA,NA
canbefoundat,NA,NA
http://dev.mysql.com/doc/refman/5.7/en/date-and-time-,NA,NA
functions.html,NA,NA
.,NA,NA
Managingtables,NA,NA
"Nowthatyouunderstandthedifferenttypesofdatathatfieldscantake,itistimeto ",NA,NA
introducetables.Asdefinedinthe,NA,NA
Schemasandtables,NA,NA
"section,atableisacollectionof ",NA,NA
fieldsthatdefinesatypeofinformation.YoucouldcompareitwithOOPandthinkof ,NA,NA
"tablesasclasses,fieldsbeingtheirproperties.Eachinstanceoftheclasswouldbearow ",NA,NA
onthetable.,NA,NA
"Whendefiningatable,youhavetodeclarethelistoffieldsthatthetablecontains.For ",NA,NA
"eachfield,youneedtospecifyitsname,itstype,andsomeextrainformationdepending ",NA,NA
onthetypeofthefield.Themostcommonare:,NOTNULL,NA
":Thisisusedifthefieldcannotbenull—thatis,ifitneedsaconcretevalid ",NA,NA
"valueforeachrow.Bydefault,afieldcanbenull.",UNSIGNED,NA
":Asmentionedearlier,thisisusedtoforbidtheuseofnegativenumbersin ",NA,NA
"thisfield.Bydefault,anumericfieldacceptsnegativenumbers.",DEFAULT<value>,NA
:Thisdefinesadefaultvalueincasetheuserdoesnotprovideany. ,NA,NA
"Usually,thedefaultvalueisnullifthisclauseisnotspecified.",NA,NA
"Tabledefinitionsalsoneedaname,aswithschemas,andsomeoptionalattributes.You ",NA,NA
"candefinethecharsetofthetableoritsengine.Enginescanbeaquitelargetopictocover, ",NA,NA
"butforthescopeofthischapter,let’sjustnotethatweshouldusetheInnoDBengineifwe ",NA,NA
"needstrongrelationshipsbetweentables.Formoreadvancedreaders,youcanreadmore ",NA,NA
aboutMySQLenginesat,NA,NA
https://dev.mysql.com/doc/refman/5.0/en/storage-,NA,NA
engines.html,NA,NA
.,NA,NA
"Knowingthis,let’strytocreateatablethatwillkeepourbooks.Thenameofthetable ",NA,NA
shouldbe,book,NA
",aseachrowwilldefineabook.Thefieldscouldhavethesameproperties ",NA,NA
the,Book,NA
classhas.Let’stakealookathowthequerytoconstructthetablewouldlook:,"mysql>CREATETABLEbook(
  
 ->isbnCHAR(13)NOTNULL,
  
 ->titleVARCHAR(255)NOTNULL,
  
 ->authorVARCHAR(255)NOTNULL,
  
 ->stockSMALLINTUNSIGNEDNOTNULLDEFAULT0,-
 >priceFLOATUNSIGNED
  
 ->)ENGINE=InnoDb; 
  
 QueryOK,0rowsaffected(0.01sec)",NA
"Asyoucannote,wecanaddmorenewlinesuntilweendthequerywithasemicolon. ",NA,NA
"Withthis,wecanformatthequeryinawaythatlooksmorereadable.MySQLwillletus ",NA,NA
knowthatwearestillwritingthesamequeryshowingthe,->,NA
prompt.Asthistable ,NA,NA
"containsfivefields,itisverylikelythatwewillneedtorefreshourmindsfromtimeto ",NA,NA
"timeaswewillforgetthem.Inordertodisplaythestructureofthetable,youcouldusethe ",DESC,NA
"command,asfollows:","mysql>DESCbook; 
  
 +--------+----------------------+------+-----+---------+-------+ 
 |Field|Type|Null|Key|Default|Extra| +--------+----------------------+------+-----+---------+-----
 --+ |isbn|char(13)|NO||NULL|| |title|varchar(255)|NO||NULL||",NA
Weused,SMALLINT,NA
for,stock,NA
asitisveryunlikelythatwewillhavemorethanthousands ,NA,NA
"ofcopiesofthesamebook.AsweknowthatISBNis13characterslong,weenforcedthis ",NA,NA
"whendefiningthefield.Finally,both",stock,NA
and,price,NA
areunsignedasnegativevaluesdo ,NA,NA
notmakesense.Let’snowcreateour,customer,NA
tableviathefollowingscript:,"mysql>CREATETABLEcustomer(
  
 ->idINTUNSIGNEDNOTNULL,
  
 ->firstnameVARCHAR(255)NOTNULL,-
 >surnameVARCHAR(255)NOTNULL,-
 >emailVARCHAR(255)NOTNULL,
  
 ->typeENUM('basic','premium')->)ENGINE=InnoDb; 
  
 QueryOK,0rowsaffected(0.00sec)",NA
"Wealreadyanticipatedtheuseofenumforthefieldtypeaswhendesigningclasses,we ",NA,NA
"coulddrawadiagramidentifyingthecontentofourdatabase.Onthis,wecouldshowthe ",NA,NA
tablesandtheirfields.Let’stakealookathowthediagramoftableswouldlooksofar:,NA,NA
"Notethatevenifwecreatetablessimilartoourclasses,wewillnotcreateatablefor ",Person,NA
".Thereasonisthatdatabasesstoredata,andthereisn’tanydatathatwecouldstore ",NA,NA
forthisclassasthe,customer,NA
"tablealreadycontainseverythingweneed.Also,sometimes, ",NA,NA
"wemaycreatetablesthatdonotexistasclassesonourcode,sotheclass-table ",NA,NA
relationshipisaveryflexibleone.,NA,NA
Keysandconstraints,NA,NA
"Nowthatwehaveourmaintablesdefined,let’strytothinkabouthowthedatainside ",NA,NA
"wouldlook.Eachrowinsideatablewoulddescribeanobject,whichmaybeeitherabook ",NA,NA
oracustomer.Whatwouldhappenifourapplicationhasabugandallowsustocreate ,NA,NA
booksorcustomerswiththesamedata?Howwillthedatabasedifferentiatethem?In ,NA,NA
"theory,wewillassignIDstocustomersinordertoavoidthesescenarios,buthowdowe ",NA,NA
enforcethattheIDnotberepeated?,NA,NA
MySQLhasamechanismthatallowsyoutoenforcecertainrestrictionsonyourdata. ,NA,NA
Otherthanattributessuchas,NOTNULL,NA
or,UNSIGNED,NA
"thatyoualreadysaw,youcantell ",NA,NA
MySQLthatcertainfieldsaremorespecialthanothersandinstructittoaddsome ,NA,NA
behaviortothem.Thesemechanismsarecalled,NA,NA
keys,NA,NA
",andtherearefourtypes:primary ",NA,NA
"key,uniquekey,foreignkey,andindex.Let’stakeacloserlookatthem.",NA,NA
Primarykeys,NA,NA
Primarykeysarefieldsthatidentifyauniquerowfromatable.Therecannotbetwoofthe ,NA,NA
"samevalueinthesametable,andtheycannotbenull.Addingaprimarykeytoatablethat ",NA,NA
defines,NA,NA
objects,NA,NA
isalmostamustasitwillassureyouthatyouwillalwaysbeableto ,NA,NA
differentiatetworowsbythisfield.,NA,NA
Anotherpartthatmakesprimarykeyssoattractiveistheirabilitytosettheprimarykeyas ,NA,NA
"anautoincrementalnumericvalue;thatis,youdonothavetoassignavaluetotheID,and ",NA,NA
"MySQLwilljustpickupthelatestinsertedIDandincrementitby1,aswedidwithour ",Unique,NA
"trait.Ofcourse,forthistohappen,yourfieldhastobeanintegerdatatype.Infact, ",NA,NA
"wehighlyrecommendthatyoualwaysdefineyourprimarykeyasaninteger,evenifthe ",NA,NA
real-lifeobjectdoesnotreallyhavethisIDatall.Thereasonisthatyoushouldsearcha ,NA,NA
"rowbythisnumericID,whichisunique,andMySQLwilladdsomeperformance ",NA,NA
improvementsthatcomebysettingthefieldasakey.,NA,NA
"Then,let’saddanIDtoour",book,NA
"table.Inordertoaddanewfield,weneedtoalterour ",NA,NA
table.Thereisacommandthatallowsyoutodothis:,ALTERTABLE,NA
".Withthiscommand, ",NA,NA
"youcanmodifythedefinitionofanyexistingfield,addnewones,orremoveexisting ",NA,NA
"ones.Asweaddthefieldthatwillbeourprimarykeyandbeautoincremental,wecanadd ",NA,NA
allthesemodifierstothefielddefinition.Executethefollowingcode:,"mysql>ALTERTABLEbook
  
 ->ADDidINTUNSIGNEDNOTNULLAUTO_INCREMENT-
 >PRIMARYKEYFIRST; 
  
 QueryOK,0rowsaffected(0.02sec) 
  
 Records:0Duplicates:0Warnings:0",NA
Note,FIRST,NA
"attheendofthecommand.Whenaddingnewfields,ifyouwantthemto ",NA,NA
"appearonadifferentpositionthanattheendofthetable,youneedtospecifytheposition. ",NA,NA
Itcouldbeeither,FIRST,NA
or,AFTER<otherfield>,NA
".Forconvenience,theprimarykeyofa ",NA,NA
tableisthefirstofitsfields.,NA,NA
"AsthetablecustomeralreadyhasanIDfield,wedonothavetoadditagainbutrather ",NA,NA
"modifyit.Inordertodothis,wewilljustusethe",ALTERTABLE,NA
commandwiththe,MODIFY,NA
"option,specifyingthenewdefinitionofanalreadyexistingfield,asfollows:","mysql>ALTERTABLEcustomer
  
 ->MODIFYidINTUNSIGNEDNOTNULL-
 >AUTO_INCREMENTPRIMARYKEY; 
  
 QueryOK,0rowsaffected(0.00sec) 
 Records:0Duplicates:0Warnings:0",NA
Foreignkeys,NA,NA
Let’simaginethatweneedtokeeptrackoftheborrowedbooks.Thetableshouldcontain ,NA,NA
"theborrowedbook,whoborrowedit,andwhenitwasborrowed.So,whatkindofdata ",NA,NA
wouldyouusetoidentifythebookorthecustomer?Wouldyouusethetitleorthename?,NA,NA
"Well,weshouldusesomethingthatidentifiesauniquerowfromthesetables,andthis“so",NA,NA
"mething”istheprimarykey.Withthisaction,wewilleliminatethechangeofusinga ",NA,NA
referencethatcanpotentiallypointtotwoormorerowsatthesametime.,NA,NA
Wecouldthencreateatablethatcontains,book_id,NA
and,customer_id,NA
"asnumericfields, ",NA,NA
"containingtheIDsthatreferencethesetwotables.Asthefirstapproach,itmakessense, ",NA,NA
"butwecanfindsomeweaknesses.Forexample,whathappensifweinsertwrongIDsand ",NA,NA
theydonotexistin,book,NA
or,customer,NA
?WecouldhavesomecodeinourPHPsidetomake ,NA,NA
surethatwhenfetchinginformationfrom,borrowed_books,NA
",weonlydisplayedthe ",NA,NA
informationthatiscorrect.Wecouldevenhavearoutinethatperiodicallychecksfor ,NA,NA
"wrongrowsandremovesthem,solvingtheissueofhavingwrongdatawastingspacein ",NA,NA
"thedisk.However,aswiththe",Unique,NA
"traitversusaddingprimarykeysinMySQL,itis ",NA,NA
usuallybettertoallowthedatabasesystemtomanagethesethingsastheperformancewill ,NA,NA
"usuallybebetter,andyoudonotneedtowriteextracode.",NA,NA
MySQLallowsyoutocreatekeysthatenforcereferencestoothertables.Thesearecalled ,NA,NA
foreignkeys,NA,NA
",andtheyaretheprimaryreasonforwhichwewereforcedtousethe ",NA,NA
InnoDBtableengineinsteadofanyother.Aforeignkeydefinesandenforcesareference ,NA,NA
betweenthisfieldandanotherrowofadifferenttable.IftheIDsuppliedforthefieldwith ,NA,NA
"aforeignkeydoesnotexistinthereferencedtable,thequerywillfail.Furthermore,ifyou ",NA,NA
haveavalid,borrowed_books,NA
rowpointingtoanexistingbookandyouremovetheentry ,NA,NA
"fromthebooktable,MySQLwillcomplainaboutit—eventhoughyouwillbeableto ",NA,NA
customizethisbehaviorsoon—asthisactionwouldleavewrongdatainthesystem.As ,NA,NA
"youcannote,thisiswaymoreusefulthanhavingtowritecodetomanagethesecases.",NA,NA
Let’screatethe,borrowed_books,NA
"tablewiththebook,customerreferences,anddates.Note ",NA,NA
thatwehavetodefinetheforeignkeysafterthedefinitionofthefieldsasopposedtowhen ,NA,NA
"wedefinedprimarykeys,asfollows:","mysql>CREATETABLEborrowed_books(
  
 ->book_idINTUNSIGNEDNOTNULL,
  
 ->customer_idINTUNSIGNEDNOTNULL,
  
 ->startDATETIMENOTNULL,
  
 ->endDATETIMEDEFAULTNULL,
  
 ->FOREIGNKEY(book_id)REFERENCESbook(id),
  
 ->FOREIGNKEY(customer_id)REFERENCEScustomer(id)-
 >)ENGINE=InnoDb; 
  
 QueryOK,0rowsaffected(0.00sec)",NA
Aswith,SHOWCREATESCHEMA,NA
",youcanalsocheckhowthetablelooks.Thiscommand ",NA,NA
willalsoshowyouinformationaboutthekeysasopposedtothe,DESC,NA
command.Let’s ,NA,NA
takealookathowitwouldwork:,mysql>SHOWCREATETABLEborrowed_books\G,NA
"Notetwoimportantthingshere.Ononehand,wehavetwoextrakeysthatwedidnot ",NA,NA
"define.Thereasonisthatwhendefiningaforeignkey,MySQLalsodefinesthefieldasa ",NA,NA
keythatwillbeusedtoimproveperformanceonthetable;wewilllookintothisina ,NA,NA
moment.TheotherelementtonoteisthefactthatMySQLdefinesnamestothekeysby ,NA,NA
itself.Thisisnecessaryasweneedtobeabletoreferencethemincasewewanttochange ,NA,NA
"orremovethiskey.YoucanletMySQLnamethekeysforyou,oryoucanspecifythe ",NA,NA
namesyoupreferwhencreatingthem.,NA,NA
"Wearerunningabookstore,andevenifweallowcustomerstoborrowbooks,wewantto ",NA,NA
beabletosellthem.Asaleisaveryimportantelementthatweneedtotrackdownas ,NA,NA
"customersmaywanttoreviewthem,oryoumayjustneedtoprovidethisinformationfor ",NA,NA
"taxationpurposes.Asopposedtoborrowing,inwhichknowingthebook,customer,and ",NA,NA
"datewasmorethanenough,here,weneedtosetIDstothesalesinordertoidentifythem ",NA,NA
tothecustomers.,NA,NA
"However,thistableismoredifficulttodesignthantheotheronesandnotjustbecauseof ",NA,NA
theID.Thinkaboutit:docustomersbuybooksonebyone?Ordotheyratherbuyany ,NA,NA
"numberofbooksatonce?Thus,weneedtoallowthetabletocontainanundefined ",NA,NA
"amountofbooks.WithPHP,thisiseasyaswewouldjustuseanarray,butwedonothave ",NA,NA
arraysinMySQL.Therearetwooptionstothisproblem.,NA,NA
OnesolutioncouldbetosettheIDofthesaleasanormalintegerfieldandnotasa ,NA,NA
"primarykey.Inthisway,wewouldbeabletoinsertseveralrowstothe",sales,NA
"table,one ",NA,NA
"foreachborrowedbook.However,thissolutionislessthanidealaswemissthe ",NA,NA
opportunityofdefiningaverygoodprimarykeybecauseithasthe,sales,NA
"ID.Also,weare ",NA,NA
duplicatingthedataaboutthecustomeranddatesincetheywillalwaysbethesame.,NA,NA
"Thesecondsolution,theonethatwewillimplement,isthecreationofaseparatedtable ",NA,NA
thatactsasa“list”.Wewillstillhaveour,sales,NA
"table,whichwillcontaintheIDofthe ",NA,NA
"saleasaprimarykey,thecustomerIDasaforeignkey,andthedates.However,wewill ",NA,NA
createasecondtablethatwecouldname,sale_book,NA
",andwewilldefinetheretheIDof ",NA,NA
"thesale,theIDofthebook,andtheamountofbooksofthesamecopythatthecustomer ",NA,NA
"bought.Inthisway,wewillhaveatoncetheinformationaboutthecustomeranddate,and ",NA,NA
wewillbeabletoinsertasmanyrowsasneededinour,sale_book,NA
list-tablewithout,NA,NA
duplicatinganydata.Let’stakealookathowwewouldcreatethese:,"mysql>CREATETABLEsale(
  
 ->idINTUNSIGNEDNOTNULLAUTO_INCREMENTPRIMARYKEY,-
 >customer_idINTUNSIGNEDNOTNULL,
  
 ->dateDATETIMENOTNULL,
  
 ->FOREIGNKEY(customer_id)REFERENCEScustomer(id)->)ENGINE=InnoDb; 
  
 QueryOK,0rowsaffected(0.00sec)
  
 mysql>CREATETABLEsale_book(
  
 ->sale_idINTUNSIGNEDNOTNULL,
  
 ->book_idINTUNSIGNEDNOTNULL,
  
 ->amountSMALLINTUNSIGNEDNOTNULLDEFAULT1,-
 >FOREIGNKEY(sale_id)REFERENCESsale(id),-
 >FOREIGNKEY(book_id)REFERENCESbook(id)->)ENGINE=InnoDb; 
  
 QueryOK,0rowsaffected(0.00sec)",NA
Keepinmindthatyoushouldalwayscreatethe,sales,NA
tablefirstbecauseifyoucreatethe ,sale_book,NA
"tablewithaforeignkeyfirst,referencingatablethatdoesnotexistyet, ",NA,NA
MySQLwillcomplain.,NA,NA
"Wecreatedthreenewtablesinthissection,andtheyareinterrelated.Itisagoodtimeto ",NA,NA
updatethediagramoftables.Notethatwelinkthefieldswiththetableswhenthereisa ,NA,NA
foreignkeydefined.Takealook:,NA,NA
Uniquekeys,NA,NA
"Asyouknow,primarykeysareextremelyusefulastheyprovideseveralfeatureswith ",NA,NA
"them.Oneoftheseisthatthefieldhastobeunique.However,youcandefineonlyone ",NA,NA
"primarykeypertable,eventhoughyoumighthaveseveralfieldsthatareunique.Inorder ",NA,NA
"toamendthislimitation,MySQLincorporates",NA,NA
uniquekeys,NA,NA
.Theirjobistomakesurethat ,NA,NA
"thefieldisnotrepeatedinmultiplerows,buttheydonotcomewiththerestofthe ",NA,NA
"functionalitiesofprimarykeys,suchasbeingautoincremental.Also,uniquekeyscanbe ",NA,NA
null.,NA,NA
Our,book,NA
and,customer,NA
tablescontaingoodcandidatesforuniquekeys.Bookscan ,NA,NA
"potentiallyhavethesametitle,andsurely,therewillbemorethanonebookbythesame ",NA,NA
"author.However,theyalsohaveanISBNwhichisunique;twodifferentbooksshouldnot ",NA,NA
"havethesameISBN.Inthesameway,eveniftwocustomersweretohavethesamename, ",NA,NA
theire-mailaddresseswillbealwaysdifferent.Let’saddthetwokeyswiththe,"ALTER 
 TABLE",NA
"command,thoughyoucanalsoaddthemwhencreatingthetableaswedidwith ",NA,NA
"foreignkeys,asfollows:","mysql>ALTERTABLEbookADDUNIQUEKEY(isbn); 
 QueryOK,0rowsaffected(0.01sec) 
  
 Records:0Duplicates:0Warnings:0
  
 mysql>ALTERTABLEcustomerADDUNIQUEKEY(email); 
 QueryOK,0rowsaffected(0.01sec) 
  
 Records:0Duplicates:0Warnings:0",NA
Indexes,NA,NA
"Indexes,whichareasynonymforkeys,arefieldsthatdonotneedanyspecialbehavioras ",NA,NA
"dotherestofthekeysbuttheyareimportantenoughinourqueries.So,wewillask ",NA,NA
MySQLtodosomeworkwiththeminordertoperformbetterwhenqueryingbythis ,NA,NA
field.DoyourememberwhenaddingaforeignkeythatMySQLaddedextrakeystothe ,NA,NA
table?Thosewereindexestoo.,NA,NA
Thinkabouthowtheapplicationwillusethedatabase.Wewanttoshowthecatalogof ,NA,NA
"bookstoourcustomers,butwecannotshowallofthematonceforsure.Thecustomer ",NA,NA
"willwanttofiltertheresults,andoneofthemostcommonwaysoffilteringisby ",NA,NA
"specifyingthetitleofthebookthattheyarelookingfor.Fromthis,wecanextractthatthe ",NA,NA
"titlewillbeusedtofilterbooksquiteoften,sowewanttoaddanindextothisfield.Let’s ",NA,NA
addtheindexviathefollowingcode:,"mysql>ALTERTABLEbookADDINDEX(title); 
 QueryOK,0rowsaffected(0.01sec) 
  
 Records:0Duplicates:0Warnings:0",NA
"Rememberthatallotherkeysalsoprovideindexing.IDsofbooks,customersandsales, ",NA,NA
"ISBNs,ande-mailsarealreadyindexed,sothereisnoneedtoaddanotherindexhere. ",NA,NA
"Also,trynottoaddindexestoeverysinglefieldasindoingsoyouwillbe",NA,NA
overindexing,NA,NA
", ",NA,NA
whichwouldmakesometypesofqueriesevenslowerthaniftheywerewithoutindexes!,NA,NA
Insertingdata,NA,NA
"Wehavecreatedtheperfecttablestoholdourdata,butsofartheyareempty.Itistime ",NA,NA
thatwepopulatethem.Wedelayedthismomentasalteringtableswithdataismore ,NA,NA
difficultthanwhentheyareempty.,NA,NA
"Inordertoinsertthisdata,wewillusethe",INSERTINTO,NA
command.Thiscommandwill ,NA,NA
"takethenameofthetable,thefieldsthatyouwanttopopulate,andthedataforeachfield.",NA,NA
"Notethatyoucanchoosenottospecifythevalueforafield,andtherearedifferent ",NA,NA
"reasonstodothis,whichareasfollows:",NA,NA
"Thefieldhasadefaultvalue,andwearehappyusingitforthisspecificrow ",NA,NA
"Eventhoughthefielddoesnothaveanexplicitdefaultvalue,thefieldcantakenull ",NA,NA
"values;so,bynotspecifyingthefield,MySQLwillautomaticallyinsertanullhere ",NA,NA
"Thefieldisaprimarykeyandisautoincremental,andwewanttoletMySQLtake ",NA,NA
thenextIDforus,NA,NA
Therearedifferentreasonsthatcancausean,INSERTINTO,NA
commandtofail:,NA,NA
IfyoudonotspecifythevalueofafieldandMySQLcannotprovideavaliddefault value ,NA,NA
IfthevalueprovidedisnotofthetypeofthefieldandMySQLfailstofindavalid ,NA,NA
conversion ,NA,NA
Ifyouspecifythatyouwanttosetthevalueforafieldbutyoufailtoprovideavalue ,NA,NA
IfyouprovideaforeignkeywithanIDbuttheIDdoesnotexistinthereferenced table,NA,NA
Let’stakealookathowtoaddrows.Let’sstartwithour,customer,NA
"table,addingone ",basic,NA
andone,premium,NA
",asfollows:","mysql>INSERTINTOcustomer(firstname,surname,email,type)-
 >VALUES(""Han"",""Solo"",""han@tatooine.com"",""premium""); 
 QueryOK,1rowaffected(0.00sec)
  
 mysql>INSERTINTOcustomer(firstname,surname,email,type)-
 >VALUES(""James"",""Kirk"",""enter@prise"",""basic""); 
 QueryOK,1rowaffected(0.00sec)",NA
"NotethatMySQLshowsyousomereturninformation;inthiscase,itshowsthattherewas ",NA,NA
"onerowaffected,whichistherowthatweinserted.WedidnotprovideanID,soMySQL ",NA,NA
"justaddedthenextonesinthelist.Asitisthefirsttimethatweareaddingdata,MySQL ",NA,NA
usedtheIDs1and2.,NA,NA
"Let’strytotrickMySQLandaddanothercustomer,repeatingthee-mailaddressfieldthat ",NA,NA
wesetasuniqueintheprevioussection:,"mysql>INSERTINTOcustomer(firstname,surname,email,type)-
 >VALUES(""Mr"",""Spock"",""enter@prise"",""basic""); 
  
 ERROR1062(23000):Duplicateentry'enter@prise'forkey'email'",NA
"Anerrorisreturnedwithanerrorcodeandanerrormessage,andtherowwasnot",NA,NA
"inserted,ofcourse.Theerrormessageusuallycontainsenoughinformationinorderto ",NA,NA
"understandtheissueandhowtofixit.Ifthisisnotthecase,wecanalwaystrytosearch ",NA,NA
ontheInternetusingtheerrorcodeandnotewhateithertheofficialdocumentationor ,NA,NA
otherusershavetosayaboutit.,NA,NA
Incaseyouneedtointroducemultiplerowstothesametableandtheycontainthesame ,NA,NA
"fields,thereisashorterversionofthecommand,inwhichyoucanspecifythefieldsand ",NA,NA
thenprovidethegroupsofvaluesforeachrow.Let’stakealookathowtouseitwhen ,NA,NA
addingbookstoour,book,NA
"table,asfollows:","mysql>INSERTINTObook(isbn,title,author,stock,price)VALUES-
 >(""9780882339726"",""1984"",""GeorgeOrwell"",12,7.50),-
 >(""9789724621081"",""1Q84"",""HarukiMurakami"",9,9.75),-
 >(""9780736692427"",""AnimalFarm"",""GeorgeOrwell"",8,3.50),-
 >(""9780307350169"",""Dracula"",""BramStoker"",30,10.15),-
 >(""9780753179246"",""19minutes"",""JodiPicoult"",0,10); 
 QueryOK,5rowsaffected(0.01sec) 
  
 Records:5Duplicates:0Warnings:0",NA
"Aswithcustomers,wewillnotspecifytheIDandletMySQLchoosetheappropriateone. ",NA,NA
Notealsothatnowtheamountofaffectedrowsis,5,NA
asweinsertedfiverows.,NA,NA
"Howcanwetakeadvantageoftheexplicitdefaultsthatwedefinedinourtables?Well,we ",NA,NA
candothisinthesamewayaswedidwiththeprimarykeys:donotspecifytheminthe ,NA,NA
"fieldslistorinthevalueslist,andMySQLwilljustusethedefaultvalue.Forexample,we ",NA,NA
definedadefaultvalueof,1,NA
forour,book.stock,NA
"field,whichisausefulnotationforthe ",book,NA
tableandthe,stock,NA
"field.Let’saddanotherrowusingthisdefault,asfollows:","mysql>INSERTINTObook(isbn,title,author,price)VALUES-
 >(""9781416500360"",""Odyssey"",""Homer"",4.23); 
 QueryOK,1rowaffected(0.00sec)",NA
"Nowthatwehavebooksandcustomers,let’saddsomehistoricdataaboutcustomers ",NA,NA
"borrowingbooks.Forthis,usethenumericIDsfrom",book,NA
and,customer,NA
",asinthe ",NA,NA
followingcode:,"mysql>INSERTINTOborrowed_books(book_id,customer_id,start,end)->VALUES
  
 ->(1,1,""2014-12-12"",""2014-12-28""),
  
 ->(4,1,""2015-01-10"",""2015-01-13""),
  
 ->(4,2,""2015-02-01"",""2015-02-10""),
  
 ->(1,2,""2015-03-12"",NULL); 
  
 QueryOK,3rowsaffected(0.00sec) 
  
 Records:3Duplicates:0Warnings:0",NA
Queryingdata,NA,NA
"Ittookquitealotoftime,butwearefinallyinthemostexciting—anduseful—section ",NA,NA
relatedtodatabases:queryingdata.QueryingdatareferstoaskingMySQLtoreturnrows ,NA,NA
fromthespecifiedtableandoptionallyfilteringtheseresultsbyasetofrules.Youcanalso ,NA,NA
"choosetogetspecificfieldsinsteadofthewholerow.Inordertoquerydata,wewilluse ",NA,NA
the,SELECT,NA
"command,asfollows:","mysql>SELECTfirstname,surname,typeFROMcustomer; +-----------+------
 ---+---------+ 
  
 |firstname|surname|type| 
  
 +-----------+---------+---------+ 
  
 |Han|Solo|premium| 
  
 |James|Kirk|basic| 
  
 +-----------+---------+---------+ 
  
 2rowsinset(0.00sec)",NA
Oneofthesimplestwaystoquerydataistospecifythefieldsofinterestafter,SELECT,NA
and ,NA,NA
specifythetablewiththe,FROM,NA
keyword.Aswedidnotaddanyfilters—mostlyknownas ,NA,NA
"conditions—tothequery,wegotalltherowsthere.Sometimes,thisisthedesired ",NA,NA
"behavior,butthemostcommonthingtodoistoaddconditionstothequerytoretrieve ",NA,NA
onlytherowsthatweneed.Usethe,WHERE,NA
keywordtoachievethis.,"mysql>SELECTfirstname,surname,typeFROMcustomer->WHEREid=1; 
  
 +-----------+---------+---------+ 
  
 |firstname|surname|type| 
  
 +-----------+---------+---------+ 
  
 |Han|Solo|premium| 
  
 +-----------+---------+---------+ 
  
 1rowinset(0.00sec)",NA
AddingconditionsisverysimilartowhenwecreatedBooleanexpressionsinPHP.We ,NA,NA
"willspecifythenameofthefield,anoperator,andavalue,andMySQLwillretrieveonly ",NA,NA
therowsthatreturn,true,NA
"tothisexpression.Inthiscase,weaskedforthecustomersthat ",NA,NA
"hadtheID1,andMySQLreturnedonerow:theonethathadanIDofexactly1.",NA,NA
Acommonquerywouldbetogetthebooksthatstartwithsometext.Wecannotconstruct ,NA,NA
"thisexpressionwithanycomparisonoperandthatyouknow,suchas",=,NA
and,<,NA
or,>,NA
",sincewe ",NA,NA
"wanttomatchonlyapartofthestring.Forthis,MySQLhasthe",LIKE,NA
"operator,which ",NA,NA
"takesastringthatcancontainwildcards.Awildcardisacharacterthatrepresentsarule, ",NA,NA
"matchinganynumberofcharactersthatfollowstherule.Forexample,the",%,NA
wildcard ,NA,NA
"representsanynumberofcharacters,sousingthe",1%,NA
stringwouldmatchanystringthat ,NA,NA
"startswith1andisfollowedbyanynumberorcharacters,matchingstringssuchas",1984,NA
or,1Q84,NA
.Let’sconsiderthefollowingexample:,"mysql>SELECTtitle,author,priceFROMbook-
 >WHEREtitleLIKE""1%""; 
  
 +------------+-----------------+-------+ |title|author|price| +-------
 -----+-----------------+-------+",NA
Weaskedforallthebookswhosetitlestartswith,1,NA
",andwegotthreerows.Youcan ",NA,NA
"imaginehowusefulthisoperatoris,especiallywhenweimplementasearchutilityinour ",NA,NA
application.,NA,NA
"AsinPHP,MySQLalsoallowsyoutoaddlogicaloperators—thatis,operatorsthattake ",NA,NA
"operandsandperformalogicaloperation,returningBooleanvaluesasaresult.Themost ",NA,NA
"commonlogicaloperatorsare,asinPHP,",AND,NA
and,OR,NA
.,AND,NA
returns,true,NA
ifboththe ,NA,NA
expressionsare,true,NA
and,OR,NA
returns,true,NA
ifeitheroftheoperandsis,true,NA
.Let’sconsider ,NA,NA
"anexample,asfollows:","mysql>SELECTtitle,author,priceFROMbook-
 >WHEREtitleLIKE""1%""ANDstock>0; +------------+-------------
 ----+-------+ |title|author|price| +------------+-----------------+---
 ----+ |1984|GeorgeOrwell|7.5| 
 |1Q84|HarukiMurakami|9.75| +------------+-----------------+---
 ----+ 2rowsinset(0.00sec)",NA
"Thisexampleisverysimilartothepreviousone,butweaddedanextracondition.We ",NA,NA
askedforalltitlesstartingwith,1,NA
andwhetherthereisstockavailable.Thisiswhyoneof ,NA,NA
thebooksdoesnotshowasitdoesnotsatisfybothconditions.Youcanaddasmany ,NA,NA
conditionsasyouneedwithlogicaloperatorsbutbearinmindthat,AND,NA
operatorstake ,NA,NA
precedenceover,OR,NA
".Ifyouwanttochangethisprecedence,youcanalwayswrap ",NA,NA
"expressionswithaparenthesis,asinPHP.",NA,NA
"Sofar,wehaveretrievedspecificfieldswhenqueryingfordata,butwecouldaskforall ",NA,NA
"thefieldsinagiventable.Todothis,wewilljustusethe",*,NA
wildcardin,SELECT,NA
.Let’s ,NA,NA
selectallthefieldsforthecustomersviathefollowingcode:,"mysql>SELECT*FROMcustomer\G 
  
 ***************************1.row*************************** id:1 
  
 firstname:Han 
  
 surname:Solo 
  
 email:han@tatooine.com 
  
 type:premium 
  
 ***************************2.row*************************** id:2 
  
 firstname:James 
  
 surname:Kirk 
  
 email:enter@prise 
  
 type:basic 
  
 2rowsinset(0.00sec)",NA
"Youcanretrievemoreinformationthanjustfields.Forexample,youcanuse",COUNT,NA
to ,NA,NA
retrievetheamountofrowsthatsatisfythegivenconditionsinsteadofretrievingallthe,NA,NA
columns.Thiswayisfasterthanretrievingallthecolumnsandthencountingthem ,NA,NA
becauseyousavetimeinreducingthesizeoftheresponse.Let’sconsiderhowitwould ,NA,NA
look:,"mysql>SELECTCOUNT(*)FROMborrowed_books
  
 ->WHEREcustomer_id=1ANDendISNOTNULL; +----------+ 
  
 |COUNT(*)| 
  
 +----------+ 
  
 |1| 
  
 +----------+ 
  
 1rowinset(0.00sec)",NA
"Asyoucannote,theresponsesays",1,NA
",whichmeansthatthereisonlyoneborrowedbook ",NA,NA
"thatsatisfiestheconditions.However,checktheconditions;youwillnotethatweused ",NA,NA
anotherfamiliarlogicaloperator:,NOT,NA
.,NOT,NA
"negatestheexpression,as",!,NA
doesinPHP.Note ,NA,NA
"alsothatwedonotusetheequalsigntocomparewithnullvalues.InMySQL,youhaveto ",NA,NA
use,IS,NA
insteadoftheequalssigninordertocomparewith,NULL,NA
".So,thesecondcondition ",NA,NA
wouldbesatisfiedwhenaborrowedbookhasanenddatethatisnotnull.,NA,NA
Let’sfinishthissectionbyaddingtwomorefeatureswhenqueryingdata.Thefirstoneis ,NA,NA
"theabilitytospecifyinwhatordertherowsshouldbereturned.Todothis,justusethe ",NA,NA
keyword,ORDERBY,NA
followedbythenameofthefieldthatyouwanttoorderby.Youcould ,NA,NA
"alsospecifywhetheryouwanttoorderinascendingmode,whichisbydefault,orinthe ",NA,NA
"descendingmode,whichcanbedonebyappending",DESC,NA
.Theotherfeatureistheability ,NA,NA
tolimittheamountofrowstoreturnusing,LIMIT,NA
"andtheamountofrowstoretrieve.Now, ",NA,NA
runthefollowing:,"mysql>SELECTid,title,author,isbnFROMbook
  
 ->ORDERBYtitleLIMIT4; 
  
 +----+-------------+-----------------+---------------+ |id|title|author|isbn| +----+---
 ----------+-----------------+---------------+ 
 |5|19minutes|JodiPicoult|9780753179246| 
 |1|1984|GeorgeOrwell|9780882339726| 
 |2|1Q84|HarukiMurakami|9789724621081| 
 |3|AnimalFarm|GeorgeOrwell|9780736692427| +----+-------------+---------
 --------+---------------+ 4rowsinset(0.00sec)",NA
UsingPDO,NA,NA
"Sofar,wehaveworkedwithMySQL,andyoualreadyhaveagoodideaofwhatyoucan ",NA,NA
"dowithit.However,connectingtotheclientandperformingqueriesmanuallyisnotour ",NA,NA
goal.Whatwewanttoachieveisthatourapplicationcantakeadvantageofthedatabase ,NA,NA
"inanautomaticway.Inordertodothis,wewilluseasetofclassesthatcomeswithPHP ",NA,NA
andallowsyoutoconnecttothedatabaseandperformqueriesfromthecode.,NA,NA
PHPDataObjects,NA,NA
(,NA,NA
PDO,NA,NA
)istheclassthatconnectstothedatabaseandallowsyouto ,NA,NA
"interactwithit.ThisisthepopularwaytoworkwithdatabasesforPHPdevelopers,even ",NA,NA
thoughthereareotherwaysthatwewillnotdiscusshere.PDOallowsyoutoworkwith ,NA,NA
"differentdatabasesystems,soyouarenottiedtoMySQLonly.Inthefollowingsections, ",NA,NA
"wewillconsiderhowtoconnecttoadatabase,insertdata,andretrieveitusingthisclass.",NA,NA
Connectingtothedatabase,NA,NA
"Inordertoconnecttothedatabase,itisgoodpracticetokeepthecredentials—thatis,the ",NA,NA
userandpassword—separatedfromthecodeinaconfigurationfile.Wealreadyhavethis ,NA,NA
fileas,config/app.json,NA
fromwhenweworkedwiththe,Config,NA
class.Let’saddthe ,NA,NA
"correctcredentialsforourdatabase.Ifyouhavetheconfigurationbydefault,the ",NA,NA
configurationfileshouldlooksimilartothis:,"{ 
  
 ""db"":{ 
  
 ""user"":""root"", 
  
 ""password"":"""" 
  
 } 
  
 }",NA
"Developersusuallyspecifyotherinformationrelatedtotheconnection,suchasthehost, ",NA,NA
"port,ornameofthedatabase.Thiswilldependonhowyourapplicationisinstalled, ",NA,NA
"whetherMySQLisrunningonadifferentserver,andsoon,anditisuptoyouhowmuch ",NA,NA
informationyouwanttokeeponyourcodeandinyourconfigurationfiles.,NA,NA
"Inordertoconnecttothedatabase,weneedtoinstantiateanobjectfromthe",PDO,NA
class. ,NA,NA
Theconstructorofthisclassexpectsthreearguments:,NA,NA
DataSourceName,NA,NA
(,NA,NA
DSN,NA,NA
"),which ",NA,NA
isastringthatrepresentsthetypeofdatabasetouse;thenameoftheuser;andthe ,NA,NA
password.Wealreadyhavetheusernameandpasswordfromthe,Config,NA
"class,butwestill ",NA,NA
needtobuildDSN.,NA,NA
OneoftheformatsforMySQLdatabasesis,"<databasetype>:host=<host>;dbname= 
 <schemaname>",NA
".AsourdatabasesystemisMySQL,itrunsonthesameserver,andthe ",NA,NA
schemanameis,bookstore,NA
",DSNwillbe",mysql:host=127.0.0.1;dbname=bookstore,NA
.,NA,NA
Let’stakealookathowwewillputeverythingtogether:,"$dbConfig=Config::getInstance()->get('db'); 
  
 $db=newPDO( 
  
 'mysql:host=127.0.0.1;dbname=bookstore', 
  
 $dbConfig['user'], 
  
 $dbConfig['password'] 
  
 ); 
  
 $db->setAttribute(PDO::ATTR_DEFAULT_FETCH_MODE,PDO::FETCH_ASSOC);",NA
Notealsothatwewillinvokethe,setAttribute,NA
methodfromthe,PDO,NA
instance.This ,NA,NA
"methodallowsyoutosetsomeoptionstotheconnection;inthiscase,itsetstheformatof ",NA,NA
theresultscomingfromMySQL.ThisoptionforcesMySQLtoreturnthearrayswhose ,NA,NA
"keysarethenamesofthefields,whichiswaymoreusefulthanthedefaultone,returning ",NA,NA
numerickeysbasedontheorderofthefields.Settingthisoptionnowwillaffectallthe ,NA,NA
queriesperformedwiththe,$db,NA
"instance,ratherthansettingtheoptioneachtimewe ",NA,NA
performaquery.,NA,NA
Performingqueries,NA,NA
Theeasiestwaytoretrievedatafromyourdatabaseistousethe,query,NA
method.This ,NA,NA
methodacceptsthequeryasastringandreturnsalistofrowsasarrays.Let’sconsideran ,NA,NA
example:writethefollowingaftertheinitializationofthedatabaseconnection—for ,NA,NA
"example,inthe",init.php,NA
file:,"$rows=$db->query('SELECT*FROMbookORDERBYtitle'); 
 foreach($rowsas$row){ 
  
 var_dump($row); 
  
 }",NA
"Thisquerytriestogetallthebooksinthedatabase,orderingthembythetitle.Thiscould ",NA,NA
bethecontentofafunctionsuchas,getAllBooks,NA
",whichisusedwhenwedisplayour ",NA,NA
catalog.Eachrowisanarraythatcontainsallthefieldsaskeysandthedataasvalues.,NA,NA
"Ifyouruntheapplicationonyourbrowser,youwillgetthefollowingresult:",NA,NA
The,query,NA
"functionisusefulwhenwewanttoretrievedata,butinordertoexecutequeries ",NA,NA
"thatinsertrows,PDOprovidesthe",exec,NA
function.Thisfunctionalsoexpectsthefirst,NA,NA
"parameterasastring,definingthequerytoexecute,butitreturnsaBooleanspecifying ",NA,NA
whethertheexecutionwassuccessfulornot.Agoodexamplewouldbetotrytoinsert ,NA,NA
books.Typethefollowing:,"$query=<<<SQL 
  
 INSERTINTObook(isbn,title,author,price) 
  
 VALUES(""9788187981954"",""PeterPan"",""J.M.Barrie"",2.34) SQL; 
  
 $result=$db->exec($query); 
  
 var_dump($result);//true",NA
Thiscodealsousesanewwayofrepresentingstrings:heredoc.Wewillenclosethestring ,NA,NA
between,<<<SQL,NA
and,SQL;,NA
",bothindifferentlines,insteadofquotes.Thebenefitofthisis ",NA,NA
"theabilitytowritestringsinmultiplelineswithtabulationsoranyotherblankspace,and ",NA,NA
PHPwillrespectit.Wecanconstructqueriesthatareeasytoreadratherthanwritingthem ,NA,NA
onasinglelineorhavingtoconcatenatethedifferentstrings.Notethat,SQL,NA
isatokento ,NA,NA
"representthestartandendofthestring,butyoucoulduseanytextthatyouconsider.",NA,NA
"Thefirsttimeyouruntheapplicationwiththiscode,thequerywillbeexecuted ",NA,NA
"successfully,andthus,theresultwillbetheBoolean",true,NA
".However,ifyourunitagain,it ",NA,NA
willreturn,false,NA
astheISBNthatweinsertedisthesamebutwesetitsrestrictiontobe ,NA,NA
unique.,NA,NA
"Itisusefultoknowthataqueryfailed,butitisbetterifweknowwhy.The",PDO,NA
instance ,NA,NA
hasthe,errorInfo,NA
methodthatreturnsanarraywiththeinformationofthelasterror.The ,NA,NA
key,2,NA
"containsthedescription,soitisprobablytheonethatwewillusemoreoften.",NA,NA
Updatethepreviouscodewiththefollowing:,"$query=<<<SQL 
  
 INSERTINTObook(isbn,title,author,price) 
  
 VALUES(""9788187981954"",""PeterPan"",""J.M.Barrie"",2.34) 
  
 SQL; 
  
 $result=$db->exec($query); 
  
 var_dump($result);//false 
  
 $error=$db->errorInfo()[2]; 
  
 var_dump($error);//Duplicateentry'9788187981954'forkey'isbn'",NA
"TheresultisthatthequeryfailedbecausetheISBNentrywasduplicated.Now,wecan ",NA,NA
buildmoremeaningfulerrormessagesforourcustomersorjustfordebuggingpurposes.,NA,NA
Preparedstatements,NA,NA
Theprevioustwofunctionsareveryusefulwhenyouneedtorunquickqueriesthatare ,NA,NA
"alwaysthesame.However,inthesecondexampleyoumightnotethatthestringofthe ",NA,NA
queryisnotveryusefulasitalwaysinsertsthesamebook.Althoughitistruethatyou ,NA,NA
"couldjustreplacethevaluesbyvariables,itisnotgoodpracticeasthesevariablesusually ",NA,NA
comefromtheusersideandcancontainmaliciouscode.Itisalwaysbettertofirstsanitize ,NA,NA
thesevalues.,NA,NA
"PDOprovidestheabilitytoprepareastatement—thatis,aquerythatisparameterized. ",NA,NA
Youcanspecifyparametersforthefieldsthatwillchangeinthequeryandthenassign ,NA,NA
"valuestotheseparameters.Let’sconsiderfirstanexample,asfollows:","$query='SELECT*FROMbookWHEREauthor=:author'; 
 $statement=$db-
 >prepare($query); 
  
 $statement->bindValue('author','GeorgeOrwell'); $statement-
 >execute(); 
  
 $rows=$statement->fetchAll(); 
  
 var_dump($rows);",NA
Thequeryisanormaloneexceptthatithas,:author,NA
insteadofthestringoftheauthorthat ,NA,NA
"wewanttofind.Thisisaparameter,andwewillidentifythemusingtheprefix",:,NA
.The ,prepare,NA
methodgetsthequeryasanargumentandreturnsa,PDOStatement,NA
instance.This ,NA,NA
"classcontainsseveralmethodstobindvalues,executestatements,fetchresults,andmore.",NA,NA
"Inthispieceofcode,weuseonlythreeofthem,asfollows:",bindValue,NA
:Thistakestwoarguments:thenameoftheparameterasdescribedinthe ,NA,NA
queryandthevaluetoassign.Ifyouprovideaparameternamethatisnotinthe ,NA,NA
"query,thiswillthrowanexception.",execute,NA
:ThiswillsendthequerytoMySQLwiththereplacementoftheparameters ,NA,NA
"bytheprovidedvalues.Ifthereisanyparameterthatisnotassignedtoavalue,the ",NA,NA
methodwillthrowanexception.Asitsbrother,exec,NA
",",execute,NA
"willreturnaBoolean, ",NA,NA
specifyingwhetherthequerywasexecutedsuccessfullyornot.,fetchAll,NA
:ThiswillretrievethedatafromMySQLincaseitwasa,SELECT,NA
query.As ,NA,NA
"aquery,",fetchAll,NA
willreturnalistofallrowsasarrays.,NA,NA
"Ifyoutrythiscode,youwillnotethattheresultisverysimilartowhenusing",query,NA
; ,NA,NA
"however,thistime,thecodeismuchmoredynamicasyoucanreuseitforanyauthorthat ",NA,NA
youneed.,NA,NA
Thereisanotherwaytobindvaluestoparametersofaquerythanusingthe,bindValue,NA
method.Youcouldprepareanarraywherethekeyisthenameoftheparameterandthe ,NA,NA
"valueisthevalueyouwanttoassigntoit,andthenyoucansenditasthefirstargumentof ",NA,NA
the,execute,NA
method.Thiswayisquiteusefulasusuallyyoualreadyhavethisarray ,NA,NA
preparedanddonotneedtocall,bindValue,NA
severaltimeswithitscontent.Addthiscode ,NA,NA
inordertotestit:,"$query=<<<SQL 
  
 INSERTINTObook(isbn,title,author,price) 
 VALUES(:isbn,:title,:author,:price) 
  
 SQL; 
  
 $statement=$db->prepare($query); 
  
 $params=[ 
  
 'isbn'=>'9781412108614', 
  
 'title'=>'Iliad', 
  
 'author'=>'Homer',",NA
"Inthislastexample,wecreatedanewbookwithalmostalltheparameters,butwedidnot ",NA,NA
"specifytheID,whichisthedesiredbehavioraswewantMySQLtochooseavalidonefor ",NA,NA
"us.However,whathappensifyouwanttoknowtheIDoftheinsertedrow?Well,you ",NA,NA
couldqueryMySQLforthebookwiththesameISBNandthereturnedrowwouldcontain ,NA,NA
"theID,butthisseemslikealotofwork.Instead,PDOhasthe",lastInsertId,NA
"method, ",NA,NA
"whichreturnsthelastIDinsertedbyaprimarykey,savingusfromoneextraquery.",NA,NA
Joiningtables,NA,NA
"EventhoughqueryingMySQLisquitefast,especiallyifitisinthesameserverasour ",NA,NA
"PHPapplication,weshouldtrytoreducethenumberofqueriesthatwewillexecuteto ",NA,NA
"improvetheperformanceofourapplication.Sofar,wehavequerieddatafromjustone ",NA,NA
"table,butthisisrarelythecase.Imaginethatyouwanttoretrieveinformationabout ",NA,NA
"borrowedbooks:thetablecontainsonlyIDsanddates,soifyouqueryit,youwillnotget ",NA,NA
"verymeaningfuldata,right?Oneapproachwouldbetoquerythedatain",borrowed_books,NA
", ",NA,NA
"andbasedonthereturningIDs,querythe",book,NA
and,customer,NA
tablesbyfilteringbytheIDs ,NA,NA
"weareinterestedin.However,thisapproachconsistsofatleastthreequeriestoMySQL ",NA,NA
andalotofworkwitharraysinPHP.Itseemsasthoughthereshouldbeabetteroption!,NA,NA
"InSQL,youcanexecute",NA,NA
joinqueries,NA,NA
.Ajoinqueryisaquerythatjoinstwoormore ,NA,NA
"tablesthroughacommonfieldand,thus,allowsyoutoretrievedatafromthesetables, ",NA,NA
"reducingtheamountofqueriesneeded.Ofcourse,theperformanceofajoinqueryisnot ",NA,NA
"asgoodastheperformanceofanormalquery,butifyouhavethecorrectkeysand ",NA,NA
"relationshipsdefined,thisoptioniswaybetterthanqueryingseparately.",NA,NA
"Inordertojointables,youneedtolinkthemusingacommonfield.Foreignkeysarevery ",NA,NA
usefulinthismatterasyouknowthatboththefieldsarethesame.Let’stakealookathow ,NA,NA
wewouldqueryforalltheimportantinforelatedtotheborrowedbooks:,"mysql>SELECTCONCAT(c.firstname,'',c.surname)ASname,->b.title,
  
 ->b.author,
  
 ->DATE_FORMAT(bb.start,'%d-%m-%y')ASstart,
  
 ->DATE_FORMAT(bb.end,'%d-%m-%y')ASend
  
 ->FROMborrowed_booksbb
  
 ->LEFTJOINcustomercONbb.customer_id=c.id-
 >LEFTJOINbookbONb.id=bb.book_id
  
 ->WHEREbb.start>=""2015-01-01""; 
  
 +------------+---------+---------------+----------+----------+ |name|title|author|start|end| +-
 -----------+---------+---------------+----------+----------+ 
 |HanSolo|Dracula|BramStoker|10-01-15|13-01-15| 
 |JamesKirk|Dracula|BramStoker|01-02-15|10-02-15| 
 |JamesKirk|1984|GeorgeOrwell|12-03-15|NULL| +------------+---------+---------------+-
 ---------+----------+ 3rowsinset(0.00sec)",NA
Thereareseveralnewconceptsintroducedinthislastquery.Especiallywithjoining ,NA,NA
"queries,aswejoinedthefieldsofdifferenttables,itmightoccurthattwotableshavethe ",NA,NA
"samefieldname,andMySQLneedsustodifferentiatethem.Thewaywewilldifferentiate ",NA,NA
twofieldsoftwodifferenttablesisbyprependingthenameofthetable.Imaginethatwe ,NA,NA
wanttodifferentiatetheIDofacustomerfromtheIDofthebook;weshouldusethemas ,customer.id,NA
and,book.id,NA
".However,writingthenameofthetableeachtimewouldmake ",NA,NA
ourqueriesendless.,NA,NA
MySQLhastheabilitytoaddanaliastoatablebyjustwritingnexttothetable’sreal ,NA,NA
"name,aswedidin",borrowed_books,NA
(,bb,NA
"),",customer,NA
(,c,NA
)or,book,NA
(,b,NA
").Onceyouaddanalias,",NA,NA
"youcanuseittoreferencethistable,allowingustowritethingssuchas",bb.customer_id,NA
insteadof,borrowed_books.customer_id,NA
.Itisalsogoodpracticetowritethetableofthe ,NA,NA
fieldevenifthefieldisnotduplicatedanywhereelseasjoiningtablesmakesitabit ,NA,NA
confusingtoknowwhereeachfieldcomesfrom.,NA,NA
"Whenjoiningtables,youneedtowritetheminthe",FROM,NA
clauseusing,LEFTJOIN,NA
",followed ",NA,NA
"bythenameofthetable,anoptionalalias,andthefieldsthatconnectbothtables.There ",NA,NA
"aredifferentjoiningtypes,butlet’sfocusonthemostusefulforourpurposes.",NA,NA
Leftjoins ,NA,NA
takeeachrowfromthefirsttable—theoneontheleft-handsideofthedefinition—and ,NA,NA
"searchfortheequivalentfieldintheright-handsidetable.Onceitfindsit,itwill ",NA,NA
"concatenatebothrowsasiftheywereone.Forexample,whenjoining",borrowed_books,NA
with,customer,NA
foreach,borrowed_books,NA
"row,MySQLwillsearchforanIDin",customer,NA
thatmatchesthecurrent,customer_id,NA
",andthenitwilladdalltheinformationofthisrow ",NA,NA
inourcurrentrowin,borrowed_books,NA
asiftheywereonlyonebigtable.As,customer_id,NA
"isaforeignkey,wearecertainthattherewillalwaysbeacustomertomatch.",NA,NA
"Youcanjoinseveraltables,andMySQLwilljustresolvethemfromlefttoright;thatis,it ",NA,NA
"willfirstjointhetwofirsttablesasone,thentrytojointhisresultingonewiththethird ",NA,NA
"table,andsoon.Thisis,infact,whatwedidinourexample:wefirstjoined ",borrowed_books,NA
with,customer,NA
andthenjoinedthesetwowith,book,NA
.,NA,NA
"Asyoucannote,therearealsoaliasesforfields.Sometimes,wedomorethanjustgetting ",NA,NA
afield;anexamplewaswhenwegothowmanyrowsaquerymatchedwith,COUNT(*),NA
.,NA,NA
"However,thetitleofthecolumnwhenretrievingthisinformationwasalso",COUNT(*),NA
", ",NA,NA
"whichisnotalwaysuseful.Atothertimes,weusedtwotableswithcollidingfieldnames, ",NA,NA
"anditmakeseverythingconfusing.Whenthishappens,justaddanaliastothefieldinthe ",NA,NA
samewaywedidwithtablenames;,AS,NA
"isoptional,butithelpstounderstandwhatyouare ",NA,NA
doing.,NA,NA
"Let’smovenowtotheusageofdatesinthisquery.Ononehand,wewilluse",DATE_FORMAT,NA
forthefirsttime.Itacceptsthedate/time/datetimevalueandthestringwiththeformat.In ,NA,NA
"thiscase,weused",%d-%m-%y,NA
",whichmeansday-month-year,butwecoulduse",%h-%i-%s,NA
to ,NA,NA
specifyhours-minutes-secondsoranyothercombination.,NA,NA
Notealsohowwecompareddatesinthe,WHERE,NA
clause.Giventwodatesortimevaluesof ,NA,NA
"thesametype,youcanusethecomparisonoperatorsasiftheywerenumbers.Inthiscase, ",NA,NA
wewilldo,"bb.start>=""2015-01-01""",NA
",whichwillgiveustheborrowedbooksfrom ",NA,NA
"January1,2015,onward.",NA,NA
Thefinalthingtonoteaboutthiscomplexqueryistheuseofthe,CONCAT,NA
function.Instead ,NA,NA
"ofreturningtwofields,oneforthenameandoneforthesurname,wewanttogetthefull ",NA,NA
"name.Todothis,wewillconcatenatethefieldsusingthisfunction,sendingasmany ",NA,NA
stringsaswewantasargumentsofthefunctionandgettingbacktheconcatenatedstring. ,NA,NA
"Asyoucansee,youcansendbothfieldsandstringsenclosedbysinglequotes.",NA,NA
"Well,ifyoufullyunderstoodthisquery,youshouldfeelsatisfiedwithyourself;thiswas ",NA,NA
themostcomplexquerywewillseeinthischapter.Wehopeyoucangetasenseofhow ,NA,NA
"powerfuladatabasesystemcanbeandthatfromnowon,youwilltrytoprocessthedata",NA,NA
asmuchasyoucanonthedatabasesideinsteadofthePHPside.Ifyousetthecorrect ,NA,NA
"indexes,itwillperformbetter.",NA,NA
Groupingqueries,NA,NA
Thelastfeaturethatwewilldiscussaboutqueryingisthe,GROUPBY,NA
clause.Thisclause ,NA,NA
"allowsyoutogrouprowsofthesametablewithacommonfield.Forexample,let’ssay ",NA,NA
wewanttoknowhowmanybookseachauthorhasinjustonequery.Trythefollowing:,"mysql>SELECT
  
 ->author,
  
 ->COUNT(*)ASamount,
  
 ->GROUP_CONCAT(titleSEPARATOR',')AStitles->FROMbook
  
 ->GROUPBYauthor
  
 ->ORDERBYamountDESC,author; 
  
 +-----------------+--------+-------------------+ |author|amount|titles| +-------
 ----------+--------+-------------------+ |GeorgeOrwell|2|1984,AnimalFarm| 
 |Homer|2|Odyssey,Iliad| |BramStoker|1|Dracula| 
 |HarukiMurakami|1|1Q84| |J.M.Barrie|1|PeterPan| 
 |JodiPicoult|1|19minutes| +-----------------+--------+-------------------+ 
 5rowsinset(0.00sec)",NA
The,GROUPBY,NA
"clause,alwaysafterthe",WHERE,NA
"clause,getsafield—ormany,separatedbya ",NA,NA
"coma—andtreatsalltherowswiththesamevalueforthisfield,asthoughtheywerejust ",NA,NA
"one.Thus,selectingbyauthorwillgroupalltherowsthatcontainthesameauthor.The ",NA,NA
"featuremightnotseemveryuseful,butthereareseveralfunctionsinMySQLthattake ",NA,NA
advantageofit.Inthisexample:,COUNT(*),NA
isusedinquerieswith,GROUPBY,NA
andshowshowmanyrowsthisfield ,NA,NA
"groups.Inthiscase,wewilluseittoknowhowmanybookseachauthorhas.Infact, ",NA,NA
"italwaysworkslikethis;however,forquerieswithout",GROUPBY,NA
",MySQLtreatsthe ",NA,NA
wholesetofrowsasonegroup.,GROUP_CONCAT,NA
issimilarto,CONCAT,NA
",whichwediscussedearlier.Theonlydifferenceis ",NA,NA
thatthistimethefunctionwillconcatenatethefieldsofalltherowsofagroup.Ifyou ,NA,NA
donotspecify,SEPARATOR,NA
",MySQLwilluseasinglecoma.However,inourcase,we ",NA,NA
"neededacomaandaspacetomakeitreadable,soweadded","SEPARATOR','",NA
atthe ,NA,NA
end.Notethatyoucanaddasmanythingstoconcatenateasyouneedin,CONCAT,NA
",the ",NA,NA
separatorwilljustseparatetheconcatenationsbyrows.,NA,NA
"Eventhoughitisnotaboutgrouping,notethe",ORDER,NA
clausethatweadded.Weorderedby ,NA,NA
twofieldsinsteadofone.ThismeansthatMySQLwillorderalltherowsbythe,amount,NA
"field;notethatthisisanalias,butyoucanuseithereaswell.Then,MySQLwillorder ",NA,NA
eachgroupofrowswiththesame,amount,NA
valuebythe,title,NA
field.,NA,NA
Thereisonelastthingtorememberaswealreadypresentedalltheimportantclausesthat ,NA,NA
a,SELECT,NA
querycancontain:MySQLexpectstheclausesofthequerytobealwaysinthe ,NA,NA
"sameorder.Ifyouwritethesamequerybutchangethisorder,youwillgetanerror.The",NA,NA
orderisasfollows:,NA,NA
1.,SELECT,NA
2.,FROM,NA
3.,WHERE,NA
4.,GROUPBY,NA
5.,ORDERBY,NA
Updatinganddeletingdata,NA,NA
"Wealreadyknowquitealotaboutinsertingandretrievingdata,butifapplicationscould ",NA,NA
"onlydothis,theywouldbequitestatic.Editingthisdataasweneediswhatmakesan ",NA,NA
"applicationdynamicandwhatgivestotheusersomevalue.InMySQL,andinmost ",NA,NA
"databasesystems,youhavetwocommandstochangedata:",UPDATE,NA
and,DELETE,NA
.Let’s ,NA,NA
discussthemindetail.,NA,NA
Updatingdata,NA,NA
"WhenupdatingdatainMySQL,themostimportantthingistohaveauniquereferenceof ",NA,NA
"therowthatyouwanttoupdate.Forthis,primarykeysareveryuseful;however,ifyou ",NA,NA
"haveatablewithnoprimarykeys,whichshouldnotbethecasemostofthetime,youcan ",NA,NA
"stillupdatetherowsbasedonotherfields.Otherthanthereference,youwillneedthenew ",NA,NA
"valueand,ofcourse,thetablenameandfieldtoupdate.Let’stakealookataverysimple ",NA,NA
example:,"mysql>UPDATEbookSETprice=12.75WHEREid=2; 
 QueryOK,1rowaffected(0.00sec) 
  
 Rowsmatched:1Changed:1Warnings:0",NA
Inthis,UPDATE,NA
"query,wesetthepriceofthebookwiththeID2to",12.75,NA
.The,SET,NA
clause ,NA,NA
doesnotneedtospecifyonlyonechange;youcanspecifyseveralchangesonthesame ,NA,NA
"rowassoonasyouseparatethembycommas—forexample,","SETprice=12.75,stock 
 =14",NA
".Also,notethe",WHERE,NA
"clause,inwhichwespecifywhichrowswewanttochange.",NA,NA
MySQLgetsalltherowsofthistablebasedontheseconditionsasthoughitwerea ,SELECT,NA
queryandapplythechangetothissetofrows.,NA,NA
WhatMySQLwillreturnisveryimportant:thenumberofrowsmatchedandthenumber ,NA,NA
ofrowschanged.Thefirstoneisthenumberofrowsthatmatchtheconditionsinthe ,WHERE,NA
clause.Thesecondonespecifiestheamountofrowsthatcanbechanged.Thereare ,NA,NA
differentreasonsnottochangearow—forexamplewhentherowalreadyhasthesame ,NA,NA
"value.Toseethis,let’srunthesamequeryagain:","mysql>UPDATEbookSETprice=12.75WHEREid=2; 
 QueryOK,0rowsaffected(0.00sec) 
  
 Rowsmatched:1Changed:0Warnings:0",NA
Thesamerownowsaysthattherewas,1,NA
"rowmatched,asexpected,but",0,NA
rowswere ,NA,NA
changed.Thereasonisthatwealreadysetthepriceofthisbookto,12.75,NA
",soMySQLdoes ",NA,NA
notneedtodoanythingaboutthisnow.,NA,NA
"Asmentionedbefore,the",WHERE,NA
clauseisthemostimportantbitinthisquery.Waytoo ,NA,NA
"manytimes,wefinddevelopersthatrunaprioriinnocent",UPDATE,NA
queriesendupchanging ,NA,NA
thewholetablebecausetheymissthe,WHERE,NA
"clause;thus,MySQLmatchesthewholetable ",NA,NA
"asvalidrowstoupdate.Thisisusuallynottheintentionofthedeveloper,anditis ",NA,NA
"somethingnotverypleasant,sotrytomakesureyoualwaysprovideavalidsetof ",NA,NA
conditions.Itisgoodpracticetofirstwritedownthe,SELECT,NA
querythatreturnstherows ,NA,NA
"youneedtoedit,andonceyouaresurethattheconditionsmatchthedesiredsetofrows, ",NA,NA
youcanwritethe,UPDATE,NA
query.,NA,NA
"However,sometimes,affectingmultiplerowsistheintendedscenario.Imaginethatweare ",NA,NA
goingthroughtoughtimesandneedtoincreasethepriceofallourbooks.Wedecidethat ,NA,NA
"wewanttoincreasethepriceby16%,whichisthesameasthecurrentpricetimes1.16.",NA,NA
Wecanrunthefollowingquerytoperformthesechanges:,"mysql>UPDATEbookSETprice=price*1.16; 
 QueryOK,8rowsaffected(0.00sec)",NA
Thisquerydoesnotcontainany,WHERE,NA
clauseaswewanttomatchallourbooks.Also ,NA,NA
notethatthe,SET,NA
clauseusesthe,price,NA
"fieldtogetthecurrentvaluefortheprice,whichis ",NA,NA
"perfectlyvalid.Finally,notethenumberofrowsmatchedandchanged,whichis",8,NA
—the ,NA,NA
wholesetofrowsforthistable.,NA,NA
"Tofinishwiththissubsection,let’sconsiderhowwecanuse",UPDATE,NA
queriesfromPHP ,NA,NA
throughPDO.Oneverycommonscenarioiswhenwewanttoaddcopiesofthealready ,NA,NA
existingbookstoourinventory.GivenabookIDandanoptionalamountofbooks—by ,NA,NA
"default,thisvaluewillbe1—wewillincreasethestockvalueofthisbookbythesemany ",NA,NA
copies.Writethisfunctioninyour,init.php,NA
file:,"functionaddBook(int$id,int$amount=1):void{ $db=newPDO( 
  
 'mysql:host=127.0.0.1;dbname=bookstore', 'root', 
  
 '' 
  
 );
  
 $query='UPDATEbookSETstock=stock+:nWHEREid=:id'; $statement=$db-
 >prepare($query); 
  
 $statement->bindValue('id',$id); 
  
 $statement->bindValue('n',$amount);
  
 if(!$statement->execute()){ 
  
 thrownewException($statement->errorInfo()[2]); } 
  
 }",NA
Therearetwoarguments:,$id,NA
and,$amount,NA
".Thefirstonewillalwaysbemandatory, ",NA,NA
"whereasthesecondonecanbeomitted,andthedefaultvaluewillbe1.Thefunctionfirst ",NA,NA
"preparesaquerysimilartothefirstoneofthissection,inwhichweincreasedtheamount ",NA,NA
"ofstockofagivenbook,thenbindsbothparameterstothestatement,andfinallyexecutes ",NA,NA
thequery.Ifsomethinghappensand,execute,NA
returns,false,NA
",wewillthrowanexception ",NA,NA
withthecontentoftheerrormessagefromMySQL.,NA,NA
Thisfunctionisveryusefulwhenweeitherbuymorestockoracustomerreturnsabook. ,NA,NA
Wecouldevenuseittoremovebooksbyprovidinganegativevalueto,$amount,NA
",butthis ",NA,NA
"isverybadpractice.Thereasonisthatevenifweforcedthestockfieldtobeunsigned, ",NA,NA
"settingittoanegativevaluewillnottriggeranyerror,onlyawarning.MySQLwillnotset ",NA,NA
"therowtoanegativevalue,butthe",execute,NA
invocationwillreturn,true,NA
",andwewillnot ",NA,NA
"knowaboutit.Itisbettertojustcreateasecondmethod,",removeBook,NA
",andverifyfirstthat ",NA,NA
theamountofbookstoremoveislowerthanorequaltothecurrentstock.,NA,NA
Foreignkeybehaviors,NA,NA
Onetrickythingtomanagewhenupdatingordeletingrowsiswhentherowthatwe ,NA,NA
"updateispartofaforeignkeysomewhereelse.Forexample,our",borrowed_books,NA
table ,NA,NA
"containstheIDsofcustomersandbooks,andasyoualreadyknow,MySQLenforcesthat ",NA,NA
"theseIDsarealwaysvalidandexistontheserespectivetables.Whatwouldhappen,then, ",NA,NA
ifwechangedtheIDofthebookitselfonthe,book,NA
"table?Orevenworse,whatwould ",NA,NA
happenifweremovedoneofthebooksfrom,book,NA
",andthereisarowin",borrowed_books,NA
thatreferencesthisID?,NA,NA
MySQLallowsyoutosetthedesiredreactionwhenoneofthesescenariostakesplace.It ,NA,NA
"hastobedefinedwhenaddingtheforeignkey;so,inourcase,wewillneedtofirst ",NA,NA
"removetheexistingonesandthenaddthemagain.Toremoveordropakey,youneedto ",NA,NA
"knowthenameofthiskey,whichwecanfindusingthe",SHOWCREATETABLE,NA
"command,as ",NA,NA
follows:,"mysql>SHOWCREATETABLEborrowed_books\G 
  
 ***************************1.row*************************** 
  
 Table:borrowed_books 
  
 CreateTable:CREATETABLE`borrowed_books`( 
  
 `book_id`int(10)unsignedNOTNULL, 
  
 `customer_id`int(10)unsignedNOTNULL, 
  
 `start`datetimeNOTNULL, 
  
 `end`datetimeDEFAULTNULL, 
  
 KEY`book_id`(`book_id`), 
  
 KEY`customer_id`(`customer_id`), 
  
 CONSTRAINT`borrowed_books_ibfk_1`FOREIGNKEY(`book_id`)REFERENCES `book`(`id`), 
  
 CONSTRAINT`borrowed_books_ibfk_2`FOREIGNKEY(`customer_id`)REFERENCES `customer`(`id`) 
  
 )ENGINE=InnoDBDEFAULTCHARSET=latin1 
  
 1rowinset(0.00sec)",NA
Thetwoforeignkeysthatwewanttoremoveare,borrowed_books_ibfk_1,NA
and ,borrowed_books_ibfk_2,NA
.Let’sremovethemusingthe,ALTERTABLE,NA
"command,aswedid before:","mysql>ALTERTABLEborrowed_books
  
 ->DROPFOREIGNKEYborrowed_books_ibfk_1; 
 QueryOK,4rowsaffected(0.02sec) 
  
 Records:4Duplicates:0Warnings:0
  
 mysql>ALTERTABLEborrowed_books
  
 ->DROPFOREIGNKEYborrowed_books_ibfk_2; 
 QueryOK,4rowsaffected(0.01sec) 
  
 Records:4Duplicates:0Warnings:0",NA
"Now,weneedtoaddtheforeignkeysagain.Theformatofthecommandwillbethesame ",NA,NA
"aswhenweaddedthem,butappendingthenewdesiredbehavior.Inourcase,ifwe ",NA,NA
"removeacustomerorbookfromourtables,wewanttoremovetherowsreferencingthese ",NA,NA
booksandcustomersfrom,borrowed_books,NA
";so,weneedtousethe",CASCADE,NA
option.Let’s ,NA,NA
considerwhattheywouldlooklike:,NA,NA
Notethatwecandefinethe,CASCADE,NA
behaviorforbothactions:whenupdatingandwhen ,NA,NA
deletingrows.Thereareotheroptionsinsteadof,CASCADE,NA
—forexample,SETNULL,NA
",which ",NA,NA
setstheforeignkeyscolumnsto,NULL,NA
"andallowstheoriginalrowtobedeleted,orthe ",NA,NA
"defaultone,",RESTRICT,NA
",whichrejectstheupdate/deletecommands.",NA,NA
Deletingdata,NA,NA
Deletingdataisalmostthesameasupdatingit.Youneedtoprovidea,WHERE,NA
clausethat ,NA,NA
"willmatchtherowsthatyouwanttodelete.Also,aswithwhenupdatingdata,itishighly ",NA,NA
recommendedtofirstbuildthe,SELECT,NA
querythatwillretrievetherowsthatyouwantto ,NA,NA
deletebeforeperformingthe,DELETE,NA
command.Donotthinkthatyouarewastingtime ,NA,NA
"withthismethodology;asthesayinggoes,measuretwice,cutonce.Notalwaysisit ",NA,NA
possibletorecoverdataafterdeletingrows!,NA,NA
Let’strytodeleteabookbyobservinghowthe,CASCADE,NA
optionwesetearlierbehaves.For ,NA,NA
"this,let’sfirstqueryfortheexistingborrowedbookslistviathefollowing:","mysql>SELECTbook_id,customer_idFROMborrowed_books; +---------+------
 -------+ 
  
 |book_id|customer_id| 
  
 +---------+-------------+ 
  
 |1|1| 
  
 |4|1| 
  
 |4|2| 
  
 |1|2| 
  
 +---------+-------------+ 
  
 4rowsinset(0.00sec)",NA
"Therearetwodifferentbooks,",1,NA
and,4,NA
",witheachofthemborrowedtwice.Let’stryto ",NA,NA
"deletethebookwiththeID4.First,buildaquerysuchas","SELECT*FROMbookWHEREid 
 =4",NA
tomakesurethattheconditioninthe,WHERE,NA
clauseistheappropriateone.Onceyou ,NA,NA
"aresure,performthefollowingquery:","mysql>DELETEFROMbookWHEREid=4; 
  
 QueryOK,1rowaffected(0.02sec)",NA
"Asyoucannote,weonlyspecifiedthe",DELETEFROM,NA
commandfollowedbythenameof ,NA,NA
thetableandthe,WHERE,NA
clause.MySQLtellsusthattherewas,1,NA
"rowaffected,whichmakes ",NA,NA
"sense,giventheprevious",SELECT,NA
statementwemade.,NA,NA
Ifwegobacktoour,borrowed_books,NA
"tableandqueryfortheexistingones,wewillnote ",NA,NA
thatalltherowsreferencingthebookwiththeID4aregone.Thisisbecausewhen ,NA,NA
deletingthemfromthe,book,NA
"table,MySQLnoticedtheforeignkeyreference,checked ",NA,NA
"whatitneededtodowhiledeleting—inthiscase,",CASCADE,NA
—anddeletedalsotherowsin ,borrowed_books,NA
.Takealookatthefollowing:,"mysql>SELECTbook_id,customer_idFROMborrowed_books; +---------+------
 -------+ 
  
 |book_id|customer_id| 
  
 +---------+-------------+ 
  
 |1|1| 
  
 |1|2| 
  
 +---------+-------------+ 
  
 2rowsinset(0.00sec)",NA
Workingwithtransactions,NA,NA
"Intheprevioussection,wereiteratedhowimportantitistomakesurethatanupdateor ",NA,NA
deletequerycontainthedesirablematchingsetofrows.Eventhoughthiswillalways ,NA,NA
"apply,thereisawaytorevertthechangesthatyoujustmade,whichisworkingwith ",NA,NA
transactions,NA,NA
.,NA,NA
AtransactionisastatewhereMySQLkeepstrackofallthechangesthatyoumakeinyour ,NA,NA
datainordertobeabletorevertallofthemifneeded.Youneedtoexplicitlystarta ,NA,NA
"transaction,andbeforeyouclosetheconnectiontotheserver,youneedtocommityour ",NA,NA
changes.ThismeansthatMySQLdoesnotreallyperformthesechangesuntilyoutellitto ,NA,NA
"doso.Ifduringatransactionyouwanttorevertthechanges,youshouldrollbackinstead ",NA,NA
ofmakingacommit.,NA,NA
PDOallowsyoutodothiswiththreefunctions:,beginTransaction,NA
:Thiswillstartthetransaction.,commit,NA
:Thiswillcommityourchanges.Keepinmindthatifyoudonotcommitand ,NA,NA
"thePHPscriptfinishesoryouclosetheconnectionexplicitly,MySQLwillrejectall ",NA,NA
thechangesyoumadeduringthistransaction.,rollBack,NA
:Thiswillrollbackallthechangesthatweremadeduringthistransaction.,NA,NA
Onepossibleuseoftransactionsinyourapplicationiswhenyouneedtoperformmultiple ,NA,NA
queriesandallofthemhavetobesuccessfulandthewholesetofqueriesshouldnotbe ,NA,NA
performedotherwise.Thiswouldbethecasewhenaddingasaleintothedatabase. ,NA,NA
Rememberthatoursalesarestoredintwotables:oneforthesaleitselfandoneforthelist ,NA,NA
"ofbooksrelatedtothissale.Whenaddinganewone,youneedtomakesurethatallthe ",NA,NA
"booksareaddedtothisdatabase;otherwise,thesalewillbecorrupted.Whatyoushould ",NA,NA
"doisexecuteallthequeries,checkingfortheirreturningvalues.Ifanyofthemreturns ",false,NA
",thewholesaleshouldberolledback.",NA,NA
Let’screatean,addSale,NA
functioninyour,init.php,NA
fileinordertoemulatethisbehavior. ,NA,NA
Thecontentshouldbeasfollows:,"functionaddSale(int$userId,array$bookIds):void{ $db=newPDO( 
  
 'mysql:host=127.0.0.1;dbname=bookstore', 'root', 
  
 '' 
  
 );
  
 $db->beginTransaction(); 
  
 try{ 
  
 $query='INSERTINTOsale(customer_id,date)' .'VALUES(:id,NOW())'; 
  
 $statement=$db->prepare($query); 
  
 if(!$statement->execute(['id'=>$userId])){ thrownewException($statement-
 >errorInfo()[2]); } 
  
 $saleId=$db->lastInsertId();",NA
Thisfunctionisquitecomplex.ItgetsasargumentstheIDofthecustomerandthelistof ,NA,NA
booksasweassumethatthedateofthesaleisthecurrentdate.Thefirstthingwewilldo ,NA,NA
"isconnecttothedatabase,instantiatingthe",PDO,NA
"class.Rightafterthis,wewillbeginour ",NA,NA
"transaction,whichwilllastonlyduringthecourseofthisfunction.Oncewebeginthe ",NA,NA
"transaction,wewillopena",try…catch,NA
blockthatwillenclosetherestofthecodeofthe ,NA,NA
"function.Thereasonisthatifwethrowanexception,the",catch,NA
"blockwillcaptureit, ",NA,NA
rollingbackthetransactionandpropagatingtheexception.Thecodeinsidethe,try,NA
block ,NA,NA
"justaddsfirstthesaleandtheniteratesthelistofbooks,insertingthemintothedatabase ",NA,NA
"too.Atalltimes,wewillchecktheresponseofthe",execute,NA
"function,andifit’s",false,NA
",we ",NA,NA
willthrowanexceptionwiththeinformationoftheerror.,NA,NA
Let’strytousethisfunction.Writethefollowingcodethattriestoaddasaleforthree ,NA,NA
"books;however,oneofthemdoesnotexist,whichistheonewiththeID200:","try{ 
  
 addSale(1,[1,2,200]); 
  
 }catch(Exception$e){ 
  
 echo'Erroraddingsale:'.$e->getMessage(); }",NA
"Thiscodewillechotheerrormessage,complainingaboutthenonexistentbook.Ifyou ",NA,NA
"checkinMySQL,therewillbenorowsinthe",sales,NA
tableasthefunctionrolledback ,NA,NA
whentheexceptionwasthrown.,NA,NA
"Finally,let’strythefollowingcodeinstead.Thisonewilladdthreevalidbookssothatthe ",NA,NA
queriesarealwayssuccessfulandthe,try,NA
"blockcangountiltheend,wherewewill ",NA,NA
committhechanges:,"try{ 
  
 addSale(1,[1,2,3]); 
  
 }catch(Exception$e){ 
  
 echo'Erroraddingsale:'.$e->getMessage(); }",NA
"Testit,andyouwillseehowthereisnomessageprintedonyourbrowser.Then,goto",NA,NA
yourdatabasetomakesurethatthereisanew,sales,NA
rowandtherearethreebookslinked ,NA,NA
toit.,NA,NA
Summary,NA,NA
"Inthischapter,welearnedtheimportanceofdatabasesandhowtousethemfromourweb ",NA,NA
application:fromsettinguptheconnectionusingPDOandcreatingandfetchingdataon ,NA,NA
"demandtoconstructingmorecomplexqueriesthatfulfillourneeds.Withallofthis,our ",NA,NA
applicationlookswaymoreusefulnowthanwhenitwascompletelystatic.,NA,NA
"Inthenextchapter,wewilldiscoverhowtoapplythemostimportantdesignpatternsfor ",NA,NA
webapplicationsthrough,NA,NA
ModelViewController,NA,NA
(,NA,NA
MVC,NA,NA
).Youwillgainasenseof ,NA,NA
clarityinyourcodewhenyouorganizeyourapplicationinthisway.,NA,NA
Chapter6.AdaptingtoMVC,NA,NA
Webapplicationsaremorecomplexthanwhatwehavebuiltsofar.Themorefunctionality ,NA,NA
"youadd,themoredifficultthecodeistomaintainandunderstand.Itisforthisreasonthat ",NA,NA
"structuringyourcodeinanorganizedwayiscrucial.Youcoulddesignyourownstructure, ",NA,NA
"butaswithOOP,therealreadyexistsomedesignpatternsthattrytosolvethisproblem.",NA,NA
MVC,NA,NA
(,NA,NA
model-view-controller,NA,NA
)hasbeenthefavoritepatternforwebdevelopers.Ithelps ,NA,NA
"usseparatethedifferentpartsofawebapplication,leavingthecodeeasytounderstand ",NA,NA
"evenforbeginners.WewilltrytorefactorourbookstoreexampletousetheMVCpattern, ",NA,NA
andyouwillrealizehowquicklyyoucanaddnewfunctionalityafterthat.,NA,NA
"Inthischapter,youwilllearnthefollowing:",NA,NA
UsingComposertomanagedependencies ,NA,NA
Designingarouterforyourapplication ,NA,NA
"Organizingyourcodeintomodels,views,andcontrollers ",NA,NA
Twigasthetemplateengine ,NA,NA
Dependencyinjection,NA,NA
TheMVCpattern,NA,NA
"Sofar,eachtimewehavehadtoaddafeature,weaddedanewPHPfilewithamixtureof ",NA,NA
"PHPandHTMLforthatspecificpage.Forchunksofcodewithasinglepurpose,and ",NA,NA
"whichwehavetoreuse,wecreatedfunctionsandaddedthemtothefunctionsfile.Even ",NA,NA
"forverysmallwebapplicationslikeours,thecodestartsbecomingveryconfusing,and ",NA,NA
theabilitytoreusecodeisnotashelpfulasitcouldbe.Nowimagineanapplicationwitha ,NA,NA
largenumberoffeatures:thatwouldbeprettymuchchaositself.,NA,NA
"Theproblemsdonotstophere.Inourcode,wehavemixedHTMLandPHPcodeina ",NA,NA
singlefile.Thatwillgiveusalotoftroublewhentryingtochangethedesignoftheweb ,NA,NA
"application,orevenifwewanttoperformaverysmallchangeacrossallpages,suchas ",NA,NA
"changingthemenuorfooterofthepage.Themorecomplextheapplication,themore ",NA,NA
problemswewillencounter.,NA,NA
MVCcameupasapatterntohelpusdividethedifferentpartsoftheapplication.These ,NA,NA
"partsareknownasmodels,views,andcontrollers.",NA,NA
Models,NA,NA
managethedataand/orthe ,NA,NA
"businesslogic,",NA,NA
views,NA,NA
"containthetemplatesforourresponses(forexample,HTMLpages), ",NA,NA
and,NA,NA
controllers,NA,NA
"orchestraterequests,decidingwhatdatatouseandhowtorenderthe ",NA,NA
appropriatetemplate.Wewillgothroughtheminlatersectionsofthischapter.,NA,NA
UsingComposer,NA,NA
"EventhoughthisisnotanecessarycomponentwhenimplementingtheMVCpattern, ",NA,NA
ComposerhasbeenanindispensabletoolforanyPHPwebapplicationoverthelastfew ,NA,NA
years.Themaingoalofthistoolistohelpyoumanagethedependenciesofyour ,NA,NA
"application,thatis,thethird-partylibraries(ofcode)thatweneedtouseinour ",NA,NA
"application.Wecanachievethatbyjustcreatingaconfigurationfilethatliststhem,andby ",NA,NA
runningacommandinyourcommandline.,NA,NA
YouneedtoinstallComposeronyourdevelopmentmachine(see,NA,NA
Chapter1,NA,NA
",",NA,NA
SettingUp ,NA,NA
theEnvironment,NA,NA
).Makesurethatyouhaveitbyexecutingthefollowingcommand:,$composer–version,NA
"ThisshouldreturntheversionofyourComposerinstallation.Ifitdoesnot,returntothe ",NA,NA
installationsectiontofixtheproblem.,NA,NA
Managingdependencies,NA,NA
"Aswestatedearlier,themaingoalofComposeristomanagedependencies.Forexample, ",NA,NA
"we’vealreadyimplementedourconfigurationreader,the",Config,NA
"class,butifweknewof ",NA,NA
"someonethatimplementedabetterversionofit,wecouldjustusetheirsinsteadof ",NA,NA
reinventingthewheel;justmakesurethattheyallowyoutodoso!,NA,NA
Note,NA,NA
Opensource,NA,NA
Opensourcereferstothecodethatdeveloperswriteandsharewiththecommunityin ,NA,NA
ordertobeusedbyotherswithoutrestrictions.Thereareactuallydifferenttypesof ,NA,NA
"licenses,andsomegiveyoumoreflexibilitythanothers,butthebasicideaisthatwecan ",NA,NA
reusethelibrariesthatotherdevelopershavewritteninourapplications.Thathelpsthe ,NA,NA
"communitytogrowinknowledge,aswecanlearnwhatothershavedone,improveit,and ",NA,NA
shareitafterwards.,NA,NA
"We’vealreadyimplementedadecentconfigurationreader,butthereareotherelementso",NA,NA
f ourapplicationthatneedtobedone.Let’stakeadvantageofComposertoreusesomeone ,NA,NA
else’slibraries.Thereareacoupleofwaysofaddingadependencytoourproject: ,NA,NA
"executingacommandinourcommandline,oreditingtheconfigurationfilemanually.As ",NA,NA
"westilldonothaveComposer’sconfigurationfile,let’susethefirstoption.Executethe ",NA,NA
followingcommandintherootdirectoryofyourapplication:,$composerrequiremonolog/monolog,NA
Thiscommandwillshowthefollowingresult:,"Usingversion^1.17formonolog/monolog 
  
 ./composer.jsonhasbeencreated 
  
 Loadingcomposerrepositorieswithpackageinformation 
 Updatingdependencies(includingrequire-dev)
  
 -Installingpsr/log(1.0.0) 
  
 Downloading:100%
  
 -Installingmonolog/monolog(1.17.2) 
 Downloading:100% 
  
 ...
  
 Writinglockfile 
  
 Generatingautoloadfiles",NA
"Withthiscommand,weaskedComposertoaddthelibrary",monolog/monolog,NA
asa ,NA,NA
"dependencyofourapplication.Havingexecutedthat,wecannowseesomechangesin ",NA,NA
ourdirectory:,NA,NA
Wehaveanewfilenamed,composer.json,NA
.Thisistheconfigurationfilewherewe ,NA,NA
canaddourdependencies.,NA,NA
Wehaveanewfilenamed,composer.lock,NA
.ThisisafilethatComposerusesinorder ,NA,NA
totrackthedependenciesthathavealreadybeeninstalledandtheirversions.,NA,NA
Wehaveanewdirectorynamed,vendor,NA
.Thisdirectorycontainsthecodeofthe,NA,NA
dependenciesthatComposerdownloaded.,NA,NA
"Theoutputofthecommandalsoshowsussomeextrainformation.Inthiscase,itsaysthat ",NA,NA
"itdownloadedtwolibrariesorpackages,eventhoughweaskedforonlyone.Thereasonis ",NA,NA
thatthepackagethatweneededalsocontainedotherdependenciesthatwereresolvedby ,NA,NA
Composer.AlsonotetheversionthatComposerdownloaded;aswedidnotspecifyany ,NA,NA
"version,Composertookthemostrecentoneavailable,butyoucanalwaystrytowritethe ",NA,NA
specificversionthatyouneed.,NA,NA
"Wewillneedanotherlibrary,inthiscase",twig/twig,NA
.Let’saddittoourdependencieslist ,NA,NA
withthefollowingcommand:,$composerrequiretwig/twig,NA
Thiscommandwillshowthefollowingresult:,"Usingversion^1.23fortwig/twig 
  
 ./composer.jsonhasbeenupdated 
  
 Loadingcomposerrepositorieswithpackageinformation 
 Updatingdependencies(includingrequire-dev)
  
 -Installingtwig/twig(v1.23.1) 
  
 Downloading:100%
  
 Writinglockfile 
  
 Generatingautoloadfiles",NA
Ifwecheckthe,composer.json,NA
"file,wewillseethefollowingcontent:","{ 
  
 ""require"":{ 
  
 ""monolog/monolog"":""^1.17"", 
  
 ""twig/twig"":""^1.23"" 
  
 } 
  
 }",NA
"ThefileisjustaJSONmapthatcontainstheconfigurationofourapplication;inthiscase, ",NA,NA
"thelistofthetwodependenciesthatweinstalled.Asyoucansee,thedependencies’name ",NA,NA
followsapattern:twowordsseparatedbyaslash.Thefirstofthewordsreferstothe ,NA,NA
vendorthatdevelopedthelibrary.Thesecondofthemisthenameofthelibraryitself.The ,NA,NA
"dependencyhasaversion,whichcouldbetheexactversionnumber—asinthiscase—orit ",NA,NA
couldcontainwildcardcharactersortagnames.Youcanreadmoreaboutthisat ,NA,NA
https://getcomposer.org/doc/articles/aliases.md,NA,NA
.,NA,NA
"Finally,ifyouwouldliketoaddanotherdependency,oreditthe",composer.json,NA
filein ,NA,NA
"anyotherway,youshouldrun",composerupdate,NA
"inyourcommandline,orwhereverthe ",composer.json,NA
"fileis,inordertoupdatethedependencies.",NA,NA
AutoloaderwithPSR-4,NA,NA
"Inthepreviouschapters,wealsoaddedanautoloadertoourapplication.Aswearenow ",NA,NA
"usingsomeoneelse’scode,weneedtoknowhowtoloadtheirclassestoo.Soon, ",NA,NA
developersrealizedthatthisscenariowithoutastandardwouldbevirtuallyimpossibleto ,NA,NA
"manage,andtheycameoutwithsomestandardsthatmostdevelopersfollow.Youcanfind ",NA,NA
alotofinformationonthistopicat,NA,NA
http://www.php-fig.org,NA,NA
.,NA,NA
"Nowadays,PHPhastwomainstandardsforautoloading:",NA,NA
PSR-0,NA,NA
and,NA,NA
PSR-4,NA,NA
.Theyare ,NA,NA
"verysimilar,butwewillbeimplementingthelatter,asitisthemostrecentstandard ",NA,NA
published.Thisstandardbasicallyfollowswhatwe’vealreadyintroducedwhentalking ,NA,NA
"aboutnamespaces:thenamespaceofaclassmustbethesameasthedirectorywhereitis, ",NA,NA
"andthenameoftheclassshouldbethenameofthefile,followedbytheextension",.php,NA
.,NA,NA
"Forexample,thefilein",src/Domain/Book.php,NA
containstheclass,Book,NA
insidethe ,NA,NA
namespace,Bookstore\Domain,NA
.,NA,NA
"ApplicationsusingComposershouldfollowoneofthosestandards,andtheyshouldnote ",NA,NA
intheirrespective,composer.json,NA
filewhichonetheyareusing.Thismeansthat ,NA,NA
"Composerknowshowtoautoloaditsownapplicationfiles,sowewillnotneedtotake ",NA,NA
"careofitwhenwedownloadexternallibraries.Tospecifythat,weeditour ",composer.json,NA
"file,andaddthefollowingcontent:","{ 
  
 ""require"":{ 
  
 ""monolog/monolog"":""^1.17"", 
  
 ""twig/twig"":""^1.23"" 
  
 }, 
  
 ""autoload"":{ 
  
 ""psr-4"":{ 
  
 ""Bookstore\\"":""src"" 
  
 } 
  
 } 
  
 }",NA
"TheprecedingcodemeansthatwewillusePSR-4inourapplication,andthatallthe ",NA,NA
namespacesthatstartwith,Bookstore,NA
shouldbefoundinsidethe,src/,NA
directory.Thisis ,NA,NA
"exactlywhatourautoloaderwasdoingalready,butreducedtoacoupleoflinesina ",NA,NA
configurationfile.Wecansafelyremoveourautoloaderandanyreferencetoitnow.,NA,NA
Composergeneratessomemappingsthathelptospeeduptheloadingofclasses.Inorder ,NA,NA
"toupdatethosemapswiththenewinformationaddedtotheconfigurationfile,weneedto ",NA,NA
runthe,composerupdate,NA
"commandthatweranearlier.Thistime,theoutputwilltellus ",NA,NA
"thatthereisnopackagetoupdate,buttheautoloadfileswillbegeneratedagain:","$composerupdate 
  
 Loadingcomposerrepositorieswithpackageinformation 
 Updatingdependencies(includingrequire-dev) 
  
 Nothingtoinstallorupdate 
  
 Writinglockfile 
  
 Generatingautoloadfiles",NA
Addingmetadata,NA,NA
"Inordertoknowwheretofindthelibrariesthatyoudefineasdependencies,Composer ",NA,NA
"keepsarepositoryofpackagesandversions,knownas",NA,NA
Packagist,NA,NA
.Thisrepositorykeepsa ,NA,NA
"lotofusefulinformationfordevelopers,suchasalltheversionsavailableforagiven ",NA,NA
"package,theauthors,somedescriptionofwhatthepackagedoes(orawebsitepointingto ",NA,NA
"thatinformation),andthedependenciesthatthispackagewilldownload.Youcanalso ",NA,NA
"browsethepackages,searchingbynameorcategories.",NA,NA
ButhowdoesPackagistknowaboutthis?Itisallthankstothe,composer.json,NA
fileitself.,NA,NA
"Inthere,youcandefineallthemetadataofyourapplicationinaformatthatComposer ",NA,NA
understands.Let’sseeanexample.Addthefollowingcontenttoyour,composer.json,NA
file:,"{ 
  
 ""name"":""picahielos/bookstore"", 
  
 ""description"":""Managesanonlinebookstore."", ""minimum-stability"":""stable"", 
  
 ""license"":""Apache-2.0"", 
  
 ""type"":""project"", 
  
 ""authors"":[ 
  
 { 
  
 ""name"":""AntonioLopez"", 
  
 ""email"":""antonio.lopez.zapata@gmail.com"" } 
  
 ], 
  
 //...
  
 }",NA
TheconfigurationfilenowcontainsthenameofthepackagefollowingtheComposer ,NA,NA
"convention:vendorname,slash,andthepackagename—inthiscase, ",picahielos/bookstore,NA
".Wealsoaddadescription,license,authors,andothermetadata.If ",NA,NA
"youhaveyourcodeinapubicrepositorysuchasGitHub,addingthis",composer.json,NA
file ,NA,NA
willallowyoutogotoPackagistandinserttheURLofyourrepository.Packagistwilladd ,NA,NA
"yourcodeasanewpackage,extractingtheinfofromyour",composer.json,NA
file.Itwill ,NA,NA
showtheavailableversionsbasedonyourtagsorbranches.Inordertolearnmoreabout ,NA,NA
"it,weencourageyoutovisittheofficialdocumentationat",NA,NA
https://getcomposer.org/doc/0,NA,NA
4-schema.md,NA,NA
.,NA,NA
Theindex.phpfile,NA,NA
"InMVCapplications,weusuallyhaveonefilethatgetsalltherequests,androutesthem ",NA,NA
tothespecificcontrollerdependingontheURL.Thislogiccangenerallybefoundinthe ,index.php,NA
"fileinourrootdirectory.Wealreadyhaveone,butasweareadaptingour ",NA,NA
"featurestotheMVCpattern,wewillnotneedthecurrent",index.php,NA
"anymore.Hence,you ",NA,NA
cansafelyreplaceitwiththefollowing:,"<?php
  
 require_once__DIR__.'/vendor/autoload.php';",NA
Theonlythingthatthisfilewilldonowisincludethefilethathandlesalltheautoloading ,NA,NA
"fromtheComposercode.Later,wewillinitializeeverythinghere,suchasdatabase ",NA,NA
"connections,configurationreaders,andsoon,butrightnow,let’sleaveitempty.",NA,NA
Workingwithrequests,NA,NA
"Asyoumightrecallfrompreviouschapters,themainpurposeofawebapplicationisto ",NA,NA
processHTTPrequestscomingfromtheclientandreturnaresponse.Ifthatisthemain ,NA,NA
"goalofyourapplication,managingrequestsandresponsesshouldbeanimportantpartof ",NA,NA
yourcode.,NA,NA
"PHPisalanguagethatcanbeusedforscripts,butitsmainusageisinwebapplications.",NA,NA
"Duetothis,thelanguagecomesreadywithalotofhelpersformanagingrequestsand ",NA,NA
"responses.Still,thenativewayisnotideal,andasgoodOOPdevelopers,weshouldcome ",NA,NA
upwithasetofclassesthathelpwiththat.Themainelementsforthissmallproject—still ,NA,NA
insideyourapplication—aretherequestandtherouter.Let’sstart!,NA,NA
Therequestobject,NA,NA
"Aswestartourminiframework,weneedtochangeourdirectorystructureabit.Wewill ",NA,NA
createthe,src/Core,NA
directoryforalltheclassesrelatedtotheframework.Asthe ,NA,NA
configurationreaderfromthepreviouschaptersisalsopartoftheframework(rathertha,NA,NA
"n functionalityfortheuser),weshouldmovethe",Config.php,NA
filetothisdirectorytoo.,NA,NA
Thefirstthingtoconsideriswhatarequestlookslike.Ifyouremember,NA,NA
Chapter2,NA,NA
",",NA,NA
Web ,NA,NA
ApplicationswithPHP,NA,NA
",arequestisbasicallyamessagethatgoestoaURL,andhasa ",NA,NA
method—GETorPOSTfornow.TheURLisatthesametimecomposedoftwoparts:the ,NA,NA
"domainofthewebapplication,thatis,thenameofyourserver,andthepathoftherequest ",NA,NA
"insidetheserver.Forexample,ifyoutrytoaccess",http://bookstore.com/my-books,NA
",the ",NA,NA
"firstpart,",http://bookstore.com,NA
",wouldbethedomainand",/my-books,NA
wouldbethepath. ,NA,NA
"Infact,",http,NA
"wouldnotbepartofthedomain,butwedonotneedthatlevelofgranularity ",NA,NA
forourapplication.Youcangetthisinformationfromtheglobalarray,$_SERVER,NA
thatPHP ,NA,NA
populatesforeachrequest.,NA,NA
Our,Request,NA
"classshouldhaveapropertyforeachofthosethreeelements,followedbya ",NA,NA
"setofgettersandsomeotherhelpersthatwillbeusefulfortheuser.Also,weshould ",NA,NA
initializeallthepropertiesfrom,$_SERVER,NA
intheconstructor.Let’sseewhatitwouldlook ,NA,NA
like:,"<?php
  
 namespaceBookstore\Core;
  
 classRequest{ 
  
 constGET='GET'; 
  
 constPOST='POST';
  
 private$domain; 
  
 private$path; 
  
 private$method;
  
 publicfunction__construct(){ 
  
 $this->domain=$_SERVER['HTTP_HOST']; $this-
 >path=$_SERVER['REQUEST_URI']; $this-
 >method=$_SERVER['REQUEST_METHOD']; }
  
 publicfunctiongetUrl():string{ 
  
 return$this->domain.$this->path; }
  
 publicfunctiongetDomain():string{ return$this->domain; 
  
 }
  
 publicfunctiongetPath():string{ return$this->path; 
  
 }",NA
"Wecanseeintheprecedingcodethatotherthanthegettersforeachproperty,weadded ",NA,NA
themethods,getUrl,NA
",",isPost,NA
",and",isGet,NA
.Theusercouldfindthesameinformationusing ,NA,NA
"thealreadyexistinggetters,butastheywillbeneededalot,itisalwaysgoodtomakeit ",NA,NA
easierfortheuser.Alsonotethatthepropertiesarecomingfromthevaluesofthe ,$_SERVER,NA
array:,HTTP_HOST,NA
",",REQUEST_URI,NA
",and",REQUEST_METHOD,NA
.,NA,NA
Filteringparametersfromrequests,NA,NA
"Anotherimportantpartofarequestistheinformationthatcomesfromtheuser,thatis,the ",NA,NA
"GETandPOSTparameters,andthecookies.Aswiththe",$_SERVER,NA
"globalarray,this ",NA,NA
informationcomesfrom,$_POST,NA
",",$_GET,NA
",and",$_COOKIE,NA
",butitisalwaysgoodtoavoid ",NA,NA
"usingthemdirectly,withoutfiltering,astheusercouldsendmaliciouscode.",NA,NA
Wewillnowimplementaclassthatwillrepresentamap—key-valuepairs—thatcanbe ,NA,NA
filtered.Wewillcallit,FilteredMap,NA
",andwillincludeitinournamespace, ",Bookstore\Core,NA
.WewilluseittocontaintheparametersGETandPOSTandthecookies ,NA,NA
astwonewpropertiesinour,Request,NA
"class.Themapwillcontainonlyoneproperty,the ",NA,NA
"arrayofdata,andwillhavesomemethodstofetchinformationfromit.Toconstructthe ",NA,NA
"object,weneedtosendthearrayofdataasanargumenttotheconstructor:","<?php
  
 namespaceBookstore\Core;
  
 classFilteredMap{ 
  
 private$map;
  
 publicfunction__construct(array$baseMap){ $this->map=$baseMap; 
  
 }
  
 publicfunctionhas(string$name):bool{ returnisset($this-
 >map[$name]); 
  
 }
  
 publicfunctionget(string$name){ return$this-
 >map[$name]??null; } 
  
 }",NA
Thisclassdoesnotdomuchsofar.Wecouldhavethesamefunctionalitywithanormal ,NA,NA
array.Theutilityofthisclasscomeswhenweaddfilterswhilefetchingdata.Wewill ,NA,NA
"implementthreefilters,butyoucanaddasmanyasyouneed:","publicfunctiongetInt(string$name){ return(int)$this-
 >get($name); }
  
 publicfunctiongetNumber(string$name){ 
 return(float)$this->get($name); }
  
 publicfunctiongetString(string$name,bool$filter=true){ $value=(string)$this-
 >get($name); 
  
 return$filter?addslashes($value):$value; 
  
 }",NA
Thesethreemethodsintheprecedingcodeallowtheusertogetparametersofaspecific ,NA,NA
type.Let’ssaythatthedeveloperneedstogettheIDofthebookfromtherequest.The,NA,NA
bestoptionistousethe,getInt,NA
methodtomakesurethatthereturnedvalueisavalid ,NA,NA
"integer,andnotsomemaliciouscodethatcanmessupourdatabase.Alsonotethe ",NA,NA
function,getString,NA
",whereweusethe",addSlashed,NA
method.Thismethodaddsslashesto ,NA,NA
"someofthesuspiciouscharacters,suchasslashesorquotes,tryingtopreventmalicious ",NA,NA
codewithit.,NA,NA
NowwearereadytogettheGETandPOSTparametersaswellasthecookiesfromour ,Request,NA
classusingour,FilteredMap,NA
.Thenewcodewouldlooklikethefollowing:,"<?php
  
 namespaceBookstore\Core;
  
 classRequest{ 
  
 //...
  
 private$params; 
  
 private$cookies;
  
 publicfunction__construct(){ 
  
 $this->domain=$_SERVER['HTTP_HOST']; 
  
 $this->path=explode('?',$_SERVER['REQUEST_URI'])[0]; $this-
 >method=$_SERVER['REQUEST_METHOD']; 
  
 $this->params=newFilteredMap( 
  
 array_merge($_POST,$_GET) 
  
 ); 
  
 $this->cookies=newFilteredMap($_COOKIE); 
  
 }
  
 //...
  
 publicfunctiongetParams():FilteredMap{ return$this-
 >params; 
  
 }
  
 publicfunctiongetCookies():FilteredMap{ return$this-
 >cookies; 
  
 } 
  
 }",NA
"Withthisnewaddition,adevelopercouldgetthePOSTparameter",price,NA
withthe ,NA,NA
followinglineofcode:,$price=$request->getParams()->getNumber('price');,NA
Thisiswaysaferthantheusualcalltotheglobalarray:,$price=$_POST['price'];,NA
Mappingroutestocontrollers,NA,NA
"IfyoucanrecallfromanyURLthatyouusedaily,youwillprobablynotseeanyPHPfile ",NA,NA
"aspartofthepath,likewehavewith",http://localhost:8000/init.php,NA
.Websitestryto ,NA,NA
formattheirURLstomakethemeasiertorememberinsteadofdependingonthefilethat ,NA,NA
"shouldhandlethatrequest.Also,aswe’vealreadymentioned,allourrequestsgothrough ",NA,NA
"thesamefile,",index.php,NA
",regardlessoftheirpath.Becauseofthis,weneedtokeepamap ",NA,NA
"oftheURLpaths,andwhoshouldhandlethem.",NA,NA
"Sometimes,wehaveURLsthatcontainparametersaspartoftheirpath,whichisdifferent ",NA,NA
"fromwhentheycontaintheGETorPOSTparameters.Forexample,togetthepagethat ",NA,NA
"showsaspecificbook,wemightincludetheIDofthebookaspartoftheURL,suchas ",/book/12,NA
or,/book/3,NA
".TheIDwillchangeforeachdifferentbook,butthesamecontroller ",NA,NA
"shouldhandlealloftheserequests.Toachievethis,wesaythattheURLcontainsan ",NA,NA
"argument,andwecouldrepresentitby",/book/:id,NA
",where",id,NA
istheargumentthat ,NA,NA
"identifiestheIDofthebook.Optionally,wecouldspecifythekindofvaluethisargument ",NA,NA
"cantake,forexample,number,string,andsoon.",NA,NA
"Controllers,theonesinchargeofprocessingrequests,aredefinedbyamethod’sclass. ",NA,NA
"ThismethodtakesasargumentsalltheargumentsthattheURL’spathdefines,suchasthe ",NA,NA
"IDofthebook.Wegroupcontrollersbytheirfunctionality,thatis,a",BookController,NA
classwillcontainthemethodsrelatedtorequestsaboutbooks.,NA,NA
Havingdefinedalltheelementsofaroute—aURL-controllerrelationship—weareready ,NA,NA
tocreateour,routes.json,NA
"file,aconfigurationfilethatwillkeepthismap.Eachentryof ",NA,NA
"thisfileshouldcontainaroute,thekeybeingtheURL,andthevalue,amapof ",NA,NA
informationaboutthecontroller.Let’sseeanexample:,"{ 
  
 ""books/:page"":{ 
  
 ""controller"":""Book"", 
  
 ""method"":""getAllWithPage"", 
  
 ""params"":{ 
  
 ""page"":""number"" 
  
 } 
  
 } 
  
 }",NA
TherouteintheprecedingexamplereferstoalltheURLsthatfollowthepattern ,/books/:page,NA
",with",page,NA
"beinganynumber.Thus,thisroutewillmatchURLssuchas ",/books/23,NA
or,/books/2,NA
",butitshouldnotmatch",/books/one,NA
or,/books,NA
.Thecontroller ,NA,NA
thatwillhandlethisrequestshouldbethe,getAllWithPage,NA
methodfrom,BookController,NA
; ,NA,NA
wewillappend,Controller,NA
"toalltheclassnames.Giventheparametersthatwedefined, ",NA,NA
thedefinitionofthemethodshouldbesomethinglikethefollowing:,"publicfunctiongetAllWithPage(int$page):string{ //...
  
 }",NA
"Thereisonelastthingweshouldconsiderwhendefiningaroute.Forsomeendpoints,we",NA,NA
"shouldenforcetheusertobeauthenticated,suchaswhentheuseristryingtoaccesstheir ",NA,NA
"ownsales.Wecoulddefinethisruleinseveralways,butwechosetodoitaspartofthe ",NA,NA
"route,addingtheentry","""login"":true",NA
aspartofthecontroller’sinformation.Withthatin ,NA,NA
"mind,let’saddtherestoftheroutesthatdefinealltheviewsthatweexpecttohave:","{ 
  
 //...
  
 ""books"":{ 
  
 ""controller"":""Book"", 
  
 ""method"":""getAll"" 
  
 }, 
  
 ""book/:id"":{ 
  
 ""controller"":""Book"", 
  
 ""method"":""get"", 
  
 ""params"":{ 
  
 ""id"":""number"" 
  
 } 
  
 }, 
  
 ""books/search"":{ 
  
 ""controller"":""Book"", 
  
 ""method"":""search"" 
  
 }, 
  
 ""login"":{ 
  
 ""controller"":""Customer"", 
  
 ""method"":""login"" 
  
 }, 
  
 ""sales"":{ 
  
 ""controller"":""Sales"", 
  
 ""method"":""getByUser"", 
  
 ""login"":true 
  
 }, 
  
 ""sales/:id"":{ 
  
 ""controller"":""Sales"", 
  
 ""method"":""get"", 
  
 ""login"":true, 
  
 ""params"":{ 
  
 ""id"":""number"" 
  
 } 
  
 }, 
  
 ""my-books"":{ 
  
 ""controller"":""Book"", 
  
 ""method"":""getByUser"", 
  
 ""login"":true 
  
 } 
  
 }",NA
Theseroutesdefineallthepagesweneed;wecangetallthebooksinapaginatedwayor ,NA,NA
"specificbooksbytheirID,wecansearchbooks,listthesalesoftheuser,showaspecific ",NA,NA
"salebyitsID,andlistallthebooksthatacertainuserhasborrowed.However,wearestill ",NA,NA
lackingsomeoftheendpointsthatourapplicationshouldbeabletohandle.Forallthose ,NA,NA
"actionsthataretryingtomodifydataratherthanrequestingit,thatis,borrowingabookor ",NA,NA
"buyingit,weneedtoaddendpointstoo.Addthefollowingtoyour",routes.json,NA
file:,{,NA
Therouter,NA,NA
Therouterwillbebyfarthemostcomplicatedpieceofcodeinourapplication.Themain ,NA,NA
goalistoreceivea,Request,NA
"object,decidewhichcontrollershouldhandleit,invokeit ",NA,NA
"withthenecessaryparameters,andreturntheresponsefromthatcontroller.Themaingoa",NA,NA
l ofthissectionistounderstandtheimportanceoftherouterratherthanitsdetailed ,NA,NA
"implementation,butwewilltrytodescribeeachofitsparts.Copythefollowingcontentas ",NA,NA
your,src/Core/Router.php,NA
file:,"<?php
  
 namespaceBookstore\Core;
  
 useBookstore\Controllers\ErrorController; 
 useBookstore\Controllers\CustomerController;
  
 classRouter{ 
  
 private$routeMap; 
  
 privatestatic$regexPatters=[ 
  
 'number'=>'\d+', 
  
 'string'=>'\w' 
  
 ];
  
 publicfunction__construct(){ 
  
 $json=file_get_contents( 
  
 __DIR__.'/../../config/routes.json' ); 
  
 $this->routeMap=json_decode($json,true); }
  
 publicfunctionroute(Request$request):string{ $path=$request->getPath();
  
 foreach($this->routeMapas$route=>$info){ 
  
 $regexRoute=$this->getRegexRoute($route,$info); 
 if(preg_match(""@^/$regexRoute$@"",$path)){ return$this->executeController( 
  
 $route,$path,$info,$request 
  
 ); 
  
 } 
  
 }
  
 $errorController=newErrorController($request); return$errorController-
 >notFound(); 
  
 } 
  
 }",NA
Theconstructorofthisclassreadsfromthe,routes.json,NA
"file,andstoresthecontentasan ",NA,NA
"array.Itsmainmethod,",route,NA
",takesa",Request,NA
"objectandreturnsastring,whichiswhat ",NA,NA
"wewillsendasoutputtotheclient.Thismethoditeratesalltheroutesfromthearray, ",NA,NA
"tryingtomatcheachwiththepathofthegivenrequest.Onceitfindsone,ittriesto ",NA,NA
executethecontrollerrelatedtothatroute.Ifnoneoftheroutesareagoodmatchtothe ,NA,NA
"request,therouterwillexecutethe",notFound,NA
methodofthe,ErrorController,NA
",whichwill",NA,NA
thenreturnanerrorpage.,NA,NA
URLsmatchingwithregularexpressions,NA,NA
"WhilematchingaURLwiththeroute,weneedtotakecareoftheargumentsfordynamic ",NA,NA
"URLs,astheydonotletusperformasimplestringcomparison.PHP—andother ",NA,NA
languages—hasaverystrongtoolforperformingstringcomparisonswithdynamic ,NA,NA
"content:regularexpressions.Beinganexpertinregularexpressionstakestime,anditis ",NA,NA
"outsidethescopeofthisbook,butwewillgiveyouabriefintroductiontothem.",NA,NA
Aregularexpressionisastringthatcontainssomewildcardcharactersthatwillmatchthe ,NA,NA
dynamiccontent.Someofthemostimportantonesareasfollows:,^,NA
:Thisisusedtospecifythatthematchingpartshouldbethestartofthewholestring ,$,NA
:Thisisusedtospecifythatthematchingpartshouldbetheendofthewholestring ,\d,NA
:Thisisusedtomatchadigit ,\w,NA
:Thisisusedtomatchaword,+,NA
":Thisisusedforfollowingacharacterorexpression,toletthatcharacteror ",NA,NA
expressiontoappearatleastonceormanytimes ,*,NA
":Thisisusedforfollowingacharacterorexpression,toletthatcharacteror ",NA,NA
expressiontoappearzeroormanytimes ,.,NA
:Thisisusedtomatchanysinglecharacter,NA,NA
Let’sseesomeexamples:,NA,NA
Thepattern,.*,NA
"willmatchanything,evenanemptystring ",NA,NA
Thepattern,.+,NA
willmatchanythingthatcontainsatleastonecharacter ,NA,NA
Thepattern,^\d+$,NA
willmatchanynumberthathasatleastonedigit,NA,NA
"InPHP,wehavedifferentfunctionstoworkwithregularexpressions.Theeasiestofthem, ",NA,NA
"andtheonethatwewilluse,is",pregmatch,NA
.Thisfunctiontakesapatternasitsfirst ,NA,NA
"argument(delimitedbytwocharacters,usually",@,NA
or,/,NA
"),thestringthatwearetryingto ",NA,NA
"matchasthesecondargument,andoptionally,anarraywherePHPstorestheoccurrences ",NA,NA
"found.ThefunctionreturnsaBooleanvalue,being",true,NA
"iftherewasamatch,",false,NA
otherwise.Weuseitasfollowsinour,Route,NA
class:,"preg_match(""@^/$regexRoute$@"",$path)",NA
The,$path,NA
"variablecontainsthepathoftherequest,forexample,",/books/2,NA
.Wematch ,NA,NA
usingapatternthatisdelimitedby,@,NA
",hasthe",^,NA
and,$,NA
wildcardstoforcethepatternto ,NA,NA
"matchthewholestring,andcontainstheconcatenationof",/,NA
andthevariable,$regexRoute,NA
.,NA,NA
Thecontentofthisvariableisgivenbythefollowingmethod;addthisaswelltoyour ,Router,NA
class:,"privatefunctiongetRegexRoute( 
  
 string$route, 
  
 array$info 
  
 ):string{ 
  
 if(isset($info['params'])){ 
  
 foreach($info['params']as$name=>$type){ $route=str_replace(",NA
Theprecedingmethoditeratestheparameterslistcomingfromtheinformationofthe ,NA,NA
"route.Foreachparameter,thefunctionreplacesthenameoftheparameterinsidetheroute ",NA,NA
"bythewildcardcharactercorrespondingtothetypeofparameter—checkthestaticarray, ",$regexPatterns,NA
".Toillustratetheusageofthisfunction,let’sseesomeexamples:",NA,NA
Theroute,/books,NA
"willbereturnedwithoutachange,asitdoesnotcontainany ",NA,NA
argument ,NA,NA
Theroute,books/:id/borrow,NA
willbechangedto,books/\d+/borrow,NA
",astheURL ",NA,NA
"argument,",id,NA
",isanumber",NA,NA
ExtractingtheargumentsoftheURL,NA,NA
"Inordertoexecutethecontroller,weneedthreepiecesofdata:thenameoftheclassto ",NA,NA
"instantiate,thenameofthemethodtoexecute,andtheargumentsthatthemethodneedsto ",NA,NA
receive.Wealreadyhavethefirsttwoaspartoftheroute,$info,NA
"array,solet’sfocusour ",NA,NA
effortsonfindingthethirdone.Addthefollowingmethodtothe,Router,NA
class:,"privatefunctionextractParams( 
  
 string$route, 
  
 string$path 
  
 ):array{ 
  
 $params=[];
  
 $pathParts=explode('/',$path); 
 $routeParts=explode('/',$route);
  
 foreach($routePartsas$key=>$routePart){ 
 if(strpos($routePart,':')===0){ 
  
 $name=substr($routePart,1); 
  
 $params[$name]=$pathParts[$key+1]; } 
  
 }
  
 return$params; 
  
 }",NA
ThislastmethodexpectsthatboththepathoftherequestandtheURLoftheroutefollow ,NA,NA
thesamepattern.Withthe,explode,NA
"method,wegettwoarraysthatshouldmatcheachof ",NA,NA
"theirentries.Weiteratethem,andforeachentryintheroutearraythatlookslikea ",NA,NA
"parameter,wefetchitsvalueintheURL.Forexample,ifwehadtheroute ",/books/:id/borrow,NA
andthepath,/books/12/borrow,NA
",theresultofthismethodwouldbe ",NA,NA
thearray,NA,NA
[‘id’=>12],NA,NA
.,NA,NA
Executingthecontroller,NA,NA
Weendthissectionbyimplementingthemethodthatexecutesthecontrollerinchargeofa,NA,NA
"givenroute.Wealreadyhavethenameoftheclass,themethod,andtheargumentsthatthe ",NA,NA
"methodneeds,sowecouldmakeuseofthe",call_user_func_array,NA
"nativefunctionthat, ",NA,NA
"givenanobject,amethodname,andtheargumentsforthemethod,invokesthemethodof ",NA,NA
theobjectpassingthearguments.Wehavetomakeuseofitasthenumberofargumentsis ,NA,NA
"notfixed,andwecannotperformanormalinvocation.",NA,NA
Butwearestillmissingabehaviorintroducedwhencreatingour,routes.json,NA
file.There ,NA,NA
"aresomeroutesthatforcetheusertobeloggedin,which,inourcase,meansthattheuser ",NA,NA
"hasacookiewiththeuserID.Givenaroutethatenforcesauthorization,wewillcheck ",NA,NA
"whetherourrequestcontainsthecookie,inwhichcasewewillsetittothecontrollerclass ",NA,NA
through,setCustomerId,NA
".Iftheuserdoesnothaveacookie,insteadofexecutingthe ",NA,NA
"controllerforthecurrentroute,wewillexecutethe",showLogin,NA
methodofthe ,CustomerController,NA
"class,whichwillrenderthetemplatefortheloginform.Let’ssee ",NA,NA
howeverythingwouldlookonaddingthelastmethodofour,Router,NA
class:,"privatefunctionexecuteController( 
  
 string$route, 
  
 string$path, 
  
 array$info, 
  
 Request$request 
  
 ):string{ 
  
 $controllerName='\Bookstore\Controllers\\' 
 .$info['controller'].'Controller'; 
 $controller=new$controllerName($request);
  
 if(isset($info['login'])&&$info['login']){ 
  
 if($request->getCookies()->has('user')){ 
  
 $customerId=$request->getCookies()->get('user'); $controller-
 >setCustomerId($customerId); 
  
 }else{ 
  
 $errorController=newCustomerController($request); return$errorController->login(); 
  
 } 
  
 }
  
 $params=$this->extractParams($route,$path); 
 returncall_user_func_array( 
  
 [$controller,$info['method']],$params ); 
  
 }",NA
"Wehavealreadywarnedyouaboutthelackofsecurityinourapplication,asthisisjusta ",NA,NA
"projectwithdidacticpurposes.So,avoidcopyingtheauthorizationsystemimplemented ",NA,NA
here.,NA,NA
Mformodel,NA,NA
"Imagineforamomentthatourbookstorewebsiteisquitesuccessful,sowethinkof ",NA,NA
"buildingamobileapptoincreaseourmarket.Ofcourse,wewouldwanttousethesame ",NA,NA
"databasethatweuseforourwebsite,asweneedtosyncthebooksthatpeopleborrowor ",NA,NA
buyfrombothapps.Wedonotwanttobeinapositionwheretwopeoplebuythesame ,NA,NA
lastcopyofabook!,NA,NA
"Notonlythedatabase,butthequeriesusedtogetbooks,updatethem,andsoon,haveto ",NA,NA
"bethesametoo,otherwisewewouldendupwithunexpectedbehavior.Ofcourse,one ",NA,NA
"apparentlyeasyoptionwouldbetoreplicatethequeriesinbothcodebases,butthathasa ",NA,NA
hugemaintainabilityproblem.Whatifwechangeonesinglefieldofourdatabase?We ,NA,NA
needtoapplythesamechangetoatleasttwodifferentcodebases.Thatdoesnotseemto ,NA,NA
beusefulatall.,NA,NA
Businesslogicplaysanimportantroleheretoo.Thinkofitasdecisionsyouneedtotake ,NA,NA
"thataffectyourbusiness.Inourcase,thatapremiumcustomerisabletoborrow10books ",NA,NA
"andanormaloneonly3,isbusinesslogic.Thislogicshouldbeputinacommonplace ",NA,NA
"too,because,ifwewanttochangeit,wewillhavethesameproblemsaswithourdatabase ",NA,NA
queries.,NA,NA
Wehopethatbynowwe’veconvincedyouthatdataandbusinesslogicshouldbe ,NA,NA
separatedfromtherestofthecodeinordertomakeitreusable.Donotworryifitishard ,NA,NA
foryoutodefinewhatshouldgoaspartofthemodeloraspartofthecontroller;alotof ,NA,NA
"peoplestrugglewiththisdistinction.Asourapplicationisverysimple,anditdoesnot ",NA,NA
"havealotofbusinesslogic,wewilljustfocusonaddingallthecoderelatedtoMySQL ",NA,NA
queries.,NA,NA
"Asyoucanimagine,foranapplicationintegratedwithMySQL,oranyotherdatabase ",NA,NA
"system,thedatabaseconnectionisanimportantelementofamodel.WechosetousePDO ",NA,NA
"inordertointeractwithMySQL,andasyoumightremember,instantiatingthatclasswas ",NA,NA
abitofapain.Let’screateasingletonclassthatreturnsaninstanceof,PDO,NA
tomakethings ,NA,NA
easier.Addthiscodeto,src/Core/Db.php,NA
:,"<?php
  
 namespaceBookstore\Core;
  
 usePDO;
  
 classDb{ 
  
 privatestatic$instance;
  
 privatestaticfunctionconnect():PDO{ 
  
 $dbConfig=Config::getInstance()->get('db'); returnnewPDO( 
  
 'mysql:host=127.0.0.1;dbname=bookstore', $dbConfig['user'], 
  
 $dbConfig['password'] 
  
 );",NA
"Thisclass,definedintheprecedingcodesnippet,justimplementsthesingletonpattern ",NA,NA
andwrapsthecreationofa,PDO,NA
"instance.Fromnowon,inordertogetadatabase ",NA,NA
"connection,wejustneedtowrite",Db::getInstance(),NA
.,NA,NA
"Althoughitmightnotbetrueforallmodels,inourapplication,theywillalwayshaveto ",NA,NA
accessthedatabase.Wecouldcreateanabstractclasswhereallmodelsextend.Thisclass ,NA,NA
couldcontaina,$db,NA
"protectedpropertythatwillbesetontheconstructor.Withthis,we ",NA,NA
avoidduplicatingthesameconstructorandpropertydefinitionacrossallourmodels.Copy ,NA,NA
thefollowingclassinto,src/Models/AbstractModel.php,NA
: ,"<?php 
  
 namespaceBookstore\Models; 
  
 usePDO; 
  
 abstractclassAbstractModel{ 
  
 private$db; 
  
 publicfunction__construct(PDO$db){ 
  
 $this->db=$db; 
  
 } 
  
 }",NA
"Finally,tofinishthesetupofthemodels,wecouldcreateanewexception(aswedidwith ",NA,NA
the,NotFoundException,NA
class)thatrepresentsanerrorfromthedatabase.Itwillnot ,NA,NA
"containanycode,butwewillbeabletodifferentiatewhereanexceptioniscomingfrom.",NA,NA
Wewillsaveitin,src/Exceptions/DbException.php,NA
: ,"<?php 
  
 namespaceBookstore\Exceptions; 
  
 useException; 
  
 classDbExceptionextendsException{ 
  
 }",NA
"Nowthatwe’vesettheground,wecanstartwritingourmodels.Itisuptoyoutoorganize ",NA,NA
"yourmodels,butitisagoodideatomimicthedomainobjectsstructure.Inthiscase,we ",NA,NA
wouldhavethreemodels:,CustomerModel,NA
",",BookModel,NA
",and",SalesModel,NA
.Inthefollowing ,NA,NA
"sections,wewillexplainthecontentsofeachofthem.",NA,NA
Thecustomermodel,NA,NA
"Let’sstartwiththeeasiestone.Asourapplicationisstillveryprimitive,wewillnotallow ",NA,NA
"thecreationofnewcostumers,andworkwiththeonesweinsertedmanuallyintothe ",NA,NA
databaseinstead.Thatmeansthattheonlythingweneedtodowithcustomersistoquery ,NA,NA
them.Let’screatea,CustomerModel,NA
classin,src/Models/CustomerModel.php,NA
withthe ,NA,NA
followingcontent:,"<?php
  
 namespaceBookstore\Models;
  
 useBookstore\Domain\Customer; 
  
 useBookstore\Domain\Customer\CustomerFactory; 
 useBookstore\Exceptions\NotFoundException;
  
 classCustomerModelextendsAbstractModel{ 
  
 publicfunctionget(int$userId):Customer{ 
  
 $query='SELECT*FROMcustomerWHEREcustomer_id=:user'; $sth=$this->db->prepare($query); 
  
 $sth->execute(['user'=>$userId]);
  
 $row=$sth->fetch();
  
 if(empty($row)){ 
  
 thrownewNotFoundException(); }
  
 returnCustomerFactory::factory( $row['type'], 
  
 $row['id'], 
  
 $row['firstname'], 
  
 $row['surname'], 
  
 $row['email'] 
  
 ); 
  
 }
  
 publicfunctiongetByEmail(string$email):Customer{ 
 $query='SELECT*FROMcustomerWHEREemail=:user'; $sth=$this->db-
 >prepare($query); 
  
 $sth->execute(['user'=>$email]);
  
 $row=$sth->fetch();
  
 if(empty($row)){ 
  
 thrownewNotFoundException(); }
  
 returnCustomerFactory::factory( $row['type'], 
  
 $row['id'], 
  
 $row['firstname'], 
  
 $row['surname'], 
  
 $row['email']",NA
The,CustomerModel,NA
"class,whichextendsfromthe",AbstractModel,NA
"class,containstwo ",NA,NA
methods;bothofthemreturna,Customer,NA
"instance,oneofthemwhenprovidingtheIDof ",NA,NA
"thecustomer,andtheotheronewhenprovidingthee-mail.Aswealreadyhavethe ",NA,NA
databaseconnectionasthe,$db,NA
"property,wejustneedtopreparethestatementwiththe ",NA,NA
"givenquery,executethestatementwiththearguments,andfetchtheresult.Asweexpect ",NA,NA
"togetacustomer,iftheuserprovidedanIDorane-mailthatdoesnotbelongtoany ",NA,NA
"customer,wewillneedtothrowanexception—inthiscase,a",NotFoundException,NA
isjust ,NA,NA
"fine.Ifwefindacustomer,weuseourfactorytocreatetheobjectandreturnit.",NA,NA
Thebookmodel,NA,NA
Our,BookModel,NA
"classgivesusabitmoreofwork.Customershadafactory,butitisnot ",NA,NA
worthhavingoneforbooks.WhatweuseforcreatingthemfromMySQLrowsisnotthe ,NA,NA
"constructor,butafetchmodethatPDOhas,andthatallowsustomaparowintoan ",NA,NA
"object.Todoso,weneedtoadaptthe",Book,NA
domainobjectabit:,NA,NA
Thenamesofthepropertieshavetobethesameasthenamesofthefieldsinthe ,NA,NA
database ,NA,NA
"Thereisnoneedforaconstructororsetters,unlessweneedthemforotherpurposes ",NA,NA
"Togowithencapsulation,propertiesshouldbeprivate,sowewillneedgettersforall ",NA,NA
ofthem,NA,NA
Thenew,Book,NA
classshouldlooklikethefollowing:,"<?php
  
 namespaceBookstore\Domain;
  
 classBook{ 
  
 private$id; 
  
 private$isbn; 
  
 private$title; 
  
 private$author; 
  
 private$stock; 
  
 private$price;
  
 publicfunctiongetId():int{ 
  
 return$this->id; 
  
 }
  
 publicfunctiongetIsbn():string{ return$this->isbn; 
  
 }
  
 publicfunctiongetTitle():string{ return$this->title; 
  
 }
  
 publicfunctiongetAuthor():string{ return$this->author; 
  
 }
  
 publicfunctiongetStock():int{ 
  
 return$this->stock; 
  
 }
  
 publicfunctiongetCopy():bool{ 
  
 if($this->stock<1){ 
  
 returnfalse; 
  
 }else{ 
  
 $this->stock--; 
  
 returntrue; 
  
 }",NA
Weretainedthe,getCopy,NA
and,addCopy,NA
"methodseventhoughtheyarenotgetters,aswe ",NA,NA
"willneedthemlater.Now,whenfetchingagroupofrowsfromMySQLwiththe",fetchAll,NA
"method,wecansendtwoparameters:theconstant",PDO::FETCH_CLASS,NA
thattellsPDOto ,NA,NA
"maprowstoaclass,andthenameoftheclassthatwewanttomapto.Let’screatethe ",BookModel,NA
classwithasimple,get,NA
methodthatfetchesabookfromthedatabasewitha ,NA,NA
givenID.Thismethodwillreturneithera,Book,NA
objectorthrowanexceptionincasetheID ,NA,NA
doesnotexist.Saveitas,src/Models/BookModel.php,NA
:,"<?php
  
 namespaceBookstore\Models;
  
 useBookstore\Domain\Book; 
  
 useBookstore\Exceptions\DbException; 
  
 useBookstore\Exceptions\NotFoundException; usePDO;
  
 classBookModelextendsAbstractModel{ 
  
 constCLASSNAME='\Bookstore\Domain\Book';
  
 publicfunctionget(int$bookId):Book{ 
  
 $query='SELECT*FROMbookWHEREid=:id'; $sth=$this->db-
 >prepare($query); 
  
 $sth->execute(['id'=>$bookId]);
  
 $books=$sth->fetchAll( 
  
 PDO::FETCH_CLASS,self::CLASSNAME ); 
  
 if(empty($books)){ 
  
 thrownewNotFoundException(); }
  
 return$books[0]; 
  
 } 
  
 }",NA
"Thereareadvantagesanddisadvantagesofusingthisfetchmode.Ononehand,weavoid ",NA,NA
"alotofdullcodewhencreatingobjectsfromrows.Usually,weeitherjustsendallthe ",NA,NA
"elementsoftherowarraytotheconstructoroftheclass,orusesettersforallitsproperties.",NA,NA
"IfweaddmorefieldstotheMySQLtable,wejustneedtoaddthepropertiestoour ",NA,NA
"domainclass,insteadofchangingeverywherewherewewereinstantiatingtheobjects.On ",NA,NA
"theotherhand,youareforcedtousethesamenamesforthefieldsinboththetable’sas",NA,NA
"wellastheclass’properties,whichmeanshighcoupling(alwaysabadidea).Thisalso ",NA,NA
"causessomeconflictswhenfollowingconventions,becauseinMySQL,itiscommonto ",NA,NA
use,book_id,NA
",butinPHP,thepropertyis",$bookId,NA
.,NA,NA
"Nowthatweknowhowthisfetchmodeworks,let’saddthreeothermethodsthatfetch ",NA,NA
datafromMySQL.Addthefollowingcodetoyourmodel:,"publicfunctiongetAll(int$page,int$pageLength):array{ $start=$pageLength*($page-
 1);
  
 $query='SELECT*FROMbookLIMIT:page,:length'; $sth=$this->db-
 >prepare($query); 
  
 $sth->bindParam('page',$start,PDO::PARAM_INT); 
  
 $sth->bindParam('length',$pageLength,PDO::PARAM_INT); $sth->execute();
  
 return$sth->fetchAll(PDO::FETCH_CLASS,self::CLASSNAME); }
  
 publicfunctiongetByUser(int$userId):array{ 
  
 $query=<<<SQL 
  
 SELECTb.* 
  
 FROMborrowed_booksbbLEFTJOINbookbONbb.book_id=b.id 
 WHEREbb.customer_id=:id 
  
 SQL; 
  
 $sth=$this->db->prepare($query); 
  
 $sth->execute(['id'=>$userId]);
  
 return$sth->fetchAll(PDO::FETCH_CLASS,self::CLASSNAME); }
  
 publicfunctionsearch(string$title,string$author):array{ $query=<<<SQL 
  
 SELECT*FROMbook 
  
 WHEREtitleLIKE:titleANDauthorLIKE:author 
  
 SQL; 
  
 $sth=$this->db->prepare($query); 
  
 $sth->bindValue('title',""%$title%""); 
  
 $sth->bindValue('author',""%$author%""); 
  
 $sth->execute();
  
 return$sth->fetchAll(PDO::FETCH_CLASS,self::CLASSNAME); }",NA
Themethodsaddedareasfollows:,getAll,NA
returnsanarrayofallthebooksforagivenpage.Rememberthat,LIMIT,NA
"allowsyoutoreturnaspecificnumberofrowswithanoffset,whichcanworkasa ",NA,NA
paginator.,getByUser,NA
returnsallthebooksthatagivencustomerhasborrowed—wewillneedto ,NA,NA
useajoinqueryforthis.Notethatwereturn,b.*,NA
",thatis,onlythefieldsofthe",book,NA
"table,skippingtherestofthefields.",NA,NA
"Finally,thereisamethodtosearchbyeithertitleorauthor,orboth.Wecandothat ",NA,NA
usingtheoperator,LIKE,NA
andenclosingthepatternswith,%,NA
.Ifwedonotspecifyoneof,NA,NA
"theparameters,wewilltrytomatchthefieldwith",%%,NA
",whichmatcheseverything.",NA,NA
"Sofar,wehavebeenaddingmethodstofetchdata.Let’saddmethodsthatwillallowusto ",NA,NA
"modifythedatainourdatabase.Forthebookmodel,wewillneedtobeabletoborrow ",NA,NA
booksandreturnthem.Hereisthecodeforthosetwoactions:,"publicfunctionborrow(Book$book,int$userId){ 
  
 $query=<<<SQL 
  
 INSERTINTOborrowed_books(book_id,customer_id,start) 
 VALUES(:book,:user,NOW()) 
  
 SQL; 
  
 $sth=$this->db->prepare($query); 
  
 $sth->bindValue('book',$book->getId()); 
  
 $sth->bindValue('user',$userId); 
  
 if(!$sth->execute()){ 
  
 thrownewDbException($sth->errorInfo()[2]); }
  
 $this->updateBookStock($book); 
  
 }
  
 publicfunctionreturnBook(Book$book,int$userId){ 
  
 $query=<<<SQL 
  
 UPDATEborrowed_booksSETend=NOW() 
  
 WHEREbook_id=:bookANDcustomer_id=:userANDendISNULL SQL; 
  
 $sth=$this->db->prepare($query); 
  
 $sth->bindValue('book',$book->getId()); 
  
 $sth->bindValue('user',$userId); 
  
 if(!$sth->execute()){ 
  
 thrownewDbException($sth->errorInfo()[2]); 
  
 }
  
 $this->updateBookStock($book); 
  
 }
  
 privatefunctionupdateBookStock(Book$book){ 
  
 $query='UPDATEbookSETstock=:stockWHEREid=:id'; $sth=$this->db-
 >prepare($query); 
  
 $sth->bindValue('id',$book->getId()); 
  
 $sth->bindValue('stock',$book->getStock()); 
  
 if(!$sth->execute()){ 
  
 thrownewDbException($sth->errorInfo()[2]); 
  
 } 
  
 }",NA
"Whenborrowingabook,youareaddingarowtothe",borrower_books,NA
table.When ,NA,NA
"returningbooks,youdonotwanttoremovethatrow,butrathertosettheenddateinorder ",NA,NA
tokeepahistoryofthebooksthatauserhasbeenborrowing.Bothmethodsneedto ,NA,NA
"changethestockoftheborrowedbook:whenborrowingit,reducingthestockbyone,and ",NA,NA
"whenreturningit,increasingthestock.Thatiswhy,inthelastcodesnippet,wecreateda ",NA,NA
"privatemethodtoupdatethestockofagivenbook,whichwillbeusedfromboththe ",borrow,NA
and,returnBook,NA
methods.,NA,NA
Thesalesmodel,NA,NA
Nowweneedtoaddthelastmodeltoourapplication:the,SalesModel,NA
.Usingthesame ,NA,NA
"fetchmodethatweusedwithbooks,weneedtoadaptthedomainclassaswell.Weneed ",NA,NA
"tothinkabitmoreinthiscase,aswewillbedoingmorethanjustfetching.Our ",NA,NA
"applicationhastobeabletocreatenewsalesondemand,containingtheIDofthe ",NA,NA
"customerandthebooks.Wecanalreadyaddbookswiththecurrentimplementation,but ",NA,NA
weneedtoaddasetterforthecustomerID.TheIDofthesalewillbegivenbythe ,NA,NA
"autoincrementIDinMySQL,sothereisnoneedtoaddasetterforit.Thefinal ",NA,NA
implementationwouldlookasfollows:,"<?php
  
 namespaceBookstore\Domain;
  
 classSale{ 
  
 private$id; 
  
 private$customer_id; 
  
 private$books; 
  
 private$date;
  
 publicfunctionsetCustomerId(int$customerId){ $this-
 >customer_id=$customerId; 
  
 }
  
 publicfunctiongetId():int{ 
  
 return$this->id; 
  
 }
  
 publicfunctiongetCustomerId():int{ return$this-
 >customer_id; 
  
 }
  
 publicfunctiongetBooks():array{ return$this->books; 
  
 }
  
 publicfunctiongetDate():string{ return$this->date; 
  
 }
  
 publicfunctionaddBook(int$bookId,int$amount=1){ if(!isset($this-
 >books[$bookId])){ 
  
 $this->books[$bookId]=0; 
  
 } 
  
 $this->books[$bookId]+=$amount; 
  
 }
  
 publicfunctionsetBooks(array$books){ $this->books=$books; 
  
 } 
  
 }",NA
The,SalesModel,NA
willbethemostdifficultonetowrite.Theproblemwiththismodelis,NA,NA
thatitincludesmanipulatingdifferenttables:,sale,NA
and,sale_book,NA
".Forexample,when ",NA,NA
"gettingtheinformationofasale,weneedtogettheinformationfromthe",sale,NA
"table,and ",NA,NA
thentheinformationofallthebooksinthe,sale_book,NA
table.Youcouldargueabout ,NA,NA
whethertohaveoneuniquemethodthatfetchesallthenecessaryinformationrelatedtoa ,NA,NA
"sale,ortohavetwodifferentmethods,onetofetchthesaleandtheothertofetchthe ",NA,NA
"books,andletthecontrollertodecidewhichonetouse.",NA,NA
"Thisactuallystartsaveryinterestingdiscussion.Ononehand,wewanttomakethings ",NA,NA
easierforthecontroller—havingoneuniquemethodtofetchtheentire,Sale,NA
object.This ,NA,NA
makessenseasthecontrollerdoesnotneedtoknowabouttheinternalimplementationof ,NA,NA
the,Sale,NA
"object,whichlowerscoupling.Ontheotherhand,forcingthemodeltoalways ",NA,NA
"fetchthewholeobject,evenifweonlyneedtheinformationinthe",sale,NA
"table,isabad ",NA,NA
idea.Imagineifthesalecontainsalotofbooks;fetchingthemfromMySQLwilldecrease ,NA,NA
performanceunnecessarily.,NA,NA
Youshouldthinkhowyourcontrollersneedtomanagesales.Ifyouwillalwaysneedthe ,NA,NA
"entireobject,youcanhaveonemethodwithoutbeingconcernedaboutperformance.If ",NA,NA
"youonlyneedtofetchtheentireobjectsometimes,maybeyoucouldaddbothmethods. ",NA,NA
"Forourapplication,wewillhaveonemethodtorulethemall,sincethatiswhatwewill ",NA,NA
alwaysneed.,NA,NA
Note,NA,NA
Lazyloading,NA,NA
"Aswithanyotherdesignchallenge,otherdevelopershavealreadygivenalotofthought ",NA,NA
tothisproblem.Theycameupwithadesignpatternnamed,NA,NA
lazyload,NA,NA
.Thispattern ,NA,NA
basicallyletsthecontrollerthinkthatthereisonlyonemethodtofetchthewholedomain ,NA,NA
"object,butwewillactuallybefetchingonlywhatweneedfromdatabase.",NA,NA
Themodelfetchesthemostusedinformationfortheobjectandleavestherestofthe ,NA,NA
propertiesthatneedextradatabasequeriesempty.Oncethecontrollerusesagetterofa ,NA,NA
"propertythatisempty,themodelautomaticallyfetchesthatdatafromthedatabase.Weget ",NA,NA
"thebestofbothworlds:thereissimplicityforthecontroller,butwedonotspendmore ",NA,NA
timethannecessaryqueryingunuseddata.,NA,NA
Addthefollowingasyour,src/Models/SaleModel.php,NA
file:,"<?php 
  
 namespaceBookstore\Models;
  
 useBookstore\Domain\Sale; 
  
 useBookstore\Exceptions\DbException; 
  
 usePDO;
  
 classSaleModelextendsAbstractModel{ 
  
 constCLASSNAME='\Bookstore\Domain\Sale';
  
 publicfunctiongetByUser(int$userId):array{ 
  
 $query='SELECT*FROMsaleWHEREs.customer_id=:user'; $sth=$this->db->prepare($query);",NA
Anothertrickymethodinthismodelistheonethattakescareofcreatingasaleinthe ,NA,NA
database.Thismethodhastocreateasaleinthe,sale,NA
"table,andthenaddallthebooksfor ",NA,NA
thatsaletothe,sale_book,NA
table.Whatwouldhappenifwehaveaproblemwhenadding ,NA,NA
"oneofthebooks?Wewouldleaveacorruptedsaleinthedatabase.Toavoidthat,weneed ",NA,NA
"tousetransactions,startingwithoneatthebeginningofthemodel’sorthecontroller’s ",NA,NA
"method,andeitherrollingbackincaseoferror,orcommittingitattheendofthemethod.",NA,NA
"Inthesamemethod,wealsoneedtotakecareoftheIDofthesale.WedonotsettheID ",NA,NA
ofthesalewhencreatingthe,sale,NA
"object,becausewerelyontheautoincrementalfieldin ",NA,NA
thedatabase.Butwheninsertingthebooksinto,sale_book,NA
",wedoneedtheIDofthesale.",NA,NA
"Forthat,weneedtorequestthePDOforthelastinsertedIDwiththe",lastInsertId,NA
method.Let’saddthenthe,create,NA
methodintoyour,SaleModel,NA
:,"publicfunctioncreate(Sale$sale){ 
  
 $this->db->beginTransaction();
  
 $query=<<<SQL 
  
 INSERTINTOsale(customer_id,date) 
  
 VALUES(:id,NOW()) 
  
 SQL;",NA
"Onelastthingtonotefromthismethodisthatweprepareastatement,bindavaluetoit ",NA,NA
"(thesaleID),andthenbindandexecutethesamestatementasmanytimesasthebooksin ",NA,NA
"thearray.Onceyouhaveastatement,youcanbindthevaluesasmanytimesasyouwant. ",NA,NA
"Also,youcanexecutethesamestatementasmanytimesasyouwant,andthevaluesstay ",NA,NA
thesame.,NA,NA
Vforview,NA,NA
"Theviewisthelayerthattakescareofthe…view.Inthislayer,youfindallthetemplates ",NA,NA
thatrendertheHTMLthattheusergets.Althoughtheseparationbetweenviewsandthe ,NA,NA
"restoftheapplicationiseasytosee,thatdoesnotmakeviewsaneasypart.Infact,you ",NA,NA
willhavetolearnanewtechnologyinordertowriteviewsproperly.Let’sgetintothe ,NA,NA
details.,NA,NA
IntroductiontoTwig,NA,NA
"Inourfirstattemptatwritingviews,wemixedupPHPandHTMLcode.Wealreadyknow ",NA,NA
"thatthelogicshouldnotbemixedinthesameplaceasHTML,butthatisnottheendof ",NA,NA
"thestory.WhenrenderingHTML,weneedsomelogictheretoo.Forexample,ifwewant ",NA,NA
"toprintalistofbooks,weneedtorepeatacertainblockofHTMLforeachbook.And ",NA,NA
"sinceaprioriwedonotknowthenumberofbookstoprint,thebestoptionwouldbea ",foreach,NA
loop.,NA,NA
Oneoptionthatalotofpeopletakeisminimizingtheamountoflogicthatyoucaninclude ,NA,NA
"inaview.Youcouldsetsomerules,suchas",NA,NA
weshouldonlyincludeconditionalsand ,NA,NA
loops,NA,NA
",whichisareasonableamountoflogicneededtorenderbasicviews.Theproblemis ",NA,NA
"thatthereisnotawayofenforcingthiskindofrule,andotherdeveloperscaneasilystart ",NA,NA
"addingheavylogicinthere.WhilesomepeopleareOKwiththat,assumingthatnoone ",NA,NA
"willdoit,othersprefertoimplementmorerestrictivesystems.Thatwasthebeginningof ",NA,NA
templateengines.,NA,NA
Youcouldthinkofatemplateengineasanotherlanguagethatyouneedtolearn.Why ,NA,NA
wouldyoudothat?Becausethisnew“language”ismorelimitedthanPHP.These ,NA,NA
"languagesusuallyallowyoutoperformconditionalsandsimpleloops,andthatisit.The ",NA,NA
"developerisnotabletoaddPHPtothatfile,sincethetemplateenginewillnottreatitas ",NA,NA
"PHPcode.Instead,itwilljustprintthecodetotheoutput—theresponse’body—asifit ",NA,NA
"wasplaintext.Also,asitisspeciallyorientedtowritetemplates,thesyntaxisusually ",NA,NA
easiertoreadwhenmixedwithHTML.Almosteverythingisanadvantage.,NA,NA
Theinconvenienceofusingatemplateengineisthatittakessometimetotranslatethe ,NA,NA
"newlanguagetoPHP,andthentoHTML.Thiscanbequitetimeconsuming,soitisvery ",NA,NA
importantthatyouchooseagoodtemplateengine.Mostofthemalsoallowyoutocache ,NA,NA
"templates,improvingtheperformance.Ourchoiceisaquitelightandwidelyusedone: ",NA,NA
Twig,NA,NA
".Aswe’vealreadyaddedthedependencyinourComposerfile,wecanuseitstraight ",NA,NA
away.,NA,NA
"SettingupTwigisquiteeasy.OnthePHPside,youjustneedtospecifythelocationofthe ",NA,NA
templates.Acommonconventionistousethe,views,NA
directoryforthat.Createthe ,NA,NA
"directory,andaddthefollowingtwolinesintoyour",index.php,NA
:,"$loader=newTwig_Loader_Filesystem(__DIR__.'/views'); 
 $twig=newTwig_Environment($loader);",NA
Thebookview,NA,NA
"Inthesesections,asweworkwithtemplates,itwouldbenicetoseetheresultofyour ",NA,NA
"work.Wehavenotyetimplementedanycontrollers,sowewillforceour",index.php,NA
to ,NA,NA
"renderaspecifictemplate,regardlessoftherequest.Wecanstartrenderingtheviewofa ",NA,NA
"singlebook.Forthat,let’saddthefollowingcodeattheendofyour",index.php,NA
",after ",NA,NA
creatingyour,twig,NA
object:,"$bookModel=newBookModel(Db::getInstance()); 
 $book=$bookModel->get(1);
  
 $params=['book'=>$book]; 
  
 echo$twig->loadTemplate('book.twig')->render($params);",NA
"Intheprecedingcode,werequestthebookwithID1tothe",BookModel,NA
",getthe",book,NA
"object,andcreateanarraywherethe",book,NA
keyhasthevalueofthe,book,NA
"object.Afterthat, ",NA,NA
wetellTwigtoloadthetemplate,book.twig,NA
andtorenderitbysendingthearray.This ,NA,NA
takesthetemplateandinjectsthe,$book,NA
"object,sothatyouareabletouseitinsidethe ",NA,NA
template.,NA,NA
Let’snowcreateourfirsttemplate.Writethefollowingcodeinto,view/book.twig,NA
.By ,NA,NA
"convention,allTwigtemplatesshouldhavethe",.twig,NA
extension:,"<h2>{{book.title}}</h2> 
  
 <h3>{{book.author}}</h3>
  
 <hr>
  
 <p> 
  
 <strong>ISBN</strong>{{book.isbn}} 
  
 </p> 
  
 <p> 
  
 <strong>Stock</strong>{{book.stock}} 
  
 </p> 
  
 <p> 
  
 <strong>Price</strong>{{book.price|number_format(2)}}€</p>
  
 <hr>
  
 <h3>Actions</h3>
  
 <formmethod=""post""action=""/book/{{book.id}}/borrow""> 
 <inputtype=""submit""value=""Borrow""> 
  
 </form>
  
 <formmethod=""post""action=""/book/{{book.id}}/buy""> 
 <inputtype=""submit""value=""Buy""> 
  
 </form>",NA
"SincethisisyourfirstTwigtemplate,let’sgostepbystep.Youcanseethatmostofthe ",NA,NA
"contentisHTML:someheaders,acoupleofparagraphs,andtwoformswithtwobuttons. ",NA,NA
"YoucanrecognizetheTwigpart,sinceitisenclosedby",{{}},NA
".InTwig,everythingthatis",NA,NA
betweenthosecurlybracketswillbeprintedout.Thefirstonethatwefindcontains ,book.title,NA
.Doyourememberthatweinjectedthe,book,NA
objectwhenrenderingthe ,NA,NA
"template?Wecanaccessithere,justnotwiththeusualPHPsyntax.Toaccessanobject’s ",NA,NA
"property,use",.,NA
insteadof,->,NA
".So,this",book.title,NA
willreturnthevalueofthe,title,NA
propertyofthe,book,NA
"object,andthe",{{}},NA
willmakeTwigprintitout.Thesameappliesto ,NA,NA
therestofthetemplate.,NA,NA
Thereisonethatdoesabitmorethanjustaccessanobject’sproperty.The ,book.price|number_format(2),NA
getsthepriceofthebookandsendsitasanargument ,NA,NA
(usingthepipesymbol)tothefunction,number_format,NA
",whichhasalreadygot",2,NA
asanother ,NA,NA
"argument.Thisbitofcodebasicallyformatsthepricetotwodigitalfigures.InTwig,you ",NA,NA
"alsohavesomefunctions,buttheyaremostlyreducedtoformattingtheoutput,whichis ",NA,NA
anacceptableamountoflogic.,NA,NA
Areyouconvincednowabouthowcleanitistouseatemplateengineforyourviews? ,NA,NA
"Youcantryitinyourbrowser:accessinganypath,yourwebservershouldexecutethe ",index.php,NA
"file,forcingthetemplate",book.twig,NA
toberendered.,NA,NA
Layoutsandblocks,NA,NA
"Whenyoudesignyourwebapplication,usuallyyouwouldwanttoshareacommonlayout ",NA,NA
"acrossmostofyourviews.Inourcase,wewanttoalwayshaveamenuatthetopofthe ",NA,NA
"viewthatallowsustogotothedifferentsectionsofthewebsite,oreventosearchbooks ",NA,NA
"fromwherevertheuseris.Aswithmodels,wewanttoavoidcodeduplication,sinceifwe ",NA,NA
"weretocopyandpastethelayouteverywhere,updatingitwouldbeanightmare.Instead, ",NA,NA
Twigcomeswiththeabilitytodefinelayouts.,NA,NA
A,NA,NA
layout,NA,NA
inTwigisjustanothertemplatefile.ItscontentisjustthecommonHTMLcode ,NA,NA
"thatwewanttodisplayacrossallviews(inourcase,themenuandsearchbar),and ",NA,NA
"containssometaggedgaps(blocksinTwig’sworld),whereyouwillbeabletoinjectthe ",NA,NA
specificHTMLofeachview.Youcandefineoneofthoseblockswiththetag,"{%block 
 %}",NA
.Let’sseewhatour,views/layout.twig,NA
filewouldlooklike:,"<html> 
  
 <head> 
  
 <title>{%blocktitle%}{%endblock%}</title> 
 </head> 
  
 <body> 
  
 <divstyle=""border:solid1px""> 
  
 <ahref=""/books"">Books</a> 
  
 <ahref=""/sales"">MySales</a> 
  
 <ahref=""/my-books"">MyBooks</a> 
  
 <hr> 
  
 <formaction=""/books/search""method=""get""> <label>Title</label> 
  
 <inputtype=""text""name=""title""> 
  
 <label>Author</label> 
  
 <inputtype=""text""name=""author""> 
  
 <inputtype=""submit""value=""Search""> </form> 
  
 </div> 
  
 {%blockcontent%}{%endblock%} 
  
 </body> 
  
 </html>",NA
"Asyoucanseeintheprecedingcode,blockshaveanamesothattemplatesusingthe ",NA,NA
"layoutcanrefertothem.Inourlayout,wedefinedtwoblocks:oneforthetitleoftheview ",NA,NA
"andtheotherforthecontentitself.Whenatemplateusesthelayout,wejustneedtowrite ",NA,NA
"theHTMLcodeforeachoftheblocksdefinedinthelayout,andTwigwilldotherest.",NA,NA
"Also,toletTwigknowthatourtemplatewantstousethelayout,weusethetag","{% 
 extends%}",NA
withthelayoutfilename.Let’supdate,views/book.twig,NA
touseournew layout:,"{%extends'layout.twig'%}
  
 {%blocktitle%} 
  
 {{book.title}} 
  
 {%endblock%}
  
 {%blockcontent%}",NA
"Atthetopofthefile,weaddthelayoutthatweneedtouse.Then,weopenablocktag ",NA,NA
"withthereferencename,andwewriteinsideittheHTMLthatwewanttouse.Youcan ",NA,NA
"useanythingvalidinsideablock,eitherTwigcodeorplainHTML.Inourtemplate,we ",NA,NA
usedthetitleofthebookasthe,title,NA
"block,whichreferstothetitleoftheview,andwe ",NA,NA
putallthepreviousHTMLinsidethe,content,NA
block.Notethateverythinginthefileis ,NA,NA
insideablocknow.Tryitinyourbrowsernowtoseethechanges.,NA,NA
Paginatedbooklist,NA,NA
"Let’saddanotherview,thistimeforapaginatedlistofbooks.Inordertoseetheresultof ",NA,NA
"yourwork,updatethecontentof",index.php,NA
",replacingthecodeoftheprevioussection ",NA,NA
withthefollowing:,"$bookModel=newBookModel(Db::getInstance()); 
 $books=$bookModel->getAll(1,3);
  
 $params=['books'=>$books,'currentPage'=>2]; 
  
 echo$twig->loadTemplate('books.twig')->render($params);",NA
"Intheprecedingsnippet,weforcetheapplicationtorenderthe",books.twig,NA
"template, ",NA,NA
"sendinganarrayofbooksfrompagenumber1,andshowing3booksperpage.Thisarray, ",NA,NA
"though,mightnotalwaysreturn3books,maybebecausethereareonly2booksinthe ",NA,NA
database.Weshouldthenusealooptoiteratethelistinsteadofassumingthesizeofthe ,NA,NA
"array.InTwig,youcanemulatea",foreach,NA
loopusing,{%for<element>in<array>%},NA
inordertoiterateanarray.Let’suseitforyour,views/books.twig,NA
:,"{%extends'layout.twig'%}
  
 {%blocktitle%} 
  
 Books 
  
 {%endblock%}
  
 {%blockcontent%} 
  
 <table> 
  
 <thead> 
  
 <th>Title</th> 
  
 <th>Author</th> 
  
 <th></th> 
  
 </thead> 
  
 {%forbookinbooks%} 
  
 <tr> 
  
 <td>{{book.title}}</td> 
  
 <td>{{book.author}}</td> 
  
 <td><ahref=""/book/{{book.id}}"">View</a></td> </tr> 
  
 {%endfor%} 
  
 </table> 
  
 {%endblock%}",NA
"WecanalsouseconditionalsinaTwigtemplate,whichworkthesameastheconditionals ",NA,NA
inPHP.Thesyntaxis,{%if<booleanexpression>%},NA
.Let’suseittodecideifwe ,NA,NA
shouldshowthepreviousand/orfollowinglinksonourpage.Addthefollowingcodeat ,NA,NA
theendofthecontentblock:,"{%ifcurrentPage!=1%} 
  
 <ahref=""/books/{{currentPage-1}}"">Previous</a> 
 {%endif%} 
  
 {%ifnotlastPage%} 
  
 <ahref=""/books/{{currentPage+1}}"">Next</a> {%endif%}",NA
Thelastthingtonotefromthistemplateisthatwearenotrestrictedtousingonly ,NA,NA
variableswhenprintingoutcontentwith,{{}},NA
.WecanaddanyvalidTwigexpression ,NA,NA
"thatreturnsavalue,aswedidwith",{{currentPage+1}},NA
.,NA,NA
Thesalesview,NA,NA
"Wehavealreadyshownyoueverythingthatyouwillneedforusingtemplates,andnow ",NA,NA
wejusthavetofinishaddingallofthem.Thenextoneinthelististhetemplatethat ,NA,NA
showsthelistofsalesforagivenuser.Updateyour,index.php,NA
filewiththefollowing hack:,"$saleModel=newSaleModel(Db::getInstance()); 
 $sales=$saleModel->getByUser(1);
  
 $params=['sales'=>$sales]; 
  
 echo$twig->loadTemplate('sales.twig')->render($params);",NA
Thetemplateforthisviewwillbeverysimilartotheonelistingthebooks:atable ,NA,NA
populatedwiththecontentofanarray.Thefollowingisthecontentof,views/sales.twig,NA
:,"{%extends'layout.twig'%}
  
 {%blocktitle%} 
  
 Mysales 
  
 {%endblock%}
  
 {%blockcontent%} 
  
 <table> 
  
 <thead> 
  
 <th>Id</th> 
  
 <th>Date</th> 
  
 </thead> 
  
 {%forsaleinsales%} 
  
 <tr> 
  
 <td>{{sale.id}}</td> 
  
 <td>{{sale.date}}</td> 
  
 <td><ahref=""/sales/{{sale.id}}"">View</a></td> </tr> 
  
 {%endfor%} 
  
 </table> 
  
 {%endblock%}",NA
Theotherviewrelatedtosalesiswherewewanttodisplayallthecontentofaspecific ,NA,NA
"one.Thissale,again,willbesimilartothebookslist,aswewillbelistingthebooks ",NA,NA
relatedtothatsale.Thehacktoforcetherenderingofthistemplateisasfollows:,"$saleModel=newSaleModel(Db::getInstance()); 
 $sale=$saleModel->get(1);
  
 $params=['sale'=>$sale]; 
  
 echo$twig->loadTemplate('sale.twig')->render($params);",NA
AndtheTwigtemplateshouldbeplacedin,views/sale.twig,NA
:,"{%extends'layout.twig'%}
  
 {%blocktitle%} 
  
 Sale{{sale.id}} 
  
 {%endblock%}",NA
Theerrortemplate,NA,NA
Weshouldaddaverysimpletemplatethatwillbeshowntotheuserwhenthereisanerror ,NA,NA
"inourapplication,ratherthanshowingaPHPerrormessage.Thistemplatewilljust ",NA,NA
expectthe,errorMessage,NA
"variable,anditcouldlooklikethefollowing.Saveitas ",views/error.twig,NA
:,"{%extends'layout.twig'%}
  
 {%blocktitle%} 
  
 Error 
  
 {%endblock%}
  
 {%blockcontent%} 
  
 <h2>Error:{{errorMessage}}</h2> {%endblock%}",NA
"Notethateventheerrorpageextendsfromthelayout,aswewanttheusertobeabletodo ",NA,NA
somethingelsewhenthishappens.,NA,NA
Thelogintemplate,NA,NA
Ourlasttemplatewillbetheonethatallowstheusertologin.Thistemplateisabit ,NA,NA
"differentfromtheothers,asitwillbeusedintwodifferentscenarios.Inthefirstone,the ",NA,NA
"useraccessestheloginviewforthefirsttime,soweneedtoshowtheform.Inthesecond ",NA,NA
"one,theuserhasalreadytriedtologin,andtherewasanerrorwhendoingso,thatis,the e-",NA,NA
"mailaddresswasnotfound.Inthiscase,wewilladdanextravariabletothetemplate, ",errorMessage,NA
",andwewilladdaconditionaltoshowitscontentsonlywhenthisvariable ",NA,NA
isdefined.Youcanusetheoperator,isdefined,NA
tocheckthat.Addthefollowingtemplate ,NA,NA
as,views/login.twig,NA
:,"{%extends'layout.twig'%}
  
 {%blocktitle%} 
  
 Login 
  
 {%endblock%}
  
 {%blockcontent%} 
  
 {%iferrorMessageisdefined%} 
  
 <strong>{{errorMessage}}</strong> {%endif%} 
  
 <formaction=""/login""method=""post""> <label>Email</label> 
  
 <inputtype=""text""name=""email""> <inputtype=""submit""> 
  
 </form> 
  
 {%endblock%}",NA
Cforcontroller,NA,NA
Itisfinallytimeforthedirectoroftheorchestra.Controllersrepresentthelayerinour ,NA,NA
"applicationthat,givenarequest,talkstothemodelsandbuildstheviews.Theyactlike ",NA,NA
themanagerofateam:theydecidewhatresourcestousedependingonthesituation.,NA,NA
"Aswestatedwhenexplainingmodels,itissometimesdifficulttodecideifsomepieceof ",NA,NA
"logicshouldgointothecontrollerorthemodel.Attheendoftheday,MVCisapattern, ",NA,NA
"likearecipethatguidesyou,ratherthananexactalgorithmthatyouneedtofollowstep ",NA,NA
"bystep.Therewillbescenarioswheretheanswerisnotstraightforward,soitwillbeupto ",NA,NA
"you;inthesecases,justtrytobeconsistent.Thefollowingaresomecommonscenarios ",NA,NA
thatmightbedifficulttolocalize:,NA,NA
Therequestpointstoapaththatwedonotsupport.Thisscenarioisalreadycovered ,NA,NA
"inourapplication,anditistherouterthatshouldtakecareofit,notthecontroller. ",NA,NA
"Therequesttriestoaccessanelementthatdoesnotexist,forexample,abookIDthat ",NA,NA
"isnotinthedatabase.Inthiscase,thecontrollershouldaskthemodelifthebook ",NA,NA
"exists,anddependingontheresponse,renderatemplatewiththebook’scontents,or ",NA,NA
anotherwitha“Notfound”message.,NA,NA
"Theusertriestoperformanaction,suchasbuyingabook,buttheparameterscoming ",NA,NA
fromtherequestarenotvalid.Thisisatrickyone.Oneoptionistogetallthe ,NA,NA
"parametersfromtherequestwithoutcheckingthem,sendingthemstraighttothe ",NA,NA
"model,andleavingthetaskofsanitizingtheinformationtothemodel.Another ",NA,NA
"optionisthatthecontrollerchecksthattheparametersprovidedmakesense,andthen ",NA,NA
"givesthemtothemodel.Thereareothersolutions,likebuildingaclassthatchecksif ",NA,NA
"theparametersarevalid,whichcanbereusedindifferentcontrollers.Inthiscase,it ",NA,NA
willdependontheamountofparametersandlogicinvolvedinthesanitization.For ,NA,NA
"requestsreceivingalotofdata,thethirdoptionlookslikethebestofthem,aswewill ",NA,NA
"beabletoreusethecodeindifferentendpoints,andwearenotwritingcontrollers ",NA,NA
"thataretoolong.Butinrequestswheretheusersendsoneortwoparameters, ",NA,NA
sanitizingtheminthecontrollermightbegoodenough.,NA,NA
"Nowthatwe’vesettheground,let’sprepareourapplicationtousecontrollers.Thefirst ",NA,NA
thingtodoistoupdateour,index.php,NA
",whichhasbeenforcingtheapplicationtoalways ",NA,NA
"renderthesametemplate.Instead,weshouldbegivingthistasktotherouter,whichwill ",NA,NA
returntheresponseasastringthatwecanjustprintwith,echo,NA
.Updateyour,index.php,NA
filewiththefollowingcontent:,"<?php
  
 useBookstore\Core\Router; 
  
 useBookstore\Core\Request;
  
 require_once__DIR__.'/vendor/autoload.php';
  
 $router=newRouter(); 
  
 $response=$router->route(newRequest()); 
 echo$response;",NA
"Asyoumightremember,therouterinstantiatesacontrollerclass,sendingtherequest ",NA,NA
"objecttotheconstructor.Butcontrollershaveotherdependenciesaswell,suchasthe ",NA,NA
"templateengine,thedatabaseconnection,ortheconfigurationreader.Eventhoughthisi",NA,NA
s notthebestsolution(youwillimproveitoncewecoverdependencyinjectioninthenext ,NA,NA
"section),wecouldcreatean",AbstractController,NA
thatwouldbetheparentofall ,NA,NA
"controllers,andwillsetthosedependencies.Copythefollowingas ",src/Controllers/AbstractController.php,NA
:,"<?php
  
 namespaceBookstore\Controllers;
  
 useBookstore\Core\Config; 
  
 useBookstore\Core\Db; 
  
 useBookstore\Core\Request; 
  
 useMonolog\Logger; 
  
 useTwig_Environment; 
  
 useTwig_Loader_Filesystem; 
  
 useMonolog\Handler\StreamHandler;
  
 abstractclassAbstractController{ 
  
 protected$request; 
  
 protected$db; 
  
 protected$config; 
  
 protected$view; 
  
 protected$log;
  
 publicfunction__construct(Request$request){ $this->request=$request; 
  
 $this->db=Db::getInstance(); 
  
 $this->config=Config::getInstance();
  
 $loader=newTwig_Loader_Filesystem( 
  
 __DIR__.'/../../views' 
  
 ); 
  
 $this->view=newTwig_Environment($loader);
  
 $this->log=newLogger('bookstore'); 
  
 $logFile=$this->config->get('log'); 
  
 $this->log->pushHandler( 
  
 newStreamHandler($logFile,Logger::DEBUG) ); 
  
 }
  
 publicfunctionsetCustomerId(int$customerId){ $this-
 >customerId=$customerId; 
  
 } 
  
 }",NA
"Wheninstantiatingacontroller,wewillsetsomepropertiesthatwillbeusefulwhen ",NA,NA
"handlingrequests.Wealreadyknowhowtoinstantiatethedatabaseconnection,the ",NA,NA
"configurationreader,andthetemplateengine.Thefourthproperty,",$log,NA
",willallowthe ",NA,NA
developertowritelogstoagivenfilewhennecessary.WewillusetheMonologlibrary,NA,NA
"forthat,buttherearemanyotheroptions.Noticethatinordertoinstantiatethelogger,we ",NA,NA
"getthevalueoflogfromtheconfiguration,whichshouldbethepathtothelogfile.The ",NA,NA
conventionistousethe,/var/log/,NA
"directory,socreatethe",/var/log/bookstore.log,NA
"file, ",NA,NA
andadd,"""log"":""/var/log/bookstore.log""",NA
toyourconfigurationfile.,NA,NA
Anotherthingthatisusefultosomecontrollers—butnotallofthem—istheinformation ,NA,NA
abouttheuserperformingtheaction.Asthisisonlygoingtobeavailableforcertain ,NA,NA
"routes,weshouldnotsetitwhenconstructingthecontroller.Instead,wehaveasetterfor ",NA,NA
"theroutertosetthecustomerIDwhenavailable;infact,therouterdoesthatalready.",NA,NA
"Finally,ahandyhelpermethodthatwecoulduseisonethatrendersagiventemplatewith ",NA,NA
"parameters,asallthecontrollerswillenduprenderingonetemplateortheother.Let’sadd ",NA,NA
thefollowingprotectedmethodtothe,AbstractController,NA
class:,"protectedfunctionrender(string$template,array$params):string{ return$this->view-
 >loadTemplate($template)->render($params); }",NA
Theerrorcontroller,NA,NA
Let’sstartbycreatingtheeasiestofthecontrollers:the,ErrorController,NA
.Thiscontroller ,NA,NA
doesnotdomuch;itjustrendersthe,error.twig,NA
templatesendingthe“Pagenotfound!”messa,NA,NA
"ge.Asyoumightremember,therouterusesthiscontrollerwhenitcannotmatchthe ",NA,NA
requesttoanyoftheotherdefinedroutes.Savethefollowingclassin ,src/Controllers/ErrorController.php,NA
:,"<?php
  
 namespaceBookstore\Controllers;
  
 classErrorControllerextendsAbstractController{ 
  
 publicfunctionnotFound():string{ 
  
 $properties=['errorMessage'=>'Pagenotfound!']; return$this-
 >render('error.twig',$properties); } 
  
 }",NA
Thelogincontroller,NA,NA
Thesecondcontrollerthatwehavetoaddistheonethatmanagestheloginofthe ,NA,NA
"customers.Ifwethinkabouttheflowwhenauserwantstoauthenticate,wehavethe ",NA,NA
followingscenarios:,NA,NA
Theuserwantstogettheloginforminordertosubmitthenecessaryinformationand ,NA,NA
login.,NA,NA
"Theusertriestosubmittheform,butwecouldnotgetthee-mailaddress.Weshould ",NA,NA
"rendertheformagain,lettingthemknowabouttheproblem.",NA,NA
"Theusersubmitstheformwithane-mail,butitisnotavalidone.Inthiscase,we ",NA,NA
shouldshowtheloginformagainwithanerrormessageexplainingthesituation. ,NA,NA
"Theusersubmitsavalide-mail,wesetthecookie,andweshowthelistofbooksso ",NA,NA
theusercanstartsearching.Thisisabsolutelyarbitrary;youcouldchoosetosend ,NA,NA
"themtotheirborrowedbookspage,theirsales,andsoon.Theimportantthinghereis ",NA,NA
tonoticethatwewillberedirectingtherequesttoanothercontroller.,NA,NA
Thereareuptofourpossiblepaths.Wewillusethe,request,NA
objecttodecidewhichof ,NA,NA
"themtouseineachcase,returningthecorrespondingresponse.Let’screate,then,the ",CustomerController,NA
classin,src/Controllers/CustomerController.php,NA
withthe ,login,NA
"method,asfollows:","<?php
  
 namespaceBookstore\Controllers;
  
 useBookstore\Exceptions\NotFoundException; 
 useBookstore\Models\CustomerModel;
  
 classCustomerControllerextendsAbstractController{ 
 publicfunctionlogin(string$email):string{ if(!$this->request->isPost()){ 
  
 return$this->render('login.twig',[]); 
 }
  
 $params=$this->request->getParams();
  
 if(!$params->has('email')){ 
  
 $params=['errorMessage'=>'Noinfoprovided.']; 
 return$this-
 >render('login.twig',$params); 
 }
  
 $email=$params->getString('email'); 
  
 $customerModel=newCustomerModel($this->db);
  
 try{ 
  
 $customer=$customerModel->getByEmail($email); 
  
 }catch(NotFoundException$e){ 
  
 $this->log->warn('Customeremailnotfound:'.$email); 
 $params=['errorMessage'=>'Emailnotfound.']; 
  
 return$this->render('login.twig',$params); 
  
 }",NA
"Asyoucansee,therearefourdifferentreturnsforthefourdifferentcases.Thecontroller ",NA,NA
"itselfdoesnotdoanything,butorchestratestherestofthecomponents,andmakes ",NA,NA
"decisions.First,wecheckiftherequestisaPOST,andifitisnot,wewillassumethatthe ",NA,NA
"userwantstogettheform.Ifitis,wewillcheckforthee-mailintheparameters,returning ",NA,NA
"anerrorifthee-mailisnotthere.Ifitis,wewilltrytofindthecustomerwiththate-mail, ",NA,NA
"usingourmodel.Ifwegetanexceptionsayingthatthereisnosuchcustomer,wewill ",NA,NA
"rendertheformwitha“Notfound”errormessage.Iftheloginissuccessful,wewillset ",NA,NA
"thecookiewiththeIDofthecustomer,andwillexecutethe",getAll,NA
methodof ,BookController,NA
"(stilltobewritten),returningthelistofbooks.",NA,NA
"Atthispoint,youshouldbeabletotesttheloginfeatureofyourapplicationendtoend ",NA,NA
withthebrowser.Trytoaccess,http://localhost:8000/login,NA
"toseetheform,adding randome-",NA,NA
"mailstogettheerrormessage,andaddingavalide-mail(checkyour",customer,NA
"tableinMySQL)tologinsuccessfully.Afterthis,youshouldseethecookiewiththe ",NA,NA
customerID.,NA,NA
Thebookcontroller,NA,NA
The,BookController,NA
"classwillbethelargestofourcontrollers,asmostoftheapplication ",NA,NA
"reliesonit.Let’sstartbyaddingtheeasiestmethods,theonesthatjustretrieve ",NA,NA
informationfromthedatabase.Savethisas,src/Controllers/BookController.php,NA
:,"<?php
  
 namespaceBookstore\Controllers;
  
 useBookstore\Models\BookModel;
  
 classBookControllerextendsAbstractController{ 
 constPAGE_LENGTH=10;
  
 publicfunctiongetAllWithPage($page):string{ $page=(int)$page; 
  
 $bookModel=newBookModel($this->db);
  
 $books=$bookModel->getAll($page,self::PAGE_LENGTH);
  
 $properties=[ 
  
 'books'=>$books, 
  
 'currentPage'=>$page, 
  
 'lastPage'=>count($books)<self::PAGE_LENGTH ]; 
  
 return$this->render('books.twig',$properties); }
  
 publicfunctiongetAll():string{ return$this-
 >getAllWithPage(1); }
  
 publicfunctionget(int$bookId):string{ 
 $bookModel=newBookModel($this->db);
  
 try{ 
  
 $book=$bookModel->get($bookId); 
  
 }catch(\Exception$e){ 
  
 $this->log->error( 
  
 'Errorgettingbook:'.$e->getMessage() 
  
 ); 
  
 $properties=['errorMessage'=>'Booknotfound!']; return$this-
 >render('error.twig',$properties); }
  
 $properties=['book'=>$book]; 
  
 return$this->render('book.twig',$properties); }
  
 publicfunctiongetByUser():string{ 
  
 $bookModel=newBookModel($this->db);
  
 $books=$bookModel->getByUser($this->customerId);",NA
There’snothingtoospecialinthisprecedingcodesofar.The,getAllWithPage,NA
and,getAll,NA
"methodsdothesamething,onewiththepagenumbergivenbytheuserasaURL ",NA,NA
"argument,andtheothersettingthepagenumberas1—thedefaultcase.Theyaskthe ",NA,NA
modelforthelistofbookstobedisplayedandpassedtotheview.Theinformationofthe ,NA,NA
currentpage—andwhetherornotweareonthelastpage—isalsosenttothetemplatein ,NA,NA
ordertoaddthe“previous”and“next”pagelinks.,NA,NA
The,get,NA
methodwillgettheIDofthebookthatthecustomerisinterestedin.Itwilltryto ,NA,NA
"fetchitusingthemodel.Ifthemodelthrowsanexception,wewillrendertheerror ",NA,NA
"templatewitha“Booknotfound”message.Instead,ifthebookIDisvalid,wewillrender ",NA,NA
thebooktemplateasexpected.,NA,NA
The,getByUser,NA
methodwillreturnallthebooksthattheauthenticatedcustomerhas ,NA,NA
borrowed.Wewillmakeuseofthe,customerId,NA
propertythatwesetfromtherouter.There ,NA,NA
"isnosanitycheckhere,sincewearenottryingtogetaspecificbook,butratheralist, ",NA,NA
whichcouldbeemptyiftheuserhasnotborrowedanybooksyet—butthatisnotanissue.,NA,NA
Anothergettercontrolleristheonethatsearchesforabookbyitstitleand/orauthor.This ,NA,NA
methodwillbetriggeredwhentheusersubmitstheforminthelayouttemplate.Theform ,NA,NA
sendsboththe,title,NA
andthe,author,NA
"fields,sothecontrollerwillaskforboth.Themodel ",NA,NA
"isreadytousetheargumentsthatareempty,sowewillnotperformanyextrachecking ",NA,NA
here.Addthemethodtothe,BookController,NA
class:,"publicfunctionsearch():string{ 
  
 $title=$this->request->getParams()->getString('title'); $author=$this->request-
 >getParams()->getString('author');
  
 $bookModel=newBookModel($this->db); 
  
 $books=$bookModel->search($title,$author);
  
 $properties=[ 
  
 'books'=>$books, 
  
 'currentPage'=>1, 
  
 'lastPage'=>true 
  
 ]; 
  
 return$this->render('books.twig',$properties); }",NA
"Yourapplicationcannotperformanyactions,butatleastyoucanfinallybrowsethelistof ",NA,NA
"books,andclickonanyofthemtoviewthedetails.Wearefinallygettingsomethinghere!",NA,NA
Borrowingbooks,NA,NA
"Borrowingandreturningbooksareprobablytheactionsthatinvolvethemostlogic, ",NA,NA
"togetherwithbuyingabook,whichwillbecoveredbyadifferentcontroller.Thisisa ",NA,NA
"goodplacetostartloggingtheuser’sactions,sinceitwillbeusefullaterfordebugging ",NA,NA
"purposes.Let’sseethecodefirst,andthendiscussitbriefly.Addthefollowingtwo ",NA,NA
methodstoyour,BookController,NA
class:,"publicfunctionborrow(int$bookId):string{ 
 $bookModel=newBookModel($this->db);
  
 try{ 
  
 $book=$bookModel->get($bookId); 
  
 }catch(NotFoundException$e){ 
  
 $this->log->warn('Booknotfound:'.$bookId); 
 $params=['errorMessage'=>'Booknotfound.']; return$this-
 >render('error.twig',$params); }
  
 if(!$book->getCopy()){ 
  
 $params=[ 
  
 'errorMessage'=>'Therearenocopiesleft.' ]; 
  
 return$this->render('error.twig',$params); }
  
 try{ 
  
 $bookModel->borrow($book,$this->customerId); 
  
 }catch(DbException$e){ 
  
 $this->log->error( 
  
 'Errorborrowingbook:'.$e->getMessage() 
  
 ); 
  
 $params=['errorMessage'=>'Errorborrowingbook.']; return$this-
 >render('error.twig',$params); 
  
 }
  
 return$this->getByUser(); 
  
 }
  
 publicfunctionreturnBook(int$bookId):string{ 
 $bookModel=newBookModel($this->db);
  
 try{ 
  
 $book=$bookModel->get($bookId); 
  
 }catch(NotFoundException$e){ 
  
 $this->log->warn('Booknotfound:'.$bookId); 
 $params=['errorMessage'=>'Booknotfound.']; return$this-
 >render('error.twig',$params); }
  
 $book->addCopy();
  
 try{ 
  
 $bookModel->returnBook($book,$this->customerId);",NA
"Aswementionedearlier,oneofthenewthingshereisthatwearelogginguseractions, ",NA,NA
likewhentryingtoborroworreturnabookthatisnotvalid.Monologallowsyoutowrite ,NA,NA
"logswithdifferentprioritylevels:error,warning,andnotices.Youcaninvokemethods ",NA,NA
suchas,error,NA
",",warn,NA
",or",notice,NA
torefertoeachofthem.Weusewarningswhensomething ,NA,NA
"unexpected,yetnotcritical,happens,forexample,tryingtoborrowabookthatisnot ",NA,NA
"there.Errorsareusedwhenthereisanunknownproblemfromwhichwecannotrecover, ",NA,NA
likeanerrorfromthedatabase.,NA,NA
Themodusoperandiofthesetwomethodsisasfollows:wegetthe,book,NA
objectfromthe ,NA,NA
"3databasewiththegivenbookID.Asusual,ifthereisnosuchbook,wereturnanerror ",NA,NA
page.Oncewehavethe,book,NA
"domainobject,wemakeuseofthehelpers",addCopy,NA
and ,getCopy,NA
"inordertoupdatethestockofthebook,andsendittothemodel,togetherwith ",NA,NA
"thecustomerID,tostoretheinformationinthedatabase.Thereisalsoasanitycheck ",NA,NA
"whenborrowingabook,justincasetherearenomorebooksavailable.Inbothcases,we ",NA,NA
returnthelistofbooksthattheuserhasborrowedastheresponseofthecontroller.,NA,NA
Thesalescontroller,NA,NA
Wearriveatthelastofourcontrollers:the,SalesController,NA
".Withadifferentmodel,it ",NA,NA
willendupdoingprettymuchthesameasthemethodsrelatedtoborrowedbooks.Butwe ,NA,NA
needtocreatethe,sale,NA
domainobjectinthecontrollerinsteadofgettingitfromthe ,NA,NA
"model.Let’saddthefollowingcode,whichcontainsamethodforbuyingabook,",add,NA
",and ",NA,NA
twogetters:onethatgetsallthesalesofagivenuserandonethatgetstheinfoofa ,NA,NA
"specificsale,thatis,",getByUser,NA
and,get,NA
"respectively.Followingtheconvention,thefile ",NA,NA
willbe,src/Controllers/SalesController.php,NA
:,"<?php
  
 namespaceBookstore\Controllers;
  
 useBookstore\Domain\Sale; 
  
 useBookstore\Models\SaleModel;
  
 classSalesControllerextendsAbstractController{ 
 publicfunctionadd($id):string{ 
  
 $bookId=(int)$id; 
  
 $salesModel=newSaleModel($this->db);
  
 $sale=newSale(); 
  
 $sale->setCustomerId($this->customerId); $sale-
 >addBook($bookId);
  
 try{ 
  
 $salesModel->create($sale); 
  
 }catch(\Exception$e){ 
  
 $properties=[ 
  
 'errorMessage'=>'Errorbuyingthebook.' ]; 
  
 $this->log->error( 
  
 'Errorbuyingbook:'.$e->getMessage() ); 
  
 return$this->render('error.twig',$properties); }
  
 return$this->getByUser(); 
  
 }
  
 publicfunctiongetByUser():string{ 
  
 $salesModel=newSaleModel($this->db);
  
 $sales=$salesModel->getByUser($this->customerId);
  
 $properties=['sales'=>$sales]; 
  
 return$this->render('sales.twig',$properties); }
  
 publicfunctionget($saleId):string{ 
  
 $salesModel=newSaleModel($this->db);
  
 $sale=$salesModel->get($saleId);",NA
Dependencyinjection,NA,NA
"Attheendofthechapter,wewillcoveroneofthemostinterestingandcontroversialof ",NA,NA
"thetopicsthatcomewith,notonlytheMVCpattern,butOOPingeneral:",NA,NA
dependency ,NA,NA
injection,NA,NA
".Wewillshowyouwhyitissoimportant,andhowtoimplementasolutionthat ",NA,NA
"suitsourspecificapplication,eventhoughtherearequiteafewdifferentimplementation",NA,NA
s thatcancoverdifferentnecessities.,NA,NA
Whyisdependencyinjectionnecessary?,NA,NA
"Westillneedtocoverthewaytounittestyourcode,henceyouhavenotexperienceditby ",NA,NA
yourselfyet.Butoneofthesignsofapotentialsourceofproblemsiswhenyouusethe ,new,NA
statementinyourcodetocreateaninstanceofaclassthatdoesnotbelongtoyour ,NA,NA
codebase—alsoknownasadependency.Using,new,NA
tocreateadomainobjectlike,Book,NA
or ,Sale,NA
"isfine.Usingittoinstantiatemodelsisalsoacceptable.Butmanuallyinstantiating, ",NA,NA
"whichsomethingelse,suchasthetemplateengine,thedatabaseconnection,orthelogger, ",NA,NA
issomethingthatyoushouldavoid.Therearedifferentreasonsthatsupportthisidea:,NA,NA
"Ifyouwanttouseacontrollerfromtwodifferentplaces,andeachoftheseplaces ",NA,NA
"needsadifferentdatabaseconnectionorlogfile,instantiatingthosedependencies ",NA,NA
insidethecontrollerwillnotallowustodothat.Thesamecontrollerwillalwaysuse ,NA,NA
thesamedependency.,NA,NA
Instantiatingthedependenciesinsidethecontrollermeansthatthecontrollerisfull,NA,NA
"y awareoftheconcreteimplementationofeachofitsdependencies,thatis,the ",NA,NA
controllerknowsthatweareusingPDOwiththeMySQLdriverandthelocationof ,NA,NA
thecredentialsfortheconnection.Thismeansahighlevelofcouplinginyour ,NA,NA
"application—so,badnews.",NA,NA
Replacingonedependencywithanotherthatimplementsthesameinterfaceisnot ,NA,NA
"easyifyouareinstantiatingthedependencyexplicitlyeverywhere,asyouwillhave ",NA,NA
"tosearchalltheseplaces,andchangetheinstantiationmanually.",NA,NA
"Forallthesereasons,andmore,itisalwaysgoodtoprovidethedependenciesthataclass ",NA,NA
suchasacontrollerneedsinsteadoflettingitcreateitsown.Thisissomethingthat ,NA,NA
everybodyagreeswith.Theproblemcomeswhenimplementingasolution.Thereare ,NA,NA
differentoptions:,NA,NA
Wehaveaconstructorthatexpects(througharguments)allthedependenciesthatth,NA,NA
"e controller,oranyotherclass,needs.Theconstructorwillassigneachofthe ",NA,NA
argumentstothepropertiesoftheclass.,NA,NA
"Wehaveanemptyconstructor,andinstead,weaddasmanysettermethodsasthe ",NA,NA
dependenciesoftheclass.,NA,NA
"Ahybridofboth,wherewesetthemaindependenciesthroughaconstructor,andset ",NA,NA
therestofthedependenciesviasetters.,NA,NA
Sendinganobjectthatcontainsallthedependenciesasauniqueargumentforthe ,NA,NA
"constructor,andthecontrollergetsthedependenciesthatitneedsfromthatcontaine",NA,NA
r.,NA,NA
"Eachsolutionhasitsprosandcons.Ifwehaveaclasswithalotofdependencies,injecting ",NA,NA
"allofthemviatheconstructorwouldmakeitcounterintuitive,soitwouldbebetterifwe ",NA,NA
"injectthemusingsetters,eventhoughaclasswithalotofdependencieslookslikebad ",NA,NA
"design.Ifwehavejustoneortwodependencies,usingtheconstructorcouldbe ",NA,NA
"acceptable,andwewillwritelesscode.Forclasseswithseveraldependencies,butnotall ",NA,NA
"ofthemmandatory,usingthehybridversioncouldbeagoodsolution.Thefourthoption ",NA,NA
makesiteasierwheninjectingthedependenciesaswedonotneedtoknowwhateach ,NA,NA
"objectexpects.Theproblemisthateachclassshouldknowhowtofetchitsdependency,",NA,NA
"thatis,thedependencyname,whichisnotideal.",NA,NA
Implementingourowndependencyinjector,NA,NA
"Opensourcesolutionsfordependencyinjectorsarealreadyavailable,butwethinkthatit ",NA,NA
wouldbeagoodexperiencetoimplementasimpleonebyyourself.Theideaofour ,NA,NA
dependencyinjectorisaclassthatcontainsinstancesofthedependenciesthatyourcode ,NA,NA
"needs.Thisclass,whichisbasicallyamapofdependencynamestodependencyinstances, ",NA,NA
willhavetwomethods:agetterandasetterofdependencies.Wedonotwanttousea ,NA,NA
"staticpropertyforthedependenciesarray,asoneofthegoalsistobeabletohavemore ",NA,NA
thanonedependencyinjectorwithadifferentsetofdependencies.Addthefollowingclass ,NA,NA
to,src/Utils/DependencyInjector.php,NA
:,"<?php
  
 namespaceBookstore�tils;
  
 useBookstore\Exceptions\NotFoundException;
  
 classDependencyInjector{ 
  
 private$dependencies=[];
  
 publicfunctionset(string$name,$object){ $this-
 >dependencies[$name]=$object; }
  
 publicfunctionget(string$name){ 
  
 if(isset($this->dependencies[$name])){ return$this-
 >dependencies[$name]; } 
  
 thrownewNotFoundException( 
  
 $name.'dependencynotfound.' ); 
  
 } 
  
 }",NA
Havingadependencyinjectormeansthatwewillalwaysusethesameinstanceofagiven ,NA,NA
"classeverytimeweaskforit,insteadofcreatingoneeachtime.Thatmeansthatsingleton ",NA,NA
"implementationsarenotneededanymore;infact,asmentionedin",NA,NA
Chapter4,NA,NA
",",NA,NA
Creating ,NA,NA
CleanCodewithOOP,NA,NA
",itispreferabletoavoidthem.Let’sgetridofthem,then.Oneof ",NA,NA
theplaceswherewewereusingitwasinourconfigurationreader.Replacetheexisting ,NA,NA
codewiththefollowinginthe,src/Core/Config.php,NA
file:,"<?php
  
 namespaceBookstore\Core;
  
 useBookstore\Exceptions\NotFoundException;
  
 classConfig{ 
  
 private$data;
  
 publicfunction__construct(){ 
  
 $json=file_get_contents(",NA
Theotherplacewhereweweremakinguseofthesingletonpatternwasinthe,DB,NA
class.In ,NA,NA
"fact,thepurposeoftheclasswasonlytohaveasingletonforourdatabaseconnection,but ",NA,NA
"ifwearenotmakinguseofit,wecanremovetheentireclass.So,deleteyour ",src/Core/DB.php,NA
file.,NA,NA
Nowweneedtodefineallthesedependenciesandaddthemtoourdependencyinjector. ,NA,NA
The,index.php,NA
fileisagoodplacetohavethedependencyinjectorbeforeweroutethe ,NA,NA
request.Addthefollowingcodejustbeforeinstantiatingthe,Router,NA
class:,"$config=newConfig();
  
 $dbConfig=$config->get('db'); 
  
 $db=newPDO( 
  
 'mysql:host=127.0.0.1;dbname=bookstore', $dbConfig['user'], 
  
 $dbConfig['password'] 
  
 );
  
 $loader=newTwig_Loader_Filesystem(__DIR__.'/../../views'); 
 $view=newTwig_Environment($loader);
  
 $log=newLogger('bookstore'); 
  
 $logFile=$config->get('log'); 
  
 $log->pushHandler(newStreamHandler($logFile,Logger::DEBUG));
  
 $di=newDependencyInjector(); 
  
 $di->set('PDO',$db); 
  
 $di->set('Utils\Config',$config); 
  
 $di->set('Twig_Environment',$view); 
  
 $di->set('Logger',$log);
  
 $router=newRouter($di); 
  
 //...",NA
Thereareafewchangesthatweneedtomakenow.Themostimportantofthemrefersto ,NA,NA
the,AbstractController,NA
",theclassthatwillmakeheavyuseofthedependencyinjector. ",NA,NA
Addapropertynamed,$di,NA
"tothatclass,andreplacetheconstructorwiththefollowing:","publicfunction__construct( 
  
 DependencyInjector$di, 
  
 Request$request 
  
 ){",NA
Theotherchangesrefertothe,Router,NA
"class,aswearesendingitnowaspartofthe ",NA,NA
"constructor,andweneedtoinjectittothecontrollersthatwecreate.Adda",$di,NA
propertyto ,NA,NA
"thatclassaswell,andchangetheconstructortothefollowingone:","publicfunction__construct(DependencyInjector$di){ $this->di=$di;
  
 $json=file_get_contents(__DIR__.'/../../config/routes.json'); $this-
 >routeMap=json_decode($json,true); 
  
 }",NA
Alsochangethecontentofthe,executeController,NA
and,route,NA
methods:,"publicfunctionroute(Request$request):string{ $path=$request-
 >getPath();
  
 foreach($this->routeMapas$route=>$info){ 
  
 $regexRoute=$this->getRegexRoute($route,$info); 
 if(preg_match(""@^/$regexRoute$@"",$path)){ 
  
 return$this->executeController( 
  
 $route,$path,$info,$request 
  
 ); 
  
 } 
  
 }
  
 $errorController=newErrorController( $this->di, 
  
 $request 
  
 ); 
  
 return$errorController->notFound(); }
  
 privatefunctionexecuteController( 
  
 string$route, 
  
 string$path, 
  
 array$info, 
  
 Request$request 
  
 ):string{ 
  
 $controllerName='\Bookstore\Controllers\\' 
  
 .$info['controller'].'Controller'; 
  
 $controller=new$controllerName($this->di,$request);
  
 if(isset($info['login'])&&$info['login']){ 
  
 if($request->getCookies()->has('user')){ 
  
 $customerId=$request->getCookies()->get('user');",NA
Thereisonelastplacethatyouneedtochange.The,login,NA
methodof ,CustomerController,NA
"wasinstantiatingacontrollertoo,soweneedtoinjectthe ",NA,NA
dependencyinjectorthereaswell:,"$newController=newBookController($this->di,$this->request);",NA
Summary,NA,NA
"Inthischapter,youlearnedwhatMVCis,andhowtowriteanapplicationthatfollows ",NA,NA
"thatpattern.Youalsoknowhowtousearoutertorouterequeststocontrollers,Twigto ",NA,NA
"writetemplates,andComposertomanageyourdependenciesandautoloader.Youwer",NA,NA
e ,NA,NA
"introducedtodependencyinjection,andyouevenbuiltyourownimplementation,eve",NA,NA
n thoughitisaverycontroversialtopicwithmanydifferentpointsofview.,NA,NA
"Inthenextchapter,wewillgothroughoneofthemostimportantpartsneededwhen ",NA,NA
writinggoodcodeandgoodapplications:unittestingyourcodetogetquickfeedback ,NA,NA
fromit.,NA,NA
Chapter7.TestingWebApplications,NA,NA
Weareprettysureyouhaveheardtheterm“bug”whenspeakingaboutapplications.,NA,NA
Sentencessuchas“Wefoundabugintheapplicationthat…”followedbysomevery ,NA,NA
undesirablebehavioraremorecommonthanyouthink.Writingcodeisnottheonlytask ,NA,NA
ofadeveloper;testingitiscrucialtoo.Youshouldnotreleaseaversionofyour ,NA,NA
"applicationthathasnotbeentested.However,couldyouimaginehavingtotestyourentire ",NA,NA
applicationeverytimeyouchangealine?Itwouldbeanightmare!,NA,NA
"Well,wearenotthefirstonestohavethisissue,so,luckilyenough,developershave ",NA,NA
"alreadyfoundaprettygoodsolutiontothisproblem.Infact,theyfoundmorethanone ",NA,NA
"solution,turningtestingintoaveryhottopicofdiscussion.Evenbeingatestdeveloper ",NA,NA
"hasbecomequiteacommonrole.Inthischapter,wewillintroduceyoutooneofthe ",NA,NA
approachesoftestingyourcode:unittests.,NA,NA
"Inthischapter,youwilllearnabout:",NA,NA
Howunittestswork ,NA,NA
ConfiguringPHPUnittotestyourcode ,NA,NA
"Writingtestswithassertions,dataproviders,andmock",NA,NA
s Goodandbadpracticeswhenwritingunittests,NA,NA
Thenecessityfortests,NA,NA
"Whenyouworkonaproject,chancesarethatyouarenottheonlydeveloperwhowill ",NA,NA
"workwiththiscode.Eveninthecasewhereyouaretheonlyonewhowilleverchangeit, ",NA,NA
"ifyoudothisafewweeksaftercreatingit,youwillprobablynotrememberalltheplaces ",NA,NA
"thatthispieceofcodeisaffected.Okay,let’sassumethatyouaretheonlydeveloperand ",NA,NA
yourmemoryisbeyondlimits;wouldyoubeabletoverifythatachangeonafrequently ,NA,NA
"usedobject,suchasarequest,willalwaysworkasexpected?Moreimportantly,would ",NA,NA
youliketodoiteverysingletimeyoumakeatinychange?,NA,NA
Typesoftests,NA,NA
"Whilewritingyourapplication,makingchangestotheexistingcode,oraddingnew ",NA,NA
"features,itisveryimportanttogetgood",NA,NA
feedback,NA,NA
.Howdoyouknowthatthefeedback ,NA,NA
yougetisgoodenough?ItshouldaccomplishtheAEIOUprinciples:,NA,NA
Automatic,NA,NA
:Gettingthefeedbackshouldbeaspainlessaspossible.Gettingitby ,NA,NA
runningjustonecommandisalwayspreferabletohavingtotestyourapplication ,NA,NA
manually.,NA,NA
Extensive,NA,NA
":Weshouldbeabletocoverasmanyusecasesaspossible,includingedge ",NA,NA
casesthataredifficulttoforeseewhenwritingcode.,NA,NA
Immediate,NA,NA
:Youshouldgetitassoonaspossible.Thismeansthatthefeedbackthat ,NA,NA
yougetjustafterintroducingachangeiswaybetterthanthefeedbackthatyouget ,NA,NA
afteryourcodeisinproduction.,NA,NA
Open,NA,NA
":Theresultsshouldbetransparent,andalso,thetestsshouldgiveusinsightto ",NA,NA
otherdevelopersastohowtointegrateoroperatewiththecode.,NA,NA
Useful,NA,NA
":Itshouldanswerquestionssuchas“Willthischangework?”,“Willitbreak ",NA,NA
"theapplicationunexpectedly?”,or“Isthereanyedgecasethatdoesnotwork ",NA,NA
properly?”.,NA,NA
"So,eventhoughtheconceptisquiteweirdatthebeginning,thebestwaytotestyourcode ",NA,NA
is…withmorecode.Exactly!Wewillwritecodewiththegoaloftestingthecodeofour ,NA,NA
"application.Why?Well,itisthebestwayweknowtosatisfyalltheAEIUprinciples,and ",NA,NA
ithasthefollowingadvantages:,NA,NA
Wecanexecutethetestsbyjustrunningonecommandfromourcommandlineor ,NA,NA
evenfromourfavoriteIDE.Thereisnoneedtomanuallytestyourapplicationviaa ,NA,NA
browsercontinually.,NA,NA
"Weneedtowritethetestjustonce.Atthebeginning,itmaybeabitpainful,butonce ",NA,NA
"thecodeiswritten,youwillnotneedtorepeatitagainandagain.Thismeansthat ",NA,NA
"aftersomework,wewillbeabletotesteverysinglecaseeffortlessly.Ifwehadto ",NA,NA
"testitmanually,alongwithalltheusecasesandedgecases,itwouldbeanightmare.",NA,NA
Youdonotneedtohavethewholeapplicationworkinginordertoknowwhether ,NA,NA
yourcodeworks.Imaginethatyouarewritingyourrouter:inordertoknowwhether ,NA,NA
"itworks,youwillhavetowaituntilyourapplicationworksinabrowser.Instead,you ",NA,NA
canwriteyourtestsandrunthemassoonasyoufinishyourclass.,NA,NA
"Whenwritingyourtests,youwillbeprovidedwithfeedbackonwhatisfailing.This ",NA,NA
isveryusefultoknowwhenaspecificfunctionoftherouterdoesnotworkandthe ,NA,NA
"reasonforthefailure,whichisbetterthangettinga500erroronourbrowser.",NA,NA
Wehopethatbynowwehavesoldyouontheideathatwritingtestsisindispensable.This ,NA,NA
"wastheeasypart,though.Theproblemisthatweknowseveraldifferentapproaches.Do ",NA,NA
wewriteteststhattesttheentireapplicationorteststhattestspecificparts?Doweisolate ,NA,NA
thetestedareafromtherest?Dowewanttointeractwiththedatabaseorwithother ,NA,NA
"externalresourceswhiletesting?Dependingonyouranswers,youwilldecideonwhich ",NA,NA
typeoftestsyouwanttowrite.Let’sdiscussthethreemainapproachesthatdevelopers,NA,NA
agreewith:,NA,NA
Unittests,NA,NA
:Theseareteststhathaveaveryfocusedscope.Theiraimistotestasingle ,NA,NA
"classormethod,isolatingthemfromtherestofcode.Takeyour",Sale,NA
domainclassas ,NA,NA
"anexample:ithassomelogicregardingtheadditionofbooks,right?Aunittest ",NA,NA
"mightjustinstantiateanewsale,addbookstotheobject,andverifythatthearrayof ",NA,NA
"booksisvalid.Unittestsaresuperfastduetotheirreducedscope,soyoucanhave ",NA,NA
"severaldifferentscenariosofthesamefunctionalityeasily,coveringalltheedge ",NA,NA
"casesyoucanimagine.Theyarealsoisolated,whichmeansthatwewillnotcaretoo ",NA,NA
"muchabouthowallthepiecesofourapplicationareintegrated.Instead,wewill ",NA,NA
makesurethateachpieceworksperfectlyfine.,NA,NA
Integrationtests,NA,NA
:Thesearetestswithawiderscope.Theiraimistoverifythatall ,NA,NA
"thepiecesofyourapplicationworktogether,sotheirscopeisnotlimitedtoaclassor ",NA,NA
functionbutratherincludesasetofclassesorthewholeapplication.Thereisstill ,NA,NA
someisolationincasewedonotwanttousearealdatabaseordependonsomeother ,NA,NA
externalwebservice.Anexampleinourapplicationwouldbetosimulatea,Request,NA
"object,sendittotherouter,andverifythattheresponseisasexpected.",NA,NA
Acceptancetests,NA,NA
:Thesearetestswithanevenwiderscope.Theytrytotestawhole ,NA,NA
"functionalityfromtheuser’spointofview.Inwebapplications,thismeansthatwe ",NA,NA
"canlaunchabrowserandsimulatetheclicksthattheuserwouldmake,assertingthe ",NA,NA
"responseinthebrowsereachtime.Andyes,allofthisthroughcode!Thesetestsare ",NA,NA
"slowertorun,asyoucanimagine,becausetheirscopeislargerandworkingwitha ",NA,NA
browserslowsthemdownquitealottoo.,NA,NA
"So,withallthesetypesoftests,whichoneshouldyouwrite?Theanswerisallofthem.",NA,NA
Thetrickistoknowwhenandhowmanyofeachtypeyoushouldwrite.Onegood ,NA,NA
"approachistowritealotofunittests,coveringabsolutelyeverythinginyourcode,then ",NA,NA
writingfewerintegrationteststomakesurethatallthecomponentsofyourapplication ,NA,NA
"worktogether,andfinallywritingacceptancetestsbuttestingonlythemainflowsofyour ",NA,NA
application.Thefollowingtestpyramidrepresentsthisidea:,NA,NA
Thereasonissimple:yourrealfeedbackwillcomefromyourunittests.Theywilltellyou ,NA,NA
ifyoumessedupsomethingwithyourchangesassoonasyoufinishwritingthembecause ,NA,NA
executingunittestsiseasyandfast.Onceyouknowthatallyourclassesandfunctions,NA,NA
"behaveasexpected,youneedtoverifythattheycanworktogether.However,forthis,you ",NA,NA
donotneedtotestalltheedgecasesagain;youalreadydidthiswhenwritingunittests.,NA,NA
"Here,youneedtowritejustafewintegrationteststhatconfirmthatallthepieces ",NA,NA
"communicateproperly.Finally,tomakesurethatnotonlythatthecodeworksbutalsothe ",NA,NA
"userexperienceisthedesiredone,wewillwriteacceptanceteststhatemulateausergoing ",NA,NA
"throughthedifferentviews.Here,testsareveryslowandonlypossibleoncetheflowis ",NA,NA
"complete,sothefeedbackcomeslater.Wewilladdacceptanceteststomakesurethatthe ",NA,NA
"mainflowswork,butwedonotneedtotesteverysinglescenarioaswealreadydidthis ",NA,NA
withintegrationandunittests.,NA,NA
Unittestsandcodecoverage,NA,NA
"Nowthatyouknowwhattestsare,whyweneedthem,andwhichtypesoftestswehave, ",NA,NA
wewillfocustherestofthechapteronwritinggoodunittestsastheywillbetheonesthat ,NA,NA
willoccupymostofyourtime.,NA,NA
"Asweexplainedbefore,theideaofaunittestistomakesurethatapieceofcode,usually ",NA,NA
"aclassormethod,worksasexpected.Astheamountofcodethatamethodcontains ",NA,NA
"shouldbesmall,runningthetestshouldtakealmostnotime.Takingadvantageofthis,we ",NA,NA
"willrunseveraltests,tryingtocoverasmanyusecasesaspossible.",NA,NA
"Ifthisisnotthefirsttimeyou’veheardaboutunittests,youmightknowtheconceptof ",NA,NA
codecoverage,NA,NA
".Thisconceptreferstotheamountofcodethatourtestsexecute,thatis, ",NA,NA
"thepercentageoftestedcode.Forexample,ifyourapplicationhas10,000linesandyour ",NA,NA
"teststestatotalof7,500lines,yourcodecoverageis75%.Therearetoolsthatshow ",NA,NA
"marksonyourcodetoindicatewhetheracertainlineistestedornot,whichisveryuseful ",NA,NA
inordertoidentifywhichpartsofyourapplicationarenottestedandthuswarnyouthatit ,NA,NA
ismoredangeroustochangethem.,NA,NA
"However,codecoverageisadouble-edgesword.Whyisthisso?Thisisbecause ",NA,NA
"developerstendtogetobsessedwithcodecoverage,aimingfora100%coverage.",NA,NA
"However,youshouldbeawarethatcodecoverageisjustaconsequence,notyourgoal.",NA,NA
Yourgoalistowriteunitteststhatverifyalltheusecasesofcertainpiecesofcodein ,NA,NA
ordertomakeyoufeelsafereachtimethatyouhavetochangethiscode.Thismeansthat ,NA,NA
"foragivenmethod,itmightnotbeenoughtowriteonetestbecausethesamelinewith ",NA,NA
"differentinputvaluesmaybehavedifferently.However,ifyourfocuswasoncode ",NA,NA
"coverage,writingonetestwouldsatisfyit,andyoumightnotneedtowriteanymoretests.",NA,NA
IntegratingPHPUnit,NA,NA
Writingtestsisataskthatyoucoulddobyyourself;youjustneedtowritecodethat ,NA,NA
throwsexceptionswhenconditionsarenotmetandthenrunthescriptanytimeyouneed.,NA,NA
"Luckily,otherdeveloperswerenotsatisfiedwiththismanualprocess,sothey ",NA,NA
implementedtoolstohelpusautomatethisprocessandgetgoodfeedback.Themostused ,NA,NA
inPHPis,NA,NA
PHPUnit,NA,NA
.PHPUnitisaframeworkthatprovidesasetoftoolstowritetestsin ,NA,NA
"aneasiermanner,givesustheabilitytoruntestsautomatically,anddeliversuseful ",NA,NA
feedbacktothedeveloper.,NA,NA
"InordertousePHPUnit,traditionally,weinstalleditonourlaptop.Indoingso,weadded ",NA,NA
theclassesoftheframeworktoincludethepathofPHPandalsotheexecutabletorunthe ,NA,NA
tests.Thiswaslessthanidealasweforceddeveloperstoinstallonemoretoolontheir ,NA,NA
"developmentmachine.Nowadays,Composer(referto",NA,NA
Chapter6,NA,NA
",",NA,NA
AdaptingtoMVC,NA,NA
",in ",NA,NA
ordertorefreshyourmemory)helpsusinincludingPHPUnitasadependencyofthe ,NA,NA
"project.ThismeansthatrunningComposer,whichyouwilldoforsureinordertogetthe ",NA,NA
"restofthedependencies,willgetPHPUnittoo.Add,then,thefollowinginto ",composer.json,NA
:,"{ 
  
 //...
  
 ""require"":{ 
  
 ""monolog/monolog"":""^1.17"", 
  
 ""twig/twig"":""^1.23"" 
  
 }, 
  
 ""require-dev"":{ 
  
 ""phpunit/phpunit"":""5.1.3"" 
  
 }, 
  
 ""autoload"":{ 
  
 ""psr-4"":{ 
  
 ""Bookstore\\"":""src"" 
  
 } 
  
 } 
  
 }",NA
Notethatthisdependencyisaddedas,require-dev,NA
.Thismeansthatthedependencywill ,NA,NA
"bedownloadedonlywhenweareonadevelopmentenvironment,butitwillnotbepartof ",NA,NA
theapplicationthatwewilldeployonproductionaswedonotneedtorunteststhere.To ,NA,NA
"getthedependency,asalways,run",composerupdate,NA
.,NA,NA
AdifferentapproachistoinstallPHPUnitgloballysothatalltheprojectsonyour ,NA,NA
developmentenvironmentcanuseitinsteadofinstallingitlocallyeachtime.Youcanread ,NA,NA
abouthowtoinstalltoolsgloballywithComposerat,NA,NA
https://akrabat.com/global-,NA,NA
installation-of-php-tools-with-composer/,NA,NA
.,NA,NA
Thephpunit.xmlfile,NA,NA
PHPUnitneedsa,phpunit.xml,NA
fileinordertodefinethewaywewanttorunthetests. ,NA,NA
"Thisfiledefinesasetofruleslikewherethetestsare,whatcodearetheteststesting,and ",NA,NA
soon.Addthefollowingfileinyourrootdirectory:,"<?xmlversion=""1.0""encoding=""UTF-8""?>
  
 <phpunitbackupGlobals=""false"" 
  
 backupStaticAttributes=""false"" colors=""true"" 
  
 convertErrorsToExceptions=""true"" 
 convertNoticesToExceptions=""true"" 
 convertWarningsToExceptions=""true"" 
 processIsolation=""false"" 
  
 stopOnFailure=""false"" 
  
 syntaxCheck=""false"" 
  
 bootstrap=""vendor/autoload.php"" 
 > 
  
 <testsuites> 
  
 <testsuitename=""BookstoreTestSuite""> 
 <directory>./tests/</directory> 
  
 </testsuite> 
  
 </testsuites> 
  
 <filter> 
  
 <whitelist> 
  
 <directory>./src</directory> 
  
 </whitelist> 
  
 </filter> 
  
 </phpunit>",NA
Thisfiledefinesquitealotofthings.Themostimportantareexplainedasfollows:,NA,NA
Setting,convertErrorsToExceptions,NA
",",convertNoticesToExceptions,NA
",and ",convertWarningsToExceptions,NA
to,true,NA
willmakeyourtestsfailifthereisaPHP ,NA,NA
"error,warning,ornotice.Thegoalistomakesurethatyourcodedoesnotcontain ",NA,NA
"minorerrorsonedgecases,whicharealwaysthesourceofpotentialproblems. ",NA,NA
The,stopOnFailure,NA
tellsPHPUnitwhetheritshouldcontinueexecutingtherestof ,NA,NA
"testsornotwhenthereisafailedtest.Inthiscase,wewanttorunallofthemto ",NA,NA
knowhowmanytestsarefailingandwhy.,NA,NA
The,bootstrap,NA
defineswhichfileweshouldexecutebeforestartingtorunthetests.,NA,NA
"Themostcommonusageistoincludetheautoloader,butyoucouldalsoincludea ",NA,NA
"filethatinitializessomedependencies,suchasdatabasesorconfigurationreaders.",NA,NA
The,testsuites,NA
definesthedirectorieswherePHPUnitwilllookfortests.Inour ,NA,NA
"case,wedefined",./tests,NA
",butwecouldaddmoreifwehadthemindifferent ",NA,NA
directories.,NA,NA
The,whitelist,NA
definesthelistofdirectoriesthatcontainthecodethatwearetesting. ,NA,NA
Thiscanbeusefultogenerateoutputrelatedtothecodecoverage.,NA,NA
"WhenrunningthetestswithPHPUnit,justmakesurethatyourunthecommandfromthe ",NA,NA
samedirectorywherethe,phpunit.xml,NA
fileis.Wewillshowyouhowinthenextsection.,NA,NA
Yourfirsttest,NA,NA
"Right,that’senoughpreparationsandtheory;let’swritesomecode.Wewillwritetestsfor ",NA,NA
"thebasiccustomer,whichisadomainobjectwithlittlelogic.Firstofall,weneedto ",NA,NA
refactorthe,Unique,NA
traitasitstillcontainssomeunnecessarycodeafterintegratingour ,NA,NA
"applicationwithMySQL.WearetalkingabouttheabilitytoassignthenextavailableID, ",NA,NA
"whichisnowhandledbytheautoincrementalfield.Removeit,leavingthecodeas follows:","<?php
  
 namespaceBookstore�tils;
  
 traitUnique{ 
  
 protected$id;
  
 publicfunctionsetId(int$id){ 
  
 $this->id=$id; 
  
 }
  
 publicfunctiongetId():int{ 
  
 return$this->id; 
  
 } 
  
 }",NA
Thetestswillbeinsidethe,tests/,NA
directory.Thestructureofdirectoriesshouldbethe ,NA,NA
sameasinthe,src/,NA
directorysothatitiseasiertoidentifywhereeachtestshouldbe.The ,NA,NA
fileandtheclassnamesneedtoendwith,Test,NA
sothatPHPUnitknowsthatafilecontains ,NA,NA
"tests.Knowingthis,ourtestshouldbein",tests/Domain/Customer/BasicTest.php,NA
",as follows:","<?php
  
 namespaceBookstore\Tests\Domain\Customer;
  
 useBookstore\Domain\Customer\Basic; 
  
 usePHPUnit_Framework_TestCase;
  
 classBasicTestextendsPHPUnit_Framework_TestCase{ 
  
 publicfunctiontestAmountToBorrow(){ 
  
 $customer=newBasic(1,'han','solo','han@solo.com');
  
 $this->assertSame( 
  
 3, 
  
 $customer->getAmountToBorrow(), 
  
 'Basiccustomershouldborrowupto3books.' ); 
  
 } 
  
 }",NA
"Asyoucannote,the",BasicTest,NA
classextendsfrom,PHPUnit_Framework_TestCase,NA
.All ,NA,NA
testclasseshavetoextendfromthisclass.Thisclasscomeswithasetofmethodsthat ,NA,NA
allowyoutomakeassertions.AnassertioninPHPUnitisjustacheckperformedona,NA,NA
"value.Assertionscanbecomparisonstoothervalues,averificationofsomeattributesof ",NA,NA
"thevalues,andsoon.Ifanassertionisnottrue,thetestwillbemarkedasfailed, ",NA,NA
outputtingthepropererrormessagetothedeveloper.Theexampleshowsanassertion ,NA,NA
usingthe,assertSame,NA
"method,whichwillcomparetwovalues,expectingthatbothof ",NA,NA
themareexactlythesame.Thethirdargumentisanerrormessagethattheassertionwill ,NA,NA
showincaseitfails.,NA,NA
"Also,notethatthefunctionnamesthatstartwith",test,NA
aretheonesexecutedwith ,NA,NA
"PHPUnit.Inthisexample,wehaveoneuniquetestnamed",testAmountToBorrow,NA
that ,NA,NA
instantiatesabasiccustomerandverifiesthattheamountofbooksthatthecustomercan ,NA,NA
"borrowis3.Inthenextsection,wewillshowyouhowtorunthistestandgetfeedback ",NA,NA
fromit.,NA,NA
"Optionally,youcoulduseanyfunctionnameifyouaddthe",@test,NA
annotationinthe ,NA,NA
"method’sDocBlock,asfollows:","/** 
  
 *@test 
  
 */ 
  
 publicfunctionthisIsATestToo(){ 
  
 //...
  
 }",NA
Runningtests,NA,NA
"Inordertorunthetestsyouwrote,youneedtoexecutethescriptthatComposergenerated ",NA,NA
in,vendor/bin,NA
.Rememberalwaystorunfromtherootdirectoryoftheprojectsothat ,NA,NA
PHPUnitcanfindyour,phpunit.xml,NA
"configurationfile.Then,type ",./vendor/bin/phpunit,NA
.,NA,NA
"Whenexecutingthisprogram,wewillgetthefeedbackgivenbythetests.Theoutput ",NA,NA
showsusthatthereisonetest(onemethod)andoneassertionandwhetherthesewere ,NA,NA
"satisfactory.Thisoutputiswhatyouwouldliketoseeeverytimeyourunyourtests,but ",NA,NA
youwillgetmorefailedteststhanyouwouldlike.Let’stakealookatthembyaddingthe ,NA,NA
followingtest:,"publicfunctiontestFail(){ 
  
 $customer=newBasic(1,'han','solo','han@solo.com');
  
 $this->assertSame( 
  
 4, 
  
 $customer->getAmountToBorrow(), 
  
 'Basiccustomershouldborrowupto3books.' ); 
  
 }",NA
Thistestwillfailaswearecheckingwhether,getAmountToBorrow,NA
"returns4,butyouknow ",NA,NA
thatitalwaysreturns3.Let’srunthetestsandtakealookatwhatkindofoutputweget.,NA,NA
Wecanquicklynotethattheoutputisnotgoodduetotheredcolor.Itshowsusthatthere ,NA,NA
"isafailure,pointingtotheclassandtestmethodthatfailed.Thefeedbackpointsoutthe ",NA,NA
"typeoffailure(as3isnotidenticalto4)andoptionally,theerrormessageweaddedwhen ",NA,NA
invokingthe,assert,NA
method.,NA,NA
Writingunittests,NA,NA
Let’sstartdiggingintoallthefeaturesthatPHPUnitoffersusinordertowritetests.We ,NA,NA
"willdividethesefeaturesindifferentsubsections:settingupatest,assertions,exceptions, ",NA,NA
"anddataproviders.Ofcourse,youdonotneedtouseallofthesetoolseachtimeyouwrite ",NA,NA
atest.,NA,NA
Thestartandendofatest,NA,NA
PHPUnitgivesyoutheopportunitytosetupacommonscenarioforeachtestinaclass. ,NA,NA
"Forthis,youneedtousethe",setUp,NA
"method,which,ifpresent,isexecutedeachtimethata ",NA,NA
testofthisclassisexecuted.Theinstanceoftheclassthatinvokesthe,setUp,NA
and,test,NA
"methodsisthesame,soyoucanusethepropertiesoftheclasstosavethecontext.One ",NA,NA
commonusewouldbetocreatetheobjectthatwewilluseforourtestsincasethisis ,NA,NA
"alwaysthesame.Foranexample,writethefollowingcodein ",tests/Domain/Customer/BasicTest.php,NA
:,"<?php
  
 namespaceBookstore\Tests\Domain\Customer;
  
 useBookstore\Domain\Customer\Basic; 
  
 usePHPUnit_Framework_TestCase;
  
 classBasicTestextendsPHPUnit_Framework_TestCase{ private$customer;
  
 publicfunctionsetUp(){ 
  
 $this->customer=newBasic( 
  
 1,'han','solo','han@solo.com' ); 
  
 }
  
 publicfunctiontestAmountToBorrow(){ 
  
 $this->assertSame( 
  
 3, 
  
 $this->customer->getAmountToBorrow(), 
  
 'Basiccustomershouldborrowupto3books.' ); 
  
 } 
  
 }",NA
When,testAmountToBorrow,NA
"isinvoked,the",$customer,NA
propertyisalreadyinitialized ,NA,NA
throughtheexecutionofthe,setUp,NA
"method.Iftheclasshadmorethanonetest,the",setUp,NA
methodwouldbeexecutedeachtime.,NA,NA
"Eventhoughitislesscommontouse,thereisanothermethodusedtocleanupthe ",NA,NA
scenarioafterthetestisexecuted:,tearDown,NA
".Thisworksinthesameway,butitis ",NA,NA
executedaftereachtestofthisclassisexecuted.Possibleuseswouldbetocleanup ,NA,NA
"databasedata,closeconnections,deletefiles,andsoon.",NA,NA
Assertions,NA,NA
"Youhavealreadybeenintroducedtotheconceptofassertions,solet’sjustlistthemost ",NA,NA
"commononesinthissection.Forthefulllist,werecommendyoutovisittheofficial ",NA,NA
documentationat,NA,NA
https://phpunit.de/manual/current/en/appendixes.assertions.ht,NA,NA
ml,NA,NA
"asitis quiteextensive;however,tobehonest,youwillprobablynotusemanyofthem.",NA,NA
"ThefirsttypeofassertionthatwewillseeistheBooleanassertion,thatis,theonethat ",NA,NA
checkswhetheravalueis,true,NA
or,false,NA
.Themethodsareassimpleas,assertTrue,NA
and ,assertFalse,NA
",andtheyexpectoneparameter,whichisthevaluetoassert,andoptionally, ",NA,NA
atexttodisplayincaseoffailure.Inthesame,BasicTest,NA
"class,addthefollowingtest:","publicfunctiontestIsExemptOfTaxes(){ 
  
 $this->assertFalse( 
  
 $this->customer->isExemptOfTaxes(), 
  
 'Basiccustomershouldbeexemptoftaxes.' ); 
  
 }",NA
Thistestmakessurethatabasiccustomerisneverexemptoftaxes.Notethatwecoulddo ,NA,NA
thesameassertionbywritingthefollowing:,"$this->assertSame( 
  
 $this->customer->isExemptOfTaxes(), 
  
 false, 
  
 'Basiccustomershouldbeexemptoftaxes.' );",NA
Asecondgroupofassertionswouldbethecomparisonassertions.Themostfamousones ,NA,NA
are,assertSame,NA
and,assertEquals,NA
".Youhavealreadyusedthefirstone,butareyousure ",NA,NA
ofitsmeaning?Let’saddanothertestandrunit:,"publicfunctiontestGetMonthlyFee(){ 
  
 $this->assertSame( 
  
 5, 
  
 $this->customer->getMonthlyFee(), 
  
 'Basiccustomershouldpay5amonth.' ); 
  
 }",NA
Theresultofthetestisshowninthefollowingscreenshot:,NA,NA
Thetestfailed!Thereasonisthat,assertSame,NA
istheequivalenttocomparingusing ,NA,NA
"identity,thatis,withoutusingtypejuggling.Theresultofthe",getMonthlyFee,NA
methodis ,NA,NA
"alwaysafloat,andwewillcompareitwithaninteger,soitwillneverbethesame,asthe ",NA,NA
errormessagetellsus.Changetheassertionto,assertEquals,NA
",whichcomparesusing ",NA,NA
"equality,andthetestwillpassnow.",NA,NA
"Whenworkingwithobjects,wecanuseanassertiontocheckwhetheragivenobjectisan ",NA,NA
"instanceoftheexpectedclassornot.Whendoingso,remembertosendthefullnameof ",NA,NA
"theclassasthisisaquitecommonmistake.Evenbetter,youcouldgettheclassname ",NA,NA
using,::class,NA
",forexample,",Basic::class,NA
.Addthefollowingtestin ,tests/Domain/Customer/CustomerFactoryTest.php,NA
:,"<?php
  
 namespaceBookstore\Tests\Domain\Customer;
  
 useBookstore\Domain\Customer\CustomerFactory; 
 usePHPUnit_Framework_TestCase;
  
 classCustomerFactoryTestextendsPHPUnit_Framework_TestCase{ 
 publicfunctiontestFactoryBasic(){ 
  
 $customer=CustomerFactory::factory( 
  
 'basic',1,'han','solo','han@solo.com' 
  
 );
  
 $this->assertInstanceOf( 
  
 Basic::class, 
  
 $customer, 
  
 'basicshouldcreateaCustomer\Basicobject.' );",NA
Thistestcreatesacustomerusingthe,customer,NA
factory.Asthetypeofcustomerwas ,basic,NA
",theresultshouldbeaninstanceof",Basic,NA
",whichiswhatwearetestingwith ",assertInstanceOf,NA
".Thefirstargumentistheexpectedclass,thesecondistheobjectthat ",NA,NA
"wearetesting,andthethirdistheerrormessage.Thistestalsohelpsustonotethe ",NA,NA
behaviorofcomparisonassertionswithobjects.Let’screateabasic,customer,NA
objectas ,NA,NA
"expectedandcompareitwiththeresultofthefactory.Then,runthetest,asfollows:","$expectedBasicCustomer=newBasic(1,'han','solo','han@solo.com');
  
 $this->assertSame( 
  
 $customer, 
  
 $expectedBasicCustomer, 
  
 'Customerobjectisnotasexpected.' );",NA
Theresultofthistestisshowninthefollowingscreenshot:,NA,NA
"Thetestfailedbecausewhenyoucomparetwoobjectswithidentitycomparison,you ",NA,NA
"comparingtheobjectreference,anditwillonlybethesameifthetwoobjectsareexactly ",NA,NA
"thesameinstance.Ifyoucreatetwoobjectswiththesameproperties,theywillbeequal ",NA,NA
"butneveridentical.Tofixthetest,changetheassertionasfollows:","$expectedBasicCustomer=newBasic(1,'han','solo','han@solo.com');
  
 $this->assertEquals( 
  
 $customer, 
  
 $expectedBasicCustomer, 
  
 'Customerobjectisnotasexpected.'",NA
Let’snowwritethetestsforthe,sale,NA
domainobjectat,tests/Domain/SaleTest.php,NA
.This ,NA,NA
"classisveryeasytotestandallowsustousesomenewassertions,asfollows:","<?php
  
 namespaceBookstore\Tests\Domain\Customer;
  
 useBookstore\Domain\Sale; 
  
 usePHPUnit_Framework_TestCase;
  
 classSaleTestextendsPHPUnit_Framework_TestCase{ 
 publicfunctiontestNewSaleHasNoBooks(){ 
  
 $sale=newSale();
  
 $this->assertEmpty( 
  
 $sale->getBooks(), 
  
 'Whennew,saleshouldhavenobooks.' ); 
  
 }
  
 publicfunctiontestAddNewBook(){ $sale=newSale(); 
  
 $sale->addBook(123);
  
 $this->assertCount( 
  
 1, 
  
 $sale->getBooks(), 
  
 'Numberofbooksnotvalid.' 
  
 ); 
  
 $this->assertArrayHasKey( 
  
 123, 
  
 $sale->getBooks(), 
  
 'Bookidcouldnotbefoundinarray.' ); 
  
 $this->assertSame( 
  
 $sale->getBooks()[123], 
  
 1, 
  
 'Whennotspecified,amountofbooksis1.' ); 
  
 } 
  
 }",NA
Weaddedtwotestshere:onemakessurethatforanew,sale,NA
"instance,thelistofbooks ",NA,NA
"associatedwithitisempty.Forthis,weusedthe",assertEmpty,NA
"method,whichtakesan ",NA,NA
arrayasanargumentandwillassertthatitisempty.Thesecondtestisaddingabookto ,NA,NA
"thesaleandthenmakingsurethatthelistofbookshasthecorrectcontent.Forthis,we ",NA,NA
willusethe,assertCount,NA
"method,whichverifiesthatthearray,thatis,thesecond ",NA,NA
"argument,hasasmanyelementsasthefirstargumentprovided.Inthiscase,weexpect ",NA,NA
thatthelistofbookshasonlyoneentry.Thesecondassertionofthistestisverifyingthat ,NA,NA
"thearrayofbookscontainsaspecifickey,whichistheIDofthebook,withthe ",assertArrayHasKey,NA
"method,inwhichthefirstargumentisthekey,andthesecondoneis ",NA,NA
"thearray.Finally,wewillcheckwiththealreadyknown",assertSame,NA
methodthatthe,NA,NA
amountofbooksinsertedis1.,NA,NA
"Eventhoughthesetwonewassertionmethodsareusefulsometimes,allthethree ",NA,NA
assertionsofthelasttestcanbereplacedbyjustan,assertSame,NA
"method,comparingthe ",NA,NA
"wholearrayofbookswiththeexpectedone,asfollows:","$this->assertSame( 
  
 [123=>1], 
  
 $sale->getBooks(), 
  
 'Booksarraydoesnotmatch.' 
  
 );",NA
Thesuiteoftestsforthe,sale,NA
domainobjectwouldnotbeenoughifwewerenottesting ,NA,NA
"howtheclassbehaveswhenaddingmultiplebooks.Inthiscase,using",assertCount,NA
and ,assertArrayHasKey,NA
"wouldmakethetestunnecessarilylong,solet’sjustcomparethe ",NA,NA
arraywithanexpectedoneviathefollowingcode:,"publicfunctiontestAddMultipleBooks(){ 
 $sale=newSale(); 
  
 $sale->addBook(123,4); 
  
 $sale->addBook(456,2); 
  
 $sale->addBook(456,8);
  
 $this->assertSame( 
  
 [123=>4,456=>10], 
  
 $sale->getBooks(), 
  
 'Booksarenotasexpected.' 
  
 ); 
  
 }",NA
Expectingexceptions,NA,NA
"Sometimes,amethodisexpectedtothrowanexceptionforcertainunexpectedusecases.",NA,NA
"Whenthishappens,youcouldtrytocapturethisexceptioninsidethetestortake ",NA,NA
advantageofanothertoolthatPHPUnitoffers:,NA,NA
expectingexceptions,NA,NA
.Tomarkatestto ,NA,NA
"expectagivenexception,justaddthe",@expectedException,NA
annotationfollowedbythe ,NA,NA
"exception’sclassfullname.Optionally,youcanuse",@expectedExceptionMessage,NA
to ,NA,NA
assertthemessageoftheexception.Let’saddthefollowingteststoour ,CustomerFactoryTest,NA
class:,"/** 
  
 *@expectedException\InvalidArgumentException 
 *@expectedExceptionMessageWrongtype.
  
 */ 
  
 publicfunctiontestCreatingWrongTypeOfCustomer(){ 
 $customer=CustomerFactory::factory( 
  
 'deluxe',1,'han','solo','han@solo.com'
  
 ); 
  
 }",NA
"Inthistestwewilltrytocreateadeluxecustomerwithourfactory,butasthistypeof ",NA,NA
"customerdoesnotexist,wewillgetanexception.Thetypeoftheexpectedexceptionis ",InvalidArgumentException,NA
",andtheerrormessageis“Wrongtype”.Ifyourunthetests, ",NA,NA
youwillseethattheypass.,NA,NA
"Ifwedefinedanexpectedexceptionandtheexceptionisneverthrown,thetestwillfail; ",NA,NA
"expectingexceptionsisjustanothertypeofassertion.Toseethishappen,addthe ",NA,NA
"followingtoyourtestandrunit;youwillgetafailure,andPHPUnitwillcomplainsaying ",NA,NA
"thatitexpectedtheexception,butitwasneverthrown:","/** 
  
 *@expectedException\InvalidArgumentException */ 
  
 publicfunctiontestCreatingCorrectCustomer(){ 
 $customer=CustomerFactory::factory( 
  
 'basic',1,'han','solo','han@solo.com' ); 
  
 }",NA
Dataproviders,NA,NA
"Ifyouthinkabouttheflowofatest,mostofthetime,weinvokeamethodwithaninput ",NA,NA
"andexpectanoutput.Inordertocoveralltheedgecases,itisnaturalthatwewillrepeat ",NA,NA
thesameactionwithasetofinputsandexpectedoutputs.PHPUnitgivesustheabilityto ,NA,NA
"doso,thusremovingalotofduplicatedcode.Thisfeatureiscalled",NA,NA
dataproviding,NA,NA
.,NA,NA
Adataproviderisapublicmethoddefinedinthe,test,NA
classthatreturnsanarraywitha ,NA,NA
specificschema.Eachentryofthearrayrepresentsatestinwhichthekeyisthenameof ,NA,NA
"thetest—optionally,youcouldusenumerickeys—andthevalueistheparameterthatthe ",NA,NA
testneeds.Atestwilldeclarethatitneedsadataproviderwiththe,@dataProvider,NA
"annotation,andwhenexecutingtests,thedataproviderinjectstheargumentsthatthetes",NA,NA
t methodneeds.Let’sconsideranexampletomakeiteasier.Writethefollowingtwo ,NA,NA
methodsinyour,CustomerFactoryTest,NA
class:,"publicfunctionproviderFactoryValidCustomerTypes(){ 
  
 return[ 
  
 'Basiccustomer,lowercase'=>[ 
  
 'type'=>'basic', 
  
 'expectedType'=>'\Bookstore\Domain\Customer\Basic' ], 
  
 'Basiccustomer,uppercase'=>[ 
  
 'type'=>'BASIC', 
  
 'expectedType'=>'\Bookstore\Domain\Customer\Basic' ], 
  
 'Premiumcustomer,lowercase'=>[ 
  
 'type'=>'premium', 
  
 'expectedType'=>'\Bookstore\Domain\Customer\Premium' ], 
  
 'Premiumcustomer,uppercase'=>[ 
  
 'type'=>'PREMIUM', 
  
 'expectedType'=>'\Bookstore\Domain\Customer\Premium' ] 
  
 ]; 
  
 }
  
 /** 
  
 *@dataProviderproviderFactoryValidCustomerTypes 
 *@paramstring$type 
  
 *@paramstring$expectedType 
  
 */ 
  
 publicfunctiontestFactoryValidCustomerTypes( 
  
 string$type, 
  
 string$expectedType 
  
 ){ 
  
 $customer=CustomerFactory::factory( 
  
 $type,1,'han','solo','han@solo.com' 
  
 ); 
  
 $this->assertInstanceOf( 
  
 $expectedType, 
  
 $customer, 
  
 'Factorycreatedthewrongtypeofcustomer.' );",NA
Thetesthereis,testFactoryValidCustomerTypes,NA
",whichexpectstwoarguments:",$type,NA
and,$expectedType,NA
.Thetestusesthemtocreateacustomerwiththefactoryandverify ,NA,NA
"thetypeoftheresult,whichwealreadydidbyhardcodingthetypes.Thetestalsodeclares ",NA,NA
thatitneedsthe,providerFactoryValidCustomerTypes,NA
dataprovider.Thisdataprovider ,NA,NA
"returnsanarrayoffourentries,whichmeansthatthetestwillbeexecutedfourtimeswith ",NA,NA
fourdifferentsetsofarguments.Thenameofeachtestisthekeyofeachentry—for ,NA,NA
"example,“Basiccustomer,lowercase”.Thisisveryusefulincaseatestfailsbecauseit ",NA,NA
"willbedisplayedaspartoftheerrormessages.Eachentryisamapwithtwovalues,",type,NA
and,expectedType,NA
",whicharethenamesoftheargumentsofthe",test,NA
method.Thevalues ,NA,NA
oftheseentriesarethevaluesthatthe,test,NA
methodwillget.,NA,NA
Thebottomlineisthatthecodewewrotewouldbethesameasifwewrote ,testFactoryValidCustomerTypes,NA
"fourtimes,hardcoding",$type,NA
and,$expectedType,NA
each ,NA,NA
time.Imaginenowthatthe,test,NA
methodcontainstensoflinesofcodeorwewantto ,NA,NA
repeatthesametestwithtensofdatasets;doyouseehowpowerfulitis?,NA,NA
Testingwithdoubles,NA,NA
"Sofar,wetestedclassesthatarequiteisolated;thatis,theydonothavemuchinteraction ",NA,NA
"withotherclasses.Nevertheless,wehaveclassesthatuseseveralclasses,suchas ",NA,NA
controllers.Whatcanwedowiththeseinteractions?Theideaofunittestsistotesta ,NA,NA
"specificmethodandnotthewholecodebase,right?",NA,NA
"PHPUnitallowsyoutomockthesedependencies;thatis,youcanprovidefakeobjectsthat ",NA,NA
"looksimilartothedependenciesthatthetestedclassneeds,buttheydonotusecodefrom ",NA,NA
thoseclasses.Thegoalofthisistoprovideadummyinstancethattheclasscanuseand ,NA,NA
invokeitsmethodswithoutthesideeffectofwhattheseinvocationsmighthave.Imagine ,NA,NA
"asanexamplethecaseofthemodels:ifthecontrollerusesarealmodel,thenwhen ",NA,NA
"invokingmethodsfromit,themodelwouldaccessthedatabaseeachtime,makingthe ",NA,NA
testsquiteunpredictable.,NA,NA
"Ifweuseamockasthemodelinstead,thecontrollercaninvokeitsmethodsasmany ",NA,NA
"timesasneededwithoutanysideeffect.Evenbetter,wecanmakeassertionsofthe ",NA,NA
argumentsthatthemockreceivedorforceittoreturnspecificvalues.Let’stakealookat ,NA,NA
howtousethem.,NA,NA
InjectingmodelswithDI,NA,NA
Thefirstthingweneedtounderstandisthatifwecreateobjectsusing,new,NA
insidethe ,NA,NA
"controller,wewillnotbeabletomockthem.Thismeansthatweneedtoinjectallthe ",NA,NA
"dependencies—forexample,usingadependencyinjector.Wewilldothisforallofthe ",NA,NA
"dependenciesbutone:themodels.Inthissection,wewilltestthe",borrow,NA
methodofthe ,BookController,NA
"class,sowewillshowthechangesthatthismethodneeds.Ofcourse,if ",NA,NA
"youwanttotesttherestofthecode,youshouldapplythesesamechangestotherestof ",NA,NA
thecontrollers.,NA,NA
Thefirstthingtodoistoaddthe,BookModel,NA
instancetothedependencyinjectorinour ,index.php,NA
"file.Asthisclassalsohasadependency,",PDO,NA
",usethesamedependency ",NA,NA
"injectortogetaninstanceofit,asfollows:","$di->set('BookModel',newBookModel($di->get('PDO')));",NA
"Now,inthe",borrow,NA
methodofthe,BookController,NA
"class,wewillchangethenew ",NA,NA
instantiationofthemodeltothefollowing:,"publicfunctionborrow(int$bookId):string{ 
 $bookModel=$this->di->get('BookModel');
  
 try{ 
  
 //...",NA
CustomizingTestCase,NA,NA
"Whenwritingyourunittest’ssuite,itisquitecommontohaveacustomized",TestCase,NA
classfromwhichalltestsextend.Thisclassalwaysextendsfrom ,PHPUnit_Framework_TestCase,NA
",sowestillgetalltheassertionsandothermethods.Asall ",NA,NA
"testshavetoimportthisclass,let’schangeourautoloadersothatitcanrecognize ",NA,NA
namespacesfromthe,tests,NA
"directory.Afterthis,run",composerupdate,NA
",asfollows:","""autoload"":{ 
  
 ""psr-4"":{ 
  
 ""Bookstore\\Tests\\"":""tests"", 
 ""Bookstore\\"":""src"" 
  
 } 
  
 }",NA
"Withthischange,wewilltellComposerthatallthenamespacesstartingwith ",Bookstore\Tests,NA
willbelocatedunderthe,tests,NA
"directory,andtherestwillfollowthe ",NA,NA
previousrules.,NA,NA
Let’saddnowourcustomized,TestCase,NA
class.Theonlyhelpermethodweneedrightnow ,NA,NA
"isonetocreatemocks.Itisnotreallynecessary,butitmakesthingscleaner.Addthe ",NA,NA
followingclassin,tests/AbstractTestClase.php,NA
:,"<?php
  
 namespaceBookstore\Tests;
  
 usePHPUnit_Framework_TestCase; 
  
 useInvalidArgumentException;
  
 abstractclassAbstractTestCaseextendsPHPUnit_Framework_TestCase{ 
 protectedfunctionmock(string$className){ 
  
 if(strpos($className,'\\')!==0){ 
  
 $className='\\'.$className; 
  
 }
  
 if(!class_exists($className)){ 
  
 $className='\Bookstore\\'.trim($className,'\\');
  
 if(!class_exists($className)){ 
  
 thrownewInvalidArgumentException( ""Class$classNamenotfound."" ); 
  
 } 
  
 }
  
 return$this->getMockBuilder($className)-
 >disableOriginalConstructor()
  
 ->getMock(); 
  
 } 
  
 }",NA
Thismethodtakesthenameofaclassandtriestofigureoutwhethertheclassispartof ,NA,NA
the,Bookstore,NA
namespaceornot.Thiswillbehandywhenmockingobjectsofourown,NA,NA
codebaseaswewillnothavetowrite,Bookstore,NA
eachtime.Afterfiguringoutwhatthe ,NA,NA
"realfullclassnameis,itusesthemockbuilderfromPHPUnittocreateoneandthen ",NA,NA
returnsit.,NA,NA
"Morehelpers!Thistime,theyareforcontrollers.Everysinglecontrollerwillalwaysneed ",NA,NA
"thesamedependencies:logger,databaseconnection,templateengine,andconfiguration ",NA,NA
"reader.Knowingthis,let’screatea",ControllerTestCase,NA
classfromwhereallthetests ,NA,NA
coveringcontrollerswillextend.Thisclasswillcontaina,setUp,NA
methodthatcreatesallthe ,NA,NA
commonmocksandsetstheminthedependencyinjector.Additasyour ,tests/ControllerTestCase.php,NA
"file,asfollows:","<?php
  
 namespaceBookstore\Tests;
  
 useBookstore�tils\DependencyInjector; 
 useBookstore\Core\Config; 
  
 useMonolog\Logger; 
  
 useTwig_Environment; 
  
 usePDO;
  
 abstractclassControllerTestCaseextendsAbstractTestCase{ protected$di;
  
 publicfunctionsetUp(){ 
  
 $this->di=newDependencyInjector(); 
  
 $this->di->set('PDO',$this->mock(PDO::class)); 
  
 $this->di->set('Utils\Config',$this->mock(Config::class)); $this->di->set( 
  
 'Twig_Environment', 
  
 $this->mock(Twig_Environment::class) 
  
 ); 
  
 $this->di->set('Logger',$this->mock(Logger::class)); } 
  
 }",NA
Usingmocks,NA,NA
"Well,we’vehadenoughofthehelpers;let’sstartwiththetests.Thedifficultparthereis ",NA,NA
"howtoplaywithmocks.Whenyoucreateone,youcanaddsomeexpectationsandreturn ",NA,NA
values.Themethodsare:,expects,NA
:Thisspecifiestheamountoftimesthemock’smethodisinvoked.Youcan ,NA,NA
send,$this->never(),NA
",",$this->once(),NA
",or",$this->any(),NA
"asanargumenttospecify0, ",NA,NA
"1,oranyinvocations.",method,NA
:Thisisusedtospecifythemethodwearetalkingabout.Theargumentthatit ,NA,NA
expectsisjustthenameofthemethod.,with,NA
:Thisisamethodusedtosettheexpectationsoftheargumentsthatthemock ,NA,NA
"willreceivewhenitisinvoked.Forexample,ifthemockedmethodisexpectedtoget ",basic,NA
asthefirstargumentand,123,NA
"asthesecond,the",with,NA
methodwillbeinvoked ,NA,NA
as,"with(""basic"",123)",NA
".Thismethodisoptional,butifwesetit,PHPUnitwill ",NA,NA
"throwanerrorincasethemockedmethoddoesnotgettheexpectedarguments,soit ",NA,NA
worksasanassertion.,will,NA
:Thisisusedtodefinewhatthemockwillreturn.Thetwomostcommonusages ,NA,NA
are,$this->returnValue($value),NA
or,$this->throwException($exception),NA
.This ,NA,NA
"methodisalsooptional,andifnotinvoked,themockwillalwaysreturnnull.",NA,NA
Let’saddthefirsttesttoseehowitwouldwork.Addthefollowingcodetothe ,tests/Controllers/BookControllerTest.php,NA
file:,"<?php
  
 namespaceBookstore\Tests\Controllers;
  
 useBookstore\Controllers\BookController; 
 useBookstore\Core\Request; 
  
 useBookstore\Exceptions\NotFoundException; 
 useBookstore\Models\BookModel; 
  
 useBookstore\Tests\ControllerTestCase; useTwig_Template;
  
 classBookControllerTestextendsControllerTestCase{ 
 privatefunctiongetController( 
  
 Request$request=null 
  
 ):BookController{ 
  
 if($request===null){ 
  
 $request=$this->mock('Core\Request'); } 
  
 returnnewBookController($this->di,$request); }
  
 publicfunctiontestBookNotFound(){ 
  
 $bookModel=$this->mock(BookModel::class); 
 $bookModel
  
 ->expects($this->once())
  
 ->method('get')
  
 ->with(123)",NA
Thefirstthingthetestdoesistocreateamockofthe,BookModel,NA
"class.Then,itaddsan ",NA,NA
expectationthatgoeslikethis:the,get,NA
"methodwillbecalledoncewithoneargument,",123,NA
", ",NA,NA
anditwillthrow,NotFoundException,NA
.Thismakessenseasthetesttriestoemulatea ,NA,NA
scenarioinwhichwecannotfindthebookinthedatabase.,NA,NA
Thesecondpartofthetestconsistsofaddingtheexpectationsofthetemplateengine.This ,NA,NA
isabitmorecomplexastherearetwomocksinvolved.The,loadTemplate,NA
methodof ,Twig_Environment,NA
isexpectedtobecalledoncewiththe,error.twig,NA
argumentasthe ,NA,NA
templatename.Thismockshouldreturn,Twig_Template,NA
",whichisanothermock.The ",render,NA
methodofthissecondmockisexpectedtobecalledoncewiththecorrecterror ,NA,NA
"message,returningtheresponse,whichisahardcodedstring.Afterallthedependencies ",NA,NA
"aredefined,wejustneedtoinvokethe",borrow,NA
methodofthecontrollerandexpecta ,NA,NA
response.,NA,NA
"Rememberthatthistestdoesnothaveonlyoneassertion,butfour:the",assertSame,NA
"methodandthethreemockexpectations.Ifanyofthemarenotaccomplished,thetestwill ",NA,NA
"fail,sowecansaythatthismethodisquiterobust.",NA,NA
"Withourfirsttest,weverifiedthatthescenarioinwhichthebookisnotfoundworks.",NA,NA
Therearetwomorescenariosthatfailaswell:whentherearenotenoughcopiesofthe ,NA,NA
booktoborrowandwhenthereisadatabaseerrorwhentryingtosavetheborrowedbook. ,NA,NA
"However,youcanseenowthatallofthemshareapieceofcodethatmocksthetemplate.",NA,NA
Let’sextractthiscodetoa,protected,NA
methodthatgeneratesthemockswhenitisgiven,NA,NA
"thetemplatename,theparametersaresenttothetemplate,andtheexpectedresponsei",NA,NA
s received.Runthefollowing:,"protectedfunctionmockTemplate( 
  
 string$templateName, 
  
 array$params, 
  
 $response 
  
 ){ 
  
 $template=$this->mock(Twig_Template::class); $template
  
 ->expects($this->once())
  
 ->method('render')
  
 ->with($params)
  
 ->will($this->returnValue($response)); $this->di-
 >get('Twig_Environment')
  
 ->expects($this->once())
  
 ->method('loadTemplate')
  
 ->with($templateName)
  
 ->will($this->returnValue($template)); }
  
 publicfunctiontestNotEnoughCopies(){ 
  
 $bookModel=$this->mock(BookModel::class); $bookModel
  
 ->expects($this->once())
  
 ->method('get')
  
 ->with(123)
  
 ->will($this->returnValue(newBook())); 
 $bookModel
  
 ->expects($this->never())
  
 ->method('borrow'); 
  
 $this->di->set('BookModel',$bookModel);
  
 $response=""Renderedtemplate""; 
  
 $this->mockTemplate( 
  
 'error.twig', 
  
 ['errorMessage'=>'Therearenocopiesleft.'], $response 
  
 );
  
 $result=$this->getController()->borrow(123);
  
 $this->assertSame( 
  
 $result, 
  
 $response, 
  
 'Responseobjectisnottheexpectedone.' ); 
  
 }
  
 publicfunctiontestErrorSaving(){ 
  
 $controller=$this->getController(); $controller-
 >setCustomerId(9);
  
 $book=newBook(); 
  
 $book->addCopy(); 
  
 $bookModel=$this->mock(BookModel::class);",NA
Theonlynoveltyhereiswhenweexpectthatthe,borrow,NA
methodisneverinvoked.Aswe ,NA,NA
"donotexpectittobeinvoked,thereisnoreasontousethe",with,NA
nor,will,NA
method.Ifthe ,NA,NA
"codeactuallyinvokesthismethod,PHPUnitwillmarkthetestasfailed.",NA,NA
Wealreadytestedandfoundthatallthescenariosthatcanfailhavefailed.Let’saddatest ,NA,NA
"nowwhereausercansuccessfullyborrowabook,whichmeansthatwewillreturnvalid ",NA,NA
"booksandcustomersfromthedatabase,the",save,NA
"methodwillbeinvokedcorrectly,and ",NA,NA
thetemplatewillgetallthecorrectparameters.Thetestlooksasfollows:,"publicfunctiontestBorrowingBook(){ $controller=$this-
 >getController(); $controller->setCustomerId(9);
  
 $book=newBook(); 
  
 $book->addCopy(); 
  
 $bookModel=$this->mock(BookModel::class); $bookModel
  
 ->expects($this->once())
  
 ->method('get')
  
 ->with(123)
  
 ->will($this->returnValue($book)); 
  
 $bookModel
  
 ->expects($this->once())
  
 ->method('borrow')
  
 ->with(newBook(),9); 
  
 $bookModel
  
 ->expects($this->once())",NA
Sothisisit.Youhavewrittenoneofthemostcomplextestsyouwillneedtowriteduring ,NA,NA
"thisbook.Whatdoyouthinkofit?Well,asyoudonothavemuchexperiencewithtests, ",NA,NA
"youmightbequitesatisfiedwiththeresult,butlet’strytoanalyzeitabitfurther.",NA,NA
Databasetesting,NA,NA
Thiswillbethemostcontroversialofthesectionsofthischapterbyfar.Whenitcomesto ,NA,NA
"databasetesting,therearedifferentschoolsofthought.Shouldweusethedatabaseornot? ",NA,NA
Shouldweuseourdevelopmentdatabaseoroneinmemory?Itisquiteoutofthescopeof ,NA,NA
"thebooktoexplainhowtomockthedatabaseorprepareafreshoneforeachtest,butwe ",NA,NA
willtrytosummarizesomeofthetechniqueshere:,NA,NA
Wewillmockthedatabaseconnectionandwriteexpectationstoalltheinteractions ,NA,NA
"betweenthemodelandthedatabase.Inourcase,thiswouldmeanthatwewould ",NA,NA
injectamockofthe,PDO,NA
"object.Aswewillwritethequeriesmanually,chancesare ",NA,NA
thatwemightintroduceawrongquery.Mockingtheconnectionwouldnothelpus ,NA,NA
detectthiserror.ThissolutionwouldbegoodifweusedORMinsteadofwritingthe ,NA,NA
"queriesmanually,butwewillleavethistopicoutofthebook.",NA,NA
"Foreachtest,wewillcreateabrandnewdatabaseinwhichweaddthedatawe ",NA,NA
"wouldliketohaveforthespecifictest.Thisapproachmighttakealotoftime,butit ",NA,NA
assuresyouthatyouwillbetestingagainstarealdatabaseandthatthereisno ,NA,NA
"unexpecteddatathatmightmakeourtestsfail;thatis,thetestsarefullyisolated.In ",NA,NA
"mostofthecases,thiswouldbethepreferableapproach,eventhoughitmightnotbe ",NA,NA
"theonethatperformsfaster.Tosolvethisinconvenience,wewillcreatein-memory ",NA,NA
databases.,NA,NA
"Testsrunagainstanalreadyexistingdatabase.Usually,atthebeginningofthetestwe ",NA,NA
"startatransactionthatwerollbackattheendofthetest,leavingthedatabasewithout ",NA,NA
"anychange.Thisapproachemulatesarealscenario,inwhichwecanfindallsortsof ",NA,NA
"dataandourcodeshouldalwaysbehaveasexpected.However,usingashared ",NA,NA
"databasealwayshassomesideeffects;forexample,ifwewanttointroducechanges ",NA,NA
"tothedatabaseschema,wewillhavetoapplythemtothedatabasebeforerunning ",NA,NA
"thetests,buttherestoftheapplicationsordevelopersthatusethedatabasearenot ",NA,NA
yetreadyforthesechanges.,NA,NA
"Inordertokeepthingssmall,wewilltrytoimplementamixtureofthesecondandthird ",NA,NA
"options.Wewilluseourexistingdatabase,butafterstartingthetransactionofeachtest, ",NA,NA
wewillcleanallthetablesinvolvedwiththetest.Thislooksasthoughweneeda ,ModelTestCase,NA
tohandlethis.Addthefollowinginto,tests/ModelTestCase.php,NA
:,"<?php
  
 namespaceBookstore\Tests;
  
 useBookstore\Core\Config; 
  
 usePDO;
  
 abstractclassModelTestCaseextendsAbstractTestCase{ protected$db; 
  
 protected$tables=[];
  
 publicfunctionsetUp(){ 
  
 $config=newConfig();",NA
The,setUp,NA
methodcreatesadatabaseconnectionwiththesamecredentialsfoundinthe ,config/app.yml,NA
"file.Then,wewillstartatransactionandinvokethe",cleanAllTables,NA
"method,whichiteratesthetablesinthe",$tables,NA
propertyanddeletesallthecontentfrom ,NA,NA
them.The,tearDown,NA
methodrollsbackthetransaction.,NA,NA
Note,NA,NA
ExtendingfromModelTestCase,NA,NA
Ifyouwriteatestextendingfromthisclassthatneedstoimplementeitherthe,setUp,NA
or ,tearDown,NA
"method,alwaysremembertoinvoketheonesfromtheparent.",NA,NA
Let’swritetestsforthe,borrow,NA
methodofthe,BookModel,NA
class.Thismethodusesbooks ,NA,NA
"andcustomers,sowewouldliketocleanthetablesthatcontainthem.Createthe",test,NA
classandsaveitin,tests/Models/BookModelTest.php,NA
:,"<?php
  
 namespaceBookstore\Tests\Models;
  
 useBookstore\Models\BookModel; 
  
 useBookstore\Tests\ModelTestCase;
  
 classBookModelTestextendsModelTestCase{ 
 protected$tables=[ 
  
 'borrowed_books', 
  
 'customer', 
  
 'book' 
  
 ]; 
  
 protected$model;
  
 publicfunctionsetUp(){ 
  
 parent::setUp();",NA
Notehowwealsooverrodethe,setUp,NA
"method,invokingtheoneintheparentandcreating ",NA,NA
"themodelinstancethatalltestswilluse,whichissafetodoaswewillnotkeepany ",NA,NA
"contextonthisobject.Beforeaddingtheteststhough,let’saddsomemorehelpersto ",ModelTestCase,NA
:onetocreatebookobjectsgivenanarrayofparametersandtwotosave ,NA,NA
booksandcustomersinthedatabase.Runthefollowingcode:,"protectedfunctionbuildBook(array$properties):Book{ $book=newBook(); 
  
 $reflectionClass=newReflectionClass(Book::class);
  
 foreach($propertiesas$key=>$value){ 
  
 $property=$reflectionClass->getProperty($key); $property-
 >setAccessible(true); 
  
 $property->setValue($book,$value); 
  
 }
  
 return$book; 
  
 }
  
 protectedfunctionaddBook(array$params){ $default=[ 
  
 'id'=>null, 
  
 'isbn'=>'isbn', 
  
 'title'=>'title', 
  
 'author'=>'author', 
  
 'stock'=>1, 
  
 'price'=>10.0, 
  
 ]; 
  
 $params=array_merge($default,$params);
  
 $query=<<<SQL 
  
 insertintobook(id,isbn,title,author,stock,price) 
 values(:id,:isbn,:title,:author,:stock,:price) SQL; 
  
 $this->db->prepare($query)->execute($params); 
  
 }
  
 protectedfunctionaddCustomer(array$params){ $default=[ 
  
 'id'=>null, 
  
 'firstname'=>'firstname', 
  
 'surname'=>'surname', 
  
 'email'=>'email', 
  
 'type'=>'basic' 
  
 ]; 
  
 $params=array_merge($default,$params);
  
 $query=<<<SQL 
  
 insertintocustomer(id,firstname,surname,email,type) 
 values(:id,:firstname,:surname,:email,:type)",NA
"Asyoucannote,weaddeddefaultvaluesforallthefields,sowearenotforcedtodefine ",NA,NA
"thewholebook/customereachtimewewanttosaveone.Instead,wejustsenttherelevant ",NA,NA
fieldsandmergedthemtothedefaultones.,NA,NA
"Also,notethatthe",buildBook,NA
"methodusedanewconcept,",NA,NA
reflection,NA,NA
",toaccesstheprivate ",NA,NA
"propertiesofaninstance.Thisiswaybeyondthescopeofthebook,butifyouare ",NA,NA
"interested,youcanreadmoreat",NA,NA
http://php.net/manual/en/book.reflection.php,NA,NA
.,NA,NA
"Wearenowreadytostartwritingtests.Withallthesehelpers,addingtestswillbevery ",NA,NA
easyandclean.The,borrow,NA
methodhasdifferentusecases:tryingtoborrowabookthatis ,NA,NA
"notinthedatabase,tryingtouseacustomernotregistered,andborrowingabook ",NA,NA
successfully.Let’saddthemasfollows:,"/** 
  
 *@expectedException\Bookstore\Exceptions\DbException */ 
  
 publicfunctiontestBorrowBookNotFound(){ 
  
 $book=$this->buildBook(['id'=>123]); 
  
 $this->model->borrow($book,123); 
  
 }
  
 /** 
  
 *@expectedException\Bookstore\Exceptions\DbException */ 
  
 publicfunctiontestBorrowCustomerNotFound(){ 
  
 $book=$this->buildBook(['id'=>123]); 
  
 $this->addBook(['id'=>123]);
  
 $this->model->borrow($book,123); 
  
 }
  
 publicfunctiontestBorrow(){ 
  
 $book=$this->buildBook(['id'=>123,'stock'=>12]); $this-
 >addBook(['id'=>123,'stock'=>12]); 
  
 $this->addCustomer(['id'=>123]);
  
 $this->model->borrow($book,123); 
  
 }",NA
"Impressed?Comparedtothecontrollertests,thesetestsarewaysimpler,mainlybecause ",NA,NA
"theircodeperformsonlyoneaction,butalsothankstoallthemethodsaddedto ",ModelTestCase,NA
".Onceyouneedtoworkwithotherobjects,suchas",sales,NA
",youcanadd ",addSale,NA
or,buildSale,NA
tothissameclasstomakethingscleaner.,NA,NA
Test-drivendevelopment,NA,NA
Youmightrealizealreadythatthereisnouniquewaytodothingswhentalkingabout ,NA,NA
developinganapplication.Itisoutofthescopeofthisbooktoshowyouallofthem—and ,NA,NA
"bythetimeyouaredonereadingtheselines,moretechniqueswillhavebeenincorporated ",NA,NA
"already—butthereisoneapproachthatisveryusefulwhenitcomestowritinggood, ",NA,NA
testablecode:,NA,NA
test-drivendevelopment,NA,NA
(,NA,NA
TDD,NA,NA
).,NA,NA
"Thismethodologyconsistsofwritingtheunittestsbeforewritingthecodeitself.Theidea, ",NA,NA
"though,isnottowriteallthetestsatonceandthenwritetheclassormethodbutratherto ",NA,NA
doitinaprogressiveway.Let’sconsideranexampletomakeiteasier.Imaginethatyour ,Sale,NA
classisyettobeimplementedandtheonlythingweknowisthatwehavetobeable ,NA,NA
toaddbooks.Renameyour,src/Domain/Sale.php,NA
fileto,src/Domain/Sale2.php,NA
orjust ,NA,NA
deleteitsothattheapplicationdoesnotknowaboutit.,NA,NA
Note,NA,NA
Isallthisverbositynecessary?,NA,NA
Youwillnoteinthisexamplethatwewillperformanexcessiveamountofstepstocome ,NA,NA
"upwithaverysimplepieceofcode.Indeed,theyaretoomanyforthisexample,butthere ",NA,NA
willbetimeswhenthisamountisjustfine.Findingthesemomentscomeswith ,NA,NA
"experience,sowerecommendyoutopracticefirstwithsimpleexamples.Eventually,it ",NA,NA
willcomenaturallytoyou.,NA,NA
"ThemechanicsofTDDconsistoffoursteps,asfollows:",NA,NA
1. Writeatestforsomefunctionalitythatisnotyetimplemented.,NA,NA
"2. Runtheunittests,andtheyshouldfail.Iftheydonot,eitheryourtestiswrong,or ",NA,NA
yourcodealreadyimplementsthisfunctionality.,NA,NA
3. Writetheminimumamountofcodetomakethetestspass.,NA,NA
"4. Runtheunittestsagain.Thistime,theyshouldpass.",NA,NA
Wedonothavethe,sale,NA
"domainobject,sothefirstthing,asweshouldstartfromsmall ",NA,NA
"thingsandthenmoveontobiggerthings,istoassurethatwecaninstantiatethe",sale,NA
object.Writethefollowingunittestin,tests/Domain/SaleTest.php,NA
aswewillwriteall ,NA,NA
"theexistingtests,butusingTDD;youcanremovetheexistingtestsinthisfile.","<?php
  
 namespaceBookstore\Tests\Domain;
  
 useBookstore\Domain\Sale; 
  
 usePHPUnit_Framework_TestCase;
  
 classSaleTestextendsPHPUnit_Framework_TestCase{ 
 publicfunctiontestCanCreate(){ 
  
 $sale=newSale(); 
  
 } 
  
 }",NA
"Runtheteststomakesurethattheyarefailing.Inordertorunonespecifictest,youcan ",NA,NA
"mentionthefileofthetestwhenrunningPHPUnit,asshowninthefollowingscript:",NA,NA
"Good,theyarefailing.ThatmeansthatPHPcannotfindtheobjecttoinstantiateit.Let’s ",NA,NA
"nowwritetheminimumamountofcoderequiredtomakethistestpass.Inthiscase, ",NA,NA
"creatingtheclasswouldbeenough,andyoucandothisthroughthefollowinglinesof ",NA,NA
code:,"<?php
  
 namespaceBookstore\Domain;
  
 classSale{ 
  
 }",NA
"Now,runtheteststomakesurethattherearenoerrors.",NA,NA
"Thisiseasy,right?So,whatweneedtodoisrepeatthisprocess,addingmore ",NA,NA
"functionalityeachtime.Let’sfocusonthebooksthatasaleholds;whencreated,the ",NA,NA
"book’slistshouldbeempty,asfollows:","publicfunctiontestWhenCreatedBookListIsEmpty(){ $sale=newSale();
  
 $this->assertEmpty($sale->getBooks()); }",NA
"Runtheteststomakesurethattheyfail—theydo.Now,writethefollowingmethodinthe ",NA,NA
class:,"publicfunctiongetBooks():array{ 
  
 return[]; 
  
 }",NA
"Now,ifyourun…wait,what?Weareforcingthe",getBooks,NA
methodtoreturnanempty ,NA,NA
arrayalways?Thisisnottheimplementationthatweneed—northeonewedeserve—so ,NA,NA
whydowedoit?Thereasonisthewordingofstep3:“Writetheminimumamountof ,NA,NA
codetomakethetestspass.”.Ourtestsuiteshouldbeextensiveenoughtodetectthiskind ,NA,NA
"ofproblem,andthisisourwaytomakesureitdoes.Thistime,wewillwritebadcodeon ",NA,NA
"purpose,butnexttime,wemightintroduceabugunintentionally,andourunittestsshould ",NA,NA
beabletodetectitassoonaspossible.Runthetests;theywillpass.,NA,NA
"Now,let’sdiscussthenextfunctionality.Whenaddingabooktothelist,weshouldsee ",NA,NA
thisbookwithamount1.Thetestshouldbeasfollows:,"publicfunctiontestWhenAddingABookIGetOneBook(){ 
 $sale=newSale(); 
  
 $sale->addBook(123);
  
 $this->assertSame( 
  
 $sale->getBooks(), 
  
 [123=>1] 
  
 ); 
  
 }",NA
Thistestisveryuseful.Notonlydoesitforceustoimplementthe,addBook,NA
"method,but ",NA,NA
alsoithelpsusfixthe,getBooks,NA
method—asitishardcodedrightnow—toalwaysreturn ,NA,NA
anemptyarray.Asthe,getBooks,NA
"methodnowexpectstwodifferentresults,wecannot ",NA,NA
trickthetestsanymore.Thenewcodefortheclassshouldbeasfollows:,"classSale{ 
  
 private$books=[];
  
 publicfunctiongetBooks():array{ return$this->books; 
  
 }
  
 publicfunctionaddBook(int$bookId){ $this-
 >books[123]=1; 
  
 } 
  
 }",NA
"Anewtestwecanwriteistheonethatallowsyoutoaddmorethanonebookatatime, ",NA,NA
sendingtheamountasthesecondargument.Thetestwouldlooksimilartothefollowing:,"publicfunctiontestSpecifyAmountBooks(){ $sale=newSale(); 
  
 $sale->addBook(123,5);
  
 $this->assertSame( 
  
 $sale->getBooks(), 
  
 [123=>5] 
  
 ); 
  
 }",NA
"Now,thetestsdonotpass,soweneedtofixthem.Let’srefactor",addBook,NA
sothatitcan ,NA,NA
acceptasecondargumentastheamount:,"publicfunctionaddBook(int$bookId,int$amount=1){ $this-
 >books[123]=$amount; 
  
 }",NA
Thenextfunctionalitywewouldliketoaddisthesamebookinvokingthemethodseveral ,NA,NA
"times,keepingtrackofthetotalamountofbooksadded.Thetestcouldbeasfollows:","publicfunctiontestAddMultipleTimesSameBook(){ $sale=newSale(); 
  
 $sale->addBook(123,5); 
  
 $sale->addBook(123); 
  
 $sale->addBook(123,5);
  
 $this->assertSame( 
  
 $sale->getBooks(), 
  
 [123=>11] 
  
 ); 
  
 }",NA
Thistestwillfailasthecurrentexecutionwillnotaddalltheamountsbutwillinstead ,NA,NA
keepthelastone.Let’sfixitbyexecutingthefollowingcode:,"publicfunctionaddBook(int$bookId,int$amount=1){ if(!isset($this-
 >books[123])){ 
  
 $this->books[123]=0; 
  
 } 
  
 $this->books[123]+=$amount; 
  
 }",NA
"Well,wearealmostthere.Thereisonelasttestweshouldadd,whichistheabilitytoadd ",NA,NA
morethanonedifferentbook.Thetestisasfollows:,"publicfunctiontestAddDifferentBooks(){ $sale=newSale(); 
  
 $sale->addBook(123,5); 
  
 $sale->addBook(456,2); 
  
 $sale->addBook(789,5);
  
 $this->assertSame( 
  
 $sale->getBooks(),",NA
"ThistestfailsduetothehardcodedbookIDinourimplementation.Ifwedidnotdothis, ",NA,NA
thetestwouldhavealreadypassed.Let’sfixitthen;runthefollowing:,"publicfunctionaddBook(int$bookId,int$amount=1){ if(!isset($this-
 >books[$bookId])){ 
  
 $this->books[$bookId]=0; 
  
 } 
  
 $this->books[$bookId]+=$amount; 
  
 }",NA
Wearedone!Doesitlookfamiliar?Itisthesamecodewewroteonourfirst ,NA,NA
implementationexceptfortherestoftheproperties.Youcannowreplacethe,sale,NA
domain ,NA,NA
"objectwiththepreviousone,soyouhaveallthefunctionalitiesneeded.",NA,NA
Theoryversuspractice,NA,NA
"Asmentionedbefore,thisisaquitelongandverboseprocessthatveryfewexperienced ",NA,NA
developersfollowfromstarttoendbutonethatmostofthemencouragepeopletofollow.,NA,NA
"Whyisthisso?Whenyouwriteallyourcodefirstandleavetheunittestsfortheend, ",NA,NA
therearetwoproblems:,NA,NA
"Firstly,intoomanycasesdevelopersarelazyenoughtoskiptests,tellingthemselves ",NA,NA
"thatthecodealreadyworks,sothereisnoneedtowritethetests.Youalreadyknow ",NA,NA
thatoneofthegoalsoftestsistomakesurethatfuturechangesdonotbreakthe ,NA,NA
"currentfeatures,sothisisnotavalidreason.",NA,NA
"Secondly,thetestswrittenafterthecodeusuallytestthecoderatherthanthe ",NA,NA
functionality.Imaginethatyouhaveamethodthatwasinitiallymeanttoperforman ,NA,NA
"action.Afterwritingthemethod,wewillnotperformtheactionperfectlyduetoa ",NA,NA
"bugorbaddesign;instead,wewilleitherdotoomuchorleavesomeedgecases ",NA,NA
"untreated.Whenwewritethetestafterwritingthecode,wewilltestwhatweseein ",NA,NA
"themethod,notwhattheoriginalfunctionalitywas!",NA,NA
"Ifyouinsteadforceyourselftowritethetestsfirstandthenthecode,youmakesurethat ",NA,NA
"youalwayshavetestsandthattheytestwhatthecodeismeanttodo,leadingtoacode ",NA,NA
"thatperformsasexpectedandisfullycovered.Also,bydoingitinsmallintervals,youget ",NA,NA
quickfeedbackanddon’thavetowaitforhourstoknowwhetherallthetestsandcode ,NA,NA
youwrotemakesenseatall.Eventhoughthisideaisquitesimpleandmakesalotof ,NA,NA
"sense,manynovicedevelopersfindithardtoimplement.",NA,NA
"Experienceddevelopershavewrittencodeforseveralyears,sotheyhavealready ",NA,NA
internalizedallofthis.Thisisthereasonwhysomeofthemprefertoeitherwriteseveral ,NA,NA
"testsbeforestartingwiththecodeortheotherwayaround,thatis,writingcodeandthen ",NA,NA
"testingitastheyaremoreproductivethisway.However,ifthereissomethingthatallof ",NA,NA
themhaveincommonitisthattheirapplicationswillalwaysbefulloftests.,NA,NA
Summary,NA,NA
"Inthischapter,youlearnedtheimportanceoftestingyourcodeusingunittests.Younow ",NA,NA
knowhowtoconfigurePHPUnitonyourapplicationsothatyoucannotonlyrunyour ,NA,NA
testsbutalsogetgoodfeedback.Yougotagoodintroductiononhowtowriteunittests ,NA,NA
"properly,andnow,itissaferforyoutointroducechangesinyourapplication.",NA,NA
"Inthenextchapter,wewillstudysomeexistingframeworks,whichyoucanuseinsteadof ",NA,NA
"writingyourowneverytimeyoustartanapplication.Inthisway,notonlywillyousave ",NA,NA
"timeandeffort,butalsootherdeveloperswillbeabletojoinyouandunderstandyour ",NA,NA
codeeasily.,NA,NA
Chapter8.UsingExistingPHP,NA,NA
Frameworks,NA,NA
"InthesamewaythatyouwroteyourframeworkwithPHP,otherpeopledidittoo.Itdid ",NA,NA
"nottakelongforpeopletorealizethatentireframeworkswerereusabletoo.Ofcourse, ",NA,NA
"oneman’smeatisanotherman’spoison,andaswithmanyotherexamplesintheITworld, ",NA,NA
"loadsofframeworksstartedtoappear.Youwillneverhearaboutmostofthem,buta ",NA,NA
handfuloftheseframeworksgotquitealotofusers.,NA,NA
"Aswewrite,therearefourorfivemainframeworksthatmostPHPdevelopersknowof: ",NA,NA
Symfony,NA,NA
and,NA,NA
ZendFramework,NA,NA
"werethemaincharactersofthislastPHPgeneration,but ",NA,NA
"Laravelisalsothere,providingalightweightandfastframeworkforthosewhoneed ",NA,NA
"fewerfeatures.Duetothenatureofthisbook,wewillfocusonthelatestones,",NA,NA
Silex,NA,NA
and ,NA,NA
Laravel,NA,NA
",astheyarequickenoughtolearninachapter—oratleasttheirbasicsare.",NA,NA
"Inthischapter,youwilllearnabout:",NA,NA
Theimportanceofframework,NA,NA
s ,NA,NA
Otherfeaturesofframeworks ,NA,NA
WorkingwithLaravel,NA,NA
WritingapplicationswithSilex,NA,NA
Reviewingframeworks,NA,NA
In,NA,NA
Chapter6,NA,NA
",",NA,NA
AdaptingtoMVC,NA,NA
",webarelyintroducedtheideaofframeworksusingthe ",NA,NA
"MVCdesignpattern.Infact,wedidnotexplainwhataframeworkis;wejustdevelopeda ",NA,NA
"verysimpleone.Ifyouarelookingforadefinition,hereitis:aframeworkisthestructure ",NA,NA
thatyouchoosetobuildyourprogramon.Let’sdiscussthisinmoredetail.,NA,NA
Thepurposeofframeworks,NA,NA
"Whenyouwriteanapplication,youneedtoaddyourmodels,views,andcontrollersifyou ",NA,NA
"usetheMVCdesignpattern,whichwereallyencourageyoutodo.Thesethreeelements, ",NA,NA
"togetherwiththeJavaScriptandCSSfilesthatcompleteyourviews,aretheonesthat ",NA,NA
differentiateyourapplicationfromothers.Thereisnowayyoucanskiponwritingthem.,NA,NA
"Ontheotherhand,thereisasetofclassesthat,eventhoughyouneedthemforthecorrect ",NA,NA
"functioningofyourapplication,theyarecommontoallotherapplications,oratleast,they ",NA,NA
areverysimilar.Examplesoftheseclassesaretheoneswehaveinthe,src/Core,NA
"directory, ",NA,NA
"suchastherouter,theconfigurationreader,andsoon.",NA,NA
Thepurposeofframeworksisclearandnecessary:theyaddsomestructuretoyour ,NA,NA
"applicationandconnectthedifferentelementsofit.Inourexample,ithelpedusroutethe ",NA,NA
"HTTPrequeststothecorrectcontroller,connecttothedatabase,andgeneratedynamic ",NA,NA
"HTMLastheresponse.However,theideathathastostriveisthereusabilityof ",NA,NA
"frameworks.Ifyouhadtowritetheframeworkeachtimeyoustartanapplication,would ",NA,NA
thatbeokay?,NA,NA
"So,inorderforaframeworktobeuseful,itmustbeeasytoreuseindifferent ",NA,NA
"environments.Thismeansthattheframeworkhastobedownloadedfromasource,andit ",NA,NA
hastobeeasytoinstall.Downloadandinstalladependency?ItseemsComposerisgoing ,NA,NA
"tobeusefulagain!Eventhoughthiswasquitedifferentsomeyearsago,nowadays,allthe ",NA,NA
mainframeworkscanbeinstalledusingComposer.Wewillshowyouhowtoinabit.,NA,NA
Themainpartsofaframework,NA,NA
"Ifweopensourceourframeworksothatotherdeveloperscanmakeuseofit,weneedto ",NA,NA
structureourcodeinawaythatisintuitive.Weneedtoreducethelearningcurveasmuch ,NA,NA
aswecan;nobodywantstospendweeksonlearninghowtoworkwithaframework.,NA,NA
"AsMVCisthedefactowebdesignpatternusedinwebapplications,mostframeworks ",NA,NA
"willseparatethethreelayers,model,view,andcontroller,inthreedifferentdirectories. ",NA,NA
"Dependingontheframework,theywillbeundera",src/,NA
"directory,eventhoughitisquite ",NA,NA
"commontofindtheviewsoutsideofthisdirectory,aswedidwithourown.Nevertheless, ",NA,NA
mostframeworkswillgiveyouenoughflexibilitytodecidewheretoplaceeachofthe ,NA,NA
layers.,NA,NA
Therestoftheclassesthatcompletetheframeworksusedtobeallgroupedinaseparate ,NA,NA
"directory—forexample,",src/Core,NA
.Itisimportanttoseparatetheseelementsfromyours ,NA,NA
"sothatyoudonotmixthecodeandmodifyacoreclassunintentionally,thusmessingup ",NA,NA
"thewholeframework.Evenbetter,thislastgenerationofPHPframeworksusedto ",NA,NA
"incorporatethecorecomponentsasindependentmodules,whichwillberequiredvia ",NA,NA
"Composer.Indoingso,theframework’s",composer.json,NA
filewillrequireallthedifferent ,NA,NA
"components,suchasrouters,configuration,databaseconnections,loggers,template ",NA,NA
"engine,andsoon,andComposerwilldownloadtheminthe",vendor/,NA
"directory,making ",NA,NA
themavailablewiththeautogeneratedautoloader.,NA,NA
"Separatingthedifferentcomponentsindifferentcodebaseshasmanybenefits.Firstofall, ",NA,NA
itallowsdifferentteamsofdeveloperstoworkinanisolatedwaywiththedifferent ,NA,NA
components.Maintainingthemisalsoeasierasthecodeisseparatedenoughnottoaffect ,NA,NA
"eachother.Finally,itallowstheendusertochoosewhichcomponentstogetforhis ",NA,NA
"applicationinanattempttocustomizetheframework,leavingoutthoseheavy ",NA,NA
componentsthatarenotused.,NA,NA
Eithertheframeworkisorganizedinindependentmodulesoreverythingistogethe,NA,NA
"r; however,therearealwaysthesamecommoncomponents,whichare:",NA,NA
Therouter,NA,NA
":Thisistheclassthat,givenanHTTPrequest,findsthecorrect ",NA,NA
"controller,instantiatesit,andexecutesit,returningtheHTTPresponse.",NA,NA
Therequest,NA,NA
:Thiscontainsahandfulofmethodsthatallowsyoutoaccess ,NA,NA
"parameters,cookies,headers,andsoon.Thisismostlyusedbytherouterandsentto ",NA,NA
thecontroller.,NA,NA
Theconfigurationhandler,NA,NA
":Thisallowsyoutogetthecorrectconfigurationfile, ",NA,NA
"readit,anduseitscontentstoconfiguretherestofthecomponents.",NA,NA
Thetemplateengine,NA,NA
:ThismergesHTMLwithcontentfromthecontrollerinorder ,NA,NA
torenderthetemplatewiththeresponse.,NA,NA
Thelogger,NA,NA
:Thisaddsentriestoalogfilewiththeerrorsorothermessagesthatwe ,NA,NA
considerimportant.,NA,NA
Thedependencyinjector,NA,NA
:Thismanagesallthedependenciesthatyourclassesneed,NA,NA
.,NA,NA
"Maybetheframeworkdoesnothaveadependencyinjector,butithassomething ",NA,NA
"similar—thatis,aservicelocator—whichtriestohelpyouinasimilarway.",NA,NA
Thewayyoucanwriteandrunyourunittests,NA,NA
":Mostofthetime,theframeworks ",NA,NA
"includePHPUnit,buttherearemoreoptionsinthecommunity.",NA,NA
Otherfeaturesofframeworks,NA,NA
Mostframeworkshavemorethanjustthefeaturesthatwedescribedintheprevious ,NA,NA
"section,eventhoughtheseareenoughtobuildsimpleapplicationsasyoualreadydidby ",NA,NA
"yourself.Still,mostwebapplicationshavealotmorecommonfeatures,sothe ",NA,NA
"frameworkstriedtoimplementgenericsolutionstoeachofthem.Thankstothis,wedo ",NA,NA
nothavetoreinventthewheelwithfeaturesthatvirtuallyallmediumandbigweb ,NA,NA
applicationsneedtoimplement.Wewilltrytodescribesomeofthemostusefulonesso ,NA,NA
thatyouhaveabetterideawhenchoosingaframework.,NA,NA
Authenticationandroles,NA,NA
Mostwebsitesenforceuserstoauthenticateinordertoperformsomeaction.Thereason ,NA,NA
forthisistoletthesystemknowwhethertheusertryingtoperformcertainactionhasthe ,NA,NA
"righttodoso.Therefore,managingusersandtheirrolesissomethingthatyouwill ",NA,NA
probablyendupimplementinginallyourwebapplications.Theproblemcomeswhen ,NA,NA
waytoomanypeopletrytoattackyoursysteminordertogettheinformationofother ,NA,NA
"usersorperformingactionsauthenticatedassomeoneelse,whichiscalled ",NA,NA
impersonification,NA,NA
.Itisforthisreasonthatyourauthenticationandauthorizationsyste,NA,NA
ms shouldbeassecureaspossible—ataskthatisnevereasy.,NA,NA
"Severalframeworksincludeaprettysecurewayofmanagingusers,permissions,and ",NA,NA
"sessions.Mostofthetime,youcanmanagethisthroughaconfigurationfileprobablyby ",NA,NA
"pointingthecredentialstoadatabasewheretheframeworkcanaddtheuserdata,your ",NA,NA
"customizedroles,andsomeothercustomizations.Thedownsideisthateachframework ",NA,NA
"hasitsownwayofconfiguringit,soyouwillhavetodigintothedocumentationofthe ",NA,NA
"frameworkyouareusingatthistime.Still,itwillsaveyoumoretimethanifyouhadto ",NA,NA
implementitbyyourself.,NA,NA
ORM,NA,NA
Object-relationalmapping,NA,NA
(,NA,NA
ORM,NA,NA
)isatechniquethatconvertsdatafromadatabaseor ,NA,NA
anyotherdatastorageintoobjects.Themaingoalistoseparatethebusinesslogicasmuch ,NA,NA
aspossiblefromthestructureofthedatabaseandtoreducethecomplexityofyourcode. ,NA,NA
"WhenusingORM,youwillprobablyneverwriteaqueryinMySQL;instead,youwilluse ",NA,NA
"achainofmethods.Behindthescenes,ORMwillwritethequerywitheachmethod ",NA,NA
invocation.,NA,NA
"TherearegoodandbadthingswhenusingORM.Ononehand,youdonothaveto ",NA,NA
"rememberalltheSQLsyntaxallthetimeandonlythecorrectmethodstoinvoke,which ",NA,NA
canbeeasierifyouworkwithanIDEthatcanautocompletemethods.Itisalsogoodto ,NA,NA
"abstractyourcodefromthetypeofstoragesystem,becauseeventhoughitisnotvery ",NA,NA
"common,youmightwanttochangeitlater.IfyouuseORM,youprobablyhavetochange ",NA,NA
"onlythetypeofconnection,butifyouwerewritingrawqueries,youwouldhavealotof ",NA,NA
worktodoinordertomigrateyourcode.,NA,NA
ThearguabledownsideofusingORMcouldbethatitmaybequitedifficulttowrite ,NA,NA
"complicatedqueriesusingmethodchains,andyouwillendupwritingthemmanually.You ",NA,NA
"arealsoatthemercyofORMinordertospeeduptheperformanceofyourqueries, ",NA,NA
"whereaswhenwritingthemmanually,itisyouwhocanchoosebetterwhatandhowtouse ",NA,NA
"whenquerying.Finally,somethingthatOOPpuristscomplainaboutquitealotisthat ",NA,NA
"usingORMfillsyourcodewithalargeamountofdummyobjects,similartothedomain ",NA,NA
objectsthatyoualreadyknow.,NA,NA
"Asyoucansee,usingORMisnotalwaysaneasydecision,butjustincaseyouchooseto ",NA,NA
"useit,mostofthebigframeworksincludeone.Takeyourtimeindecidingwhetherornot ",NA,NA
"touseoneinyourapplications;incaseyoudo,choosewiselywhichone.Youmightend ",NA,NA
uprequiringanORMdifferentfromtheonethattheframeworkprovides.,NA,NA
Cache,NA,NA
Thebookstoreisaprettygoodexamplethatmayhelpindescribingthecachefeature.It ,NA,NA
hasadatabaseofbooksthatisqueriedeverytimethatsomeoneeitherlistsallthebooksor ,NA,NA
asksforthedetailsofaspecificone.Mostofthetimetheinformationrelatedtobookswill ,NA,NA
bethesame;theonlychangewouldbethestockofthebooksfromtimetotime.Wecould ,NA,NA
"saythatoursystemhaswaymorereadsthanwrites,wherereadsmeansqueryingfordata ",NA,NA
"andwritesmeansupdatingit.Inthiskindofsystem,itseemslikeawasteoftimeand ",NA,NA
"resourcestoaccessthedatabaseeachtime,knowingthatmostofthetime,wewillgetthe ",NA,NA
sameresults.Thisfeelingincreasesifwedosomeexpensivetransformationtothedata ,NA,NA
thatweretrieve.,NA,NA
A,NA,NA
cachelayer,NA,NA
allowstheapplicationtostoretemporarydatainastoragesystemfaster ,NA,NA
"thanourdatabase,usuallyinmemoryratherthandisk.Eventhoughcachesystemsare ",NA,NA
"gettingmorecomplex,theyusuallyallowyoutostoredatabykey-valuepairs,asinan ",NA,NA
array.,NA,NA
Theideaisnottoaccessthedatabasefordatathatweknowisthesameasthelasttimewe ,NA,NA
"accesseditinordertosavetimeandresources.Implementationscanvaryquitealot,but ",NA,NA
themainflowisasfollows:,NA,NA
1. Youtrytoaccessacertainpieceofdataforthefirsttime.Weaskthecachewhethera ,NA,NA
"certainkeyisthere,whichitisnot.",NA,NA
"2. Youquerythedatabase,gettingbacktheresult.Afterprocessingit—andmaybe ",NA,NA
transformingittoyourdomainobjects—youstoretheresultinthecache.Thekey ,NA,NA
"wouldbethesameyouusedinstep1,andthevaluewouldbetheobject/array/JSON ",NA,NA
thatyougenerated.,NA,NA
3. Youtrytoaccessthesamepieceofdataagain.Youaskthecachewhetherthekeyis ,NA,NA
"there;here,itis,soyoudonotneedtoaccessthedatabaseatall.",NA,NA
"Itseemseasy,right?Themainproblemwithcachescomeswhenweneedtoinvalidatea ",NA,NA
certainkey.Howandwhenshouldwedoit?Thereareacoupleofapproachesthatare ,NA,NA
worthmentioning:,NA,NA
Youwillsetanexpirationtimetothekey-valuepairinthecache.Afterthistime ,NA,NA
"passes,thecachewillremovethekey-valuepairautomatically,soyouwillhaveto ",NA,NA
"querythedatabaseagain.Eventhoughthissystemmightworkforsomeapplications, ",NA,NA
"itdoesnotforours.Ifthestockchangesto0beforethecacheexpires,theuserwill ",NA,NA
seebooksthattheycannotborroworbuy.,NA,NA
"Thedataneverexpires,buteachtimewemakeachangeinthedatabase,wewill ",NA,NA
identifywhichkeysinthecacheareaffectedbythischangeandthenpurgethem. ,NA,NA
"Thisisidealsincethedatawillbeinthecacheuntilitisnolongervalid,whetherthis ",NA,NA
is2secondsor3weeks.Thedownsideisthatidentifyingthesekeyscouldbeahard ,NA,NA
"taskdependingonyourdatastructure.Ifyoumissdeletingsomeofthem,youwill ",NA,NA
"havecorrupteddatainyourcache,whichisquitedifficulttodebuganddetect.",NA,NA
"Youcanseethatcacheisadouble-edgedsword,sowewouldrecommendyoutoonlyuse",NA,NA
"itwhennecessaryandnotjustbecauseyourframeworkcomeswithit.AswithORM,if ",NA,NA
"youarenotconvincedbythecachesystemthatyourframeworkprovides,usingadifferent ",NA,NA
"oneshouldnotbedifficult.Infact,yourcodeshouldnotbeawareofwhichcachesystem ",NA,NA
youareusingexceptwhencreatingtheconnectionobject.,NA,NA
Internationalization,NA,NA
"Englishisnottheonlylanguageoutthere,andyouwouldliketomakeyourwebsiteas ",NA,NA
"accessibleaspossible.Dependingonyourtarget,itwouldbeagoodideatohaveyour ",NA,NA
"websitetranslatedtootherlanguagestoo,buthowdoyoudothis?Wehopethatbynow ",NA,NA
youdidnotanswer:“Copy-pastingallthetemplatesandtranslatingthem”.Thisiswaytoo ,NA,NA
"inefficient;whenmakingalittlechangeinatemplate,youneedtoreplicatethechange ",NA,NA
everywhere.,NA,NA
Therearetoolsthatcanbeintegratedwitheithercontrollersand/ortemplateenginesin ,NA,NA
"ordertotranslatestrings.Youusuallykeepafileforeachlanguagethatyouhave,inwhich ",NA,NA
youwilladdallthestringsthatneedtobetranslatedplustheirtranslation.Oneofthemost ,NA,NA
"commonformatsforthisisPOfiles,inwhichyouhaveamapofkey-valuepairswith ",NA,NA
"originallytranslatedpairs.Lateron,youwillinvokea",translate,NA
methodsendingthe ,NA,NA
"originalstring,whichwillreturnthetranslatedstringdependingonthelanguageyou ",NA,NA
selected.,NA,NA
"Whenwritingtemplates,itmightbetiringtoinvokethetranslationeachtimeyouwantto ",NA,NA
"displayastring,butyouwillendupwithonlyonetemplate,whichismucheasierto ",NA,NA
maintainthananyotheroption.,NA,NA
"Usually,internationalizationisverymuchtiedtotheframeworkthatyouuse;however,if ",NA,NA
"youhavetheopportunitytousethesystemofyourchoice,payspecialattentiontoits ",NA,NA
"performance,thetranslationfilesituses,andhowitmanagesstringswithparameters—",NA,NA
"thatis,howwecanaskthesystemtotranslatemessagessuchas“Hello%s,whoareyou?”inw",NA,NA
hich“%s”needstobeinjectedeachtime.,NA,NA
Typesofframeworks,NA,NA
"Nowthatyouknowquitealotaboutwhataframeworkcanofferyou,youareina ",NA,NA
positiontodecidewhatkindofframeworkyouwouldliketouse.Inordertomakethis ,NA,NA
"decision,itmightbeusefultoknowwhatkindsofframeworksareavailable.This ",NA,NA
"categorizationisnothingofficial,justsomeguidelinesthatweofferyoutomakeyour ",NA,NA
choiceeasier.,NA,NA
Completeandrobustframeworks,NA,NA
Thistypeofframeworkcomeswiththewholepackage.Itcontainsallthefeaturesthatwe ,NA,NA
"discussedearlier,soitwillallowyoutodevelopverycompleteapplications.Usually, ",NA,NA
theseframeworksallowyoutocreateapplicationsveryeasilywithjustafew ,NA,NA
"configurationfilesthatdefinethingssuchashowtoconnecttoadatabase,whatkindof ",NA,NA
"rolesyouneed,orwhetheryouwanttouseacache.Otherthanthis,youwilljusthaveto ",NA,NA
"addyourcontrollers,views,andmodels,whichsavesyoualotoftime.",NA,NA
Theproblemwiththeseframeworksisthelearningcurve.Givenallthefeaturesthey ,NA,NA
"contain,youneedtospendquitealotoftimeonlearninghowtouseeachone,whichis ",NA,NA
"usuallynotverypleasant.Infact,mostcompanieslookingforwebdevelopersrequirethat ",NA,NA
"youhaveexperiencewiththeframeworktheyuse;otherwise,itwillbeabadinvestment ",NA,NA
forthem.,NA,NA
Anotherthingyoushouldconsiderwhenchoosingtheseframeworksiswhethertheyare ,NA,NA
"structuredinmodulesorcomeasahugemonolith.Inthefirstcase,youwillbeableto ",NA,NA
"choosewhichmodulestousethataddalotofflexibility.Ontheotherhand,ifyouhaveto ",NA,NA
"stickwithallofthem,itmightmakeyourapplicationslowevenifyoudonotuseallof ",NA,NA
thefeatures.,NA,NA
Lightweightandflexibleframeworks,NA,NA
"Evenwhenworkingonasmallapplication,youwouldliketouseaframeworktosaveyou ",NA,NA
"alotoftimeandpain,butyoushouldavoidusingoneofthelargerframeworksasthey ",NA,NA
"willbetoomuchtohandleforwhatyoureallyneed.Inthiscase,youshouldchoosea ",NA,NA
"lightweightframework,onethatcontainsveryfewfeatures,similartowhatwe ",NA,NA
implementedinpreviouschapters.,NA,NA
Thebenefitoftheseframeworksisthateventhoughyougetthebasicfeaturessuchas ,NA,NA
"routing,youarecompletelyfreetoimplementtheloginsystem,cachelayer,or ",NA,NA
"internationalizationsystemthatsuitsyourspecificapplicationbetter.Infact,youcoul",NA,NA
d buildamorecompleteframeworkusingthisoneasthebaseandthenaddingallthe ,NA,NA
"complementsyouneed,makingitcompletelycustomized.",NA,NA
"Asyoucannote,bothtypeshavetheirprosandcons.Itwillbeuptoyoutochoosethe ",NA,NA
"correctoneeachtime,dependingonyourneeds,thetimethatyoucanspend,andthe ",NA,NA
experiencethatyouhavewitheachone.,NA,NA
Anoverviewoffamousframeworks,NA,NA
Youalreadyhaveagoodideaaboutwhataframeworkcanofferandwhattypesthereare. ,NA,NA
"Now,itistimetoreviewsomeofthemostimportantonesouttheresothatyougetanidea ",NA,NA
ofwheretostartlookingforyournextPHPwebapplication.Notethatwiththereleaseof ,NA,NA
"PHP7,therewillbequitealotofneworimprovedPHPframeworks.Trytoalwaysbein ",NA,NA
theloop!,NA,NA
Symfony2,NA,NA
Symfonyhasbeenoneofthemostfavoriteframeworksofdevelopersduringthelast10 ,NA,NA
"years.Afterreinventingitselfforitsversion2,Symfonyenteredthegenerationof ",NA,NA
"frameworksbymodules.Infact,itisquitecommontofindotherprojectsusingSymfony ",NA,NA
2componentsmixedupwithsomeotherframeworkasyoujustneedtoaddthenameof ,NA,NA
themoduleinyourComposerfiletouseit.,NA,NA
YoucanstartapplicationswithSymfony2byjustexecutingacommand.Symfony2 ,NA,NA
"createsallthedirectories,emptyconfigurationfiles,andsoonreadyforyou.Youcanalso ",NA,NA
"addemptycontrollersfromthecommandline.TheyuseDoctrine2asORM,whichis ",NA,NA
probablyoneofthemostreliableORMsthatPHPcanoffernowadays.Forthetemplate ,NA,NA
"engine,youwillfindTwig,whichisthesameaswhatweusedinourframework.",NA,NA
"Ingeneral,thisisaveryattractiveframeworkwithahugecommunitybehinditgiving ",NA,NA
"support;plus,alotofcompaniesalsouseit.Itisalwaysworthatleastcheckingthelistof ",NA,NA
modulesincaseyoudonotwanttousethewholeframeworkbutwanttotakeadvantage ,NA,NA
ofsomebitsofit.,NA,NA
ZendFramework2,NA,NA
"ThesecondbigPHPframework,atleastsincelastyear,isZendFramework2.Aswith ",NA,NA
"Symfony,ithasbeenoutthereforquitealongtimetoo.Also,aswithanyothermodern ",NA,NA
"framework,itisbuiltinanOOPway,tryingtoimplementallthegooddesignpatterns ",NA,NA
usedforwebapplications.Itiscomposedofmultiplecomponentsthatyoucanreusein ,NA,NA
"otherprojects,suchastheirwell-knownauthenticationsystem.Itlackssomeelements, ",NA,NA
"suchasatemplateengine—usuallytheymixPHPandHTML—andORM,butyoucan ",NA,NA
easilyintegratetheonesthatyouprefer.,NA,NA
"ThereisalotofworkgoingoninordertoreleaseZendFramework3,whichwillcome ",NA,NA
"withsupportforPHP7,performanceimprovements,andsomeothernewcomponents.W",NA,NA
e recommendyoutokeepaneyeonit;itcouldbeagoodcandidate.,NA,NA
Otherframeworks,NA,NA
"EventhoughSymfonyandZendFrameworkarethetwobigplayers,moreandmorePHP ",NA,NA
"frameworkshaveappearedintheselastyears,evolvingquitefastandbringingtothegame ",NA,NA
"moreinterestingfeatures.NamessuchasCodeIgniter,Yii,PHPCake,andotherswillstart ",NA,NA
tosoundfamiliarassoonasyoustartbrowsingPHPprojects.Assomeofthemcameinto ,NA,NA
"playlaterthanSymfonyandZendFramework,theyimplementsomenewfeaturesthatthe ",NA,NA
"othersdonothave,suchascomponentsrelatedtoJavaScriptandjQuery,integrationwith ",NA,NA
"SeleniumforUItesting,andothers.",NA,NA
Eventhoughitisalwaysagoodthingtohavediversificationsimplybecauseyouwill ,NA,NA
"probablygetexactlywhatyouneedfromoneortheother,besmartwhenchoosingyour ",NA,NA
framework.Thecommunityplaysanimportantroleherebecauseifyouhaveany ,NA,NA
"problem,itwillhelpyoutofixitoryoucanjusthelpevolvetheframeworkwitheachnew ",NA,NA
PHPrelease.,NA,NA
TheLaravelframework,NA,NA
EventhoughSymfonyandZendFrameworkhavebeenthebigplayersforquitealong ,NA,NA
"time,duringthislastcoupleofyears,athirdframeworkcameintoplaythathasgrownin ",NA,NA
popularitysomuchthatnowadaysitisthefavoriteframeworkamongdevelopers.,NA,NA
"Simplicity,elegantcode,andhighspeedofdevelopmentarethetrumpcardsofthis“frame",NA,NA
"workforartisans”.Inthissection,youwillhaveaglanceatwhatLaravelcando, ",NA,NA
takingthefirststepstocreateaverysimpleapplication.,NA,NA
Installation,NA,NA
Laravelcomeswithasetofcommand-linetoolsthatwillmakeyourlifeeasier.Becauseof ,NA,NA
"this,itisrecommendedtoinstallitgloballyinsteadofperproject—thatis,tohaveLaravel ",NA,NA
asanotherprograminyourenvironment.YoucanstilldothiswithComposerbyrunning ,NA,NA
thefollowingcommand:,"$composerglobalrequire""laravel/installer""",NA
ThiscommandshoulddownloadtheLaravelinstallerto,~/.composer/vendor,NA
.Inorderto ,NA,NA
"beabletousetheexecutablefromthecommandline,youwillneedtorunsomething ",NA,NA
similartothis:,$sudoln-s~/.composer/vendor/bin/laravel/usr/bin/laravel,NA
"Now,youareabletousethe",laravel,NA
"command.Toensurethateverythingwentallright, ",NA,NA
justrunthefollowing:,$laravel–version,NA
"IfeverythingwentOK,thisshouldoutputtheversioninstalled.",NA,NA
Projectsetup,NA,NA
"Yes,weknow.Everysingletutorialstartsbycreatingablog.However,wearebuilding ",NA,NA
"webapplications,andthisistheeasiestapproachwecantakethataddssomevaluetoyou.",NA,NA
Let’sstartthen;executethefollowingcommandwhereveryouwanttoaddyour ,NA,NA
application:,$laravelnewphp-blog,NA
"ThiscommandwilloutputsomethingsimilartowhatComposerdoes,simplybecauseit ",NA,NA
"fetchesdependenciesusingComposer.Afterafewseconds,theapplicationwillhopefully ",NA,NA
tellyouthateverythingwasinstalledsuccessfullyandthatyouarereadytogo.,NA,NA
Laravelcreatedanew,php-blog,NA
directorywithquitealotofcontent.Youshouldhave ,NA,NA
somethingsimilartothedirectorystructureshowninthefollowingscreenshot:,NA,NA
Let’ssetupthedatabase.Thefirstthingyoushoulddoisupdatethe,.env,NA
filewiththe ,NA,NA
correctdatabasecredentials.Updatethe,DB_DATABASE,NA
valueswithyourown;here’san ,NA,NA
example:,"DB_HOST=localhost 
  
 DB_DATABASE=php_blog 
  
 DB_USERNAME=root 
  
 DB_PASSWORD=",NA
Youwillalsoneedtocreatethe,php_blog,NA
"database.Doitwithjustonecommand,as ",NA,NA
follows:,"$mysql-uroot-e""CREATESCHEMAphp_blog""",NA
"WithLaravel,youhaveamigrationssystem;thatis,youkeepallthedatabaseschema ",NA,NA
changesunder,database/migrations,NA
sothatanyoneelseusingyourcodecanquicklyset ,NA,NA
"uptheirdatabase.Thefirststepistorunthefollowingcommand,whichwillcreatea ",NA,NA
migrationsfileforthe,blogs,NA
table:,$phpartisanmake:migrationcreate_posts_table--create=posts,NA
"Openthegeneratedfile,whichshouldbesomethingsimilarto ",database/migrations/<date>_create_posts_table.php,NA
.The,up,NA
methoddefinesthe ,NA,NA
"tableblogswithanautoincrementalIDandtimestampfield.Wewouldliketoaddatitle, ",NA,NA
"thecontentofthepost,andtheuserIDthatcreatedit.Replacethe",up,NA
methodwiththe ,NA,NA
following:,"publicfunctionup() 
  
 { 
  
 Schema::create('posts',function(Blueprint$table){ 
 $table->increments('id'); 
  
 $table->timestamps(); 
  
 $table->string('title'); 
  
 $table->text('content'); 
  
 $table->integer('user_id')->unsigned(); 
  
 $table->foreign('user_id')
  
 ->references('id')->on('users'); 
  
 }); 
  
 }",NA
"Here,thetitlewillbeastring,whereasthecontentisatext.Thedifferenceisinthelength ",NA,NA
"ofthesefields,stringbeingasimple",VARCHAR,NA
andtexta,TEXT,NA
datatype.FortheuserIDwe ,NA,NA
defined,INTUNSIGNED,NA
",whichreferencesthe",id,NA
fieldofthe,users,NA
table.Laravelalready ,NA,NA
definedthe,users,NA
"tablewhencreatingtheproject,soyoudonothavetoworryaboutit.If ",NA,NA
"youareinterestedinhowitlooks,checkthe ",database/migrations/2014_10_12_000000_create_users_table.php,NA
file.Youwillnote ,NA,NA
"thatauseriscomposedbyanID,aname,theuniquee-mail,andthepassword.",NA,NA
"Sofar,wehavejustwrittenthemigrationfiles.Inordertoapplythem,youneedtorunthe ",NA,NA
followingcommand:,NA,NA
"Ifeverythingwentasexpected,youshouldhavea",blogs,NA
tablenowsimilartothe ,NA,NA
following:,NA,NA
"Tofinishwithallthepreparations,weneedtocreateamodelforour",blogs,NA
table.This ,NA,NA
modelwillextendfrom,NA,NA
Illuminate\Database\Eloquent\Model,NA,NA
",whichistheORMth",NA,NA
"at Laraveluses.Togeneratethismodelautomatically,runthefollowingcommand:",$phpartisanmake:modelPost,NA
Thenameofthemodelshouldbethesameasthatofthedatabasetablebutinsingular. ,NA,NA
"Afterrunningthiscommand,youcanfindtheemptymodelin",app/Post.php,NA
.,NA,NA
Addingthefirstendpoint,NA,NA
Let’saddaquickendpointjusttounderstandhowroutesworkandhowtolinkcontrollers ,NA,NA
"withtemplates.Inordertoavoiddatabaseaccess,let’sbuildtheaddnewpostview,which ",NA,NA
willdisplayaformthatallowstheusertoaddanewpostwithatitleandtext.Let’sstart ,NA,NA
byaddingtherouteandcontroller.Openthe,app/Http/routes.php,NA
fileandaddthe following:,"Route::group(['middleware'=>['web']],function(){ 
 Route::get('/new',function(){ 
  
 returnview('new'); 
  
 }); 
  
 });",NA
Thesethreeverysimplelinessaythatforthe,/new,NA
"endpoint,wewanttoreplywiththe",new,NA
"view.Lateron,wewillcomplicatethingshereinthecontroller,butfornow,let’sfocuson ",NA,NA
theviews.,NA,NA
"LaravelusesBladeasthetemplateengineinsteadofTwig,butthewaytheyworkisquite ",NA,NA
similar.Theycanalsodefinelayoutsfromwhereothertemplatescanextend.Theplacefor ,NA,NA
yourlayoutsisin,resources/views/layouts,NA
.Createan,app.blade.php,NA
filewiththe ,NA,NA
"followingcontentinsidethisdirectory,asfollows:","<!DOCTYPEhtml> 
  
 <htmllang=""en""> 
  
 <head> 
  
 <title>PHPBlog</title> 
  
 <linkrel=""stylesheet""href=""{{URL::asset('css/layout.css')}}"" type=""text/css""> 
  
 @yield('css') 
  
 </head> 
  
 <body> 
  
 <divclass=""navbar""> 
  
 <ul> 
  
 <li><ahref=""/new"">Newarticle</a></li> 
  
 <li><ahref=""/"">Articles</a></li> 
  
 </ul> 
  
 </div> 
  
 <divclass=""content""> 
  
 @yield('content') 
  
 </div> 
  
 </body> 
  
 </html>",NA
"Thisisjustanormallayoutwithatitle,someCSS,andan",ul,NA
"listofsectionsinthebody, ",NA,NA
whichwillbeusedasthenavigationbar.Therearetwoimportantelementstonotehere ,NA,NA
otherthantheHTMLcodethatshouldalreadysoundfamiliar:,NA,NA
"Todefineablock,Bladeusesthe",@yield,NA
annotationfollowedbythenameofthe ,NA,NA
"block.Inourlayout,wedefinedtwoblocks:",css,NA
and,content,NA
.,NA,NA
ThereisafeaturethatallowsyoutobuildURLsintemplates.Wewanttoincludethe ,NA,NA
CSSfilein,public/css/layout.css,NA
",sowewilluse",URL::asset,NA
tobuildthisURL.It,NA,NA
isalsohelpfultoincludeJSfiles.,NA,NA
"Asyousaw,weincludeda",layout.css,NA
file.CSSandJSfilesarestoredunderthe,public,NA
directory.Createyoursin,public/css/layout.css,NA
withthefollowingcode:,".content{ 
  
 position:fixed; 
  
 top:50px; 
  
 width:100% 
  
 } 
  
 .navbarul{ 
  
 position:fixed; 
  
 top:0; 
  
 width:100%; 
  
 list-style-type:none; 
  
 margin:0; 
  
 padding:0; 
  
 overflow:hidden; 
  
 background-color:#333; 
  
 } 
  
 .navbarli{ 
  
 float:left; 
  
 border-right:1pxsolid#bbb; 
  
 } 
  
 .navbarli:last-child{ 
  
 border-right:none; 
  
 } 
  
 .navbarlia{ 
  
 display:block; 
  
 color:white; 
  
 text-align:center; 
  
 padding:14px16px; 
  
 text-decoration:none; 
  
 } 
  
 .navbarlia:hover{ 
  
 background-color:#111; 
  
 }",NA
"Now,wecanfocusonourview.Templatesarestoredin",resources/views,NA
",and,aswith ",NA,NA
"layouts,theyneedthe",.blade.php,NA
fileextension.Createyourviewin ,resources/views/new.blade.php,NA
withthefollowingcontent:,"@extends('layouts.app')
  
 @section('css') 
  
 <linkrel=""stylesheet""href=""{{URL::asset('css/new.css')}}"" type=""text/css""> 
  
 @endsection
  
 @section('content') 
  
 <h2>Addnewpost</h2> 
  
 <formmethod=""post""action=""/new""> 
  
 <divclass=""component""> 
  
 <labelfor=""title"">Title</label> 
 <inputtype=""text""name=""title""/> </div>",NA
Thesyntaxisquiteintuitive.Thistemplateextendsfromthelayouts’oneanddefinestwo ,NA,NA
sectionsorblocks:,css,NA
and,content,NA
.TheCSSfileincludedfollowsthesameformatasthe ,NA,NA
previousone.Youcancreateitin,public/css/new.css,NA
withcontentsimilartothe following:,"label{ 
  
 display:block; 
  
 } 
  
 input{ 
  
 width:80%; 
  
 } 
  
 button{ 
  
 font-size:30px; 
  
 float:right; 
  
 margin-right:20%; 
  
 } 
  
 textarea{ 
  
 width:80%; 
  
 } 
  
 .component{ 
  
 padding:10px; 
  
 }",NA
TherestofthetemplatejustdefinesthePOSTformpointingtothesameURLwithtitle ,NA,NA
andtextfields.Everythingisreadytotestitinyourbrowser!Tryaccessing ,http://localhost:8080/new,NA
ortheportnumberofyourchoice.Youshouldsee ,NA,NA
somethingsimilartothefollowingscreenshot:,NA,NA
Managingusers,NA,NA
"Asexplainedbefore,userauthenticationandauthorizationisoneofthefeaturesthatmost ",NA,NA
frameworkscontain.Laravelmakesourlivesveryeasybyprovidingtheusermodeland ,NA,NA
theregistrationandauthenticationcontrollers.Itisquiteeasytomakeuseofthem:you ,NA,NA
justneedtoaddtheroutespointingtothealreadyexistingcontrollersandaddtheviews. ,NA,NA
Let’sbegin.,NA,NA
Therearefiveroutesthatyouneedtoconsiderhere.Therearetwothatbelongtothe ,NA,NA
"registrationstep,onetogettheformandanotheronefortheformtosubmitthe ",NA,NA
informationprovidedbytheuser.Theotherthreearerelatedtotheauthenticationpart:on,NA,NA
"e togettheform,onetoposttheform,andoneforthelogout.Allfiveofthemareincluded ",NA,NA
inthe,Auth\AuthController,NA
class.Addtoyour,routes.php,NA
filethefollowingroutes:,"//Registrationroutes…
  
 Route::get('auth/register','Auth\AuthController@getRegister'); 
 Route::post('auth/register','Auth\AuthController@postRegister');
  
 //Authenticationroutes…
  
 Route::get('/login','Auth\AuthController@getLogin'); 
 Route::post('login','Auth\AuthController@postLogin'); 
 Route::get('logout','Auth\AuthController@getLogout');",NA
"Notehowwedefinedtheseroutes.Asopposedtotheonethatwecreatedpreviously,the ",NA,NA
secondargumentoftheseisastringwiththeconcatenationofthecontroller’sclassname ,NA,NA
andmethod.Thisisabetterwaytocreateroutesbecauseitseparatesthelogictoa ,NA,NA
differentclassthatcanlaterbereusedand/orunittested.,NA,NA
"Ifyouareinterested,youcanbrowsethecodeforthiscontroller.Youwillfindacomplex ",NA,NA
"design,wherethefunctionstherouteswillinvokeareactuallypartoftwotraitsthatthe ",AuthController,NA
classuses:,RegistersUsers,NA
and,AuthenticatesUsers,NA
.Checkingthese ,NA,NA
methodswillenableyoutounderstandwhatgoesonbehindthescenes.,NA,NA
Each,get,NA
"routeexpectsaviewtorender.Fortheuser’sregistration,weneedtocreatea ",NA,NA
templatein,resources/views/auth/register.blade.php,NA
",andfortheloginview,we ",NA,NA
needatemplatein,resources/views/auth/login.blade.php,NA
.Assoonaswesendthe ,NA,NA
"correctPOSTparameterstothecorrectURL,wecanaddanycontentthatwethink ",NA,NA
necessary.,NA,NA
Userregistration,NA,NA
"Let’sstartwiththeregistrationform;thisformneedsfourPOSTparameters:name,e-",NA,NA
"mail,password,andpasswordconfirmation,andastheroutesays,weneedtosubmititto ",/auth/register,NA
.Thetemplatecouldlooksimilartothefollowing:,"@extends('layouts.app')
  
 @section('css') 
  
 <linkrel=""stylesheet""href=""{{URL::asset('css/register.css')}}"" type=""text/css""> 
  
 @endsection",NA
"Thistemplateisquitesimilartotheformfornewposts:itextendsthelayout,addsaCSS ",NA,NA
"file,andpopulatesthecontentsectionwithaform.Thenewadditionhereistheuseofthe ",old,NA
functionthatretrievesthevaluesubmittedonthepreviousrequestincasethatthe ,NA,NA
formwasnotvalidandweshoweditbacktotheuser.,NA,NA
"Beforewetryit,weneedtoadda",register.css,NA
filewiththestylesforthisform.A ,NA,NA
simpleonecouldbeasfollows:,"div.content{ 
  
 text-align:center; 
  
 } 
  
 label{ 
  
 display:block; 
  
 } 
  
 input{ 
  
 width:250px; 
  
 } 
  
 button{ 
  
 font-size:20px; 
  
 } 
  
 .component{ 
  
 padding:10px; 
  
 }",NA
"Finally,weshouldeditthelayoutinordertoaddalinkonthemenupointingtothe",NA,NA
registrationandloginpages.Thisisassimpleasaddingthefollowing,li,NA
elementsatthe ,NA,NA
endofthe,ul,NA
tag:,"<liclass=""right""><ahref=""/auth/register"">Signup</a></li> 
 <liclass=""right""><ahref=""/login"">Signin</a></li>",NA
Addalsothestyleforthe,right,NA
classattheendof,layout.css,NA
:,"div.alert{ 
  
 color:red; 
  
 }",NA
"Tomakethingsevenmoreuseful,wecouldaddtheinformationforwhatwentwrong ",NA,NA
"whensubmittingtheform.Laravelflashestheerrorsintothesession,andtheycanbe ",NA,NA
accessedviathe,errors,NA
templatevariable.Asthisiscommontoallformsandnotonlyto ,NA,NA
"theregistrationone,wecouldaddittothe",app.blade.php,NA
"layout,asfollows:","<divclass=""content""> 
  
 @if(count($errors)>0) 
  
 <divclass=""alert""> 
  
 <strong>Whoops!Somethingwentwrong!</strong> @foreach($errors-
 >all()as$error) 
  
 <p>{{$error}}</p> 
  
 @endforeach 
  
 </div> 
  
 @endif 
  
 @yield('content')",NA
"Inthispieceofcode,wewilluseBlade’s",@if,NA
conditionaland,@foreach,NA
loop.Thesyntax ,NA,NA
isthesameasPHP;theonlydifferenceisthe,@,NA
prefix.,NA,NA
"Now,wearereadytogo.Launchyourapplicationandclickontheregistrationlinkonthe ",NA,NA
"right-handsideofthemenu.Attempttosubmittheform,butleavesomefieldsblankso ",NA,NA
thatwecannotehowtheerrorsaredisplayed.Theresultshouldbesomethingsimilarto ,NA,NA
this:,NA,NA
Onethingthatweshouldcustomizeiswheretheuserwillberedirectedoncethe ,NA,NA
"registrationissuccessful.Inthiscase,wecanredirectthemtotheloginpage.Inorderto ",NA,NA
"achievethis,youneedtochangethevalueofthe",$redirectTo,NA
propertyof ,AuthController,NA
".Sofar,weonlyhavethenewpostpage,butlater,youcouldaddany ",NA,NA
paththatyouwantviathefollowing:,protected$redirectPath='/new;,NA
Userlogin,NA,NA
Theuser’sloginhasafewmorechangesotherthantheregistration.Wenotonlyneedto ,NA,NA
"addtheloginview,weshouldalsomodifythemenuinthelayoutinordertoacknowledge ",NA,NA
"theauthenticateduser,removetheregisterlink,andaddalogoutone.Thetemplate,as ",NA,NA
"mentionedearlier,hastobesavedin",resources/views/auth/login.blade.php,NA
.The formneedsane-,NA,NA
mailandpasswordandoptionallyacheckboxforthe,NA,NA
rememberme ,NA,NA
functionality.Anexamplecouldbethefollowing:,"@extends('layouts.app')
  
 @section('css') 
  
 <linkrel=""stylesheet""href=""{{URL::asset('css/register.css')}}""",NA
Thelayouthastobechangedslightly.Wherewedisplayedthelinkstoregisterandlogin ,NA,NA
"users,nowweneedtocheckwhetherthereisauseralreadyauthenticated;ifso,weshould ",NA,NA
rathershowalogoutlink.Youcangettheauthenticateduserthroughthe,Auth::user(),NA
"methodevenfromtheview.Iftheresultisnotempty,itmeansthattheuserwas ",NA,NA
authenticatedsuccessfully.Changethetwolinksusingthefollowingcode:,"<ul> 
  
 <li><ahref=""/new"">Newarticle</a></li> 
  
 <li><ahref=""/"">Articles</a></li> 
  
 @if(Auth::user()!==null) 
  
 <liclass=""right""> 
  
 <ahref=""/logout"">Logout</a> 
  
 </li> 
  
 @else 
  
 <liclass=""right""> 
  
 <ahref=""/auth/register"">Signup</a> </li> 
  
 <liclass=""right""> 
  
 <ahref=""/login"">Signin</a> 
  
 </li> 
  
 @endif 
  
 </ul>",NA
Protectedroutes,NA,NA
Thislastpartoftheusermanagementsessionisprobablythemostimportantone.Oneof ,NA,NA
"themaingoalswhenauthenticatingusersistoauthorizethemtocertaincontent—thatis, ",NA,NA
"toallowthemtovisitcertainpagesthatunauthenticateduserscannot.InLaravel,youcan",NA,NA
definewhichroutesareprotectedinthiswaybyjustaddingthe,auth,NA
middleware.Update ,NA,NA
thenewpostroutewiththefollowingcode:,"Route::get('/new',['middleware'=>'auth',function(){ returnview('new'); 
  
 }]);",NA
Everythingisready!Trytoaccessthenewpostpageafterloggingout;youwillbe ,NA,NA
redirectedautomaticallytotheloginpage.Canyoufeelhowpowerfulaframeworkcan ,NA,NA
be?,NA,NA
Settinguprelationshipsinmodels,NA,NA
"Aswementionedbefore,LaravelcomeswithanORM,EloquentORM,whichmakes ",NA,NA
"dealingwithmodelsaveryeasytask.Inoursimpledatabase,wedefinedonetablefor ",NA,NA
"posts,andwealreadyhadanotheroneforusers.PostscontaintheIDoftheuserthatowns ",NA,NA
"it—thatis,",user_id,NA
.Itisgoodpracticetousethesingularofthenameofthetable ,NA,NA
followedby,_id,NA
sothatEloquentwillknowwheretolook.Thiswasallwedidregarding ,NA,NA
theforeignkey.,NA,NA
Weshouldalsomentionthisrelationshiponthemodelside.Dependingonthetypeofthe ,NA,NA
"relationship(onetoone,onetomany,ormanytomany),thecodewillbeslightly ",NA,NA
"different.Inourcase,wehaveaone-to-manyrelationshipbecauseoneusercanhave ",NA,NA
"manyposts.TosaysoinLaravel,weneedtoupdateboththe",Post,NA
andthe,User,NA
models.,NA,NA
The,User,NA
"modelneedstospecifythatithasmanyposts,soyouneedtoadda",posts,NA
methodwiththefollowingcontent:,"publicfunctionposts(){ 
  
 return$this->hasMany('App\Post'); }",NA
Thismethodsaysthatthemodelforusershasmanyposts.Theotherchangethatneedsto ,NA,NA
bemadein,Post,NA
issimilar:weneedtoadda,user,NA
methodthatdefinestherelationship.,NA,NA
Themethodshouldbesimilartothisone:,"publicfunctionuser(){ 
  
 return$this->belongsTo('App�ser'); }",NA
"Itlookslikeverylittle,butthisisthewholeconfigurationthatweneed.Inthenext ",NA,NA
"section,youwillseehoweasyitistosaveandqueryusingthesetwomodels.",NA,NA
Creatingcomplexcontrollers,NA,NA
"Eventhoughthetitleofthissectionmentionscomplexcontrollers,youwillnotethatwe ",NA,NA
cancreatecompleteandpowerfulcontrollerswithverylittlecode.Let’sstartbyadding ,NA,NA
thecodethatwillmanagethecreationofposts.Thiscontrollerneedstobelinkedtothe ,NA,NA
followingroute:,"Route::post('/new','Post\PostController@createPost');",NA
"Asyoucanimagine,now,weneedtocreatethe",Post\PostController,NA
classwiththe ,createPost,NA
methodinit.Controllersshouldbestoredin,app/Http/Controllers,NA
",andif ",NA,NA
"theycanbeorganizedinfolders,itwouldbeevenbetter.Savethefollowingclassin ",app/Http/Controllers/Post/PostController.php,NA
:,"<?php
  
 namespaceApp\Http\Controllers\Post;
  
 useApp\Http\Controllers\Controller; 
  
 useIlluminate\Http\Request; 
  
 useIlluminate\Support\Facades\Auth; 
  
 useIlluminate\Support\Facades\Validator; useApp\Post;
  
 classPostControllerextendsController{
  
 publicfunctioncreatePost(Request$request){
  
 } 
  
 }",NA
"Sofar,theonlytwothingswecannotefromthisclassare:",NA,NA
Controllersextendfromthe,App\Http\Controllers\Controller,NA
"class,which ",NA,NA
containssomegeneralhelpersforallthecontrollers.,NA,NA
Methodsofcontrollerscangetthe,Illuminate\Http\Request,NA
argumentastheuser’s ,NA,NA
"request.Thisobjectwillcontainelementssuchasthepostedparameters,cookies,and ",NA,NA
soon.Thisisverysimilartotheonewecreatedinourownapplication.,NA,NA
Thefirstthingweneedtodointhiskindofcontrollerischeckwhethertheparameters ,NA,NA
"postedarecorrect.Forthis,wewillusethefollowingcode:","publicfunctioncreatePost(Request$request){ 
 $validator=Validator::make($request->all(),[ 
 'title'=>'required|max:255', 
  
 'content'=>'required|min:20', 
  
 ]);
  
 if($validator->fails()){ 
  
 returnredirect()->back()
  
 ->withInput()
  
 ->withErrors($validator); 
  
 }",NA
"Thefirstthingwedidiscreateavalidator.Forthis,weusedthe",Validator::make,NA
"functionandsenttwoarguments:thefirstonecontainsalltheparametersfromtherequest, ",NA,NA
andthesecondoneisanarraywiththeexpectedfieldsandtheirconstraints.Notethatwe ,NA,NA
expecttworequiredfields:,title,NA
and,content,NA
".Here,thefirstonecanbeupto255 ",NA,NA
"characterslong,andthesecondoneneedstobeatleast20characterslong.",NA,NA
Oncethe,validator,NA
"objectiscreated,wecancheckwhetherthedatapostedbytheuser ",NA,NA
matchestherequirementswiththe,fails,NA
method.Ifitreturns,true,NA
"—thatis,thevalidation ",NA,NA
fails—wewillredirecttheuserbacktothepreviouspagewith,redirect()->back(),NA
.To ,NA,NA
"performthisinvocation,wewilladdtwomoremethodcalls:",withInput,NA
willsendthe ,NA,NA
"submittedvaluessothatwecandisplaythemagain,and",withErrors,NA
willsendtheerrors ,NA,NA
thesameway,AuthController,NA
did.,NA,NA
"Atthispoint,itwouldbehelpfultotheuserifweshowthepreviouslysubmittedtitleand ",NA,NA
"textincasethepostisnotvalid.Forthis,usethealreadyknown",old,NA
methodintheview:,"{{--...--}} 
  
 <inputtype=""text""name=""title"" 
 value=""{{old('title')}}""/> 
 </div> 
  
 <divclass=""component""> 
  
 <label>Text</label> 
  
 <textarearows=""20""name=""content""> 
 {{old('content')}} 
  
 </textarea> 
  
 {{--...--}}",NA
"Atthispoint,wecanalreadytesthowthecontrollerbehaveswhenthepostdoesnotmatch ",NA,NA
therequiredvalidations.Ifyoumissanyoftheparametersortheydonothavecorrect ,NA,NA
"lengths,youwillgetanerrorpagesimilartothefollowingone:",NA,NA
Let’snowaddthelogictosavethepostincaseitisvalid.Ifyouremembertheinteraction ,NA,NA
"withthemodelsfromourpreviousapplication,youwillbegladlysurprisedathoweasyit ",NA,NA
istoworkwiththemhere.Takealookatthefollowing:,"publicfunctioncreatePost(Request$request){ 
 $validator=Validator::make($request->all(),[ 'title'=>'required|max:255', 
  
 'content'=>'required|min:20', 
  
 ]);
  
 if($validator->fails()){ 
  
 returnredirect()->back()
  
 ->withInput()
  
 ->withErrors($validator); 
  
 }
  
 $post=newPost(); 
  
 $post->title=$request->title; 
  
 $post->content=$request->content;
  
 Auth::user()->posts()->save($post);
  
 returnredirect('/new'); 
  
 }",NA
Thefirstthingwewilldoiscreatea,post,NA
objectsettingthetitleandcontentfromthe ,NA,NA
"requestvalues.Then,giventheresultof",Auth::user(),NA
",whichgivesustheinstanceofthe ",NA,NA
"currentlyauthenticatedusermodel,wewillsavethepostthatwejustcreatedthrough ",posts()->save($post),NA
".Ifwewantedtosavethepostwithouttheinformationoftheuser, ",NA,NA
wecoulduse,$post->save(),NA
".Really,thatisall.",NA,NA
Let’squicklyaddanotherendpointtoretrievethelistofpostsforagivenusersothatwe ,NA,NA
cantakealookathowEloquentORMallowsustofetchdataeasily.Addthefollowing ,NA,NA
route:,"Route::get('/',['middleware'=>'auth',function(){ $posts=Auth::user()
  
 ->posts()
  
 ->orderBy('created_at')
  
 ->get(); 
  
 returnview('posts',['posts'=>$posts]); 
  
 }]);",NA
Thewayweretrievedataisverysimilartohowwesaveit.Weneedtheinstanceofa model—,NA,NA
"inthiscase,theauthenticateduser—andwewilladdaconcatenationofmethod ",NA,NA
"invocationsthatwillinternallygeneratethequerytoexecute.Inthiscase,wewillaskfor ",NA,NA
"thepostsorderedbythecreationdate.Inordertosendinformationtotheview,weneedto ",NA,NA
"passasecondargument,whichwillbeanarrayofparameternamesandvalues.",NA,NA
Addthefollowingtemplateas,resources/views/posts.blade.php,NA
",whichwilldisplay ",NA,NA
thelistofpostsfortheauthenticateduserasatable.Notehowwewillusethe,$post,NA
"object,whichisaninstanceofthemodel,inthefollowingcode:","@extends('layouts.app')
  
 @section('css') 
  
 <linkrel=""stylesheet""href=""{{URL::asset('css/posts.css')}}"" type=""text/css""> 
  
 @endsection
  
 @section('content') 
  
 <h2>Yourposts</h2>
  
 <table> 
  
 @foreach($postsas$post) 
  
 <tr> 
  
 <td>{{$post->title}}</td> 
  
 <td>{{$post->created_at}}</td> 
  
 <td>{{str_limit($post->content,100)}}</td> 
 </tr> 
  
 @endforeach 
  
 </table> 
  
 @endsection",NA
Thelistsofpostsarefinallydisplayed.Theresultshouldbesomethingsimilartothe ,NA,NA
followingscreenshot:,NA,NA
Addingtests,NA,NA
"Inaveryshorttime,wecreatedanapplicationthatallowsyoutoregister,login,and ",NA,NA
createandlistpostsfromscratch.Wewillendthissectionbytalkingabouthowtotest ,NA,NA
yourLaravelapplicationwithPHPUnit.,NA,NA
ItisextremelyeasytowritetestsinLaravelasithasaveryniceintegrationwithPHPUnit. ,NA,NA
Thereisalreadya,phpunit.xml,NA
"file,acustomized",TestCase,NA
"class,customizedassertions, ",NA,NA
"andplentyofhelpersinordertotestwiththedatabase.Italsoallowsyoutotestroutes, ",NA,NA
emulatingtheHTTPrequestinsteadoftestingthecontrollers.Wewillvisitallthese ,NA,NA
featureswhiletestingthecreationofnewposts.,NA,NA
"Firstofall,weneedtoremove",tests/ExampleTest.php,NA
"becauseittestedthehomepage, ",NA,NA
"andaswemodifiedit,itwillfail.Donotworry;thisisanexampletestthathelps ",NA,NA
"developerstostarttesting,andmakingitfailisnotaproblematall.",NA,NA
"Now,weneedtocreateournewtest.Todothis,wecaneitheraddthefilemanuallyoruse ",NA,NA
thecommandlineandrunthefollowingcommand:,$phpartisanmake:testNewPostTest,NA
Thiscommandcreatesthe,tests/NewPostTest.php,NA
"file,whichextendsfrom",TestCase,NA
.If ,NA,NA
"youopenit,youwillnotethatthereisalreadyadummytest,whichyoucanalsoremove.",NA,NA
"Eitherway,youcanrunPHPUnittomakesureeverythingpasses.Youcandoitinthe ",NA,NA
"samewaywedidpreviously,asfollows:",$./vendor/bin/phpunit,NA
Thefirsttestwecanaddisonewherewetrytoaddanewpostbutthedatapassedbythe ,NA,NA
"POSTparametersisnotvalid.Inthiscase,weshouldexpectthattheresponsecontains ",NA,NA
"errorsandolddata,sotheusercanedititinsteadofrewritingeverythingagain.Addthe ",NA,NA
followingtesttothe,NewPostTest,NA
class:,"<?php
  
 classNewPostTestextendsTestCase 
  
 { 
  
 publicfunctiontestWrongParams(){ 
  
 $user=factory(App�ser::class)
  
 ->make(['email'=>'test@user.laravel']);
  
 $this->be($user);
  
 $this->call( 
  
 'POST', 
  
 '/new', 
  
 ['title'=>'thetitle','content'=>'ojhkjhg'] );
  
 $this->assertSessionHasErrors('content'); $this-
 >assertHasOldInput(); 
  
 } 
  
 }",NA
Thefirstthingwecannoteinthetestisthecreationofa,user,NA
instanceusingafactory.,NA,NA
Youcanpassanarraywithanyparameterthatyouwanttosettothe,make,NA
invocation; ,NA,NA
"otherwise,defaultswillbeused.Afterwegetthe",user,NA
"instance,wewillsendittothe",be,NA
methodtoletLaravelknowthatwewantthatusertobetheauthorizedoneforthistest.,NA,NA
"Oncewesetthegroundsforthetest,wewillusethe",call,NA
helperthatwillemulateareal ,NA,NA
"HTTPrequest.Tothismethod,wehavetosendtheHTTPmethod(inthiscase,POST), ",NA,NA
"theroutetorequest,andoptionallytheparameters.Notethatthe",call,NA
methodreturnsthe ,NA,NA
responseobjectincaseyouneedit.,NA,NA
"Wewillsendatitleandthecontent,butthissecondoneisnotlongenough,sowewill ",NA,NA
"expectsomeerrors.Laravelcomeswithseveralcustomizedassertions,especiallywhen ",NA,NA
"testingthesekindsofresponses.Inthiscase,wecouldusetwoofthem: ",assertSessionHasErrors,NA
",whichcheckswhetherthereareanyflasherrorsinthesession ",NA,NA
"(inparticular,theonesforthecontentparameter),and",assertHasOldInput,NA
",whichchecks ",NA,NA
whethertheresponsecontainsolddatainordertoshowitbacktotheuser.,NA,NA
Thesecondtestthatwewouldliketoaddisthecasewheretheuserpostsvaliddataso ,NA,NA
thatwecansavethepostinthedatabase.Thistestistrickierasweneedtointeractwith ,NA,NA
"thedatabase,whichisusuallyanotaverypleasantexperience.However,Laravelgivesus ",NA,NA
enoughtoolstohelpusinthistask.ThefirstandmostimportantistoletPHPUnitknow ,NA,NA
"thatwewanttousedatabasetransactionsforeachtest.Then,weneedtopersistthe ",NA,NA
"authenticateduserinthedatabaseastheposthasaforeignkeypointingtoit.Finally,we ",NA,NA
shouldassertthatthepostissavedinthedatabasecorrectly.Addthefollowingcodetothe ,NewPostTest,NA
class:,"useDatabaseTransactions;
  
 //...
  
 publicfunctiontestNewPost(){ 
  
 $postParams=[ 
  
 'title'=>'thetitle', 
  
 'content'=>'Inaplacefarfaraway.' ];
  
 $user=factory(App�ser::class)
  
 ->make(['email'=>'test@user.laravel']); 
 $user->save();
  
 $this->be($user);
  
 $this->call('POST','/new',$postParams);
  
 $this->assertRedirectedTo('http://localhost/new'); $this-
 >seeInDatabase('posts',$postParams); 
  
 }",NA
The,DatabaseTransactions,NA
traitwillmakethetesttostartatransactionatthebeginning ,NA,NA
"andthenrollitbackoncethetestisdone,sowewillnotleavethedatabasewithdatafrom ",NA,NA
tests.Savingtheauthenticateduserinthedatabaseisalsoaneasytaskastheresultofthe,NA,NA
"factoryisaninstanceoftheuser’smodel,andwecanjustinvokethe",save,NA
methodonit.,NA,NA
The,assertRedirectedTo,NA
assertionwillmakesurethattheresponsecontainsthevalid ,NA,NA
"headersthatredirecttheusertothespecifiedURL.Moreinterestingly,",seeInDatabase,NA
willverifythatthereisanentityinthe,posts,NA
"table,whichisthefirstargument,withthe ",NA,NA
"dataprovidedinthearray,whichisthesecondargument.",NA,NA
"Therearequitealotofassertions,butasyoucannote,theyareextremelyuseful,reducing ",NA,NA
whatcouldbealongtesttoaveryfewlines.Werecommendyoutovisittheofficial ,NA,NA
documentationforthefulllist.,NA,NA
TheSilexmicroframework,NA,NA
"AfteratasteofwhatLaravelcanofferyou,youmostlikelydonotwanttohearabout ",NA,NA
"minimalistmicroframeworks.Still,wethinkitisgoodtoknowmorethanoneframework. ",NA,NA
"Youcangettoknowdifferentapproaches,bemoreversatile,andeveryonewillwantyou ",NA,NA
intheirteam.,NA,NA
"WechoseSilexbecauseitisamicroframework,whichisverydifferentfromLaravel,and ",NA,NA
"alsobecauseitispartoftheSymfonyfamily.WiththisintroductiontoSilex,youwill ",NA,NA
"learnhowtouseyoursecondframework,whichisofatotallydifferenttype,andyouwill ",NA,NA
"beonestepclosertoknowingSymfonyaswell,whichisoneofthebigplayers.",NA,NA
"Whatisthebenefitofmicroframeworks?Well,theyprovidetheverybasics—thatis,a ",NA,NA
"router,asimpledependencyinjector,requesthelpers,andsoon,butthisistheendofit.",NA,NA
"Youhaveplentyofroomtochooseandbuildwhatyoureallyneed,includingexternal ",NA,NA
librariesorevenyourownones.Thismeansthatyoucanhaveaframeworkspecially ,NA,NA
"customizedforeachdifferentproject.Infact,Silexprovidesahandfulofbuilt-inservice ",NA,NA
"providersthatyoucanintegrateveryeasily,fromtemplateenginestologgingorsecurity.",NA,NA
Installation ,NA,NA
"There’snonewshere.Composerdoeseverythingforyou,asitdoeswithLaravel.Execute ",NA,NA
thefollowingcommandonyourcommandlineattherootofyournewprojectinorderto ,NA,NA
includeSilexinyour,composer.json,NA
file:,$composerrequiresilex/silex,NA
"Youmayrequiremoredependencies,butlet’saddthemwhenweneedthem.",NA,NA
Projectsetup,NA,NA
Silex’smostimportantclassis,Silex\Application,NA
".Thisclass,whichextendsfrom ",NA,NA
Pimple,NA,NA
"(alightweightdependencyinjector),managesalmostanything.Youcanuseitas ",NA,NA
anarrayasitimplementsthe,ArrayAccess,NA
"interface,oryoucouldinvokeitsmethodsto ",NA,NA
"adddependencies,registerservices,andsoon.Thefirstthingtodoistoinstantiateitin ",NA,NA
your,public/index.php,NA
"file,asfollows:","<?php
  
 useSilex\Application;
  
 require_once__DIR__.'/../vendor/autoload.php';
  
 $app=newApplication();",NA
Managingconfiguration,NA,NA
Oneofthefirstthingsweliketodoisloadtheconfiguration.Wecoulddosomethingvery ,NA,NA
"simple,suchasincludingafilewithPHPorJSONcontent,butlet’smakeuseofoneof ",NA,NA
"theserviceproviders,",ConfigServiceProvider,NA
.Let’sadditwithComposerviathe followingline:,$composerrequireigorw/config-service-provider,NA
"Thisserviceallowsustohavemultipleconfigurationfiles,oneforeachenvironmentwe ",NA,NA
"need.Imaginingthatwewanttohavetwoenvironments,",prod,NA
and,dev,NA
",thismeanswe ",NA,NA
needtwofiles:onein,config/prod.json,NA
andonein,config/dev.json,NA
.The ,config/dev.json,NA
filewouldlooksimilartothis:,"{ 
  
 ""debug"":true, 
  
 ""cache"":false, 
  
 ""database"":{ 
  
 ""user"":""dev"", 
  
 ""password"":"""" 
  
 } 
  
 }",NA
The,config/prod.json,NA
filewouldlooksimilartothis:,"{ 
  
 ""debug"":false, 
  
 ""cache"":true, 
  
 ""database"":{ 
  
 ""user"":""root"", 
  
 ""password"":""fsd98na9nc"" 
  
 } 
  
 }",NA
"Inordertoworkinadevelopmentenvironment,youwillneedtosetthecorrectvalueto ",NA,NA
theenvironmentvariablebyrunningthefollowingcommand:,exportAPP_ENV=dev,NA
The,APP_ENV,NA
environmentvariablewillbetheonetellinguswhichenvironmentwearein.,NA,NA
"Now,itistimetousethisserviceprovider.Inordertoregisteritbyreadingfromthe ",NA,NA
"configurationfileofthecurrentenvironment,addthefollowinglinestoyour",index.php,NA
file:,"$env=getenv('APP_ENV')?:'prod'; 
  
 $app->register( 
  
 newIgorw\Silex\ConfigServiceProvider( 
 __DIR__.""/../config/$env.json"" ) 
  
 );",NA
Thefirstthingwedidhereistogettheenvironmentfromtheenvironmentvariable.By ,NA,NA
"default,wesetitto",prod,NA
".Then,weinvoked",register,NA
fromthe,$app,NA
objecttoaddan ,NA,NA
instanceof,ConfigServiceProvider,NA
bypassingthecorrectconfigurationfilepath.From ,NA,NA
"nowon,the",$app,NA
“array”willcontainthreeentries:,debug,NA
",",cache,NA
",and",db,NA
withthecontent ,NA,NA
oftheconfigurationfiles.Wewillbeabletoaccessthemwheneverwehaveaccessto ,$app,NA
",whichwillbemostlyeverywhere.",NA,NA
Settingthetemplateengine,NA,NA
"AnotherofthehandyserviceprovidersisTwig.Asyoumightremember,Twigisthe ",NA,NA
"templateenginethatweusedinourownframework,anditis,infact,fromthesame ",NA,NA
peoplethatdevelopedSymfonyandSilex.Youalsoalreadyknowhowtoaddthe ,NA,NA
dependencywithComposer;simplyrunthefollowing:,$composerrequiretwig/twig,NA
"Toregistertheservice,wewillneedtoaddthefollowinglinesinour",public/index.php,NA
file:,"$app->register( 
  
 newSilex\Provider\TwigServiceProvider(), 
 ['twig.path'=>__DIR__.'/../views'] );",NA
"Also,createthe",views/,NA
"directorywherewewilllaterstoreourtemplates.Now,youhave ",NA,NA
the,Twig_Environment,NA
instanceavailablebyjustaccessing,$app['twig'],NA
.,NA,NA
Addingalogger,NA,NA
"Thelastoneoftheserviceprovidersthatwewillregisterfornowisthelogger.Thistime, ",NA,NA
thelibrarytouseis,NA,NA
Monolog,NA,NA
",andyoucanincludethisviathefollowing:",$composerrequiremonolog/monolog,NA
"Thequickestwaytoregisteraserviceisbyjustprovidingthepathofthelogfile,which ",NA,NA
canbedoneasfollows:,"$app->register( 
  
 newSilex\Provider\MonologServiceProvider(), 
 ['monolog.logfile'=>__DIR__.'/../app.log'] );",NA
"Ifyouwouldliketoaddmoreinformationtothisserviceprovider,suchaswhatlevelof ",NA,NA
"logsyouwanttosave,thenameofthelog,andsoon,youcanaddthemtothearray ",NA,NA
togetherwiththelogfile.Takealookatthedocumentationat ,NA,NA
http://silex.sensiolabs.org/doc/providers/monolog.html,NA,NA
forthefulllistofparameter,NA,NA
s available.,NA,NA
"Aswiththetemplateengine,fromnowon,youcanaccessthe",Monolog\Logger,NA
instance ,NA,NA
fromthe,Application,NA
objectbyaccessing,$app['monolog'],NA
.,NA,NA
Addingthefirstendpoint,NA,NA
ItistimetoseehowtherouterworksinSilex.Wewouldliketoaddasimpleendpointfor ,NA,NA
"thehomepage.Aswealreadymentioned,the",$app,NA
"instancecanmanagealmostanything, ",NA,NA
includingroutes.Addthefollowingcodeattheendofthe,public/index.php,NA
file:,"$app->get('/',function(Application$app){ return$app['twig']-
 >render('home.twig'); });",NA
ThisisasimilarwayofaddingroutestotheonethatLaravelfollows.Weinvokedthe,get,NA
"methodasitisaGETendpoint,andwepassedtheroutestringandthe",Application,NA
"instance.Aswementionedhere,",$app,NA
"alsoactsasadependencyinjector—infact,it ",NA,NA
extendsfromone:Pimple—soyouwillnoticethe,Application,NA
instancealmost ,NA,NA
everywhere.Theresultoftheanonymousfunctionwillbetheresponsethatwewillsend ,NA,NA
"totheuser—inthiscase,arenderedTwigtemplate.",NA,NA
"Rightnow,thiswillnotdothetrick.InordertoletSilexknowthatyouaredonesettingup ",NA,NA
"yourapplication,youneedtoinvokethe",run,NA
methodattheveryendofthe ,public/index.php,NA
"file.Rememberthatifyouneedtoaddanythingelsetothisfile,ithas ",NA,NA
tobebeforethisline:,$app->run();,NA
"YouhavealreadyworkedwithTwig,sowewillnotspendtoomuchtimeonthis.Thefirst ",NA,NA
thingtoaddisthe,views/home.twig,NA
template:,"{%extends""layout.twig""%}
  
 {%blockcontent%} 
  
 <h1>Hivisitor!</h1> 
  
 {%endblock%}",NA
"Now,asyoumighthavealreadyguessed,wewilladdthe",views/layout.twig,NA
"template, ",NA,NA
asfollows:,"<html> 
  
 <head> 
  
 <title>SilexExample</title> 
  
 </head> 
  
 <body> 
  
 {%blockcontent%} 
  
 {%endblock%} 
  
 </body> 
  
 </html>",NA
Tryaccessingthehomepageofyourapplication;youshouldgetthefollowingresult:,NA,NA
Accessingthedatabase,NA,NA
"Forthissection,wewillwriteanendpointthatwillcreaterecipesforourcookbook.Run ",NA,NA
thefollowingMySQLqueriesinordertosetupthe,cookbook,NA
databaseandcreatethe ,NA,NA
empty,recipes,NA
table:,"mysql>CREATESCHEMAcookbook; 
  
 QueryOK,1rowaffected(0.00sec) 
  
 mysql>USEcookbook; 
  
 Databasechanged 
  
 mysql>CREATETABLErecipes(
  
 ->idINTUNSIGNEDNOTNULLAUTO_INCREMENTPRIMARYKEY,-
 >nameVARCHAR(255)NOTNULL,
  
 ->ingredientsTEXTNOTNULL,
  
 ->instructionsTEXTNOTNULL,
  
 ->timeINTUNSIGNEDNOTNULL); 
  
 QueryOK,0rowsaffected(0.01sec)",NA
"SilexdoesnotcomewithanyORMintegration,soyouwillneedtowriteyourSQL ",NA,NA
"queriesbyhand.However,thereisaDoctrineserviceproviderthatgivesyouasimpler ",NA,NA
"interfacethantheonePDOoffers,solet’strytointegrateit.Toinstallthis,runthe ",NA,NA
followingcommand:,"$composerrequire""doctrine/dbal:~2.2""",NA
"Now,wearereadytoregistertheserviceprovider.Aswiththerestofservices,addthe ",NA,NA
followingcodetoyour,public/index.php,NA
beforetheroutedefinitions:,"$app->register(newSilex\Provider\DoctrineServiceProvider(),[ 'dbs.options'=>[ 
  
 [ 
  
 'driver'=>'pdo_mysql', 
  
 'host'=>'127.0.0.1', 
  
 'dbname'=>'cookbook', 
  
 'user'=>$app['database']['user'], 
  
 'password'=>$app['database']['password'] 
  
 ] 
  
 ] 
  
 ]);",NA
"Whenregistering,youneedtoprovidetheoptionsforthedatabaseconnection.Someof ",NA,NA
"themwillbethesameregardlessoftheenvironment,suchasthedriveroreventhehost, ",NA,NA
"butsomewillcomefromtheconfigurationfile,suchas",$app['database']['user'],NA
. ,NA,NA
"Fromnowon,youcanaccessthedatabaseconnectionvia",$app['db'],NA
.,NA,NA
"Withthedatabasesetup,let’saddtheroutesthatwillallowustoaddandfetchrecipes.As ",NA,NA
"withLaravel,youcanspecifyeithertheanonymousfunction,aswealreadydid,ora ",NA,NA
controllerandmethodtoexecute.Replacethecurrentroutewiththefollowingthree ,NA,NA
routes:,"$app->get( 
  
 '/', 
  
 'CookBook\\Controllers\\RecipesController::getAll'",NA
"Asyoucanobserve,therewillbeanewcontroller, ",CookBook\Controllers\RecipesController,NA
",whichwillbeplacedin ",src/Controllers/RecipesController.php,NA
.Thismeansthatyouneedtochangethe ,NA,NA
autoloaderinComposer.Edityour,composer.json,NA
filewiththefollowing:,"""autoload"":{ 
  
 ""psr-4"":{""CookBook\\"":""src/""} 
  
 }",NA
"Now,let’saddthecontrollerclass,asfollows:","<?php
  
 namespaceCookBook\Controllers;
  
 classRecipes{
  
 }",NA
Thefirstmethodwewilladdisthe,getNewForm,NA
"method,whichwilljustrendertheadda ",NA,NA
newrecipepage.Themethodlookssimilartothis:,"publicfunctiongetNewForm(Application$app):string{ return$app['twig']-
 >render('new_recipe.twig'); }",NA
Themethodwilljustrender,new_recipe.twig,NA
.Anexampleofthistemplatecouldbeas ,NA,NA
follows:,"{%extends""layout.twig""%}
  
 {%blockcontent%} 
  
 <h1>Addrecipe</h1> 
  
 <formmethod=""post""> 
  
 <div> 
  
 <labelfor=""name"">Name</label> 
  
 <inputtype=""text""name=""name"" 
  
 value=""{{nameisdefined?name:""""}}""/> </div> 
  
 <div> 
  
 <labelfor=""ingredients"">Ingredients</label> 
  
 <textareaname=""ingredients""> 
  
 {{ingredientsisdefined?ingredients:""""}} </textarea> 
  
 </div> 
  
 <div>",NA
"Thistemplatesendsthename,ingredients,instructions,andthetimethatittakesto ",NA,NA
preparethedish.Theendpointthatwillgetthisformneedstogettheresponseobjectin ,NA,NA
ordertoextractthisinformation.Inthesamewaythatwecouldgetthe,Application,NA
"instanceasanargument,wecangetthe",Request,NA
onetooifwespecifyitinthemethod ,NA,NA
definition.AccessingthePOSTparametersisaseasyasinvokingthe,get,NA
methodby ,NA,NA
sendingthenameoftheparameterorcalling,$request->request->all(),NA
togetallof ,NA,NA
themasanarray.Addthefollowingmethodthatcheckswhetherallthedataisvalidand ,NA,NA
"renderstheformagainifitisnot,sendingthesubmitteddataanderrors:","publicfunctioncreate(Application$app,Request$request):string{ $params=$request->request-
 >all(); 
  
 $errors=[];
  
 if(empty($params['name'])){ 
  
 $errors[]='Namecannotbeempty.'; 
  
 } 
  
 if(empty($params['ingredients'])){ 
  
 $errors[]='Ingredientscannotbeempty.'; } 
  
 if(empty($params['instructions'])){ 
  
 $errors[]='Instructionscannotbeempty.'; } 
  
 if($params['time']<=0){ 
  
 $errors[]='Timehastobeapositivenumber.'; }
  
 if(!empty($errors)){ 
  
 $params=array_merge($params,['errors'=>$errors]); return$app['twig']-
 >render('new_recipe.twig',$params); } 
  
 }",NA
The,layout.twig,NA
templateneedstobeeditedtooinordertoshowtheerrorsreturned.We ,NA,NA
candothisbyexecutingthefollowing:,"{#...#} 
  
 {%iferrorsisdefined%} 
  
 <p>Somethingwentwrong!</p> 
  
 <ul>",NA
"Atthispoint,youcanalreadytrytoaccess",http://localhost/recipes,NA
",filltheform ",NA,NA
"leavingsomethingempty,submitting,andgettingtheformbackwiththeerrors.Itshould ",NA,NA
looksomethingsimilartothis(withsomeextraCSSstyles):,NA,NA
Thecontinuationofthecontrollershouldallowustostorethecorrectdataasanewrecipe ,NA,NA
"inthedatabase.Todoso,itwouldbeagoodideatocreateaseparateclass,suchas ",CookBook\Models\RecipeModel,NA
";however,tospeedthingsup,let’saddthefollowingfew ",NA,NA
linesthatwouldgointothemodeltothecontroller.RememberthatwehavetheDoctrine ,NA,NA
"serviceprovider,sothereisnoneedtousePDOdirectly:",NA,NA
"Doctrinealsohelpswhenfetchingdata.Toseeitworking,checkthethirdandfinal ",NA,NA
"method,inwhichwewillfetchalltherecipesinordertoshowtheuser:","publicfunctiongetAll(Application$app):string{ 
  
 $recipes=$app['db']->fetchAll('SELECT*FROMrecipes'); 
 return$app['twig']-
 >render( 
  
 'home.twig', 
  
 ['recipes'=>$recipes] 
  
 ); 
  
 }",NA
"Withonlyoneline,weperformedaquery.ItisnotascleanastheEloquentORMof ",NA,NA
"Laravel,butatleastitismuchlessverbosethanusingrawPDO.Finally,youcanupdate ",NA,NA
your,home.twig,NA
templatewiththefollowingcontentinordertodisplaytherecipesthatwe ,NA,NA
justfetchedfromthedatabase:,"{%extends""layout.twig""%}
  
 {%blockcontent%} 
  
 <h1>Hivisitor!</h1> 
  
 <p>Checkourrecipes!</p> 
  
 <table> 
  
 <th>Name</th> 
  
 <th>Time</th> 
  
 <th>Ingredients</th> 
  
 <th>Instructions</th> 
  
 {%forrecipeinrecipes%} 
  
 <tr> 
  
 <td>{{recipe.name}}</td> 
  
 <td>{{recipe.time}}</td> 
  
 <td>{{recipe.ingredients}}</td> 
 <td>{{recipe.instructions}}</td> </tr> 
  
 {%endfor%} 
  
 </table> 
  
 {%endblock%}",NA
SilexversusLaravel,NA,NA
"Eventhoughwedidsomesimilarcomparisonbeforestartingthechapter,itistimeto ",NA,NA
recapitulatewhatwesaidandcompareitwithwhatyounotedbyyourself.Laravel ,NA,NA
belongstothetypeofframeworkthatallowsyoutocreategreatthingswithverylittle ,NA,NA
"work.Itcontainsallthecomponentsthatyou,asawebdeveloper,willeverneed.There ",NA,NA
hastobesomegoodreasonforhowfastitbecamethemostpopularframeworkofthe ,NA,NA
year!,NA,NA
"Ontheotherhand,Silexisamicroframework,whichbyitselfdoesverylittle.Itisjustthe ",NA,NA
skeletononwhichyoucanbuildtheframeworkthatyouexactlyneed.Italreadyprovides ,NA,NA
"quitealotofserviceproviders,andwedidnotdiscussevenhalfofthem;werecommend ",NA,NA
youtovisit,NA,NA
http://silex.sensiolabs.org/doc/providers.html,NA,NA
"forthefulllist.However,ifyo",NA,NA
"u prefer,youcanalwaysaddotherdependencieswithComposerandusethem.If,forsome ",NA,NA
"reason,youstoplikingtheORMorthetemplateenginethatyouuse,oritjusthappens ",NA,NA
"thatanewandbetteroneappearsinthecommunity,switchingthemshouldbeeasy.On ",NA,NA
"theotherhand,whenworkingwithLaravel,youwillprobablysticktowhatitcomeswith it.",NA,NA
"Thereisalwaysanoccasionforeachframework,andwewouldliketoencourageyouto ",NA,NA
"beopentoallthepossibilitiesthatthereareoutthere,keepuptodate,andexplorenew ",NA,NA
frameworksortechnologiesfromtimetotime.,NA,NA
Summary,NA,NA
"Inthischapter,youlearnedhowimportantitistoknowsomeofthemostimportant ",NA,NA
"frameworks.Youalsolearnedthebasicsoftwofamousones:LaravelandSilex.Now,you ",NA,NA
arereadytoeitheruseyourframeworkortousethesetwoforyournextapplication.With ,NA,NA
"this,youalsohavethecapacitytotakeanyothersimilarframeworkandunderstandit ",NA,NA
easily.,NA,NA
"Inthenextchapter,wewillstudywhatRESTAPIsareandhowtowriteonewithLaravel. ",NA,NA
Thiswillexpandyoursetofskillsandgiveyoumoreflexibilityforwhenyouneedto ,NA,NA
decidewhichapproachtotakewhendesigningandwritingapplications.,NA,NA
Chapter9.BuildingRESTAPIs,NA,NA
Mostnon-developersprobablythinkthatcreatingapplicationsmeansbuildingeither ,NA,NA
"softwareforyourPCorMac,games,orwebpages,becausethatiswhattheycanseeand ",NA,NA
"use.Butonceyoujointhedevelopers’community,eitherbyyourownorprofessionally, ",NA,NA
youwilleventuallyrealizehowmuchworkisdoneforapplicationsandtoolsthatdonot ,NA,NA
haveauserinterface.,NA,NA
"Haveyoueverwonderedhowsomeone’swebsitecanaccessyourFacebookprofile,and ",NA,NA
"lateron,postanautomaticmessageonyourwall?Orhowwebsitesmanageto ",NA,NA
"send/receiveinformationinordertoupdatethecontentofthepage,withoutrefreshingo",NA,NA
"r submittinganyform?Allofthesefeatures,andmanymoreinterestingones,arepossible ",NA,NA
thankstotheintegrationofapplicationsworking“behindthescenes”.Knowinghowto ,NA,NA
usethemwillopenthedoorsforcreatingmoreinterestingandusefulwebapplications.,NA,NA
"Inthischapter,youwilllearnthefollowing:",NA,NA
"IntroductiontoAPIsandRESTAPIs,andtheiruse ",NA,NA
ThefoundationofRESTAPIs ,NA,NA
Usingthird-partyAPIs ,NA,NA
ToolsforRESTAPIdevelopers,NA,NA
DesigningandwritingRESTAPIswithLaravel ,NA,NA
DifferentwaysoftestingyourRESTAPIs,NA,NA
IntroducingAPIs,NA,NA
API,NA,NA
standsfor,NA,NA
ApplicationProgramInterface,NA,NA
.Itsgoalistoprovideaninterfacesothat ,NA,NA
"otherprogramscansendcommandsthatwilltriggersomeprocessinsidetheapplication, ",NA,NA
"possiblyreturningsomeoutput.Theconceptmightseemabitabstract,butinfact,there ",NA,NA
areAPIsvirtuallyineverythingwhichissomehowrelatedtocomputers.Let’sseesome ,NA,NA
reallifeexamples:,NA,NA
"OperatingsystemsorOS,likeWindowsorLinux,aretheprogramsthatallowyouto ",NA,NA
"usecomputers.Whenyouuseanyapplicationfromyourcomputer,itmostprobably ",NA,NA
"needstotalktotheOSinonewayoranother,forexamplebyrequestingacertain ",NA,NA
"file,sendingsomeaudiotothespeakers,andsoon.Alltheseinteractionsbetweenthe ",NA,NA
applicationandtheOSarepossiblethankstotheAPIsthattheOSprovides.Inthis ,NA,NA
"way,theapplicationneednotinteractwiththehardwarestraightaway,whichisa ",NA,NA
verytiringtask.,NA,NA
"Tointeractwiththeuser,amobileapplicationprovidesaGUI.Theinterfacecaptures ",NA,NA
"alltheeventsthattheusertriggers,likeclickingortyping,inordertosendthemto ",NA,NA
theserver.TheGUIcommunicateswiththeserverusinganAPIinthesamewaythe ,NA,NA
programcommunicateswiththeOSasexplainedearlier.,NA,NA
Whenyoucreateawebsitethatneedstodisplaytweetsfromtheuser’sTwitter ,NA,NA
"account,youneedtocommunicatewithTwitter.TheyprovideanAPIthatcanbe ",NA,NA
"accessedviaHTTP.Onceauthenticated,bysendingthecorrectHTTPrequests,you ",NA,NA
canupdateand/orretrievedatafromtheirapplication.,NA,NA
"Asyoucansee,therearedifferentplaceswhereAPIsareuseful.Ingeneral,whenyou ",NA,NA
"haveasystemthatshouldbeaccessedexternally,youneedtoprovidepotentialusersan ",NA,NA
"API.Whenwesayexternally,wemeanfromanotherapplicationorlibrary,butitcanvery ",NA,NA
wellbeinsidethesamemachine.,NA,NA
IntroducingRESTAPIs,NA,NA
RESTAPIsareaspecifictypeofAPIs.TheyuseHTTPastheprotocoltocommunicate ,NA,NA
"withthem,soyoucanimaginethattheywillbethemostusedonesbywebapplications.",NA,NA
"Infact,theyarenotverydifferentfromthewebsitesthatyou’vealreadybuilt,sincethe ",NA,NA
"clientsendsanHTTPrequest,andtheserverreplieswithanHTTPresponse.The ",NA,NA
differencehereisthatRESTAPIsmakeheavyuseofHTTPstatuscodestounderstand ,NA,NA
"whattheresponseis,andinsteadofreturningHTMLresourceswithCSSandJS,the ",NA,NA
"responseusesJSON,XML,oranyotherdocumentformatwithjustinformation,andnota ",NA,NA
graphicuserinterface.,NA,NA
"Let’stakeanexample.TheTwitterAPI,onceauthenticated,allowsdeveloperstogetthe ",NA,NA
tweetsofagivenuserbysendinganHTTPGETrequestto ,https://api.twitter.com/1.1/statuses/user_timeline.json,NA
.Theresponsetothis ,NA,NA
requestisanHTTPmessagewithaJSONmapoftweetsasthebodyandthestatuscode ,NA,NA
200.We’vealreadymentionedstatuscodein,NA,NA
Chapter2,NA,NA
",",NA,NA
WebApplicationswithPHP,NA,NA
",but ",NA,NA
wewillreviewthemshortly.,NA,NA
TheRESTAPIalsoallowsdeveloperstoposttweetsonbehalfoftheuser.Ifyouwere ,NA,NA
"alreadyauthenticated,asinthepreviousexample,youjustneedtosendaPOSTrequestto ",https://api.twitter.com/1.1/statuses/update.json,NA
withtheappropriatePOST ,NA,NA
"parametersinthebody,likethetextthatyouwanttotweet.Eventhoughthisrequestisnot ",NA,NA
"aGET,andthus,youarenotrequestingdatabutrathersendingit,theresponseofthis ",NA,NA
requestisquiteimportanttoo.Theserverwillusethestatuscodesoftheresponsetolet ,NA,NA
"therequesterknowifthetweetwaspostedsuccessfully,oriftheycouldnotunderstand ",NA,NA
"therequest,therewasaninternalservererror,theauthenticationwasnotvalid,andsoon.",NA,NA
"Eachofthesescenarioshasadifferentstatuscode,whichisthesameacrossall ",NA,NA
"applications.ThismakesitveryeasytocommunicatewithdifferentAPIs,sinceyouwill ",NA,NA
notneedtolearnanewlistofstatuscodeeachtime.Theservercanalsoaddsomeextra ,NA,NA
"informationtothebodyinordertothrowsomelightonwhytheerrorhappened,butthat ",NA,NA
willdependontheapplication.,NA,NA
YoucanimaginethattheseRESTAPIsareprovidedtodeveloperssotheycanintegrate ,NA,NA
"themwiththeirapplications.Theyarenotuser-friendly,butHTTP-friendly.",NA,NA
ThefoundationsofRESTAPIs,NA,NA
"EventhoughRESTAPIsdonothaveanofficialstandard,mostdevelopersagreeonthe ",NA,NA
"samefoundation.IthelpsthatHTTP,whichistheprotocolthatthistechnologyusesto ",NA,NA
"communicate,doeshaveastandard.Inthissection,wewilltrytodescribehowREST ",NA,NA
APIsshouldwork.,NA,NA
HTTPrequestmethods,NA,NA
We’vealreadyintroducedtheideaofHTTPmethodsin,NA,NA
Chapter2,NA,NA
",",NA,NA
WebApplicationswith ,NA,NA
PHP,NA,NA
".WeexplainedthatanHTTPmethodisjusttheverboftherequest,whichdefines ",NA,NA
whatkindofactionitistryingtoperform.We’vealreadydefinedthismethodwhen ,NA,NA
workingwithHTMLforms:the,form,NA
"tagcangetanoptionalattribute,",method,NA
",whichwill ",NA,NA
maketheformsubmitwiththatspecificHTTPmethod.,NA,NA
"YouwillnotuseformswhenworkingwithRESTAPIs,butyoucanstillspecifythe ",NA,NA
"methodoftherequest.Infact,tworequestscangotothesameendpointwiththesame ",NA,NA
"parameters,headers,andsoon,andyethavecompletelydifferentbehaviorsduetotheir ",NA,NA
"methods,whichmakesthemaveryimportantpartoftherequest.",NA,NA
AswearegivingsomuchimportancetoHTTPmethodsinordertoidentifywhatarequest ,NA,NA
"istryingtodo,itisnaturalthatwewillneedahandfulofthem.Sofar,wehaveintroduced ",NA,NA
"GETandPOST,butthereareactuallyeightdifferentmethods:GET,POST,PUT, ",NA,NA
"DELETE,OPTIONS,HEAD,TRACE,andCONNECT.Youwillusuallyworkwithjust ",NA,NA
fourofthem.Let’slookatthemindetail.,NA,NA
GET,NA,NA
"WhenarequestusestheGETmethod,itmeansthatitisrequestingforinformationabout ",NA,NA
"agivenentity.Theendpointshouldcontaininformationofwhatthatentityis,liketheID ",NA,NA
"ofabook.GETcanalsobeusedtoqueryforalistofobjects,eitherallofthem,filtered,or ",NA,NA
paginated.,NA,NA
"GETrequestscanaddextrainformationtotherequestwhenneeded.Forexample,ifwe ",NA,NA
"aretrytoretrieveallthebooksthatcontainthestring“rings”,orifwewantthepage ",NA,NA
"number2ofthefulllistofbooks.Asyoualreadyknow,thisextrainformationisaddedto ",NA,NA
"thequerystringasGETparameters,whichisalistofkey-valuepairsconcatenatedbyan ",NA,NA
ampersand(,&,NA
").So,thatmeansthattherequestfor","http://bookstore.com/books?
  
 year=2001&page3",NA
isprobablyusedforgettingthesecondpageofthelistofbooks ,NA,NA
publishedduring2001.,NA,NA
"RESTAPIshaveextensivedocumentationontheavailableendpointsandparameters,soit ",NA,NA
"shouldbeeasyforyoutolearntoqueryproperly.Still,eventhoughitwillbedocumented, ",NA,NA
"youshouldexpectparameterswithintuitivenames,liketheonesintheexample.",NA,NA
POSTandPUT,NA,NA
POSTisthesecondtypeofHTTPmethodthatyoualreadyknowabout.Youuseditin ,NA,NA
"formswiththeintentionof“posting”data,thatis,tryingtoupdatearesourceontheserver ",NA,NA
"side.Whenyouwantedtoaddorupdateanewbook,yousentaPOSTrequestwiththe ",NA,NA
dataofthebookasthePOSTparameters.,NA,NA
"POSTparametersaresentinaformatsimilartotheGETparameters,butinsteadofbeing ",NA,NA
"partofthequerystring,theyareincludedaspartoftherequest’sbody.FormsinHTML ",NA,NA
"arealreadydoingthatforyou,butwhenyouneedtotalktoaRESTAPI,youshould ",NA,NA
"knowhowtodothisbyyourself.Inthenextsection,wewillshowyouhowtoperform",NA,NA
POSTusingtoolsotherthanforms.Alsonotethatyoucanaddanydatatothebodyofthe ,NA,NA
request;itisquitecommontosendJSONinthebodyinsteadofPOSTparameters.,NA,NA
ThePUTmethodisquitesimilartothePOSTmethod.Thistootriestoaddorupdatedata ,NA,NA
"ontheserverside,andforthispurpose,italsoaddsextrainformationonthebodyofthe ",NA,NA
request.Whyshouldwehavetwodifferentmethodsthatdothesamething?Thereare ,NA,NA
actuallytwomaindifferencesbetweenthesemethods:,NA,NA
"PUTrequestseithercreatearesourceorupdateit,buttheaffectedresourceistheone ",NA,NA
definedbytheendpointandnothingelse.Thatmeansthatifwewanttoupdatea ,NA,NA
"book,theendpointshouldstatethattheresourceisabook,andspecifyit,for ",NA,NA
"example,",http://bookstore.com/books/8734,NA
".Ontheotherhand,ifyoudonot ",NA,NA
"identifytheresourcetobecreatedorupdatedintheendpoint,oryouaffectother ",NA,NA
"resourcesatthesametime,youshouldusePOSTrequests.",NA,NA
Idempotentisacomplicatedwordforasimpleconcept.AnidempotentHTTP ,NA,NA
"methodisonethatcanbecalledmanytimes,andtheresultwillalwaysbethesame. ",NA,NA
"Forexample,ifyouaretryingtoupdatethetitleofabookto“DonQuixote”,itdoes ",NA,NA
"notmatterhowmanytimesyoucallit,theresultwillalwaysbethesame:the ",NA,NA
"resourcewillhavethetitle“DonQuixote”.Ontheotherhand,non-idempotent ",NA,NA
methodsmightreturndifferentresultswhenexecutingthesamerequest.Anexample ,NA,NA
"couldbeanendpointthatincreasesthestockofsomebook.Eachtimeyoucallit,you ",NA,NA
"willincreasethestockmoreandmore,andthus,theresultisnotthesame.PUT ",NA,NA
"requestsareidempotent,whereasPOSTrequestsarenot.",NA,NA
"Evenwiththisexplanationinmind,misusingPOSTandPUTisquiteacommonmistake ",NA,NA
"amongdevelopers,especiallywhentheylackenoughexperienceindevelopingREST ",NA,NA
"APIs.SinceformsinHTMLonlysenddatawithPOSTandnotPUT,thefirstoneismore ",NA,NA
"popular.YoumightfindRESTAPIswherealltheendpointsthatupdatedataarePOST, ",NA,NA
eventhoughsomeofthemshouldbePUT.,NA,NA
DELETE,NA,NA
TheDELETEHTTPmethodisquiteself-explanatory.Itisusedwhenyouwanttodeletea ,NA,NA
"resourceontheserver.AswithPUTrequests,DELETEendpointsshouldidentifythe ",NA,NA
specificresourcetobedeleted.Anexamplewouldbewhenwewanttoremoveonebook ,NA,NA
fromourdatabase.WecouldsendaDELETErequesttoanendpointsimilarto ,http://bookstore.com/books/23942,NA
.,NA,NA
"DELETErequestsjustdeleteresources,andtheyarealreadydeterminedbytheURL.",NA,NA
"Still,ifyouneedtosendextrainformationtotheserver,youcouldusethebodyofthe ",NA,NA
"requestasyoudowithPOSTorPUT.Infact,youcanalwayssendinformationwithinthe ",NA,NA
"bodyoftherequest,includingGETrequests,butthatdoesnotmeanitisagoodpracticeto ",NA,NA
doso.,NA,NA
Statuscodesinresponses,NA,NA
"IfHTTPmethodsareveryimportantforrequests,statuscodesarealmostindispensable ",NA,NA
"forresponses.Withjustonenumber,theclientwillknowwhathappenedwiththerequest.",NA,NA
"Thisisespeciallyusefulwhenyouknowthatstatuscodesareastandard,andtheyare ",NA,NA
extensivelydocumentedontheInternet.,NA,NA
We’vealreadydescribedthemostimportantonesin,NA,NA
Chapter2,NA,NA
",",NA,NA
WebApplicationswith ,NA,NA
PHP,NA,NA
",butlet’slistthemagain,addingafewmorethatareimportantforRESTAPIs.For ",NA,NA
"thefulllistofstatuscodes,youcanvisit",NA,NA
https://www.w3.org/Protocols/rfc2616/rfc26,NA,NA
16-sec10.html,NA,NA
.,NA,NA
2xx–success,NA,NA
Allthestatuscodesthatstartwith2areusedforresponseswheretherequestwas ,NA,NA
"processedsuccessfully,regardlessofwhetheritwasaGETorPOST.Someofthemost ",NA,NA
commonlyusedonesinthiscategoryareasfollows:,NA,NA
200OK,NA,NA
:Itisthegeneric“everythingwasOK”response.Ifyouwereaskingfora ,NA,NA
"resource,youwillgetitinthebodyoftheresponse,andifyouwereupdatinga ",NA,NA
"resource,thiswillmeanthatthenewdatahasbeensuccessfullysaved.",NA,NA
201created,NA,NA
:Itistheresponseusedwhenresourcesarecreatedsuccessfullywith ,NA,NA
POSTorPUT.,NA,NA
202accepted,NA,NA
":Thisresponsemeansthattherequesthasbeenaccepted,butithasnot ",NA,NA
beenprocessedyet.Thismightbeusefulwhentheclientneedsastraightforward ,NA,NA
"responseforaveryheavyoperation:theserversendstheacceptedresponse,andthen ",NA,NA
startsprocessingit.,NA,NA
3xx–redirection,NA,NA
"Eventhoughyoumightthinkthereisonlyonetypeofredirection,thereareafew ",NA,NA
refinements:,NA,NA
301movedpermanently,NA,NA
:Thismeansthattheresourcehasbeenmovedtoadifferen,NA,NA
"t URL,sofromthenon,youshouldtrytoaccessitthroughtheURLprovidedinthe ",NA,NA
bodyoftheresponse.,NA,NA
303seeother,NA,NA
":Thismeansthattherequesthasbeenprocessedbut,inordertoseethe ",NA,NA
"response,youneedtoaccesstheURLprovidedinthebodyoftheresponse.",NA,NA
4xx–clienterror,NA,NA
Thiscategoryhasstatuscodesdescribingwhatwentwrongduetotheclient’srequest:,NA,NA
400badrequest,NA,NA
":Thisisagenericresponsetoamalformedrequest,thatis,thereisa ",NA,NA
"syntaxerrorintheendpoint,orsomeoftheexpectedparameterswerenotprovided. ",NA,NA
401unauthorized,NA,NA
:Thismeanstheclienthasnotbeenauthenticatedsuccessfullyyet,NA,NA
", andtheresourcethatitistryingtoaccessneedsthisauthentication.",NA,NA
403forbidden,NA,NA
:Thiserrormessagemeansthateventhoughtheclienthasbeen ,NA,NA
"authenticated,itdoesnothaveenoughpermissionstoaccessthatresource.",NA,NA
404notfound,NA,NA
:Thespecificresourcehasnotbeenfound.,NA,NA
405methodnotallowed,NA,NA
":Thismeansthattheendpointexists,butitdoesnotaccept ",NA,NA
"theHTTPmethodusedontherequest,forexample,weweretryingtousePUT,but ",NA,NA
theendpointonlyacceptsPOSTrequests.,NA,NA
5xx–servererror,NA,NA
"Thereareupto11differenterrorsontheserverside,butweareonlyinterestedinone:the ",NA,NA
500internalserver,NA,NA
"error.Youcouldusethisstatuscodewhensomethingunexpected, ",NA,NA
"likeadatabaseerror,happenswhileprocessingtherequest.",NA,NA
RESTAPIsecurity,NA,NA
RESTAPIsareapowerfultoolsincetheyallowdeveloperstoretrieveand/orupdatedata ,NA,NA
"fromtheserver.Butwithgreatpowercomesgreatresponsibility,andwhendesigninga ",NA,NA
"RESTAPI,youshouldthinkaboutmakingyourdataassecureaspossible.Imagine—",NA,NA
anyonecouldposttweetsonyourbehalfwithasimpleHTTPrequest!,NA,NA
"Similartousingwebapplications,therearetwoconceptshere:",NA,NA
authentication,NA,NA
and ,NA,NA
authorization,NA,NA
".Authenticatingsomeoneisidentifyingwhoheorsheis,thatis,linkinghis ",NA,NA
"orherrequesttoauserinthedatabase.Ontheotherhand,authorizingsomeoneistoallow ",NA,NA
thatspecificusertoperformcertainactions.Youcouldthinkofauthenticationasthelogin ,NA,NA
"oftheuser,andauthorizationasgivingpermissions.",NA,NA
RESTAPIsneedtomanagethesetwoconceptsverycarefully.Justbecauseadeveloper ,NA,NA
"hasbeenauthenticateddoesnotmeanhecanaccessallthedataontheserver.Sometimes, ",NA,NA
"userscanaccessonlytheirowndata,whereassometimesyouwouldliketoimplementa ",NA,NA
rolessystemwhereeachrolehasdifferentaccesslevels.Italwaysdependsonthetypeof ,NA,NA
applicationyouarebuilding.,NA,NA
"Althoughauthorizationhappensontheserverside,thatis,it’stheserver’sdatabasethat ",NA,NA
"willdecidewhetheragivenusercanaccessacertainresourceornot,authenticationshave ",NA,NA
tobetriggeredbytheclient.Thismeansthattheclienthastoknowwhatauthentication ,NA,NA
systemtheRESTAPIisusinginordertoproceedwiththeauthentication.EachREST ,NA,NA
"APIwillimplementitsownauthenticationsystem,buttherearesomewellknown ",NA,NA
implementations.,NA,NA
Basicaccessauthentication,NA,NA
"Basicaccessauthentication—BAforshort—is,asitsnamesuggests,basic.Theclientadds ",NA,NA
"theinformationabouttheuserintheheadersofeachrequest,thatis,usernameand ",NA,NA
password.TheproblemisthatthisinformationisonlyencodedusingBASE64butnot ,NA,NA
"encrypted,makingitextremelyeasyforanintrudertodecodetheheaderandobtainthe ",NA,NA
"passwordinplaintext.Ifyoueverhavetouseit,since,tobehonest,itisaveryeasyway ",NA,NA
"ofimplementingsomesortofauthentication,wewouldrecommendyoutouseitwith ",NA,NA
HTTPS.,NA,NA
"Inordertousethismethod,youneedtoconcatenatetheusernameandpasswordlike ",username:password,NA
",encodetheresultantstringusingBase64,andaddtheauthorization ",NA,NA
headeras:,Authorization:Basic<encoded-string>,NA
OAuth2.0,NA,NA
"Ifbasicauthenticationwasverysimple,andinsecure,OAuth2.0isthemostsecuresystem ",NA,NA
"thatRESTAPIsuseinordertoauthenticate,andsowasthepreviousOAuth1.0.Thereare ",NA,NA
"actuallydifferentversionsofthisstandard,butallofthemworkonthesamefoundation:",NA,NA
"1. Therearenousernamesandpasswords.Instead,theprovideroftheRESTAPI ",NA,NA
assignsapairofcredentials—atokenandthesecret—tothedeveloper.,NA,NA
2. ,NA,NA
"Inordertoauthenticate,thedeveloperneedstosendaPOSTrequesttothe“token”end",NA,NA
"point,whichisdifferentineachRESTAPIbuthasthesameconcept.Thisrequest ",NA,NA
hastoincludetheencodeddevelopercredentials.,NA,NA
3. Theserverrepliestothepreviousrequestwithasessiontoken.This(andnotthe ,NA,NA
credentialsmentionedinthefirststep)istobeincludedineachrequestthatyoumake ,NA,NA
"totheRESTAPI.Thesessiontokenexpiresforsecurityreasons,soyouwillhaveto ",NA,NA
repeatthesecondstepagainwhenthathappens.,NA,NA
"Eventhoughthisstandardiskindofrecent(2012onwards),severalbigcompanieslike ",NA,NA
GoogleorFacebookhavealreadyimplementeditfortheirRESTAPIs.Itmightlookabit ,NA,NA
"overcomplicated,butyouwillsoongettouseit,andevenimplementit.",NA,NA
Usingthird-partyAPIs,NA,NA
ThatwasenoughtheoryaboutRESTAPIs;itistimetodiveintoarealworldexample.In ,NA,NA
"thissection,wewillwriteasmallPHPapplicationthatinteractswithTwitter’sRESTAPI; ",NA,NA
"thatincludesrequestingdevelopercredentials,authenticating,andsendingrequests.Th",NA,NA
"e goalistogiveyouyourfirstexperienceinworkingwithRESTAPIs,andshowingyou ",NA,NA
thatitiseasierthanyoucouldexpect.Itwillalsohelpyoutounderstandbetterhowthey ,NA,NA
"work,soitwillbeeasiertobuildyourownlater.",NA,NA
Gettingtheapplication’scredentials,NA,NA
RESTAPIsusuallyhavetheconceptofapplication.Anapplicationislikeanaccounton ,NA,NA
theirdevelopmentsitethatidentifieswhousestheAPI.Thecredentialsthatyouwilluse ,NA,NA
"toaccesstheAPIwillbelinkedtothisapplication,whichmeansthatyoucanhave ",NA,NA
multipleapplicationslinkedtothesameaccount.,NA,NA
"AssumingthatyouhaveaTwitteraccount,goto",NA,NA
https://apps.twitter.com,NA,NA
inordertocreat,NA,NA
e anewapplication.Clickonthe,NA,NA
CreateNewApp,NA,NA
buttoninordertoaccesstheformfor ,NA,NA
"applicationdetails.Thefieldsareveryself-explanatory—justanamefortheapplication, ",NA,NA
"thedescription,andthewebsiteURL.ThecallbackURLisnotnecessaryhere,sincethat ",NA,NA
willbeusedonlyforapplicationsthatrequireaccesstosomeoneelse’saccount.Agree ,NA,NA
withthetermsandconditionsinordertoproceed.,NA,NA
"Onceyouhavebeenredirectedtoyourapplication’spage,youwillseeallsortof ",NA,NA
"informationthatyoucanedit.Sincethisisjustanexample,let’sgostraighttowhat ",NA,NA
matters:thecredentials.Clickonthe,NA,NA
KeysandAccessTokens,NA,NA
tabtoseethevaluesof ,NA,NA
Consumerkey(APIkey),NA,NA
and,NA,NA
ConsumerSecret(APIsecret),NA,NA
.Thereisnothingelsethat ,NA,NA
"weneedfromhere.Youcansavethemonyourfilesystem,as",~/.twitter_php7.json,NA
",for example:","{ 
  
 ""key"":""iTh4Mzl0EAPn9HAm98hEhAmVEXS"", 
  
 ""secret"":""PfoWM9yq4Bh6rGbzzJhr893j4r4sMIAeVRaPMYbkDer5N6F"" }",NA
Tip,NA,NA
Securingyourcredentials,NA,NA
"SecuringyourRESTAPIcredentialsshouldbetakenseriously.Infact,youshouldtake ",NA,NA
"careofallkindsofcredentials,likethedatabaseones.Butthedifferenceisthatyouwill ",NA,NA
"usuallyhostyourdatabaseinyourserver,whichmakesthingsslightlymoredifficultto ",NA,NA
"whoeverwantstoattack.Ontheotherhand,thethird-partyRESTAPIisnotpartofyour ",NA,NA
"system,andsomeonewithyourcredentialscanuseyouraccountfreelyonyourbehalf.",NA,NA
"Neverincludeyourcredentialsinyourcodebase,especiallyifyouhaveyourcodein ",NA,NA
"GitHuborsomeotherrepository.Onesolutionwouldbetohaveafileinyourserver, ",NA,NA
"outsideyourcode,withthecredentials;ifthatfileisencrypted,thatisevenbetter.Andtry ",NA,NA
"torefreshyourcredentialsregularly,whichyoucanprobablydoontheprovider’swebsite.",NA,NA
Settinguptheapplication ,NA,NA
Ourapplicationwillbeextremelysimple.Itwillconsistofoneclassthatwillallowusto ,NA,NA
fetchtweets.Thiswillbemanagedbyour,app.php,NA
script.,NA,NA
"AswehavetomakeHTTPrequests,wecaneitherwriteourownfunctionsthatuse",NA,NA
cURL ,NA,NA
"(asetofPHPnativefunctions),ormakeuseofthefamousPHPlibrary,",NA,NA
Guzzle,NA,NA
.This ,NA,NA
librarycanbefoundin,NA,NA
Packagist,NA,NA
",sowewilluseComposertoincludeit: ",$composerrequireguzzlehttp/guzzle,NA
Wewillhavea,Twitter,NA
"class,whichwillgetthecredentialsfromtheconstructor,andone ",NA,NA
publicmethod:,fetchTwits,NA
".Fornow,justcreatetheskeletonsothatwecanworkwithit; ",NA,NA
wewillimplementsuchmethodsinlatersections.Addthefollowingcodeto ,src/Twitter.php,NA
: ,"<?php 
  
 namespaceTwitterApp; 
  
 classTwitter{ 
  
 private$key; 
  
 private$secret; 
  
 publicfunction__construct(String$key,String$secret){ 
  
 $this->key=$key; 
  
 $this->secret=$secret; 
  
 } 
  
 publicfunctionfetchTwits(stringname,int$count):array{ 
  
 return[]; 
  
 } 
  
 }",NA
Sincewesetthenamespace,TwitterApp,NA
",weneedtoupdateour",composer.json,NA
filewith ,NA,NA
thefollowingaddition.Remembertorun,composerupdate,NA
toupdatetheautoloader.,"""autoload"":{ 
  
 ""psr-4"":{""TwitterApp\\"":""src""} 
  
 }",NA
"Finally,wewillcreateabasic",app.php,NA
"file,whichincludestheComposerautoloader, ",NA,NA
"readsthecredentialsfile,andcreatesaTwitterinstance: ","<?php 
  
 useTwitterApp\Twitter; 
  
 require__DIR__.'/vendor/autoload.php'; 
  
 $path=$_SERVER['HOME'].'/.twitter_php7.json'; 
  
 $jsonCredentials=file_get_contents($path); 
  
 $credentials=json_decode($jsonCredentials,true);",NA
Requestinganaccesstoken,NA,NA
"Inarealworldapplication,youwouldprobablywanttoseparatethecoderelatedto ",NA,NA
authenticationfromtheonethatdealswithoperationslikefetchingorpostingdata.To ,NA,NA
"keepthingssimplehere,wewillletthe",Twitter,NA
classknowhowtoauthenticatebyitself.,NA,NA
Let’sstartbyaddinga,$client,NA
propertytotheclasswhichwillcontainaninstanceof ,NA,NA
Guzzle’s,Client,NA
"class.ThisinstancewillcontainthebaseURIoftheTwitterAPI,which ",NA,NA
wecanhaveastheconstant,TWITTER_API_BASE_URI,NA
.Instantiatethispropertyinthe ,NA,NA
constructorsothattherestofthemethodscanmakeuseofit.Youcanalsoaddan ,$accessToken,NA
propertywhichwillcontaintheaccesstokenreturnedbytheTwitterAPI ,NA,NA
whenauthenticating.Allthesechangesarehighlightedhere:,"<?php
  
 namespaceTwitterApp;
  
 useException; 
  
 useGuzzleHttp\Client;
  
 classTwitter{
  
 constTWITTER_API_BASE_URI='https://api.twitter.com';
  
 private$key; 
  
 private$secret; 
  
 private$accessToken; 
  
 private$client;
  
 publicfunction__construct(String$key,String$secret){ $this->key=$key; 
  
 $this->secret=$secret;
  
 $this->client=newClient( 
  
 ['base_uri'=>self::TWITTER_API_BASE_URI] ); 
  
 }
  
 //... 
  
 }",NA
"Thenextstepwouldbetowriteamethodthat,giventhekeyandsecretareprovided, ",NA,NA
requestsanaccesstokentotheprovider.Morespecifically:,NA,NA
Concatenatethekeyandthesecretwitha,:,NA
.EncodetheresultusingBase64.,NA,NA
SendaPOSTrequestto,/oauth2/token,NA
withtheencodedcredentialsasthe ,Authorization,NA
header.Alsoincludea,Content-Type,NA
headerandabody(checkthe ,NA,NA
codeformoreinformation).,NA,NA
Wenowinvokethe,post,NA
methodofGuzzle’s,client,NA
instancesendingtwoarguments:the ,NA,NA
endpointstring(,/oauth2/token,NA
)andanarraywithoptions.Theseoptionsincludethe ,NA,NA
"headersandthebodyoftherequest,asyouwillseeshortly.Theresponseofthis",NA,NA
invocationisanobjectthatidentifiestheHTTPresponse.Youcanextractthecontent ,NA,NA
(body)oftheresponsewith,getBody,NA
.Twitter’sAPIresponseisaJSONwithsome ,NA,NA
arguments.Theonethatyoucareaboutthemostisthe,access_token,NA
",thetokenthatyou ",NA,NA
willneedtoincludeineachsubsequentrequesttotheAPI.Extractitandsaveit.Thefull ,NA,NA
methodlooksasfollows:,"privatefunctionrequestAccessToken(){ 
  
 $encodedString=base64_encode( 
  
 $this->key.':'.$this->secret 
  
 ); 
  
 $headers=[ 
  
 'Authorization'=>'Basic'.$encodedString, 
  
 'Content-Type'=>'application/x-www-form-urlencoded;charset=UTF-8' ]; 
  
 $options=[ 
  
 'headers'=>$headers, 
  
 'body'=>'grant_type=client_credentials' 
  
 ];
  
 $response=$this->client->post(self::OAUTH_ENDPOINT,$options); 
 $body=json_decode($response->getBody(),true);
  
 $this->accessToken=$body['access_token']; }",NA
Youcanalreadytrythiscodebyaddingthesetwolinesattheendoftheconstructor:,"$this->requestAccessToken(); 
  
 var_dump($this->accessToken);",NA
Runtheapplicationinordertoseetheaccesstokengivenbytheproviderusingthe ,NA,NA
followingcommand.Remembertoremovetheprecedingtwolinesinordertoproceed ,NA,NA
withthesection.,$phpapp.php,NA
"Keepinmindthat,eventhoughhavingakeyandsecretandgettinganaccesstokenisthe ",NA,NA
"sameacrossallOAuthauthentications,thespecificwayofencoding,theendpointused, ",NA,NA
andtheresponsereceivedfromtheproviderareexclusivefromTwitter’sAPI.Itcouldbe ,NA,NA
"thatseveralothersareexactlythesame,butalwayscheckthedocumentationforeachone.",NA,NA
Fetchingtweets,NA,NA
WefinallyarrivetothesectionwhereweactuallymakeuseoftheAPI.Wewill ,NA,NA
implementthe,fetchTwits,NA
methodinordertogetalistofthelast,NA,NA
N,NA,NA
numberoftweetsfor ,NA,NA
"agivenuser.Inordertoperformrequests,weneedtoaddthe",Authorization,NA
headerto ,NA,NA
"eachone,thistimewiththeaccesstoken.Sincewewanttomakethisclassasreusableas ",NA,NA
"possible,let’sextractthistoaprivatemethod:","privatefunctiongetAccessTokenHeaders():array{ if(empty($this-
 >accessToken)){ 
  
 $this->requestAccessToken(); 
  
 }
  
 return['Authorization'=>'Bearer'.$this->accessToken]; }",NA
"Asyoucansee,theprecedingmethodalsoallowsustofetchtheaccesstokenfromthe ",NA,NA
"provider.Thisisuseful,sinceifwemakemorethanonerequest,wewilljustrequestthe ",NA,NA
"accesstokenonce,andwehaveoneuniqueplacetodoso.Addnowthefollowingmethod ",NA,NA
implementation:,"constGET_TWITS='/1.1/statuses/user_timeline.json'; 
 //...
  
 publicfunctionfetchTwits(string$name,int$count):array{ $options=[ 
  
 'headers'=>$this->getAccessTokenHeaders(), 
  
 'query'=>[ 
  
 'count'=>$count, 
  
 'screen_name'=>$name 
  
 ] 
  
 ];
  
 $response=$this->client->get(self::GET_TWITS,$options); 
 $responseTwits=json_decode($response->getBody(),true);
  
 $twits=[]; 
  
 foreach($responseTwitsas$twit){ 
  
 $twits[]=[ 
  
 'created_at'=>$twit['created_at'], 'text'=>$twit['text'], 
  
 'user'=>$twit['user']['name'] 
  
 ]; 
  
 }
  
 return$twits; 
  
 }",NA
Thefirstpartoftheprecedingmethodbuildsthe,options,NA
arraywiththeaccesstoken ,NA,NA
"headersandthequerystringarguments—inthiscase,withthenumberoftweetsto ",NA,NA
retrieveandtheuser.WeperformtheGETrequestanddecodetheJSONresponseintoan ,NA,NA
"array.Thisarraycontainsalotofinformationthatwemightnotneed,soweiterateitin ",NA,NA
"ordertoextractthosefieldsthatwereallywant—inthisexample,thedate,thetext,and ",NA,NA
theuser.,NA,NA
"Inordertotesttheapplication,justinvokethe",fetchTwits,NA
methodattheendofthe ,app.php,NA
"file,specifyingtheTwitterIDofoneofthepeopleyouarefollowing,oryourself.","$twits=$twitter->fetchTwits('neiltyson',10); var_dump($twits);",NA
"Youshouldgetaresponsesimilartoours,showninthefollowingscreenshot:",NA,NA
"Onethingtokeepinmindisthataccesstokensexpireaftersometime,returninganHTTP ",NA,NA
"responsewitha4xxstatuscode(usually,401unauthorized).Guzzlethrowsanexception ",NA,NA
"whenthestatuscodeiseither4xxor5xx,soitiseasymanagethesescenarios.Youcould ",NA,NA
addthiscodewhenperformingtheGETrequest:,"try{ 
  
 $response=$this->client->get(self::GET_TWITS,$options); }catch(ClientException$e){ 
  
 if($e->getCode()==401){ 
  
 $this->requestAccessToken(); 
  
 $response=$this->client->get(self::GET_TWITS,$options); }else{ 
  
 throw$e; 
  
 } 
  
 }",NA
ThetoolkitoftheRESTAPIdeveloper,NA,NA
"WhileyouaredevelopingyourownRESTAPI,orwritinganintegrationforathird-party ",NA,NA
"one,youmightwanttotestitbeforeyoustartwritingyourcode.Thereareahandfulof ",NA,NA
"toolsthatwillhelpyouwiththistask,whetheryouwanttouseyourbrowser,oryouarea ",NA,NA
fanofthecommandline.,NA,NA
TestingAPIswithbrowsers,NA,NA
Thereareactuallyseveraladd-onsthatallowyoutoperformHTTPrequestsfrom ,NA,NA
"browsers,dependingonwhichoneyouuse.Somefamousnamesare",NA,NA
AdvancedRestClient ,NA,NA
forChromeand,NA,NA
RESTClient,NA,NA
"forFirefox.Attheendoftheday,allthoseclientsallowyou ",NA,NA
"toperformthesameHTTPrequests,whereyoucanspecifytheURL,themethod,the ",NA,NA
"headers,thebody,andsoon.Theseclientswillalsoshowyouallthedetailsyoucan ",NA,NA
"imaginefromtheresponse,includingthestatuscode,thetimespent,andthebody.The ",NA,NA
followingscreenshotdisplaysanexampleofarequestusingChrome’s,NA,NA
AdvancedRest ,NA,NA
Client,NA,NA
:,NA,NA
"IfyouwanttotestGETrequestswithyourownAPI,andallthatyouneedistheURL, ",NA,NA
"thatis,youdonotneedtosendanyheaders,youcanjustuseyourbrowserasifyouwere ",NA,NA
"tryingtoaccessanyotherwebsite.Ifyoudoso,andifyouareworkingwithJSON ",NA,NA
"responses,youcaninstallanotheradd-ontoyourbrowserthatwillhelpyouinviewing",NA,NA
yourJSONinamore“beautiful”way.Lookfor,NA,NA
JSONView,NA,NA
onanybrowserforareally ,NA,NA
handyone.,NA,NA
TestingAPIsusingthecommandline,NA,NA
"Somepeoplefeelmorecomfortableusingthecommandline;soluckily,forthemthereare ",NA,NA
toolsthatallowthemtoperformanyHTTPrequestfromtheirconsoles.Wewillgivea ,NA,NA
briefintroductiontooneofthemostfamousones:cURL.Thistoolhasquitealotof ,NA,NA
"features,butwewillfocusonlyontheonesthatyouwillbeusingmoreoften:theHTTP ",NA,NA
"method,postparameters,andheaders:",-X<method>,NA
:ThisspecifiestheHTTPmethodtouse,--data,NA
":Thisaddstheparametersspecified,whichcanbeaddedaskey-valuepairs, ",NA,NA
"JSON,plaintext,andsoon",--header,NA
:Thisaddsaheadertotherequest,NA,NA
ThefollowingisanexampleofthewaytosendaPOSTrequestwithcURL:,"curl-XPOST--data""text=Thisissparta!""\ 
  
 >--header""Authorization:Bearer8s8d7bf8asdbf8sbdf8bsa""\ 
 >https://api.twitter.com/1.1/statuses/update.json 
  
 {""errors"":[{""code"":89,""message"":""Invalidorexpiredtoken.""}]}",NA
"IfyouareusingaUnixsystem,youwillprobablybeabletoformattheresultingJSONby ",NA,NA
appending,|python-mjson.tool,NA
sothatitgetseasiertoread:,"$curl-XPOST--data""text=Thisissparta!""\ 
  
 >--header""Authorization:Bearer8s8d7bf8asdbf8sbdf8bsa""\ 
 >https://api.twitter.com/1.1/statuses/update.json\ 
  
 >|python-mjson.tool 
  
 { 
  
 ""errors"":[ 
  
 { 
  
 ""code"":89, 
  
 ""message"":""Invalidorexpiredtoken."" 
  
 } 
  
 ] 
  
 }",NA
"cURLisquiteapowerfultoolthatletsyoudoquiteafewtricks.Ifyouareinterested,go ",NA,NA
aheadandcheckthedocumentationorsometutorialonhowtouseallitsfeatures.,NA,NA
BestpracticeswithRESTAPIs,NA,NA
"We’vealreadygonethroughsomeofthebestpracticeswhenwritingRESTAPIs,like ",NA,NA
"usingHTTPmethodsproperly,orchoosingthecorrectstatuscodeforyourresponses.We ",NA,NA
alsodescribedtwoofthemostusedauthenticationsystems.Butthereisstillalottolearn ,NA,NA
aboutcreatingproperRESTAPIs.Rememberthattheyaremeanttobeusedby ,NA,NA
"developerslikeyourself,sotheywillalwaysbegratefulifyoudothingsproperly,and ",NA,NA
maketheirliveseasier.Ready?,NA,NA
Consistencyinyourendpoints,NA,NA
"Whendecidinghowtonameyourendpoints,trykeepingthemconsistent.Eventhough ",NA,NA
"youarefreetochoose,thereisasetofspokenrulesthatwillmakeyourendpointsmore ",NA,NA
intuitiveandeasytounderstand.Let’slistsomeofthem:,NA,NA
"Forstarters,anendpointshouldpointtoaspecificresource(forexample,booksor ",NA,NA
"tweets),andyoushouldmakethatclearinyourendpoint.Ifyouhaveanendpoint ",NA,NA
"thatreturnsthelistofallbooks,donotnameit",/library,NA
",asitisnotobviouswhatit ",NA,NA
"willbereturning.Instead,nameit",/books,NA
or,/books/all,NA
.,NA,NA
"Thenameoftheresourcecanbeeitherpluralorsingular,butmakeitconsistent.If ",NA,NA
sometimesyouuse,/books,NA
andsometimes,/user,NA
",itmightbeconfusing,andpeople ",NA,NA
"willprobablymakemistakes.Wepersonallyprefertousethepluralform,butthatis ",NA,NA
totallyuptoyou.,NA,NA
"Whenyouwanttoretrieveaspecificresource,doitbyspecifyingtheIDwhenever ",NA,NA
"possible.IDsmustbeuniqueinyoursystem,andanyotherparametermightpointto ",NA,NA
"twodifferententities.SpecifytheIDnexttothenameoftheresource,suchas ",/books/249234-234-23-42,NA
.,NA,NA
"IfyoucanunderstandwhatanendpointdoesbyjusttheHTTPmethod,thereisno ",NA,NA
"needtoaddthisinformationaspartoftheendpoint.Forexample,ifyouwanttogeta ",NA,NA
"book,oryouwanttodeleteit,",/books/249234-234-23-42,NA
alongwiththeHTTP ,NA,NA
"methodsGETandDELETEaremorethanenough.Ifitisnotobvious,stateitasa ",NA,NA
"verbattheendoftheendpoint,like",/employee/9218379182/promote,NA
.,NA,NA
Documentasmuchasyoucan,NA,NA
"Thetitlesayseverything.YouareprobablynotgoingtobetheoneusingtheRESTAPI, ",NA,NA
"otherswill.Obviously,evenifyoudesignaveryintuitivesetofendpoints,developerswill ",NA,NA
"stillneedtoknowthewholesetofavailableendpoints,whateachofthemdoes,what ",NA,NA
"optionalparametersareavailable,andsoon.",NA,NA
"Writeasmuchdocumentationaspossible,andkeepituptodate.Takealookatother ",NA,NA
documentedAPIstogatherideasonhowtodisplaytheinformation.Thereareplentyof ,NA,NA
"templatesandtoolsthatwillhelpyoudeliverawell-presenteddocumentation,butyouare ",NA,NA
theonethathastobeconsistentandmethodical.Developershaveaspecialhatetowards ,NA,NA
"documentinganything,butwealsoliketofindclearandbeautifullypresented ",NA,NA
documentationwhenweneedtousesomeoneelse’sAPIs.,NA,NA
Filtersandpagination,NA,NA
OneofthecommonusagesofanAPIistolistresourcesandfilterthembysomecriteria. ,NA,NA
Wealreadysawanexamplewhenwewerebuildingourownbookstore;wewantedtoget ,NA,NA
thelistofbooksthatcontainedacertainstringintheirtitlesorauthors.,NA,NA
"Somedeveloperstrytohavebeautifulendpoints,whichaprioriisagoodthingtodo.",NA,NA
"Imaginethatyouwanttofilterjustbytitle,youmightenduphavinganendpointlike ",/books/title/<string>,NA
".Weaddalsotheabilitytofilterbyauthor,andwenowgettwo ",NA,NA
moreendpoints:,/books/title/<string>/author/<string>,NA
and ,/books/author/<string>,NA
.Nowlet’saddthedescriptiontoo—doyouseewhereweare going?,NA,NA
"Eventhoughsomedevelopersdonotliketousequerystringsasarguments,thereis ",NA,NA
"nothingwrongwithit.Infact,ifyouusethemproperly,youwillendupwithcleaner ",NA,NA
"endpoints.Youwanttogetbooks?Fine,justuse",/books,NA
",andaddwhicheverfilteryou ",NA,NA
needusingthequerystring.,NA,NA
Paginationoccurswhenyouhavewaytoomanyresourcesofthesametypetoretrieveall ,NA,NA
atonce.YoushouldthinkofpaginationasanotheroptionalfiltertobespecifiedasaGET ,NA,NA
"parameter.Youshouldhavepageswithadefaultsize,let’ssay10books,butitisagood ",NA,NA
"ideatogivethedeveloperstheabilitytodefinetheirownsize.Inthiscase,developerscan ",NA,NA
specifythelengthandthenumberofpagestoretrieve.,NA,NA
APIversioning,NA,NA
YourAPIisareflectionofwhatyourapplicationcando.Chancesarethatyourcodewill ,NA,NA
"evolve,improvingthealreadyexistingfeaturesoraddingnewones.YourAPIshouldbe ",NA,NA
"updatedtoo,exposingthosenewfeatures,updatingexistingendpoints,orevenremoving ",NA,NA
someofthem.,NA,NA
"ImaginenowthatsomeoneelseisusingyourRESTAPI,andtheirwholewebsiterelieson ",NA,NA
"it.Ifyouchangeyourexistingendpoints,theirwebsitewillstopworking!Theywillnotbe ",NA,NA
"happyatall,andwilltrytofindsomeoneelsethatcandowhatyouweredoing.Nota ",NA,NA
"goodscenario,butthen,howdoyouimproveyourAPI?",NA,NA
"Thesolutionistouseversioning.WhenyoureleaseanewversionoftheAPI,donotnuke ",NA,NA
downtheexistingone;youshouldgivesometimetotheuserstoupgradetheir ,NA,NA
integrations.AndhowcantwodifferentversionsoftheAPIcoexist?Youalreadysawone ,NA,NA
oftheoptions—theonethatwerecommendyou:byspecifyingtheversionoftheAPIto ,NA,NA
useaspartoftheendpoint.DoyouremembertheendpointoftheTwitterAPI ,/1.1/statuses/user_timeline.json,NA
?The,1.1,NA
referstotheversionthatwewanttouse.,NA,NA
UsingHTTPcache,NA,NA
"IfthemainfeatureofRESTAPIsisthattheymakeheavyuseofHTTP,whynottake ",NA,NA
"advantageofHTTPcache?Well,thereareactualreasonsfornotusingit,butmostofthem ",NA,NA
areduetoalackofknowledgeaboutusingitproperly.Itisoutofthescopeofthisbookto ,NA,NA
"explaineverysingledetailofitsimplementation,butlet’strytogiveashortintroduction ",NA,NA
tothetopic.PlentyofresourcesontheInternetcanhelpyoutounderstandthepartsthat ,NA,NA
youaremoreinterestedin.,NA,NA
HTTPresponsescanbedividedaspublicandprivate.Publicresponsesaresharedbetween ,NA,NA
"allusersoftheAPI,whereastheprivateonesaremeanttobeuniqueforeachuser.You ",NA,NA
canspecifywhichtypeofresponseisyoursusingthe,Cache-Control,NA
"header,allowingthe ",NA,NA
responsetobecachedifthemethodoftherequestwasaGET.Thisheadercanalsoexpose ,NA,NA
"theexpirationofthecache,thatis,youcanspecifythedurationforwhichyourresponse ",NA,NA
"willremainthesame,andthus,canbecached.",NA,NA
"Othersystemsrelyongeneratingahashoftherepresentationofaresource,andadditas ",NA,NA
the,ETag,NA
(Entitytag)headerinordertoknowiftheresourcehaschangedornot.Ina ,NA,NA
"similarway,youcansetthe",Last-Modified,NA
headertolettheclientknowwhenwasthe ,NA,NA
lasttimethatthegivenresourcechanged.Theideabehindthosesystemsistoidentify ,NA,NA
"whentheclientalreadycontainsvaliddata.Ifso,theproviderdoesnotprocessthe ",NA,NA
"request,butreturnsanemptyresponsewiththestatuscode304(notmodified)instead. ",NA,NA
"Whentheclientgetsthatresponse,itusesitscachedcontent.",NA,NA
CreatingaRESTAPIwithLaravel,NA,NA
"Inthissection,wewillbuildaRESTAPIwithLaravelfromscratch.ThisRESTAPIwill ",NA,NA
"allowyoutomanagedifferentclientsatyourbookstore,notonlyviathebrowser,butvia ",NA,NA
"theUIaswell.Youwillbeabletoperformprettymuchthesameactionsasbefore,thatis, ",NA,NA
"listingbooks,buyingthem,borrowingforfree,andsoon.",NA,NA
"OncetheRESTAPIisdone,youshouldremoveallthebusinesslogicfromthebookstore ",NA,NA
thatyoubuiltduringthepreviouschapters.Thereasonisthatyoushouldhaveoneunique ,NA,NA
"placewhereyoucanactuallymanipulateyourdatabasesandtheRESTAPI,andtherestof ",NA,NA
"theapplications,likethewebone,shouldabletocommunicatewiththeRESTAPIfor ",NA,NA
"managingdata.Indoingso,youwillbeabletocreateotherapplicationsfordifferent ",NA,NA
"platforms,likemobileapps,thatwillusetheRESTAPItoo,andboththewebsiteandthe ",NA,NA
"mobileappwillalwaysbesynchronized,sincetheywillbeusingthesamesources.",NA,NA
"AswithourpreviousLaravelexample,inordertocreateanewproject,youjustneedto ",NA,NA
runthefollowingcommand:,$laravelnewbookstore_api,NA
SettingOAuth2authentication,NA,NA
Thefirstthingthatwearegoingtoimplementistheauthenticationlayer.Wewilluse ,NA,NA
OAuth2inordertomakeourapplicationmoresecurethanbasicauthentication.Laravel ,NA,NA
"doesnotprovidesupportforOAuth2outofthebox,butthereisaserviceproviderwhich ",NA,NA
doesthatforus.,NA,NA
InstallingOAuth2Server,NA,NA
"ToinstallOAuth2,additasadependencytoyourprojectusingComposer:","$composerrequire""lucadegasperi/oauth2-server-laravel:5.1.*""",NA
Thisserviceproviderneedsquiteafewchanges.Wewillgothroughthemwithoutgoing ,NA,NA
"intotoomuchdetailonhowthingsworkexactly.Ifyouaremoreinterestedinthetopic,or ",NA,NA
"ifyouwanttocreateyourownserviceprovidersforLaravel,werecommendyoutogo ",NA,NA
thoughtheextensiveofficialdocumentation.,NA,NA
"Tostartwith,weneedtoaddthenewOAuth2Serverserviceprovidertothearrayof ",NA,NA
providersinthe,config/app.php,NA
file.Addthefollowinglinesattheendofthe,providers,NA
array:,"/* 
  
 *OAuth2ServerServiceProviders…
  
 */
  
 LucaDegasperi\OAuth2Server\Storage\FluentStorageServiceProvider::class, 
 LucaDegasperi\OAuth2Server\OAuth2ServerServiceProvider::class,",NA
"Inthesameway,youneedtoaddanewaliastothe",aliases,NA
arrayinthesamefile:,"'Authorizer'=>LucaDegasperi\OAuth2Server\Facades\Authorizer::class,",NA
Let’smovetothe,app/Http/Kernel.php,NA
"file,whereweneedtomakesomechangestoo. ",NA,NA
Addthefollowingentrytothe,$middleware,NA
arraypropertyofthe,Kernel,NA
class:,"\LucaDegasperi\OAuth2Server\Middleware\OAuthExceptionHandlerMiddleware::cla ss,",NA
Addthefollowingkey-valuepairstothe,$routeMiddleware,NA
arraypropertyofthesame ,NA,NA
class:,"'oauth'=>\LucaDegasperi\OAuth2Server\Middleware\OAuthMiddleware::class, 'oauth-user'=> 
  
 \LucaDegasperi\OAuth2Server\Middleware\OAuthUserOwnerMiddleware::class, 'oauth-client'=> 
  
 \LucaDegasperi\OAuth2Server\Middleware\OAuthClientOwnerMiddleware::class, 'check-authorization-
 params'=> 
  
 \LucaDegasperi\OAuth2Server\Middleware\CheckAuthCodeRequestMiddleware::clas s, 
  
 'csrf'=>\App\Http\Middleware\VerifyCsrfToken::class,",NA
WeaddedaCSRFtokenverifiertothe,$routeMiddleware,NA
",soweneedtoremovetheone ",NA,NA
alreadydefinedin,$middlewareGroups,NA
",sincetheyareincompatible.Usethefollowing",NA,NA
linetodoso:,"\App\Http\Middleware\VerifyCsrfToken::class,",NA
Settingupthedatabase,NA,NA
"Let’ssetupthedatabasenow.Inthissection,wewillassumethatyoualreadyhavethe ",NA,NA
"bookstoredatabaseinyourenvironment.Ifyoudonothaveit,gobackto",NA,NA
Chapter5,NA,NA
", ",NA,NA
UsingDatabases,NA,NA
",tocreateitinordertoproceedwiththissetup.",NA,NA
Thefirstthingtodoistoupdatethedatabasecredentialsinthe,.env,NA
file.Theyshouldlook ,NA,NA
"somethingsimilartothefollowinglines,butwithyourusernameandpassword:","DB_HOST=localhost 
  
 DB_DATABASE=bookstore 
  
 DB_USERNAME=root 
  
 DB_PASSWORD=",NA
InordertopreparetheconfigurationanddatabasemigrationfilesfromtheOAuth2Server ,NA,NA
"serviceprovider,weneedtopublishit.InLaravel,youdoitbyexecutingthefollowing ",NA,NA
command:,$phpartisanvendor:publish,NA
Nowthe,database/migrations,NA
directorycontainsallthenecessarymigrationfilesthat ,NA,NA
"willcreatethenecessarytablesrelatedtoOAuth2inourdatabase.Toexecutethem,we ",NA,NA
runthefollowingcommand:,$phpartisanmigrate,NA
Weneedtoaddatleastoneclienttothe,oauth_clients,NA
"table,whichisthetablethat ",NA,NA
storesthekeyandsecretsforallclientsthatwanttoconnecttoourRESTAPI.Thisnew ,NA,NA
clientwillbetheonethatyouwilluseduringthedevelopmentprocessinordertotest ,NA,NA
whatyouhavedone.WecansetarandomID—thekey—andthesecretasfollows:,"mysql>INSERTINTOoauth_clients(id,secret,name)-
 >VALUES('iTh4Mzl0EAPn90sK4EhAmVEXS',
  
 ->'PfoWM9yq4Bh6rGbzzJhr8oDDsNZwGlsMIAeVRaPM',->'Toni'); 
  
 QueryOK,1rowaffected,1warning(0.00sec)",NA
Enablingclient-credentialsauthentication,NA,NA
Sincewepublishedthepluginsin,vendor,NA
"inthepreviousstep,nowwehavethe ",NA,NA
configurationfilesfortheOAuth2Server.Thispluginallowsusdifferentauthentication ,NA,NA
"systems(allofthemwithOAuth2),dependingonournecessities.Theonethatweare ",NA,NA
interestedinforourprojectisthe,client_credentials,NA
"type.ToletLaravelknow,addthe ",NA,NA
followinglinesattheendofthearrayinthe,config/oauth2.php,NA
file:,"'grant_types'=>[ 
  
 'client_credentials'=>[ 
  
 'class'=> 
  
 '\League\OAuth2\Server\Grant\ClientCredentialsGrant', 'access_token_ttl'=>3600",NA
Theseprecedinglinesgrantaccesstothe,client_credentials,NA
"type,whicharemanaged ",NA,NA
bythe,ClientCredentialsGrant,NA
class.The,access_token_ttl,NA
valuereferstothetime ,NA,NA
"periodoftheaccesstoken,thatis,forhowlongsomeonecanuseit.Inthiscase,itissetto ",NA,NA
"1hour,thatis,3,600seconds.",NA,NA
"Finally,weneedtoenablearoutesowecanpostourcredentialsinexchangeforanaccess ",NA,NA
token.Addthefollowingroutetotheroutesfilein,app/Http/routes.php,NA
:,"Route::post('oauth/access_token',function(){ 
  
 returnResponse::json(Authorizer::issueAccessToken()); });",NA
Requestinganaccesstoken,NA,NA
"Itistimetotestwhatwehavedonesofar.Todoso,weneedtosendaPOSTrequestto ",NA,NA
the,/oauth/access_token,NA
endpointthatweenabledjustnow.Thisrequestneedsthe ,NA,NA
followingPOSTparameters:,client_id,NA
withthekeyfromthedatabase ,client_secret,NA
withthesecretfromthedatabase ,grant_type,NA
"tospecifythetypeofauthenticationthatwearetryingtoperform,inthis ",NA,NA
case,client_credentials,NA
Therequestissuedusingthe,NA,NA
AdvancedRESTClient,NA,NA
add-onfromChromelooksas ,NA,NA
follows:,NA,NA
Theresponsethatyoushouldgetshouldhavethesameformatasthisone:,"{ 
  
 ""access_token"":""MPCovQda354d10zzUXpZVOFzqe491E7ZHQAhSAax"" 
 ""token_type"":""Bearer"" 
  
 ""expires_in"":3600 
  
 }",NA
NotethatthisisadifferentwayofrequestingforanaccesstokenthanwhattheTwitter ,NA,NA
"APIdoes,buttheideaisstillthesame:givenakeyandasecret,theprovidergivesusan ",NA,NA
accesstokenthatwillallowustousetheAPIforsometime.,NA,NA
Preparingthedatabase,NA,NA
"Eventhoughwe’vealreadydonethesameinthepreviouschapter,youmightthink:“Why ",NA,NA
dowestartbypreparingthedatabase?”.Wecouldarguethatyoufirstneedtoknowthe ,NA,NA
"kindofendpointsyouwanttoexposeinyourRESTAPI,andonlythenyoucanstart ",NA,NA
"thinkingaboutwhatyourdatabaseshouldlooklike.Butyoucouldalsothinkthat,since ",NA,NA
"weareworkingwithanAPI,eachendpointshouldmanageoneresource,sofirstyouneed ",NA,NA
todefinetheresourcesyouaredealingwith.This,NA,NA
codefirstversusdatabase/modelfirst,NA,NA
is ,NA,NA
"anongoingwarontheInternet.Butwhicheverwayyouthinkisbetter,thefactisthatwe ",NA,NA
"alreadyknowwhattheuserswillneedtodowithourRESTAPI,sincewealreadybuilt ",NA,NA
theUIpreviously;soitdoesnotreallymatter.,NA,NA
Weneedtocreatefourtables:,books,NA
",",sales,NA
",",sales_books,NA
",and",borrowed_books,NA
. ,NA,NA
RememberthatLaravelalreadyprovidesa,users,NA
"table,whichwecanuseasour ",NA,NA
customers.Runthefollowingfourcommandstocreatethemigrationsfiles:,"$phpartisanmake:migrationcreate_books_table--create=books 
 $phpartisanmake:migrationcreate_sales_table--create=sales 
 $phpartisanmake:migrationcreate_borrowed_books_table\--
 create=borrowed_books 
  
 $phpartisanmake:migrationcreate_sales_books_table\
  
 --create=sales_books",NA
Nowwehavetogofilebyfiletodefinewhateachtableshouldlooklike.Wewilltryto ,NA,NA
replicatethedatastructurefrom,NA,NA
Chapter5,NA,NA
",",NA,NA
UsingDatabases,NA,NA
",asmuchaspossible.",NA,NA
Rememberthatthemigrationfilescanbefoundinsidethe,database/migrations,NA
directory.Thefirstfilethatwecaneditisthe,create_books_table.php,NA
.Replacethe ,NA,NA
existingempty,up,NA
methodbythefollowingone:,"publicfunctionup() 
  
 { 
  
 Schema::create('books',function(Blueprint$table){ $table->increments('id'); 
  
 $table->string('isbn')->unique(); 
  
 $table->string('title'); 
  
 $table->string('author'); 
  
 $table->smallInteger('stock')->unsigned(); 
  
 $table->float('price')->unsigned(); 
  
 }); 
  
 }",NA
Thenextoneinthelistis,create_sales_table.php,NA
.Rememberthatthisonehasaforeign ,NA,NA
keypointingtothe,users,NA
table.Youcanuse,references(field)->on(tablename),NA
to ,NA,NA
definethisconstraint.,"publicfunctionup() 
  
 { 
  
 Schema::create('sales',function(Blueprint$table){ 
  
 $table->increments('id'); 
  
 $table->string('user_id')->references('id')->on('users'); $table->timestamps(); 
  
 });",NA
The,create_sales_books_table.php,NA
filecontainstwoforeignkeys:onepointingtothe ,NA,NA
"IDofthesale,andonetotheIDofthebook.Replacetheexisting",up,NA
methodbythe ,NA,NA
followingone:,"publicfunctionup() 
  
 { 
  
 Schema::create('sales_books',function(Blueprint$table){ $table->increments('id'); 
  
 $table->integer('sale_id')->references('id')->on('sales'); $table->integer('book_id')-
 >references('id')->on('books'); $table->smallInteger('amount')->unsigned(); 
  
 }); 
  
 }",NA
"Finally,editthe",create_borrowed_books_table.php,NA
"file,whichhasthe",book_id,NA
foreign ,NA,NA
keyandthe,start,NA
and,end,NA
timestamps:,"publicfunctionup() 
  
 { 
  
 Schema::create('borrowed_books',function(Blueprint$table){ $table->increments('id'); 
  
 $table->integer('book_id')->references('id')->on('books'); $table->string('user_id')-
 >references('id')->on('users'); $table->timestamp('start'); 
  
 $table->timestamp('end'); 
  
 }); 
  
 }",NA
Themigrationfilesarereadysowejustneedtomigratetheminordertocreatethe ,NA,NA
databasetables.Runthefollowingcommand:,$phpartisanmigrate,NA
"Also,addsomebookstothedatabasemanuallysothatyoucantestlater.Forexample:","mysql>INSERTINTObooks(isbn,title,author,stock,price)VALUES-
 >(""9780882339726"",""1984"",""GeorgeOrwell"",12,7.50),
  
 ->(""9789724621081"",""1Q84"",""HarukiMurakami"",9,9.75),-
 >(""9780736692427"",""AnimalFarm"",""GeorgeOrwell"",8,3.50),-
 >(""9780307350169"",""Dracula"",""BramStoker"",30,10.15),-
 >(""9780753179246"",""19minutes"",""JodiPicoult"",0,10); 
 QueryOK,5rowsaffected(0.01sec) 
  
 Records:5Duplicates:0Warnings:0",NA
Settingupthemodels,NA,NA
"Thenextthingtodoonthelististoaddtherelationshipsthatourdatahas,thatis,to ",NA,NA
"translatetheforeignkeysfromthedatabasetothemodels.Firstofall,weneedtocreate ",NA,NA
"thosemodels,andforthatwejustrunthefollowingcommands:","$phpartisanmake:modelBook 
  
 $phpartisanmake:modelSale 
  
 $phpartisanmake:modelBorrowedBook 
  
 $phpartisanmake:modelSalesBook",NA
"Nowwehavetogomodelbymodel,andaddtheonetooneandonetomanyrelationships ",NA,NA
aswedidinthepreviouschapter.For,BookModel,NA
",wewillonlyspecifythatthemodeldoes ",NA,NA
"nothavetimestamps,sincetheycomebydefault.Todoso,addthefollowinghighlighted ",NA,NA
linetoyour,app/Book.php,NA
file:,"<?php
  
 namespaceApp;
  
 useIlluminate\Database\Eloquent\Model;
  
 classBookextendsModel 
  
 { 
  
 public$timestamps=false; 
  
 }",NA
Forthe,BorrowedBook,NA
"model,weneedtospecifythatithasonebook,anditbelongstoa ",NA,NA
user.Wealsoneedtospecifythefieldswewillfillonceweneedtocreatetheobject—in ,NA,NA
"thiscase,",book_id,NA
and,start,NA
.Addthefollowingtwomethodsin,app/BorrowedBook.php,NA
:,"<?php
  
 namespaceApp;
  
 useIlluminate\Database\Eloquent\Model;
  
 classBorrowedBookextendsModel 
  
 { 
  
 protected$fillable=['user_id','book_id','start']; public$timestamps=false;
  
 publicfunctionuser(){ 
  
 return$this->belongsTo('App�ser'); }
  
 publicfunctionbook(){ 
  
 return$this->hasOne('App\Book'); } 
  
 }",NA
"Salescanhavemany“salebooks”(weknowitmightsoundalittleawkward),andthey ",NA,NA
alsobelongtojustoneuser.Addthefollowingtoyour,app/Sale.php,NA
:,NA,NA
"Likeborrowedbooks,salebookscanhaveonebookandbelongtoonesaleinsteadofto ",NA,NA
oneuser.Thefollowinglinesshouldbeaddedto,app/SalesBook.php,NA
: ,"<?php 
  
 namespaceApp; 
  
 useIlluminate\Database\Eloquent\Model; 
  
 classSaleBookextendsModel 
  
 { 
  
 public$timestamps=false; 
  
 protected$fillable=['book_id','sale_id','amount']; 
  
 publicfunctionsale(){ 
  
 return$this->belongsTo('App\Sale'); 
  
 } 
  
 publicfunctionbooks(){ 
  
 return$this->hasOne('App\Book'); 
  
 } 
  
 }",NA
"Finally,thelastmodelthatweneedtoupdateisthe",User,NA
model.Weneedtoaddthe ,NA,NA
oppositerelationshiptothe,belongs,NA
weusedearlierin,Sale,NA
and,BorrowedBook,NA
.Addthese ,NA,NA
"twofunctions,andleavetherestoftheclassintact: ","<?php 
  
 namespaceApp; 
  
 useIlluminate\Foundation\Auth�serasAuthenticatable; 
  
 classUserextendsAuthenticatable 
  
 { 
  
 //...",NA
Designingendpoints,NA,NA
"Inthissection,weneedtocomeupwiththelistofendpointsthatwewanttoexposetothe ",NA,NA
RESTAPIclients.Keepinmindthe“rules”explainedinthe,NA,NA
BestpracticeswithREST ,NA,NA
APIs,NA,NA
"section.Inshort,keepthefollowingrulesinmind:",NA,NA
Oneendpointinteractswithoneresource ,NA,NA
Apossibleschemacouldbe,"<APIversion>/<resourcename>/<optional
  
 id>/<optionalaction>",NA
UseGETparametersforfilteringandpagination,NA,NA
"Sowhatwilltheuserneedtodo?Wealreadyhaveagoodideaaboutthat,sincewe ",NA,NA
createdtheUI.Abriefsummarywouldbeasfollows:,NA,NA
"Listalltheavailablebookswithsomefiltering(bytitleandauthor),andpaginated ",NA,NA
"whennecessary.Alsoretrievetheinformationonaspecificbook,giventheID.",NA,NA
"Allowtheusertoborrowaspecificbookifavailable.Inthesameway,theuser ",NA,NA
"shouldbeabletoreturnbooks,andlistthehistoryofborrowedbookstoo(filteredby ",NA,NA
dateandpaginated).,NA,NA
"Allowtheusertobuyalistofbooks.Thiscouldbeimproved,butfornowlet’sforce ",NA,NA
"theusertobuybookswithjustonerequest,includingthefulllistofbooksinthe ",NA,NA
"body.Also,listthesalesoftheuserfollowingthesamerulesasthatwithborrowed books.",NA,NA
"Wewillstartstraightawaywithourlistofendpoints,specifyingthepath,theHTTP ",NA,NA
"method,andtheoptionalparameters.Itwillalsogiveyouanideaonhowtodocument ",NA,NA
yourRESTAPIs.,NA,NA
GET,"/books
  
 title",NA
:Optionalandfiltersbytitle,author,NA
:Optionalandfiltersbyauthor,page,NA
":Optional,defaultis1,andspecifiesthepagetoreturn",page-size,NA
":Optional,defaultis50,andspecifiesthepagesizetoreturn",NA,NA
GET,/books/<bookid>,NA
POST,"/borrowed-books
  
 book-id",NA
:MandatoryandspecifiestheIDofthebooktoborrow,NA,NA
GET,"/borrowed-books
  
 from",NA
:Optionalandreturnsborrowedbooksfromthespecifieddate,page,NA
":Optional,defaultis1,andspecifiesthepagetoreturn",page-size,NA
":Optional,defaultis50,andspecifiesthenumberofborrowedbooks ",NA,NA
perpage,NA,NA
PUT,/borrowed-books/<borrowedbookid>/return,NA
POST,"/sales
  
 books",NA
:MandatoryanditisanarraylistingthebookIDstobuyandtheir,NA,NA
"amounts,thatis,",NA,NA
"{“book-id-1”:amount,“book-id-2”:amount,…}",NA,NA
GET,"/sales
  
 from",NA
:Optionalandreturnsborrowedbooksfromthespecifieddate ,page,NA
":Optional,defaultis1,andspecifiesthepagetoreturn ",page-size,NA
":Optional,defaultis50,andspecifiesthenumberofsalesperpage",NA,NA
GET,/sales/<salesid>,NA
"WeusePOSTrequestswhencreatingsalesandborrowedbooks,sincewedonotknowthe ",NA,NA
"IDoftheresourcethatwewanttocreateapriori,andpostingthesamerequestwillcreate ",NA,NA
"multipleresources.Ontheotherhand,whenreturningabook,wedoknowtheIDofthe ",NA,NA
"borrowedbook,andsendingthesamerequestmultipletimeswillleavethedatabaseinthe ",NA,NA
samestate.Let’stranslatetheseendpointstoroutesin,app/Http/routes.php,NA
:,"/* 
  
 *Booksendpoints.
  
 */ 
  
 Route::get('books',['middleware'=>'oauth', 
  
 'uses'=>'BookController@getAll']); 
  
 Route::get('books/{id}',['middleware'=>'oauth', 
 'uses'=>'BookController@get']); 
  
 /* 
  
 *Borrowedbooksendpoints.
  
 */ 
  
 Route::post('borrowed-books',['middleware'=>'oauth', 
  
 'uses'=>'BorrowedBookController@borrow']); 
  
 Route::get('borrowed-books',['middleware'=>'oauth', 
  
 'uses'=>'BorrowedBookController@get']); 
  
 Route::put('borrowed-books/{id}/return',['middleware'=>'oauth', 
 'uses'=>'BorrowedBookController@returnBook']); 
  
 /* 
  
 *Salesendpoints.
  
 */ 
  
 Route::post('sales',['middleware'=>'oauth', 
 'uses'=>'SalesController@buy]); 
  
 Route::get('sales',['middleware'=>'oauth', 
  
 'uses'=>'SalesController@getAll']); 
  
 Route::get('sales/{id}',['middleware'=>'oauth', 
 'uses'=>'SalesController@get']);",NA
"Intheprecedingcode,notehowweaddedthemiddleware",oauth,NA
toalltheendpoints.This ,NA,NA
willrequiretheusertoprovideavalidaccesstokeninordertoaccessthem.,NA,NA
Addingthecontrollers,NA,NA
"Fromtheprevioussection,youcanimaginethatweneedtocreatethreecontrollers: ",BookController,NA
",",BorrowedBookController,NA
",and",SalesController,NA
.Let’sstartwiththe ,NA,NA
easiestone:returningtheinformationofabookgiventheID.Createthefile ,app/Http/Controllers/BookController.php,NA
",andaddthefollowingcode:","<?php
  
 namespaceApp\Http\Controllers;
  
 useApp\Book; 
  
 useIlluminate\Http\JsonResponse; 
  
 useIlluminate\Http\Response;
  
 classBookControllerextendsController{
  
 publicfunctionget(string$id):JsonResponse{ $book=Book::find($id);
  
 if(empty($book)){ 
  
 returnnewJsonResponse( 
  
 null, 
  
 JsonResponse::HTTP_NOT_FOUND ); 
  
 }
  
 returnresponse()->json(['book'=>$book]); } 
  
 }",NA
"Eventhoughthisprecedingexampleisquiteeasy,itcontainsmostofwhatwewillneed ",NA,NA
"fortherestoftheendpoints.WetrytofetchabookgiventheIDfromtheURL,andwhen ",NA,NA
"notfound,wereplywitha404(notfound)emptyresponse—theconstant ",Response::HTTP_NOT_FOUND,NA
"is404.Incasewehavethebook,wereturnitasJSONwith ","response-
 >json()",NA
.Notehowweaddtheseeminglyunnecessarykey,book,NA
;itistruethat ,NA,NA
"wedonotreturnanythingelseand,sinceweaskforthebook,theuserwillknowwhatwe ",NA,NA
"aretalkingabout,butasitdoesnotreallyhurt,itisgoodtobeasexplicitaspossible.",NA,NA
Let’stestit!Youalreadyknowhowtogetanaccesstoken—checkthe,NA,NA
Requestingan ,NA,NA
accesstoken,NA,NA
"section.Sogetone,andtrytoaccessthefollowingURLs:","http://localhost/books/0?access_token=12345
  
 http://localhost/books/1?access_token=12345",NA
Assumingthat,12345,NA
"isyouraccesstoken,thatyouhaveabookinthedatabasewithID",1,NA
", ",NA,NA
andyoudonothaveabookwithID,0,NA
",thefirstURLshouldreturna404response,andthe ",NA,NA
"secondone,aresponsesomethingsimilartothefollowing:","{ 
  
 ""book"":{ 
  
 ""id"":1 
  
 ""isbn"":""9780882339726""",NA
Let’snowaddthemethodtogetallthebookswithfiltersandpagination.Itlooksquite ,NA,NA
"verbose,butthelogicthatweuseisquitesimple:","publicfunctiongetAll(Request$request):JsonResponse{ $title=$request-
 >get('title',''); 
  
 $author=$request->get('author',''); 
  
 $page=$request->get('page',1); 
  
 $pageSize=$request->get('page-size',50);
  
 $books=Book::where('title','like',""%$title%"")-
 >where('author','like',""%$author%"")
  
 ->take($pageSize)
  
 ->skip(($page-1)*$pageSize)
  
 ->get();
  
 returnresponse()->json(['books'=>$books]); }",NA
"Wegetalltheparametersthatcancomefromtherequest,andsetthedefaultvaluesof ",NA,NA
"eachoneincasetheuserdoesnotincludethem(sincetheyareoptional).Then,weusethe ",NA,NA
EloquentORMtofilterbytitleandauthorusing,where(),NA
",andlimitingtheresultswith ","take()-
 >skip()",NA
.WereturntheJSONinthesamewaywedidwiththepreviousmethod. ,NA,NA
"Inthisonethough,wedonotneedanyextracheck;ifthequerydoesnotreturnanybook, ",NA,NA
itisnotreallyaproblem.,NA,NA
"YoucannowplaywithyourRESTAPI,sendingdifferentrequestswithdifferentfilters. ",NA,NA
Thefollowingaresomeexamples:,"http://localhost/books?access_token=12345
  
 http://localhost/books?access_token=12345&title=19&page-size=1
  
 http://localhost/books?access_token=12345&page=2",NA
Thenextcontrollerinthelistis,BorrowedBookController,NA
.Weneedtoaddthreemethods: ,borrow,NA
",",get,NA
",and",returnBook,NA
".Asyoualreadyknowhowtoworkwithrequests,responses, ",NA,NA
"statuscodes,andtheEloquentORM,wewillwritetheentireclassstraightaway:","<?php
  
 namespaceApp\Http\Controllers;
  
 useApp\Book; 
  
 useApp\BorrowedBook; 
  
 useIlluminate\Http\JsonResponse; 
  
 useIlluminate\Http\Request; 
  
 useLucaDegasperi\OAuth2Server\Facades\Authorizer;
  
 classBorrowedBookControllerextendsController{",NA
Theonlythingtonoteintheprecedingcodeishowwealsoupdatethestockofthebook ,NA,NA
"byincreasingordecreasingthestock,andinvokethe",save,NA
methodtosavethechangesin ,NA,NA
thedatabase.Wealsoreturntheborrowedbookobjectastheresponsewhenborrowinga ,NA,NA
"booksothattheusercanknowtheborrowedbookID,anduseitwhenqueryingor ",NA,NA
returningthebook.,NA,NA
Youcantesthowthissetofendpointsworkswiththefollowingusecases:,NA,NA
Borrowabook.Checkthatyougetavalidresponse.,NA,NA
Getthelistofborrowedbooks.Theonethatyoujustcreatedshouldbetherewitha ,NA,NA
validstartingdateandanemptyenddate.,NA,NA
Gettheinformationofthebookyouborrowed.Thestockshouldbeoneless.,NA,NA
Returnthebook.Fetchthelistofborrowedbookstochecktheenddateandthe ,NA,NA
returnedbooktocheckthestock.,NA,NA
"Ofcourse,youcanalwaystrytotricktheAPIandaskforbookswithoutstock,non-",NA,NA
"existingborrowedbooks,andthelike.Alltheseedgecasesshouldrespondwiththe ",NA,NA
correctstatuscodesanderrormessages.,NA,NA
"Wefinishthissection,andtheRESTAPI,bycreatingthe",SalesController,NA
.This ,NA,NA
"controlleristheonethatcontainsmorelogic,sincecreatingasaleimpliesaddingentries ",NA,NA
"tothesalesbookstable,priortocheckingforenoughstockforeachone.Addthe ",NA,NA
followingcodeto,app/Html/SalesController.php,NA
:,"<?php
  
 namespaceApp\Http\Controllers;
  
 useApp\Book; 
  
 useApp\Sale; 
  
 useApp\SalesBook; 
  
 useIlluminate\Http\JsonResponse; 
  
 useIlluminate\Http\Request; 
  
 useLucaDegasperi\OAuth2Server\Facades\Authorizer;
  
 classSalesControllerextendsController{
  
 publicfunctionget(string$id):JsonResponse{ $sale=Sale::find($id);",NA
"Intheprecedingcode,notehowwefirstchecktheavailabilityofallthebooksbefore ",NA,NA
"creatingthesalesentry.Thisway,wemakesurethatwedonotleaveanyunfinishedsale ",NA,NA
"inthedatabasewhenreturninganerrortotheuser.Youcouldchangethis,anduse ",NA,NA
"transactionsinstead,andifabookisnotvalid,justrollbackthetransaction.",NA,NA
"Inordertotestthis,wecanfollowsimilarstepsaswedidwithborrowedbooks.Just ",NA,NA
rememberthatthe,books,NA
"parameter,whenpostingasale,isaJSONmap;forexample, ","{""1"":2,""4"":1}",NA
meansthatIamtryingtobuytwobookswithID,1,NA
andonebookwith ID,4,NA
.,NA,NA
TestingyourRESTAPIs ,NA,NA
YouhavealreadybeentestingyourRESTAPIafterfinishingeachcontrollerbymaking ,NA,NA
"somerequestandexpectingaresponse.Asyoumightimagine,thiscanbehandy ",NA,NA
"sometimes,butitisforsurenotthewaytogo.Testingshouldbeautomatic,andshould ",NA,NA
coverasmuchaspossible.Wewillhavetothinkofasolutionsimilartounittesting. ,NA,NA
In,NA,NA
Chapter10,NA,NA
",",NA,NA
BehavioralTesting,NA,NA
",youwilllearnmoremethodologiesandtoolsfortesting ",NA,NA
"anapplicationendtoend,andthatwillincludeRESTAPIs.However,duetothe ",NA,NA
"simplicityofourRESTAPI,wecanaddsomeprettygoodtestswithwhatLaravel ",NA,NA
"providesusaswell.Actually,theideaisverysimilartotheteststhatwewrotein",NA,NA
Chapter ,NA,NA
8,NA,NA
",",NA,NA
UsingExistingPHPFrameworks,NA,NA
",wherewemadearequesttosomeendpoint,and ",NA,NA
expectedaresponse.Theonlydifferencewillbeinthekindofassertionsthatweuse ,NA,NA
"(whichcancheckifaJSONresponseisOK),andthewayweperformrequests.",NA,NA
Let’saddsometeststothesetofendpointsrelatedtobooks.Weneedsomebooksinthe ,NA,NA
"databaseinordertoquerythem,sowewillhavetopopulatethedatabasebeforeeachtest, ",NA,NA
"thatis,usethe",setUp,NA
method.Rememberthatinordertoleavethedatabasecleanoftest ,NA,NA
"data,weneedtousethetrait",DatabaseTransactions,NA
.Addthefollowingcodeto ,tests/BooksTest.php,NA
: ,"<?php 
  
 useIlluminate\Foundation\Testing\DatabaseTransactions; 
  
 useApp\Book; 
  
 classBooksTestextendsTestCase{ 
  
 useDatabaseTransactions; 
  
 private$books=[]; 
  
 publicfunctionsetUp(){ 
  
 parent::setUp(); 
  
 $this->addBooks(); 
  
 } 
  
 privatefunctionaddBooks(){ 
  
 $this->books[0]=Book::create( 
  
 [ 
  
 'isbn'=>'293842983648273', 
  
 'title'=>'Iliad', 
  
 'author'=>'Homer', 
  
 'stock'=>12, 
  
 'price'=>7.40 
  
 ] 
  
 ); 
  
 $this->books[0]->save(); 
  
 $this->books[0]=$this->books[0]->fresh(); 
  
 $this->books[1]=Book::create(",NA
"Asyoucanseeintheprecedingcode,weaddthreebookstothedatabase,andtotheclass ",NA,NA
property,$books,NA
too.Wewillneedthemwhenwewanttoassertthataresponseisvalid. ,NA,NA
Alsonotetheuseofthe,fresh,NA
method;thismethodsynchronizesthemodelthatwehave ,NA,NA
withthecontentinthedatabase.WeneedtodothisinordertogettheIDinsertedinthe ,NA,NA
"database,sincewedonotknowitapriori.",NA,NA
Thereisanotherthingweneedtodobeforeweruneachtest:authenticatingourclient.We ,NA,NA
willneedtomakeaPOSTrequesttotheaccesstokengenerationendpointsendingvalid ,NA,NA
"credentials,andstoringtheaccesstokenthatwereceivesothatitcanbeusedinthe ",NA,NA
"remainingrequests.Youarefreetochoosehowtoprovidethecredentials,sincethereare ",NA,NA
"differentwaystodoit.Inourcase,wejustprovidethecredentialsofaclienttestthatwe ",NA,NA
"knowexistsinthedatabase,butyoumightprefertoinsertthatclientintothedatabase ",NA,NA
eachtime.Updatethetestwiththefollowingcode:,"<?php
  
 useIlluminate\Foundation\Testing\DatabaseTransactions; useApp\Book;
  
 classBooksTestextendsTestCase{
  
 useDatabaseTransactions;
  
 private$books=[]; 
  
 private$accessToken;
  
 publicfunctionsetUp(){ 
  
 parent::setUp();",NA
"Intheprecedingcode,weusethe",post,NA
methodinordertosendaPOSTrequest.This ,NA,NA
"methodacceptsastringwiththeendpoint,andanarraywiththeparameterstobe ",NA,NA
"included.Aftermakingarequest,Laravelsavestheresponseobjectintothe",$response,NA
"property.WecanJSON-decodeit,andextracttheaccesstokenthatweneed.",NA,NA
Itistimetoaddsometests.Let’sstartwithaneasyone:requestingabookgivenanID. ,NA,NA
TheIDisusedtomaketheGETrequestswiththeIDofthebook(donotforgettheaccess ,NA,NA
"token),andcheckiftheresponsematchestheexpectedone.Rememberthatwehavethe ",$books,NA
"arrayalready,soitwillbeprettyeasytoperformthesechecks.",NA,NA
Wewillbeusingtwoassertions:,seeJson,NA
",whichcomparesthereceivedJSONresponse ",NA,NA
"withtheonethatweprovide,and",assertResponseOk,NA
",whichyoualreadyknowfrom ",NA,NA
previoustests—itjustchecksthattheresponsehasa200statuscode.Addthistesttothe ,NA,NA
class:,"publicfunctiontestGetBook(){ 
  
 $expectedResponse=[ 
  
 'book'=>json_decode($this->books[1],true) ]; 
  
 $url='books/'.$this->books[1]->id 
  
 .'?'.$this->getCredentials();
  
 $this->get($url)
  
 ->seeJson($expectedResponse)
  
 ->assertResponseOk(); 
  
 }
  
 privatefunctiongetCredentials():string{ 
  
 return'grant_access=client_credentials&access_token=' .$this->accessToken; 
  
 }",NA
Weusethe,get,NA
methodinsteadof,post,NA
",sincethisisaGETrequest.Alsonotethatweuse",NA,NA
the,getCredentials,NA
"helper,sincewewillhavetouseitineachtest.Toseeanother ",NA,NA
"example,let’saddatestthatcheckstheresponsewhenrequestingthebooksthatcontain ",NA,NA
thegiventitle:,"publicfunctiontestGetBooksByTitle(){ 
  
 $expectedResponse=[ 
  
 'books'=>[ 
  
 json_decode($this->books[0],true), json_decode($this-
 >books[2],true) ] 
  
 ];
  
 $url='books/?title=Il&'.$this->getCredentials(); $this->get($url)
  
 ->seeJson($expectedResponse)
  
 ->assertResponseOk(); 
  
 }",NA
"Theprecedingtestisprettymuchthesameasthepreviousone,isn’tit?Theonlychanges ",NA,NA
"aretheendpointandtheexpectedresponse.Well,theremainingtestswillallfollowthe ",NA,NA
"samepattern,sincesofar,wecanonlyfetchbooksandfilterthem.",NA,NA
"Toseesomethingdifferent,let’scheckhowtotestanendpointthatcreatesresources. ",NA,NA
"Therearedifferentoptions,oneofthembeingtofirstmaketherequest,andthengoingto ",NA,NA
"thedatabasetocheckthattheresourcehasbeencreated.Anotheroption,theonethatwe ",NA,NA
"prefer,istofirstsendtherequestthatcreatestheresource,andthen,withtheinformation ",NA,NA
"intheresponse,sendarequesttofetchthenewlycreatedresource.Thisispreferable, ",NA,NA
"sincewearetestingonlytheRESTAPI,andwedonotneedtoknowthespecificschema ",NA,NA
"thatthedatabaseisusing.Also,iftheRESTAPIchangesitsdatabase,thetestswillkeep ",NA,NA
passing—andtheyshould—sincewetestthroughtheinterfaceonly.,NA,NA
Onegoodexamplecouldbeborrowingabook.ThetestshouldfirstsendaPOSTinorder ,NA,NA
"toborrowthebook,specifyingthebookID,thenextracttheborrowedbookIDfromthe ",NA,NA
"response,andfinallysendaGETrequestaskingforthatborrowedbook.Tosavetime,you ",NA,NA
canaddthefollowingtesttothealreadyexisting,tests/BooksTest.php,NA
:,"publicfunctiontestBorrowBook(){ 
  
 $params=['book-id'=>$this->books[1]->id]; 
  
 $params=array_merge($params,$this->postCredentials());
  
 $this->post('borrowed-books',$params)
  
 ->seeJsonContains(['book_id'=>$this->books[1]->id])->assertResponseOk();
  
 $response=json_decode($this->response->getContent(),true);
  
 $url='borrowed-books'.'?'.$this->getCredentials(); 
  
 $this->get($url)
  
 ->seeJsonContains(['id'=>$response['borrowed-book']['id']])->assertResponseOk(); 
  
 }
  
 privatefunctionpostCredentials():array{",NA
Summary,NA,NA
"Inthischapter,youlearnedtheimportanceofRESTAPIsinthewebworld.Nowyouare ",NA,NA
"ablenotonlytousethem,butalsowriteyourownRESTAPIs,whichhasturnedyouinto ",NA,NA
amoreresourcefuldeveloper.Youcanalsointegrateyourapplicationswiththird-party ,NA,NA
"APIstogivemorefeaturestoyourusers,andformakingyourwebsitesmoreinteresting ",NA,NA
anduseful.,NA,NA
"Inthenextandlastchapter,wewillendthisbookdiscoveringatypeoftestingotherthan ",NA,NA
"unittesting:behavioraltesting,whichimprovesthequalityandreliabilityofyourweb ",NA,NA
applications.,NA,NA
Chapter10.BehavioralTesting,NA,NA
In,NA,NA
Chapter7,NA,NA
",",NA,NA
TestingWebApplications,NA,NA
",youlearnedhowtowriteunittestsinordertotest ",NA,NA
"smallpiecesofcodeinanisolatedway.Eventhoughthisisamust,itisnotenoughalone ",NA,NA
tomakesureyourapplicationworksasitshould.Thescopeofyourtestcouldbesosmall ,NA,NA
"thateventhoughthealgorithmthatyoutestmakessense,itwouldnotbewhatthe ",NA,NA
businessaskedyoutocreate.,NA,NA
"Acceptancetestswereborninordertoaddthislevelofsecuritytothebusinessside, ",NA,NA
"complementingthealreadyexistingunittests.Inthesameway,BDDoriginatedfrom ",NA,NA
TDDinordertowritecodebasedontheseacceptancetestsinanattempttoinvolve ,NA,NA
businessandmanagersinthedevelopmentprocess.AsPHPisoneofthefavorite ,NA,NA
"languagesofwebdevelopers,itisjustnaturaltofindpowerfultoolstoimplementBDDin ",NA,NA
yourprojects.Youwillbepositivelysurprisedbywhatyoucandowith,NA,NA
Behat,NA,NA
and,NA,NA
Mink,NA,NA
", ",NA,NA
thetwomostpopularBDDframeworksatthemoment.,NA,NA
"Inthischapter,youwilllearnabout:",NA,NA
AcceptancetestsandBDD ,NA,NA
WritingfeatureswithGherkin ,NA,NA
ImplementingandrunningtestswithBehat,NA,NA
WritingtestsagainstbrowserswithMink,NA,NA
Behavior-drivendevelopment,NA,NA
Wealreadyexposedin,NA,NA
Chapter7,NA,NA
",",NA,NA
TestingWebApplications,NA,NA
",thedifferenttoolswecanuse ",NA,NA
"inordertomakeourapplicationsbug-free,suchasautomatedtests.Wedescribedwhat ",NA,NA
"unittestsareandhowtheycanhelpusachieveourgoals,butthisisfarfromenough.In ",NA,NA
"thissection,wewilldescribetheprocessofcreatingareal-worldapplication,howunit ",NA,NA
"testsarenotenough,andwhatothertechniqueswecanincludeinthislifecycleinorderto ",NA,NA
"succeedinourtask—inthiscase,behavioraltests.",NA,NA
Introducingcontinuousintegration,NA,NA
Thereisahugedifferencebetweendevelopingasmallwebapplicationbyyourselfand ,NA,NA
"beingpartofabigteamofdevelopers,managers,marketingpeople,andsoon,thatworks ",NA,NA
aroundthesamebigwebapplication.Workingonanapplicationusedbythousandsor ,NA,NA
"millionsofusershasaclearrisk:ifyoumessitup,therewillbeahugenumberof ",NA,NA
"unhappyaffectedusers,whichmaytranslateintosalesgoingdown,partnerships ",NA,NA
"terminated,andsoon.",NA,NA
"Fromthisscenario,youcanimaginethatpeoplewouldbescaredwhentheyhaveto ",NA,NA
"changeanythinginproduction.Beforedoingso,theywillmakesurethateverything ",NA,NA
"worksperfectlyfine.Forthisreason,thereisalwaysaheavyprocessaroundallthe ",NA,NA
"changesaffectingawebapplicationinproduction,includingloadsoftestsofallkinds.",NA,NA
"Somethinkthatbyreducingthenumberoftimestheydeploytoproduction,theycan ",NA,NA
"reducetheriskoffailure,whichendsupwiththemhavingreleaseseveryseveralmonths ",NA,NA
withanuncountablenumberofchanges.,NA,NA
"Now,imaginereleasingtheresultoftwoorthreemonthsofcodechangesatonceand ",NA,NA
somethingmysteriouslyfailsinproduction:doyouknowwheretoevenstartlookingfor ,NA,NA
"thecauseoftheproblem?Whatifyourteamisgoodenoughtomakeperfectreleases,but ",NA,NA
theendresultisnotwhatthemarketneeds?Youmightendupwastingmonthsofwork!,NA,NA
"Eventhoughtherearedifferentapproachesandnotallcompaniesusethem,let’stryto ",NA,NA
describeoneofthemostfamousonesfromthelastfewyears:,NA,NA
continuousintegration ,NA,NA
(,NA,NA
CI,NA,NA
).Theideaistointegratesmallpiecesofworkoftenratherthanbigoneseveryoncein ,NA,NA
"awhile.Ofcourse,releasingisstillaconstraintinyoursystem,whichmeansthatittakes ",NA,NA
"alotoftimeandresources.CItriestoautomatizethisprocessasmuchaspossible, ",NA,NA
reducingtheamountoftimeandresourcesthatyouneedtoinvest.Therearehugebenefits ,NA,NA
"withthisapproach,whichareasfollows:",NA,NA
"Releasesdonottakeforevertobedone,andthereisn’tanentireteamfocusedon ",NA,NA
releasingasthisisdoneautomatically.,NA,NA
"Youcanreleasechangesonebyoneastheycome.Ifsomethingfails,youknow ",NA,NA
exactlywhatthechangewasandwheretostartlookingfortheerror.Youcaneven ,NA,NA
revertthechangeseasilyifyouneedto.,NA,NA
"Asyoureleasesooften,youcangetquickfeedbackfromeveryone.Youwillbeable ",NA,NA
tochangeyourplansintimeifyouneedtoinsteadofwaitingformonthstogetany ,NA,NA
feedbackandwastingalltheeffortyouputonthisrelease.,NA,NA
"Theideaseemsperfect,buthowdoweimplementit?First,let’sfocusonthemanualpart ",NA,NA
oftheprocess:developingthefeaturesusinga,NA,NA
versioncontrolsystem,NA,NA
(,NA,NA
VCS,NA,NA
).The ,NA,NA
followingdiagramshowsaverycommonapproach:,NA,NA
"Aswealreadymentioned,aVCSallowsdeveloperstoworkonthesamecodebase, ",NA,NA
trackingallthechangesthateveryonemakesandhelpingontheresolutionofconflicts.A ,NA,NA
"VCSusuallyallowsyoutohavedifferentbranches;thatis,youcandivergefromthemain ",NA,NA
lineofdevelopmentandcontinuetodoworkwithoutmessingwithit.Thepreviousgraph ,NA,NA
showsyouhowtousebranchestowritenewfeaturesandcanbeexplainedasfollows:,NA,NA
A,NA,NA
:AteamneedstostartworkingonfeatureA.Theycreateanewbranchfromthe ,NA,NA
"master,inwhichtheywilladdallthechangesforthisfeature.",NA,NA
B,NA,NA
:Adifferentteamalsoneedstostartworkingonafeature.Theycreateanew ,NA,NA
"branchfrommaster,sameasbefore.Atthispoint,theyarenotawareofwhatthefirst ",NA,NA
teamisdoingastheydoitontheirownbranch.,NA,NA
C,NA,NA
":Thesecondteamfinishestheirjob.Nooneelsechangedmaster,sotheycan ",NA,NA
"mergetheirchangesstraightaway.Atthispoint,theCIprocesswillstarttherelease ",NA,NA
process.,NA,NA
D,NA,NA
":Thefirstteamfinishesthefeature.Inordertomergeittomaster,theyneedtofirst ",NA,NA
rebasetheirbranchwiththenewchangesofmasterandsolveanyconflictsthatmight ,NA,NA
takeplace.Theolderthebranchisthemorechancesofgettingconflictsyouwill ,NA,NA
"have,soyoucanimaginethatsmallerandfasterfeaturesarepreferred.",NA,NA
"Now,let’stakealookathowtheautomatedsideoftheprocesslooks.Thefollowinggraph ",NA,NA
showsyouallthestepsfromthemergingintomastertoproductiondeployment:,NA,NA
"Untilyoumergeyourcodeintomaster,youareinthedevelopmentenvironment.TheCI ",NA,NA
"toolwilllistentoallthechangesonthemasterbranchofyourproject,andforeachof ",NA,NA
"them,itwilltriggerajob.Thisjobwilltakecareofbuildingtheprojectifnecessaryand ",NA,NA
"thenrunallthetests.Ifthereisanyerrorortestfailure,itwillleteveryonenow,andthe ",NA,NA
teamthattriggeredthisjobshouldtakecareoffixingit.Themasterbranchisconsidered ,NA,NA
unstableatthispoint.,NA,NA
"Ifalltestspass,theCItoolwilldeployyourcodeintostaging.Stagingisanenvironment ",NA,NA
"thatemulatesproductionasmuchaspossible;thatis,ithasthesameserverconfiguration, ",NA,NA
"databasestructure,andsoon.Oncetheapplicationishere,youcanrunalltheteststhat ",NA,NA
youneeduntilyouareconfidenttocontinuethedeploymenttoproduction.Asyoumake ,NA,NA
"smallchanges,youdonotneedtomanuallytestabsolutelyeverything.Instead,youcan ",NA,NA
testyourchangesandthemainusecasesofyourapplication.,NA,NA
Unittestsversusacceptancetests,NA,NA
"WesaidthatthegoalofCIistohaveaprocessasautomatizedaspossible.However,we ",NA,NA
"stillneedtomanuallytesttheapplicationinstaging,right?Acceptanceteststotherescue!",NA,NA
"Writingunittestsisniceandamust,buttheytestonlysmallpiecesofcodeinanisolated ",NA,NA
"way.Evenifyourentireunittestssuitepasses,youcannotbesurethatyourapplication ",NA,NA
worksatallasyoumightnotintegrateallthepartsproperlybecauseyouaremissing ,NA,NA
functionalitiesorthefunctionalitiesthatyoubuiltwerenotwhatthebusinessneeded. ,NA,NA
Acceptanceteststesttheentireflowofaspecificusecase.,NA,NA
"Ifyourapplicationisawebsite,acceptancetestswillprobablylaunchabrowserand ",NA,NA
"emulateuseractions,suchasclickingandtyping,inordertoassertthatthepagereturns ",NA,NA
"whatisexpected.Yes,fromafewlinesofcode,youcanexecutealltheteststhatwere ",NA,NA
previouslymanualinanautomatedway.,NA,NA
"Now,imaginethatyouwroteacceptancetestsforallthefeaturesofyourapplication.Once ",NA,NA
"thecodeisinstaging,theCItoolcanautomaticallyrunallofthesetestsandmakesure ",NA,NA
thatthenewcodedoesnotbreakanyexistingfunctionality.Youcanevenrunthemusing ,NA,NA
asmanydifferentbrowsersasyouneedtomakesurethatyourapplicationworksfinein ,NA,NA
"allofthem.Ifatestfails,theCItoolwillnotifytheteamresponsible,andtheywillhave ",NA,NA
"tofixit.Ifallthetestspass,theCItoolcanautomaticallydeployyourcodeinto ",NA,NA
production.,NA,NA
"Whydoweneedtowriteunitteststhen,ifacceptanceteststestwhatthebusinessreally ",NA,NA
"caresabout?Thereareseveralreasonstokeepbothacceptanceandunittests;infact,you ",NA,NA
shouldhavewaymoreunitteststhanacceptancetests.,NA,NA
"Unittestschecksmallpiecesofcode,whichmakethemorders-of-magnitudefaster ",NA,NA
"thanacceptancetests,whichtestthewholeflowagainstabrowser.Thatmeansthat ",NA,NA
"youcanrunallyourunittestsinafewsecondsorminutes,butitwilltakemuch ",NA,NA
longertorunallyouracceptancetests.,NA,NA
Writingacceptanceteststhatcoverabsolutelyallthepossiblecombinationsofuse ,NA,NA
casesisvirtuallyimpossible.Writingunitteststhatcoverahighpercentageofuse ,NA,NA
casesforagivenmethodorpieceofcodeisrathereasy.Youshouldhaveloadsof ,NA,NA
unitteststestingasmanyedgecasesaspossiblebutonlysomeacceptancetests ,NA,NA
testingthemainusecases.,NA,NA
"Whenshouldyouruneachtypeoftestthen?Asunittestsarefaster,theyshouldbe ",NA,NA
executedduringthefirststagesofdeployment.Onlyonceweknowthattheyallhave ,NA,NA
passeddowewanttospendtimedeployingtostagingandrunningacceptancetests.,NA,NA
TDDversusBDD,NA,NA
In,NA,NA
Chapter7,NA,NA
",",NA,NA
TestingWebApplications,NA,NA
",youlearnedthatTDDortest-drivendevelopment ",NA,NA
isthepracticeofwritingfirsttheunittestsandthenthecodeinanattempttowritetestable ,NA,NA
andcleanercodeandtomakesurethatyourtestsuiteisalwaysuptodate.Withthe ,NA,NA
"appearanceofacceptancetests,TDDevolvedtoBDDorbehavior-drivendevelopment.",NA,NA
"BDDisquitesimilartoTDD,inthatyoushouldwritethetestsfirstandthenthecodethat ",NA,NA
"makesthesetestspass.TheonlydifferenceisthatwithBDD,wewriteteststhatspecify ",NA,NA
"thedesiredbehaviorofthecode,whichcanbetranslatedtoacceptancetests.Eventhough ",NA,NA
"itwillalwaysdependonthesituation,youshouldwriteacceptanceteststhattestavery ",NA,NA
specificpartoftheapplicationratherthanlongusecasesthatcontainseveralsteps.With ,NA,NA
"BDD,aswithTDD,youwanttogetquickfeedback,andifyouwriteabroadtest,youwill ",NA,NA
"havetowritealotofcodeinordertomakeitpass,whichisnotthegoalthatBDDwants ",NA,NA
toachieve.,NA,NA
Businesswritingtests,NA,NA
ThewholepointofacceptancetestsandBDDistomakesurethatyourapplicationworks ,NA,NA
"asexpected,notonlyyourcode.Acceptancetests,then,shouldnotbewrittenby ",NA,NA
"developersbutbythebusinessitself.Ofcourse,youcannotexpectthatmanagersand ",NA,NA
"executiveswilllearnhowtocodeinordertocreateacceptancetests,butthereisabunch ",NA,NA
oftoolsthatallowyoutotranslateplainEnglishinstructionsor,NA,NA
behavioralspecifications ,NA,NA
"intoacceptancetests’code.Ofcourse,theseinstructionshavetofollowsomepatterns.",NA,NA
Behavioralspecificationshavethefollowingparts:,NA,NA
"Atitle,whichdescribesbriefly,butinaveryclearway,whatusecasethebehavioral ",NA,NA
specificationcovers.,NA,NA
"Anarrative,whichspecifieswhoperformsthetest,whatthebusinessvalueis,and ",NA,NA
whattheexpectedoutcomeis.Usuallytheformatofthenarrativeisthefollowing:,"Inorderto<businessvalue> 
  
 Asa<stakeholder> 
  
 Iwantto<expectedoutcome>",NA
"Asetofscenarios,whichisadescriptionandasetofstepsofeachspecificusecase ",NA,NA
thatwewanttocover.Eachscenariohasadescriptionandalistofinstructionsinthe ,Given,NA
-,When,NA
-,Then,NA
format;wewilldiscussmoreonthisinthenextsection.Acommon ,NA,NA
patternsis:,"Scenario:<shortdescription> 
  
 Given<setupscenario> 
  
 When<stepstotake> 
  
 Then<expectedoutcome>",NA
"Inthenexttwosections,wewilldiscovertwotoolsinPHPthatyoucanuseinorderto ",NA,NA
understandbehavioralscenariosandrunthemasacceptancetests.,NA,NA
BDDwithBehat,NA,NA
ThefirstofthetoolswewillintroduceisBehat.BehatisaPHPframeworkthatcan ,NA,NA
"transformbehavioralscenariosintoacceptancetestsandthenrunthem,providing ",NA,NA
feedbacksimilartoPHPUnit.TheideaistomatcheachofthestepsinEnglishwiththe ,NA,NA
scenariosinaPHPfunctionthatperformssomeactionorassertssomeresults.,NA,NA
"Inthissection,wewilltrytoaddsomeacceptanceteststoourapplication.Theapplication ",NA,NA
willbeasimpledatabasemigrationscriptthatwillallowustokeeptrackofthechanges ,NA,NA
thatwewilladdtoourschema.Theideaisthateachtimethatyouwanttochangeyour ,NA,NA
"database,youwillwritethechangesonamigrationfileandthenexecutethescript.The ",NA,NA
applicationwillcheckwhatwasthelastmigrationexecutedandwillperformnewones. ,NA,NA
WewillfirstwritetheacceptancetestsandthenintroducethecodeprogressivelyasBDD ,NA,NA
suggests.,NA,NA
"InordertoinstallBehatonyourdevelopmentenvironment,youcanuseComposer.The ",NA,NA
commandisasfollows:,$composerrequirebehat/behat,NA
"Behatactuallydoesnotcomewithanysetofassertionfunctions,soyouwillhavetoeither ",NA,NA
implementyourownbywritingconditionalsandthrowingexceptionsoryoucould ,NA,NA
integrateanylibrarythatprovidesthem.DevelopersusuallychoosePHPUnitforthisas ,NA,NA
"theyarealreadyusedtoitsassertions.Addit,then,toyourprojectviathefollowing:",$composerrequirephpunit/phpunit,NA
"AswithPHPUnit,Behatneedstoknowwhereyourtestsuiteislocated.Youcaneither ",NA,NA
"haveaconfigurationfilestatingthisandotherconfigurationoptions,whichissimilarto ",NA,NA
the,phpunit.xml,NA
"configurationfileforPHPUnit,oryoucouldfollowtheconventionsthat ",NA,NA
"Behatsetsandskiptheconfigurationstep.Ifyouchoosethesecondoption,youcanlet ",NA,NA
BehatcreatethefolderstructureandPHP,test,NA
classforyouwiththefollowingcommand:,$./vendor/bin/behat--init,NA
"Afterrunningthiscommand,youshouldhavea ",features/bootstrap/FeatureContext.php,NA
"file,whichiswhereyouneedtoaddthesteps ",NA,NA
"ofthePHPfunctions’matchingscenarios.Moreonthisshortly,butfirst,let’sfindouthow ",NA,NA
towritebehavioralspecificationssothatBehatcanunderstandthem.,NA,NA
IntroducingtheGherkinlanguage,NA,NA
"Gherkinisthelanguage,orrathertheformat,thatbehavioralspecificationshavetofollow. ",NA,NA
"UsingGherkinnaming,eachbehavioralspecificationisa",NA,NA
feature,NA,NA
.Eachfeatureisaddedto ,NA,NA
the,features,NA
directoryandshouldhavethe,.feature,NA
extension.Featurefilesshouldstart ,NA,NA
withthe,Feature,NA
keywordfollowedbythetitleandthenarrativeinthesameformatthat ,NA,NA
"wealreadymentionedbefore—thatis,the",NA,NA
Inorderto–Asa–Ineedto,NA,NA
"structure.Infact, ",NA,NA
"Gherkinwillonlyprinttheselines,butkeepingitconsistentwillhelpyourdevelopersand ",NA,NA
businessknowwhattheyaretryingtoachieve.,NA,NA
Ourapplicationwillhavetwofeatures:oneforthesetupofourdatabasetoallowthe ,NA,NA
"migrationstooltowork,andtheotheroneforthecorrectbehaviorwhenadding ",NA,NA
migrationstothedatabase.Addthefollowingcontenttothe,features/setup.feature,NA
file:,"Feature:Setup 
  
 Inordertorundatabasemigrations 
  
 Asadeveloper 
  
 Ineedtobeabletocreatetheemptyschemaandmigrationstable.",NA
"Then,addthefollowingfeaturedefinitiontothe",features/migrations.feature,NA
file:,"Feature:Migrations 
  
 Inordertoaddchangestomydatabaseschema Asadeveloper 
  
 Ineedtobeabletorunthemigrationsscript",NA
Definingscenarios,NA,NA
Thetitleandnarrativeoffeaturesdoesnotreallydoanythingmorethangiveinformation ,NA,NA
"tothepersonwhorunsthetests.Therealworkisdoneinscenarios,whicharespecificuse ",NA,NA
caseswithasetofstepstotakeandsomeassertions.Youcanaddasmanyscenariosas ,NA,NA
youneedtoeachfeaturefileaslongastheyrepresentdifferentusecasesofthesame ,NA,NA
"feature.Forexample,for",setup.feature,NA
",wecanaddacoupleofscenarios:onewhereit ",NA,NA
"isthefirsttimethattheuserrunsthescript,sotheapplicationwillhavetosetupthe ",NA,NA
"database,andonewheretheuseralreadyexecutedthescriptpreviously,sotheapplication ",NA,NA
doesnotneedtogothroughthesetupprocess.,NA,NA
AsBehatneedstobeabletotranslatethescenarioswritteninplainEnglishtoPHP ,NA,NA
"functions,youwillhavetofollowsomeconventions.Infact,youwillseethattheyare ",NA,NA
verysimilartotheonesthatwealreadymentionedinthebehavioralspecificationssection.,NA,NA
WritingGiven-When-Thentestcases,NA,NA
Ascenariomuststartwiththe,Scenario,NA
keywordfollowedbyashortdescriptionofwhat ,NA,NA
"usecasethescenariocovers.Then,youneedtoaddthelistofstepsandassertions.",NA,NA
Gherkinallowsyoutousefourkeywordsforthis:,Given,NA
",",When,NA
",",Then,NA
",and",And,NA
".Infact, ",NA,NA
"theyallhavethesamemeaningwhenitcomestocode,buttheyaddalotofsemantic ",NA,NA
valuetoyourscenarios.Let’sconsideranexample;addthefollowingscenarioattheend ,NA,NA
ofyour,setup.feature,NA
file:,"Scenario:SchemadoesnotexistandIdonothavemigrations 
 GivenIdonothavethe""bdd_db_test""schema 
  
 AndIdonothavemigrationfiles 
  
 WhenIrunthemigrationsscript 
  
 ThenIshouldhaveanemptymigrationstable 
  
 AndIshouldget: 
  
 """""" 
  
 Latestversionappliedis0.
  
 """"""",NA
Thisscenariotestswhathappenswhenwedonothaveanyschemainformationandrun ,NA,NA
"themigrationsscript.First,itdescribesthestateofthescenario:",NA,NA
GivenIdonothavethe ,NA,NA
bdd_db_testschemaAndIdonothavemigrationfiles,NA,NA
.Thesetwolineswillbetranslated ,NA,NA
"toonemethodeach,whichwillremovetheschemaandallmigrationfiles.Then,the ",NA,NA
scenariodescribeswhattheuserwilldo:,NA,NA
WhenIrunthemigrationsscript,NA,NA
".Finally,weset ",NA,NA
theexpectationsforthisscenario:,NA,NA
ThenIshouldhaveanemptymigrationstableAndI ,NA,NA
shouldgetLatestversionappliedis0.,NA,NA
.,NA,NA
"Ingeneral,thesamestepwillalwaysstartbythesamekeyword—thatis,",NA,NA
Irunthe ,NA,NA
migrationsscript,NA,NA
willalwaysbeprecededby,When,NA
.The,And,NA
keywordisaspecialoneasit ,NA,NA
matchesallthethreekeywords;itsonlypurposeistohavestepsasEnglish-friendlyas ,NA,NA
"possible;althoughifyouprefer,youcouldwrite",NA,NA
GivenIdonothavemigrationfiles,NA,NA
.,NA,NA
Anotherthingtonoteinthisexampleistheuseofargumentsaspartofthestep.Theline ,NA,NA
AndIshouldget,NA,NA
isfollowedbyastringenclosedby,"""""""",NA
.ThePHPfunctionwillgetthis ,NA,NA
"stringasanargument,soyoucanhaveoneuniquestepdefinition—thatis,thefunction—",NA,NA
forawidevarietyofsituationsjustusingdifferentstrings.,NA,NA
Reusingpartsofscenarios,NA,NA
"Itisquitecommonthatforagivenfeature,youalwaysstartfromthesamescenario.For ",NA,NA
"example,",setup.feature,NA
hasascenarioinwhichwecanrunthemigrationsforthefirst ,NA,NA
"timewithoutanymigrationfile,butwewillalsoaddanotherscenarioinwhichwewantto ",NA,NA
runthemigrationsscriptforthefirsttimewithsomemigrationfilestomakesurethatit ,NA,NA
willapplyallofthem.Bothscenarioshaveincommononething:theydonothavethe ,NA,NA
databasesetup.,NA,NA
Gherkinallowsyoutodefinesomestepsthatwillbeappliedtoallthescenariosofthe ,NA,NA
feature.Youcanusethe,Background,NA
"keywordandalistofsteps,usually",Given,NA
.Addthese ,NA,NA
twolinesbetweenthe,feature,NA
narrativeand,scenario,NA
definition:,"Background: 
  
 GivenIdonothavethe""bdd_db_test""schema",NA
"Now,youcanremovethefirststepfromtheexistingscenarioas",Background,NA
willtake ,NA,NA
careofit.,NA,NA
Writingstepdefinitions,NA,NA
"Sofar,wehavewrittenfeaturesusingtheGherkinlanguage,butwestillhavenot ",NA,NA
consideredhowanyofthestepsineachscenarioistranslatedtoactualcode.Theeasiest ,NA,NA
waytonotethisisbyaskingBehattoruntheacceptancetests;asthestepsarenotdefined ,NA,NA
"anywhere,Behatwillprintoutallthefunctionsthatyouneedtoaddtoyour ",FeatureContext,NA
"class.Torunthetests,justexecutethefollowingcommand:",$./vendor/bin/behat,NA
Thefollowingscreenshotshowstheoutputthatyoushouldgetifyouhavenostep ,NA,NA
definitions:,NA,NA
"Asyoucannote,Behatcomplainedaboutsomemissingstepsandthenprintedinyellow ",NA,NA
themethodsthatyoucoulduseinordertoimplementthem.Copyandpastetheminto ,NA,NA
yourautogenerated,features/bootstrap/FeatureContext.php,NA
file.Thefollowing ,FeatureContext,NA
classhasalreadyimplementedallofthem:,"<?php
  
 useBehat\Behat\Context\Context; 
  
 useBehat\Behat\Context\SnippetAcceptingContext; 
 useBehat\Gherkin\Node\PyStringNode;
  
 require_once__DIR__.
  
 '/../../vendor/phpunit/phpunit/src/Framework/Assert/Functions.php';
  
 classFeatureContextimplementsContext,SnippetAcceptingContext { 
  
 private$db; 
  
 private$config; 
  
 private$output;
  
 publicfunction__construct(){ 
  
 $configFileContent=file_get_contents( 
  
 __DIR__.'/../../config/app.json' 
  
 ); 
  
 $this->config=json_decode($configFileContent,true); }
  
 privatefunctiongetDb():PDO{ 
  
 if($this->db===null){ 
  
 $this->db=newPDO( 
  
 ""mysql:host={$this->config['host']};"" .""dbname=bdd_db_test"", 
  
 $this->config['user'], 
  
 $this->config['password'] 
  
 ); 
  
 }
  
 return$this->db; 
  
 }
  
 /** 
  
 *@GivenIdonothavethe""bdd_db_test""schema 
  
 */ 
  
 publicfunctioniDoNotHaveTheSchema() 
  
 { 
  
 $this->executeQuery('DROPSCHEMAIFEXISTSbdd_db_test'); }
  
 /** 
  
 *@GivenIdonothavemigrationfiles 
  
 */ 
  
 publicfunctioniDoNotHaveMigrationFiles() 
  
 { 
  
 exec('rmdb/migrations/*.sql>/dev/null2>&1');",NA
"Asyoucannote,wereadtheconfigurationfromthe",config/app.json,NA
file.Thisisthe ,NA,NA
"sameconfigurationfilethattheapplicationwilluse,anditcontainsthedatabase’s ",NA,NA
credentials.Wealsoinstantiateda,PDO,NA
objecttoaccessthedatabasesothatwecouldadd ,NA,NA
orremovetablesortakealookatwhatthescriptdid.,NA,NA
Stepdefinitionsareasetofmethodswithacommentoneachofthem.Thiscommentisan ,NA,NA
annotationasitstartswith,@,NA
andisbasicallyaregularexpressionmatchingtheplain ,NA,NA
Englishstepdefinedinthefeature.Eachofthemhasitsimplementation:eitherremoving ,NA,NA
"adatabaseormigrationfiles,executingthemigrationsscript,orcheckingwhatthe ",NA,NA
migrationstablecontains.,NA,NA
Theparameterizationofsteps,NA,NA
Intheprevious,FeatureContext,NA
"class,weintentionallymissedthe",iShouldGet,NA
method. ,NA,NA
"Asyoumightrecall,thisstephasastringargumentidentifiedbyastringenclosed ",NA,NA
between,"""""""",NA
.Theimplementationforthismethodlooksasfollows:,/**,NA
Notehowtheregularexpressiondoesnotcontainthestring.Thishappenswhenusing ,NA,NA
longstringswith,"""""""",NA
".Also,theargumentisaninstanceof",PyStringNode,NA
",whichisabit ",NA,NA
"morecomplexthananormalstring.However,fearnot;whenyoucompareitwithastring, ",NA,NA
PHPwilllookforthe,__toString,NA
"method,whichjustprintsthecontentofthestring.",NA,NA
Runningfeaturetests,NA,NA
"Intheprevioussections,wewroteacceptancetestsusingBehat,butwehavenotwrittena ",NA,NA
"singlelineofcodeyet.Beforerunningthem,though,addthe",config/app.json,NA
configurationfilewiththecredentialsofyourdatabaseusersothatthe,FeatureContext,NA
"constructorcanfindit,asfollows:","{ 
  
 ""host"":""127.0.0.1"", 
  
 ""schema"":""bdd_db_test"", 
  
 ""user"":""root"", 
  
 ""password"":"""" 
  
 }",NA
"Now,let’sruntheacceptancetests,expectingthemtofail;otherwise,ourtestswillnotbe ",NA,NA
validatall.Theoutputshouldbesomethingsimilartothis:,NA,NA
"Asexpected,the",Then,NA
stepsfailed.Let’simplementtheminimumcodenecessaryinorder ,NA,NA
"tomakethetestspass.Forstarters,addtheautoloaderintoyour",composer.json,NA
fileand ,NA,NA
run,composerupdate,NA
:,"""autoload"":{ 
  
 ""psr-4"":{ 
  
 ""Migrations\\"":""src/"" 
  
 } 
  
 }",NA
Wewouldliketoimplementa,Schema,NA
classthatcontainsthehelpersnecessarytosetupa ,NA,NA
"database,runmigrations,andsoon.Rightnow,thefeatureisonlyconcernedaboutthe ",NA,NA
"setupofthedatabase—thatis,creatingthedatabase,addingtheemptymigrationstableto ",NA,NA
"keeptrackofallthemigrationsadded,andtheabilitytogetthelatestmigrationregistered",NA,NA
assuccessful.Addthefollowingcodeas,src/Schema.php,NA
:,"<?php
  
 namespaceMigrations;
  
 useException; 
  
 usePDO;
  
 classSchema{
  
 constSETUP_FILE=__DIR__.'/../db/setup.sql'; 
  
 constMIGRATIONS_DIR=__DIR__.'/../db/migrations/';
  
 private$config; 
  
 private$connection;
  
 publicfunction__construct(array$config) { 
  
 $this->config=$config; 
  
 }
  
 privatefunctiongetConnection():PDO 
  
 { 
  
 if($this->connection===null){ 
  
 $this->connection=newPDO( 
  
 ""mysql:host={$this->config['host']};"" .""dbname={$this->config['schema']}"", $this-
 >config['user'], 
  
 $this->config['password'] 
  
 ); 
  
 }
  
 return$this->connection; 
  
 } 
  
 }",NA
"Eventhoughthefocusofthischapteristowriteacceptancetests,let’sgothroughthe ",NA,NA
differentimplementedmethods:,NA,NA
Theconstructorand,getConnection,NA
justreadtheconfigurationfilein ,config/app.json,NA
andinstantiatedthe,PDO,NA
object.,NA,NA
The,createSchema,NA
executed,CREATESCHEMAIFNOTEXISTS,NA
",soiftheschema ",NA,NA
"alreadyexists,itwilldonothing.Weexecutedthecommandwith",exec,NA
insteadof,PDO,NA
as,PDO,NA
alwaysneedstouseanexistingdatabase.,NA,NA
The,getLatestMigration,NA
"willfirstcheckwhetherthemigrationstableexists;ifnot, ",NA,NA
wewillcreateitusing,setup.sql,NA
andthenfetchthelastsuccessfulmigration.,NA,NA
Wealsoneedtoaddthe,migrations/setup.sql,NA
filewiththequerytocreatethe ,NA,NA
"migrationstable,asfollows:",CREATETABLEIFNOTEXISTSmigrations(,NA
"Finally,weneedtoaddthe",migrate.php,NA
"file,whichistheonethattheuserwillexecute. ",NA,NA
"Thisfilewillgettheconfiguration,instantiatethe",Schema,NA
"class,setupthedatabase,and ",NA,NA
retrievethelastmigrationapplied.Runthefollowingcode:,"<?php
  
 require_once__DIR__.'/vendor/autoload.php';
  
 $configFileContent=file_get_contents(__DIR__.'/config/app.json'); 
 $config=json_decode($configFileContent,true);
  
 $schema=newMigrations\Schema($config);
  
 $schema->createSchema();
  
 $version=$schema->getLatestMigration(); 
 echo""Latestversionappliedis$version.\n"";",NA
"Youarenowgoodtorunthetestsagain.Thistime,theoutputshouldbesimilartothis ",NA,NA
"screenshot,whereallthestepsareingreen:",NA,NA
"Nowthatouracceptancetestispassing,weneedtoaddtherestofthetests.Tomake ",NA,NA
"thingsquicker,wewilladdallthescenarios,andthenwewillimplementthenecessary ",NA,NA
"codetomakethempass,butitwouldbebetterifyouaddonescenarioatatime.The ",NA,NA
secondscenarioof,setup.feature,NA
couldlookasfollows(rememberthatthefeature ,NA,NA
containsa,Background,NA
"section,inwhichwecleanthedatabase):",NA,NA
"Thisscenarioisimportantasitusedparametersinsidethestepdefinitions.Forexample, ",NA,NA
the,NA,NA
Ihavemigrationfile,NA,NA
"stepispresentedtwice,eachtimewithadifferentmigrationfile ",NA,NA
number.Theimplementationofthisstepisasfollows:,"/** 
  
 *@GivenIhavemigrationfile:version: 
  
 */ 
  
 publicfunctioniHaveMigrationFile( 
  
 string$version, 
  
 PyStringNode$file 
  
 ){ 
  
 $filePath=__DIR__.""/../../db/migrations/$version.sql""; file_put_contents($filePath,$file-
 >getRaw()); 
  
 }",NA
"Theannotationofthismethod,whichisaregularexpression,used",:version,NA
asa ,NA,NA
wildcard.Anystepthatstartswith,NA,NA
GivenIhavemigrationfile,NA,NA
followedbysomethingelse ,NA,NA
"willmatchthisstepdefinition,andthe“somethingelse”bitwillbereceivedasthe ",$version,NA
argumentasastring.,NA,NA
"Here,weintroducedyetanothertypeofargument:tables.The",NA,NA
ThenIshouldonlyhavethe ,NA,NA
followingtables,NA,NA
"stepdefinedatableoftworowsofonecolumneach,andthe",NA,NA
ThenI ,NA,NA
shouldhavethefollowingmigrations,NA,NA
bitsentatableoftworowsoftwocolumnseach.,NA,NA
Theimplementationforthenewstepsisasfollows:,"/** 
  
 *@ThenIshouldonlyhavethefollowingtables: 
  
 */ 
  
 publicfunctioniShouldOnlyHaveTheFollowingTables(TableNode$tables){ $tablesInDb=$this-
 >getDb()
  
 ->query('SHOWTABLES')",NA
Thetablesarereceivedas,TableNode,NA
arguments.Thisclasscontainsa,getRows,NA
method ,NA,NA
thatreturnsanarraywiththerowsdefinedinthefeaturefile.,NA,NA
Theotherfeaturethatwewouldliketoaddis,features/migrations.feature,NA
.This ,NA,NA
"featurewillassumethattheuseralreadyhasthedatabasesetup,sowewilladda ",Background,NA
sectionwiththisstep.Wewilladdonescenarioinwhichthemigrationfile ,NA,NA
"numbersarenotconsecutive,inwhichcasetheapplicationshouldstopatthelast ",NA,NA
"consecutivemigrationfile.Theotherscenariowillmakesurethatwhenthereisanerror, ",NA,NA
theapplicationdoesnotcontinuethemigrationprocess.Thefeatureshouldlooksimilarto ,NA,NA
thefollowing:,"Feature:Migrations 
  
 Inordertoaddchangestomydatabaseschema Asadeveloper 
  
 Ineedtobeabletorunthemigrationsscript
  
 Background: 
  
 GivenIhavethebdd_db_test
  
 Scenario:Migrationsarenotconsecutive 
  
 GivenIhavemigration3 
  
 AndIhavemigrationfile4: 
  
 """""" 
  
 CREATETABLEtest4(idINT); 
  
 """""" 
  
 AndIhavemigrationfile6: 
  
 """""" 
  
 CREATETABLEtest6(idINT); 
  
 """""" 
  
 WhenIrunthemigrationsscript 
  
 ThenIshouldonlyhavethefollowingtables: |migrations| 
  
 |test4| 
  
 AndIshouldhavethefollowingmigrations: |3|success| 
  
 |4|success|",NA
Therearen’tanynewGherkinfeatures.Thetwonewstepimplementationslookas ,NA,NA
follows:,"/** 
  
 *@GivenIhavethebdd_db_test 
  
 */ 
  
 publicfunctioniHaveTheBddDbTest() 
  
 { 
  
 $this->executeQuery('CREATESCHEMAbdd_db_test'); }
  
 /** 
  
 *@GivenIhavemigration:version 
  
 */ 
  
 publicfunctioniHaveMigration(string$version) 
  
 { 
  
 $this->getDb()->exec( 
  
 file_get_contents(__DIR__.'/../../db/setup.sql') );
  
 $query=<<<SQL 
  
 INSERTINTOmigrations(version,status) 
 VALUES(:version,'success')",NA
"Now,itistimetoaddtheneededimplementationtomakethetestspass.Thereareonly ",NA,NA
twochangesneeded.Thefirstoneisan,applyMigrationsFrom,NA
methodinthe,Schema,NA
class ,NA,NA
"that,givenaversionnumber,willtrytoapplythemigrationfileforthisnumber.Ifthe ",NA,NA
"migrationissuccessful,itwilladdarowinthemigrationstable,withthenewversion ",NA,NA
"addedsuccessfully.Ifthemigrationfailed,wewouldaddtherecordinthemigrations ",NA,NA
"tableasafailureandthenthrowanexceptionsothatthescriptisawareofit.Finally,ifthe ",NA,NA
"migrationfiledoesnotexist,thereturningvaluewillbe",false,NA
.Addthiscodetothe ,Schema,NA
class:,"publicfunctionapplyMigrationsFrom(int$version):bool { 
  
 $filePath=self::MIGRATIONS_DIR.""$version.sql"";
  
 if(!file_exists($filePath)){ 
  
 returnfalse; 
  
 }
  
 $connection=$this->getConnection(); 
  
 if($connection->exec(file_get_contents($filePath))===false){ $error=$connection-
 >errorInfo()[2]; 
  
 $this->registerMigration($version,'error'); 
  
 thrownewException($error); 
  
 }
  
 $this->registerMigration($version,'success'); returntrue; 
  
 }
  
 privatefunctionregisterMigration(int$version,string$status) { 
  
 $query=<<<SQL 
  
 INSERTINTOmigrations(version,status) 
  
 VALUES(:version,:status) 
  
 SQL; 
  
 $params=['version'=>$version,'status'=>$status];
  
 $this->getConnection()->prepare($query)->execute($params); }",NA
Theotherbitmissingisinthe,migrate.php,NA
script.Weneedtocallthenewlycreated ,applyMigrationsFrom,NA
"methodwithconsecutiveversionsstartingfromthelatestone,until ",NA,NA
wegeteithera,false,NA
valueoranexception.Wealsowanttoprintoutinformationabout ,NA,NA
whatisgoingonsothattheuserisawareofwhatmigrationswereadded.Addthe ,NA,NA
followingcodeattheendofthe,migrate.php,NA
script:,"do{ 
  
 $version++;",NA
"Now,runthetestsandvoilà!Theyallpass.Younowhavealibrarythatmanagesdatabase ",NA,NA
"migrations,andyouare100%surethatitworksthankstoyouracceptancetests.",NA,NA
TestingwithabrowserusingMink,NA,NA
"Sofar,wehavebeenabletowriteacceptancetestsforascript,butmostofyouarereading ",NA,NA
thisbookinordertowriteniceandshinywebapplications.Howcanyoutakeadvantage ,NA,NA
ofacceptanceteststhen?ItistimetointroducethesecondPHPtoolofthischapter:Mink.,NA,NA
"MinkisactuallyanextensionofBehat,whichaddsimplementationsofseveralsteps ",NA,NA
"relatedtowebbrowsertesting.Forexample,ifyouaddMinktoyourapplication,youwill ",NA,NA
"beabletoaddscenarioswhereMinkwilllaunchabrowserandclickortypeasrequested, ",NA,NA
"savingyoualotoftimeandeffortinmanualtesting.However,first,let’stakealookat ",NA,NA
howMinkcanachievethis.,NA,NA
Typesofwebdrivers,NA,NA
"Minkmakesuseofwebdrivers—thatis,librariesthathaveanAPIthatallowsyouto ",NA,NA
"interactwithabrowser.Youcansendcommands,suchas",NA,NA
gotothispage,NA,NA
",",NA,NA
clickonthis ,NA,NA
link,NA,NA
",",NA,NA
fillthisinputfieldwiththistext,NA,NA
",andsoon,andthewebdriverwilltranslatethisinto ",NA,NA
"thecorrectinstructionforyourbrowser.Thereareseveralwebdrivers,eachofthem ",NA,NA
implementedfollowingadifferentapproach.Itisforthisreasonthatdependingonthe ,NA,NA
"webdriver,youwillhavesomefeaturesorothers.",NA,NA
Webdriverscanbedividedintotwogroupsdependingonhowtheywork:,NA,NA
Headlessbrowsers,NA,NA
:Thesedriversdonotreallylaunchabrowser;theyonlytryto ,NA,NA
emulateone.TheyactuallyrequestforthewebpageandrendertheHTMLand ,NA,NA
"JavaScriptcode,sotheyareawareofhowthepagelooks,buttheydonotdisplayit.",NA,NA
"Theyhaveahugebenefit:theyareeasytoinstallandmanage,andastheydonot ",NA,NA
"havetobuildthegraphicalrepresentation,theyareextremelyfast.Thedisadvantag",NA,NA
e isthattheyhavesevererestrictionsintermsofCSSandsomeJavaScript ,NA,NA
"functionalities,especiallyAJAX.",NA,NA
Webdriversthatlaunchrealbrowserslikeauserwoulddo,NA,NA
:Thesewebdrivers ,NA,NA
candoalmostanythingandarewaymorepowerfulthanheadlessbrowsers.The ,NA,NA
"problemisthattheycanbeabittrickytoinstallandarevery,veryslow—asslowas ",NA,NA
arealusertryingtogothroughthescenarios.,NA,NA
"So,whichoneshouldyouchoose?Asalways,itwilldependonwhatyourapplicationis. ",NA,NA
IfyouhaveanapplicationthatdoesnotmakeheavyuseofCSSandJavaScriptanditis ,NA,NA
"notcriticalforyourbusiness,youcoulduseheadlessbrowsers.Instead,iftheapplication ",NA,NA
isthecornerstoneofyourbusinessandyouneedtobeabsolutelycertainthatalltheUI ,NA,NA
"featuresworkasexpected,youmightwanttogoforwebdriversthatlaunchbrowsers.",NA,NA
InstallingMinkwithGoutte,NA,NA
"Inthischapter,wewilluse",NA,NA
Goutte,NA,NA
",aheadlesswebdriverwrittenbythesameguysthat ",NA,NA
workedon,NA,NA
Symfony,NA,NA
",toaddsomeacceptanceteststotherepositoriespageofGitHub.The ",NA,NA
"requiredcomponentsofyourprojectwillbeBehat,Mink,andtheGouttedriver.Addthem ",NA,NA
withComposerviathefollowingcommands:,"$composerrequirebehat/behat 
  
 $composerrequirebehat/mink-extension 
 $composerrequirebehat/mink-goutte-driver",NA
"Now,executethefollowinglinetoaskBehattocreatethebasicdirectorystructure:",$./vendor/bin/behat–init,NA
Theonlychangewewilladdtothe,FeatureContext,NA
classiswhereitextendsfrom.This ,NA,NA
"time,wewilluse",MinkContext,NA
inordertogetallthestepdefinitionsrelatedtoweb ,NA,NA
testing.The,FeatureContext,NA
classshouldlooksimilartothis:,"<?php
  
 useBehat\MinkExtension\Context\MinkContext;
  
 require__DIR__.'/../../vendor/autoload.php';
  
 classFeatureContextextendsMinkContext{ }",NA
MinkalsoneedssomeconfigurationinordertoletBehatknowwhichwebdriverwewant ,NA,NA
touseorwhatthebaseURLforourtestsis.Addthefollowinginformationto,behat.yml,NA
:,"default: 
  
 extensions: 
  
 Behat\MinkExtension: 
  
 base_url:""https://github.com"" 
  
 sessions: 
  
 default_session: 
  
 goutte:~",NA
"Withthisconfiguration,weletBehatknowthatweareusingtheMinkextension,that ",NA,NA
MinkwilluseGoutteinallthesessions(youcouldactuallydefinedifferentsessionswith ,NA,NA
"differentwebdriversifnecessary),andthatthebaseURLforthesetestsistheGitHub ",NA,NA
one.Behatisalreadyinstructedtolookforthe,behat.yml,NA
fileinthesamedirectorythat ,NA,NA
"weexecuteditin,sothereisnothingelsethatweneedtodo.",NA,NA
Interactionwiththebrowser,NA,NA
"Now,let’slookatthemagic.Ifyouknowthestepstouse,writingacceptancetestswith ",NA,NA
"Minkwillbelikeagame.First,addthefollowingfeaturein",feature/search.feature,NA
:,"Feature:Search 
  
 Inordertofindrepositories 
  
 Asawebsiteuser 
  
 Ineedtobeabletosearchrepositoriesbyname
  
 Background: 
  
 GivenIamon""/picahielos"" 
  
 AndIfollow""Repositories""
  
 Scenario:Searchingexistingrepository 
 WhenIfillin""zap""for""q"" 
  
 AndIpress""Search"" 
  
 ThenIshouldsee""picahielos/zap""
  
 Scenario:Searchingnon-existingrepository 
 WhenIfillin""yolo""for""q"" 
  
 AndIpress""Search"" 
  
 ThenIshouldnotsee""picahielos/yolo""",NA
Thefirstthingtonoteisthatwehavea,Background,NA
section.Thissectionassumesthatthe ,NA,NA
uservisitedthe,NA,NA
https://github.com/picahielos,NA,NA
pageandclickedonthe,NA,NA
Repositories,NA,NA
lin,NA,NA
k. Using,NA,NA
Ifollow,NA,NA
withsomestringistheequivalentoftryingtofindalinkwiththisstring ,NA,NA
andclickingonit.,NA,NA
Thefirstscenariousedthe,NA,NA
WhenIfill<field>with<value>,NA,NA
"step,whichbasicallytriesto ",NA,NA
"findtheinputfieldonthepage(youcaneitherspecifytheIDorname),andtypesthe ",NA,NA
"valueforyou.Inthiscase,the",q,NA
"fieldwasthesearchbar,andwetyped",zap,NA
".Then,similar ",NA,NA
"towhenclickingonthelinks,the",NA,NA
Ipress<button>,NA,NA
"linewilltrytofindthebuttonbyname, ",NA,NA
"ID,orvalue,andwillclickonit.Finally,",NA,NA
ThenIshouldsee,NA,NA
followedbyastringwillassert ,NA,NA
"thatthegivenstringcouldbefoundonthepage.Inshort,thetestlaunchedabrowser, ",NA,NA
"goingtothespecifiedURL,clickingonthe",NA,NA
Repositories,NA,NA
"link,searchingforthe",zap,NA
"repository,andassertingthatitcouldfindit.Inasimilarway,thesecondscenariotriedto ",NA,NA
findarepositorythatdoesnotexist.,NA,NA
"Ifyourunthetests,theyshouldpass,butyouwillnotseeanybrowser.Rememberthat ",NA,NA
"Goutteisaheadlessbrowserwebdriver.However,checkhowfastthesetestsare ",NA,NA
"executed;inmylaptop,ittooklessthan3seconds!Canyouimagineanyoneperforming ",NA,NA
thesetwotestsmanuallyinlessthanthistime?,NA,NA
Onelastthing:havingacheatsheetofpredefinedMinkstepsisoneofthehandiestthings ,NA,NA
tohavenearyourdesk;youcanfindoneat,NA,NA
http://blog.lepine.pro/images/2012-03-,NA,NA
behat-cheat-sheet-en.pdf,NA,NA
".Asyoucansee,wedidnotwriteasinglelineofcode,andwestill ",NA,NA
"havetwotestsmakingsurethatthewebsiteworksasexpected.Also,ifyouneedtoadda ",NA,NA
"fancierstep,donotworry;youcanstillimplementyourstepdefinitionsaswedidinBehat ",NA,NA
previouslywhiletakingadvantageofthewebdriver’sinterfacethatMinkprovides.We ,NA,NA
recommendyoutogothroughtheofficialdocumentationinordertotakealookatthe,NA,NA
completelistofthingsthatyoucandowithMink.,NA,NA
Summary,NA,NA
"Inthisconcludingchapter,youlearnedhowimportantitistocoordinatethebusinesswith ",NA,NA
"theapplication.Forthis,yousawwhatBDDisandhowtoimplementitwithyourPHP ",NA,NA
webapplicationsusingBehatandMink.ThisalsogivesyoutheabilitytotesttheUIwith ,NA,NA
"webdrivers,whichyoucouldnotdoitwithunittestsandPHPUnit.Now,youcanmake ",NA,NA
"surethatnotonlyisyourapplicationbug-freeandsecure,butalsothatitdoeswhatthe ",NA,NA
businessneedsittodo.,NA,NA
Congratulationsonreachingtheendofthebook!Youstartedasaninexperienced ,NA,NA
"developer,butnowyouareabletowritesimpleandcomplexwebsitesandRESTAPIs ",NA,NA
withPHPandhaveanextensiveknowledgeofgoodtestpractices.Youhaveevenworked ,NA,NA
"withacoupleoffamousPHPframeworks,soyouarereadytoeitherstartanewproject ",NA,NA
withthemorjoinateamthatusesoneofthem.,NA,NA
"Now,youmightbewondering:whatdoIdonext?Youalreadyknowthetheory—well, ",NA,NA
someofit—sowewouldrecommendthatyoupracticealot.Thereareseveralwaysyou ,NA,NA
"candothis:bycreatingyourownapplication,joiningateamworkingonopensource ",NA,NA
"projects,orworkingforacompany.Trytokeepuptodatewithnewreleasesofthe ",NA,NA
"languageorthetoolsandframeworks,discoveranewframeworkfromtimetotime,and ",NA,NA
neverstopreading.Expandingyoursetofskillsisalwaysagreatidea!,NA,NA
"Ifyourunoutofideasonwhattoreadnext,herearesomehints.Wedidnotgothrough ",NA,NA
"thefrontendparttoomuch,soyoumightbeinterestedinreadingaboutCSSandspecially ",NA,NA
"JavaScript.JavaScripthasbecomethemaincharacterintheselastfewyears,sodonot ",NA,NA
missitout.Ifyouareratherinterestedinthebackendsideandhowtomanageapplications ,NA,NA
"properly,trydiscoveringnewtechnologies,suchascontinuousintegrationtoolssimilarto ",NA,NA
"Jenkins.Finally,ifyouprefertofocusonthetheoryand“science”side,youcanread ",NA,NA
abouthowtowritequalitycodewith,NA,NA
CodeComplete,NA,NA
",",NA,NA
SteveMcConnell,NA,NA
",orhowtomake ",NA,NA
gooduseofdesignpatternswith,NA,NA
DesignPatterns:ElementsofReusableObject-Oriented ,NA,NA
Software,NA,NA
",",NA,NA
"ErichGamma,JohnVlissides,RalphJohnson,andRichardHelm",NA,NA
",agangof four.",NA,NA
Alwaysenjoyandhavefunwhendeveloping.Always!,NA,NA
Index,NA,NA
A,NA,NA
abstractclasses ,NA,NA
about/,NA,NA
Abstractclasses ,NA,NA
acceptancetests ,NA,NA
about/,NA,NA
Typesoftests ,NA,NA
versusunittests/,NA,NA
Unittestsversusacceptancetests ,NA,NA
aliases ,NA,NA
URL/,NA,NA
Managingdependencies ,NA,NA
anonymousfunctions ,NA,NA
about/,NA,NA
Anonymousfunctions ,NA,NA
Apache ,NA,NA
reference/,NA,NA
ThePHPbuilt-inserver ,NA,NA
API ,NA,NA
about/,NA,NA
IntroducingAPIs ,NA,NA
APIs ,NA,NA
"testing,withbrowsers/",NA,NA
TestingAPIswithbrowsers,NA,NA
"testing,withcommandline/",NA,NA
TestingAPIsusingthecommandline ,NA,NA
argumentsbyvalue ,NA,NA
versusargumentsbyreference/,NA,NA
Functionarguments ,NA,NA
arithmeticoperators ,NA,NA
about/,NA,NA
Arithmeticoperators ,NA,NA
arrayfunctions ,NA,NA
about/,NA,NA
Otherarrayfunctions,NA,NA
arrays ,NA,NA
about/,NA,NA
Arrays ,NA,NA
initializing/,NA,NA
Initializingarrays ,NA,NA
populating/,NA,NA
Populatingarrays ,NA,NA
accessing/,NA,NA
Accessingarrays ,NA,NA
issetfunction/,NA,NA
Theemptyandissetfunctions ,NA,NA
emptyfunction/,NA,NA
Theemptyandissetfunctions,NA,NA
"elements,searchingin/",NA,NA
Searchingforelementsinanarray ,NA,NA
ordering/,NA,NA
Orderingarrays ,NA,NA
assertions ,NA,NA
about/,NA,NA
Assertions ,NA,NA
reference/,NA,NA
Assertions ,NA,NA
assignmentoperators ,NA,NA
about/,NA,NA
Assignmentoperators,NA,NA
authentication ,NA,NA
about/,NA,NA
RESTAPIsecurity ,NA,NA
authorization ,NA,NA
about/,NA,NA
RESTAPIsecurity,NA,NA
autoloader,NA,NA
about/,NA,NA
Autoloadingclasses ,NA,NA
autoloading ,NA,NA
about/,NA,NA
Autoloadingclasses,NA,NA
B,NA,NA
BDD ,NA,NA
versusTDD/,NA,NA
TDDversusBDD ,NA,NA
"BDD,withBehat ",NA,NA
about/,NA,NA
BDDwithBehat ,NA,NA
Behat ,NA,NA
about/,NA,NA
BDDwithBehat,NA,NA
behavior-drivendevelopment ,NA,NA
about/,NA,NA
Behavior-drivendevelopment ,NA,NA
behavioralspecifications ,NA,NA
about/,NA,NA
Businesswritingtests ,NA,NA
"bestpractices,RESTAPIs ",NA,NA
about/,NA,NA
BestpracticeswithRESTAPIs ,NA,NA
"consistency,inendpoints/",NA,NA
Consistencyinyourendpoints ,NA,NA
documenting/,NA,NA
Documentasmuchasyoucan ,NA,NA
filters/,NA,NA
Filtersandpagination ,NA,NA
pagination/,NA,NA
Filtersandpagination ,NA,NA
APIversioning/,NA,NA
APIversioning ,NA,NA
"HTTPcache,using/",NA,NA
UsingHTTPcache ,NA,NA
browsers ,NA,NA
"APIs,testingwith/",NA,NA
TestingAPIswithbrowsers ,NA,NA
businesswritingtests ,NA,NA
about/,NA,NA
Businesswritingtests,NA,NA
C,NA,NA
cachelayer ,NA,NA
about/,NA,NA
Cache ,NA,NA
callable ,NA,NA
about/,NA,NA
Anonymousfunctions ,NA,NA
casting ,NA,NA
about/,NA,NA
Gettinginformationfromtheuser,NA,NA
versustypejuggling/,NA,NA
Gettinginformationfromtheuser ,NA,NA
Cforcontroller ,NA,NA
defining/,NA,NA
Cforcontroller ,NA,NA
errorcontroller/,NA,NA
Theerrorcontroller ,NA,NA
logincontroller/,NA,NA
Thelogincontroller ,NA,NA
bookcontroller/,NA,NA
Thebookcontroller ,NA,NA
"books,borrowing/",NA,NA
Borrowingbooks ,NA,NA
salescontroller/,NA,NA
Thesalescontroller ,NA,NA
class ,NA,NA
about/,NA,NA
Classesandobjects ,NA,NA
classconstructors ,NA,NA
about/,NA,NA
Classconstructors ,NA,NA
classes ,NA,NA
conventions/,NA,NA
Propertiesandmethodsvisibility ,NA,NA
autoloading/,NA,NA
Autoloadingclasses ,NA,NA
classmethods ,NA,NA
about/,NA,NA
Classmethods ,NA,NA
classproperties ,NA,NA
about/,NA,NA
Classproperties ,NA,NA
codecoverage ,NA,NA
about/,NA,NA
Unittestsandcodecoverage ,NA,NA
commandline ,NA,NA
"APIs,testingwith/",NA,NA
TestingAPIsusingthecommandline ,NA,NA
comparisonoperators ,NA,NA
about/,NA,NA
Comparisonoperators ,NA,NA
"components,frameworks ",NA,NA
router/,NA,NA
Themainpartsofaframework ,NA,NA
request/,NA,NA
Themainpartsofaframework ,NA,NA
configurationhandler/,NA,NA
Themainpartsofaframework ,NA,NA
templateengine/,NA,NA
Themainpartsofaframework ,NA,NA
logger/,NA,NA
Themainpartsofaframework ,NA,NA
dependencyinjector/,NA,NA
Themainpartsofaframework ,NA,NA
Composer ,NA,NA
reference/,NA,NA
InstallingComposer ,NA,NA
using/,NA,NA
UsingComposer ,NA,NA
"dependencies,managing/",NA,NA
Managingdependencies,NA,NA
"autoloader,withPSR-4/",NA,NA
AutoloaderwithPSR-4,NA,NA
"metadata,adding/",NA,NA
Addingmetadata ,NA,NA
index.phpfile/,NA,NA
Theindex.phpfile ,NA,NA
conditionals ,NA,NA
about/,NA,NA
Controlstructures,NA,NA
",",NA,NA
Conditionals ,NA,NA
constraints ,NA,NA
about/,NA,NA
Keysandconstraints ,NA,NA
continuousintegration(CI),NA,NA
about/,NA,NA
Introducingcontinuousintegration ,NA,NA
controllers ,NA,NA
about/,NA,NA
TheMVCpattern ,NA,NA
controlstructures ,NA,NA
about/,NA,NA
Controlstructures ,NA,NA
conditionals/,NA,NA
Conditionals ,NA,NA
switch…case/,NA,NA
Switch…case,NA,NA
loops/,NA,NA
Loops ,NA,NA
cookies ,NA,NA
"data,persistingwith/",NA,NA
Persistingdatawithcookies ,NA,NA
CSS ,NA,NA
about/,NA,NA
"HTML,CSS,andJavaScript ",NA,NA
cURL ,NA,NA
about/,NA,NA
Settinguptheapplication,NA,NA
D,NA,NA
data ,NA,NA
"persisting,withcookies/",NA,NA
Persistingdatawithcookies ,NA,NA
inserting/,NA,NA
Insertingdata ,NA,NA
querying/,NA,NA
Queryingdata ,NA,NA
updating/,NA,NA
Updatinganddeletingdata,NA,NA
",",NA,NA
Updatingdata ,NA,NA
deleting/,NA,NA
Deletingdata,NA,NA
databases ,NA,NA
versusfiles/,NA,NA
Writingfiles ,NA,NA
about/,NA,NA
Introducingdatabases ,NA,NA
MySQL/,NA,NA
MySQL ,NA,NA
"databases,datatypes ",NA,NA
about/,NA,NA
Databasedatatypes ,NA,NA
numericdatatypes/,NA,NA
Numericdatatypes ,NA,NA
stringdatatypes/,NA,NA
Stringdatatypes ,NA,NA
listofvalues/,NA,NA
Listofvalues ,NA,NA
dateandtimedatatypes/,NA,NA
Dateandtimedatatypes ,NA,NA
databasetesting ,NA,NA
about/,NA,NA
Databasetesting ,NA,NA
dataproviders ,NA,NA
about/,NA,NA
Dataproviders ,NA,NA
dataproviding ,NA,NA
about/,NA,NA
Dataproviders ,NA,NA
DataSourceName(DSN)/,NA,NA
Connectingtothedatabase ,NA,NA
datatypes ,NA,NA
about/,NA,NA
Datatypes ,NA,NA
Booleans/,NA,NA
Datatypes ,NA,NA
integers/,NA,NA
Datatypes ,NA,NA
floats/,NA,NA
Datatypes ,NA,NA
strings/,NA,NA
Datatypes ,NA,NA
reference/,NA,NA
Databasedatatypes ,NA,NA
dateandtimedatatypes ,NA,NA
about/,NA,NA
Dateandtimedatatypes ,NA,NA
referencelink/,NA,NA
Dateandtimedatatypes ,NA,NA
decrementingoperators ,NA,NA
about/,NA,NA
Incrementinganddecrementingoperators ,NA,NA
DELETEmethod/,NA,NA
DELETE ,NA,NA
dependencyinjection ,NA,NA
defining/,NA,NA
Dependencyinjection ,NA,NA
about/,NA,NA
Dependencyinjection ,NA,NA
needfor/,NA,NA
Whyisdependencyinjectionnecessary?,NA,NA
dependencyinjector ,NA,NA
implementing/,NA,NA
Implementingourowndependencyinjector,NA,NA
designpatterns,NA,NA
about/,NA,NA
Designpatterns ,NA,NA
factory/,NA,NA
Factory ,NA,NA
singleton/,NA,NA
Singleton ,NA,NA
DesignPatternsPHP ,NA,NA
reference/,NA,NA
Designpatterns ,NA,NA
DI ,NA,NA
"models,injectingwith/",NA,NA
InjectingmodelswithDI,NA,NA
doubles ,NA,NA
testingwith/,NA,NA
Testingwithdoubles ,NA,NA
do…whileloop/,NA,NA
Do…while,NA,NA
E,NA,NA
elements ,NA,NA
"searching,inarray/",NA,NA
Searchingforelementsinanarray ,NA,NA
EloquentJavaScript ,NA,NA
reference/,NA,NA
"HTML,CSS,andJavaScript ",NA,NA
emptyfunction ,NA,NA
about/,NA,NA
Theemptyandissetfunctions,NA,NA
encapsulation ,NA,NA
about/,NA,NA
Encapsulation ,NA,NA
environment ,NA,NA
"settingup,withVagrant/",NA,NA
SettinguptheenvironmentwithVagrant ,NA,NA
"environmentsetup,onOSX ",NA,NA
about/,NA,NA
SettinguptheenvironmentonOSX ,NA,NA
"PHP,installing/",NA,NA
InstallingPHP ,NA,NA
"MySQL,installing/",NA,NA
InstallingMySQL ,NA,NA
"Nginx,installing/",NA,NA
InstallingNginx ,NA,NA
"Composer,installing/",NA,NA
InstallingComposer ,NA,NA
"environmentsetup,onUbuntu ",NA,NA
about/,NA,NA
SettinguptheenvironmentonUbuntu ,NA,NA
"PHP,installing/",NA,NA
InstallingPHP ,NA,NA
"MySQL,installing/",NA,NA
InstallingMySQL ,NA,NA
"Nginx,installing/",NA,NA
InstallingNginx ,NA,NA
"environmentsetup,onWindows ",NA,NA
about/,NA,NA
SettinguptheenvironmentonWindows ,NA,NA
"PHP,installing/",NA,NA
InstallingPHP ,NA,NA
"MySQL,installing/",NA,NA
InstallingMySQL ,NA,NA
"Nginx,installing/",NA,NA
InstallingNginx ,NA,NA
"Composer,installing/",NA,NA
InstallingComposer ,NA,NA
escapecharacters ,NA,NA
about/,NA,NA
Workingwithstrings ,NA,NA
exceptionhandling ,NA,NA
try…catchblock/,NA,NA
Thetry…catchblock ,NA,NA
finallyblock/,NA,NA
Thefinallyblock ,NA,NA
exceptions ,NA,NA
handling/,NA,NA
Handlingexceptions ,NA,NA
catching/,NA,NA
Catchingdifferenttypesofexceptions ,NA,NA
exitcondition/,NA,NA
For ,NA,NA
expectingexceptions ,NA,NA
about/,NA,NA
Expectingexceptions ,NA,NA
expression ,NA,NA
about/,NA,NA
Operators,NA,NA
F,NA,NA
factorydesignpattern,NA,NA
about/,NA,NA
Factory ,NA,NA
feature,NA,NA
about/,NA,NA
IntroducingtheGherkinlanguage ,NA,NA
"features,frameworks",NA,NA
about/,NA,NA
Otherfeaturesofframeworks,NA,NA
authentication/,NA,NA
Authenticationandroles,NA,NA
roles/,NA,NA
Authenticationandroles,NA,NA
Object-relationalmapping(ORM)/,NA,NA
ORM,NA,NA
cache/,NA,NA
Cache,NA,NA
internationalization/,NA,NA
Internationalization ,NA,NA
featuretests,NA,NA
running/,NA,NA
Runningfeaturetests ,NA,NA
fetchmode,NA,NA
advantages/,NA,NA
Thebookmodel,NA,NA
disadvantages/,NA,NA
Thebookmodel ,NA,NA
fields,NA,NA
about/,NA,NA
Schemasandtables ,NA,NA
"fields,table",NA,NA
NOTNULL/,NA,NA
Managingtables,NA,NA
UNSIGNED/,NA,NA
Managingtables,NA,NA
DEFAULT<value>/,NA,NA
Managingtables ,NA,NA
files,NA,NA
reading/,NA,NA
Readingfiles,NA,NA
writing/,NA,NA
Writingfiles,NA,NA
versusdatabases/,NA,NA
Writingfiles ,NA,NA
filesystem,NA,NA
about/,NA,NA
Thefilesystem ,NA,NA
filesystemfunctions,NA,NA
about/,NA,NA
Otherfilesystemfunctions ,NA,NA
finallyblock,NA,NA
about/,NA,NA
Thefinallyblock ,NA,NA
foreachloop/,NA,NA
Foreach ,NA,NA
foreignkeybehaviors/,NA,NA
Foreignkeybehaviors ,NA,NA
foreignkeys,NA,NA
about/,NA,NA
Foreignkeys ,NA,NA
forloop/,NA,NA
For ,NA,NA
"foundations,RESTAPIs",NA,NA
HTTPrequestmethods/,NA,NA
HTTPrequestmethods,NA,NA
"statuscodes,inresponses/",NA,NA
Statuscodesinresponses,NA,NA
RESTAPIsecurity/,NA,NA
RESTAPIsecurity ,NA,NA
"framework,types",NA,NA
about/,NA,NA
Typesofframeworks,NA,NA
complete/,NA,NA
Completeandrobustframeworks ,NA,NA
robust/,NA,NA
Completeandrobustframeworks ,NA,NA
lightweight/,NA,NA
Lightweightandflexibleframeworks ,NA,NA
flexible/,NA,NA
Lightweightandflexibleframeworks ,NA,NA
frameworks ,NA,NA
reviewing/,NA,NA
Reviewingframeworks ,NA,NA
purpose/,NA,NA
Thepurposeofframeworks,NA,NA
parts/,NA,NA
Themainpartsofaframework ,NA,NA
components/,NA,NA
Themainpartsofaframework ,NA,NA
features/,NA,NA
Otherfeaturesofframeworks ,NA,NA
overview/,NA,NA
Anoverviewoffamousframeworks ,NA,NA
Symfony2/,NA,NA
Symfony2 ,NA,NA
ZendFramework2/,NA,NA
ZendFramework2 ,NA,NA
functionarguments/,NA,NA
Functionarguments,NA,NA
functions ,NA,NA
about/,NA,NA
Functions ,NA,NA
declaring/,NA,NA
Functiondeclaration ,NA,NA
"functions,arrays ",NA,NA
reference/,NA,NA
Orderingarrays,NA,NA
",",NA,NA
Otherarrayfunctions ,NA,NA
"functions,dateandtimedatatypes ",NA,NA
DAY()/,NA,NA
Dateandtimedatatypes,NA,NA
MONTH()/,NA,NA
Dateandtimedatatypes ,NA,NA
YEAR()/,NA,NA
Dateandtimedatatypes ,NA,NA
HOUR()/,NA,NA
Dateandtimedatatypes ,NA,NA
MINUTE()/,NA,NA
Dateandtimedatatypes ,NA,NA
SECOND()/,NA,NA
Dateandtimedatatypes ,NA,NA
CURRENT_DATE()/,NA,NA
Dateandtimedatatypes ,NA,NA
CURRENT_TIME()/,NA,NA
Dateandtimedatatypes,NA,NA
NOW()/,NA,NA
Dateandtimedatatypes ,NA,NA
DATE_FORMAT()/,NA,NA
Dateandtimedatatypes ,NA,NA
DATE_ADD()/,NA,NA
Dateandtimedatatypes ,NA,NA
"functions,PDO ",NA,NA
beginTransaction/,NA,NA
Workingwithtransactions ,NA,NA
commit/,NA,NA
Workingwithtransactions ,NA,NA
rollBack/,NA,NA
Workingwithtransactions ,NA,NA
"functions,PHPfiles ",NA,NA
include/,NA,NA
PHPfiles ,NA,NA
require/,NA,NA
PHPfiles ,NA,NA
include_once/,NA,NA
PHPfiles ,NA,NA
require_once/,NA,NA
PHPfiles ,NA,NA
"functions,strings ",NA,NA
reference/,NA,NA
Workingwithstrings ,NA,NA
strlen/,NA,NA
Workingwithstrings,NA,NA
trim/,NA,NA
Workingwithstrings,NA,NA
strtolower/,NA,NA
Workingwithstrings,NA,NA
strtoupper/,NA,NA
Workingwithstrings,NA,NA
str_replace/,NA,NA
Workingwithstrings,NA,NA
substr/,NA,NA
Workingwithstrings,NA,NA
strpos/,NA,NA
Workingwithstrings,NA,NA
G,NA,NA
GETmethod/,NA,NA
GET ,NA,NA
getter,NA,NA
about/,NA,NA
Encapsulation ,NA,NA
Gherkin,NA,NA
about/,NA,NA
IntroducingtheGherkinlanguage ,NA,NA
Given-When-Thentestcases,NA,NA
writing/,NA,NA
WritingGiven-When-Thentestcases ,NA,NA
Goutte,NA,NA
"Mink,installingwith/",NA,NA
InstallingMinkwithGoutte ,NA,NA
GraphicalUserInterface(GUI),NA,NA
about/,NA,NA
MySQL ,NA,NA
Guzzle,NA,NA
about/,NA,NA
Settinguptheapplication,NA,NA
H,NA,NA
HTML ,NA,NA
about/,NA,NA
"HTML,CSS,andJavaScript ",NA,NA
HTMLforms ,NA,NA
about/,NA,NA
HTMLforms ,NA,NA
HTTP ,NA,NA
about/,NA,NA
TheHTTPprotocol,NA,NA
"HTTPmessage,parts ",NA,NA
about/,NA,NA
Partsofthemessage ,NA,NA
URI/,NA,NA
URL ,NA,NA
HTTPmethod/,NA,NA
TheHTTPmethod ,NA,NA
body/,NA,NA
Body ,NA,NA
headers/,NA,NA
Headers ,NA,NA
statuscode/,NA,NA
Thestatuscode ,NA,NA
HTTPmethod ,NA,NA
about/,NA,NA
TheHTTPmethod ,NA,NA
GET/,NA,NA
TheHTTPmethod ,NA,NA
POST/,NA,NA
TheHTTPmethod ,NA,NA
PUT/,NA,NA
TheHTTPmethod ,NA,NA
DELETE/,NA,NA
TheHTTPmethod ,NA,NA
OPTION/,NA,NA
TheHTTPmethod ,NA,NA
HTTPprotocol ,NA,NA
about/,NA,NA
TheHTTPprotocol ,NA,NA
"interchangeofmessages,example/",NA,NA
Asimpleexample ,NA,NA
complexexample/,NA,NA
Amorecomplexexample ,NA,NA
HTTPrequestmethods ,NA,NA
about/,NA,NA
HTTPrequestmethods ,NA,NA
GET/,NA,NA
GET ,NA,NA
POST/,NA,NA
POSTandPUT ,NA,NA
PUT/,NA,NA
POSTandPUT ,NA,NA
DELETE/,NA,NA
DELETE,NA,NA
I,NA,NA
500internalservererror/,NA,NA
5xx–servererror ,NA,NA
Illuminate\Database\Eloquent\Model/,NA,NA
Projects,NA,NA
etup ,NA,NA
impersonification,NA,NA
about/,NA,NA
Authenticationandroles ,NA,NA
incrementingoperators,NA,NA
about/,NA,NA
Incrementinganddecrementingoperators,NA,NA
indexes,NA,NA
about/,NA,NA
Indexes ,NA,NA
infiniteloops/,NA,NA
While ,NA,NA
informationhiding,NA,NA
about/,NA,NA
Encapsulation ,NA,NA
inheritance,NA,NA
about/,NA,NA
Inheritance,NA,NA
",",NA,NA
Introducinginheritance,NA,NA
"methods,overriding/",NA,NA
Overridingmethods,NA,NA
abstractclasses/,NA,NA
Abstractclasses ,NA,NA
installing,NA,NA
Vagrant/,NA,NA
InstallingVagrant,NA,NA
"Mink,withGoutte/",NA,NA
InstallingMinkwithGoutte ,NA,NA
integrationtests,NA,NA
about/,NA,NA
Typesoftests ,NA,NA
interface,NA,NA
about/,NA,NA
Interfaces ,NA,NA
internationalization,NA,NA
about/,NA,NA
Internationalization ,NA,NA
issetfunction,NA,NA
about/,NA,NA
Theemptyandissetfunctions,NA,NA
J,NA,NA
JavaScript ,NA,NA
about/,NA,NA
"HTML,CSS,andJavaScript ",NA,NA
joinqueries ,NA,NA
about/,NA,NA
Joiningtables,NA,NA
K,NA,NA
keys ,NA,NA
about/,NA,NA
Keysandconstraint,NA,NA
s ,NA,NA
primarykeys/,NA,NA
Primarykey,NA,NA
s ,NA,NA
foreignkeys/,NA,NA
Foreignkeys ,NA,NA
uniquekeys/,NA,NA
Uniquekeys,NA,NA
L,NA,NA
lambdafunctions ,NA,NA
about/,NA,NA
Anonymousfunctions ,NA,NA
Laravel ,NA,NA
versusSilex/,NA,NA
SilexversusLaravel ,NA,NA
Laravelframework ,NA,NA
about/,NA,NA
TheLaravelframework,NA,NA
installation/,NA,NA
Installation ,NA,NA
projectsetup/,NA,NA
Projectsetup ,NA,NA
"firstendpoint,adding/",NA,NA
Addingthefirstendpoint ,NA,NA
"users,managing/",NA,NA
Managingusers ,NA,NA
"relationships,settingupinmodels/",NA,NA
Settinguprelationshipsinmodels ,NA,NA
"complexcontrollers,creating/",NA,NA
Creatingcomplexcontrollers ,NA,NA
"tests,adding/",NA,NA
Addingtests ,NA,NA
layout ,NA,NA
about/,NA,NA
Layoutsandblocks ,NA,NA
lazyload ,NA,NA
about/,NA,NA
Thesalesmodel ,NA,NA
leftjoins ,NA,NA
about/,NA,NA
Joiningtables ,NA,NA
listofvalues ,NA,NA
about/,NA,NA
Listofvalues ,NA,NA
lists ,NA,NA
about/,NA,NA
Arrays ,NA,NA
logicaloperators ,NA,NA
about/,NA,NA
Logicaloperators ,NA,NA
loops ,NA,NA
about/,NA,NA
Controlstructures,NA,NA
",",NA,NA
Loops ,NA,NA
whileloop/,NA,NA
While ,NA,NA
do…whileloop/,NA,NA
Do…while ,NA,NA
forloop/,NA,NA
For ,NA,NA
foreach/,NA,NA
Foreach,NA,NA
M,NA,NA
magicmethods ,NA,NA
about/,NA,NA
Magicmethods ,NA,NA
__toString/,NA,NA
Magicmethods ,NA,NA
__call/,NA,NA
Magicmethods ,NA,NA
__get/,NA,NA
Magicmethods ,NA,NA
maps,NA,NA
about/,NA,NA
Arrays ,NA,NA
methods ,NA,NA
overriding/,NA,NA
Overridingmethods ,NA,NA
methodsvisibility ,NA,NA
about/,NA,NA
Propertiesandmethodsvisibility ,NA,NA
Mformodel ,NA,NA
defining/,NA,NA
Mformodel ,NA,NA
customermodel/,NA,NA
Thecustomermodel ,NA,NA
bookmodel/,NA,NA
Thebookmodel ,NA,NA
salesmodel/,NA,NA
Thesalesmodel ,NA,NA
Mink ,NA,NA
"used,fortestingwithbrowser/",NA,NA
TestingwithabrowserusingMink ,NA,NA
"installing,withGoutte/",NA,NA
InstallingMinkwithGoutte ,NA,NA
browserinteraction/,NA,NA
Interactionwiththebrowser ,NA,NA
mocks ,NA,NA
using/,NA,NA
Usingmocks ,NA,NA
models ,NA,NA
about/,NA,NA
TheMVCpattern ,NA,NA
"injecting,withDI/",NA,NA
InjectingmodelswithDI ,NA,NA
Monolog ,NA,NA
about/,NA,NA
Addingalogger ,NA,NA
reference/,NA,NA
Addingalogger ,NA,NA
MVCpattern ,NA,NA
defining/,NA,NA
TheMVCpattern ,NA,NA
MySQL ,NA,NA
about/,NA,NA
MySQL ,NA,NA
MySQLengines ,NA,NA
reference/,NA,NA
Managingtables ,NA,NA
MySQLserverinstaller ,NA,NA
reference/,NA,NA
InstallingMySQL,NA,NA
",",NA,NA
InstallingMySQL ,NA,NA
MySQLWorkbench ,NA,NA
reference/,NA,NA
InstallingMySQL,NA,NA
N,NA,NA
namespaces ,NA,NA
about/,NA,NA
Namespaces ,NA,NA
Nginx ,NA,NA
reference/,NA,NA
ThePHPbuilt-inserver ,NA,NA
numericdatatypes ,NA,NA
about/,NA,NA
Numericdatatypes,NA,NA
O,NA,NA
OAuth2authentication ,NA,NA
"database,settingup/",NA,NA
Settingupthedatabase ,NA,NA
"client-credentialsauthentication,enabling/",NA,NA
Enablingclient-credentials ,NA,NA
authentication ,NA,NA
"accesstoken,requesting/",NA,NA
Requestinganaccesstoken ,NA,NA
OAuth2.0,NA,NA
about/,NA,NA
OAuth2.0 ,NA,NA
OAuth2Server ,NA,NA
installing/,NA,NA
InstallingOAuth2Server ,NA,NA
Object-relationalmapping(ORM) ,NA,NA
about/,NA,NA
ORM ,NA,NA
objects ,NA,NA
about/,NA,NA
Classesandobjects ,NA,NA
operatorprecedence ,NA,NA
about/,NA,NA
Operatorprecedence ,NA,NA
operators ,NA,NA
about/,NA,NA
Operators ,NA,NA
arithmeticoperators/,NA,NA
Arithmeticoperators ,NA,NA
assignmentoperators/,NA,NA
Assignmentoperators ,NA,NA
comparisonoperators/,NA,NA
Comparisonoperators ,NA,NA
logicaloperators/,NA,NA
Logicaloperators ,NA,NA
decrementingoperators/,NA,NA
Incrementinganddecrementingoperators ,NA,NA
incrementingoperators/,NA,NA
Incrementinganddecrementingoperators ,NA,NA
optionalarguments/,NA,NA
Functionarguments ,NA,NA
overindexing ,NA,NA
about/,NA,NA
Indexes ,NA,NA
overloadedfunctions/,NA,NA
Functiondeclaration,NA,NA
P,NA,NA
Packagist ,NA,NA
about/,NA,NA
Addingmetadata,NA,NA
",",NA,NA
Settinguptheapplication ,NA,NA
references/,NA,NA
Addingmetadata ,NA,NA
PDO ,NA,NA
using/,NA,NA
UsingPDO ,NA,NA
"connecting,todatabase/",NA,NA
Connectingtothedatabase,NA,NA
"queries,performing/",NA,NA
Performingqueries ,NA,NA
preparedstatements/,NA,NA
Preparedstatements ,NA,NA
PHP ,NA,NA
reference/,NA,NA
AutoloaderwithPSR-4 ,NA,NA
"PHP,andHTML ",NA,NA
mixing/,NA,NA
Conditionals ,NA,NA
"PHP,inwebapplications ",NA,NA
about/,NA,NA
PHPinwebapplications ,NA,NA
"information,obtainingfromuser/",NA,NA
Gettinginformationfromtheuser ,NA,NA
HTMLforms/,NA,NA
HTMLforms ,NA,NA
"data,persistingwithcookies/",NA,NA
Persistingdatawithcookies ,NA,NA
PHPbuilt-inserver ,NA,NA
about/,NA,NA
ThePHPbuilt-inserver ,NA,NA
PHPfiles ,NA,NA
about/,NA,NA
PHPfiles ,NA,NA
functions/,NA,NA
PHPfiles ,NA,NA
"PHPfunctions,filesystem ",NA,NA
file_exists/,NA,NA
Otherfilesystemfunctions ,NA,NA
is_writable/,NA,NA
Otherfilesystemfunctions ,NA,NA
reference/,NA,NA
Otherfilesystemfunctions ,NA,NA
PHPinstaller ,NA,NA
reference/,NA,NA
InstallingPHP ,NA,NA
PHPUnit ,NA,NA
about/,NA,NA
IntegratingPHPUnit ,NA,NA
integrating/,NA,NA
IntegratingPHPUnit ,NA,NA
phpunit.xmlfile ,NA,NA
about/,NA,NA
Thephpunit.xmlfile ,NA,NA
Pimple ,NA,NA
about/,NA,NA
Projectsetup ,NA,NA
polymorphism ,NA,NA
about/,NA,NA
Polymorphism ,NA,NA
POSTmethod/,NA,NA
POSTandPUT ,NA,NA
preparedstatements/,NA,NA
Preparedstatements ,NA,NA
primarykeys ,NA,NA
about/,NA,NA
Primarykeys ,NA,NA
productionwebservers,NA,NA
about/,NA,NA
ThePHPbuilt-inserver,NA,NA
"projectsetup,Silexmicroframework ",NA,NA
about/,NA,NA
Projectsetup ,NA,NA
"configuration,managing/",NA,NA
Managingconfiguration ,NA,NA
"templateengine,setting/",NA,NA
Settingthetemplateengine ,NA,NA
"logger,adding/",NA,NA
Addingalogger ,NA,NA
propertiesvisibility ,NA,NA
about/,NA,NA
Propertiesandmethodsvisibility,NA,NA
PUTmethod/,NA,NA
POSTandPUT,NA,NA
Q ,NA,NA
queries ,NA,NA
grouping/,NA,NA
Groupingqueries,NA,NA
R,NA,NA
receiver ,NA,NA
about/,NA,NA
Asimpleexample ,NA,NA
reflection ,NA,NA
about/,NA,NA
Databasetesting ,NA,NA
reference/,NA,NA
Databasetesting ,NA,NA
requests,NA,NA
workingwith/,NA,NA
Workingwithrequests ,NA,NA
requestobject/,NA,NA
Therequestobject ,NA,NA
"parameters,filteringfrom/",NA,NA
Filteringparametersfromrequests ,NA,NA
"routes,mappingtocontrollers/",NA,NA
Mappingroutestocontrollers ,NA,NA
router/,NA,NA
Therouter ,NA,NA
"RESTAPI,creatingwithLaravel ",NA,NA
about/,NA,NA
CreatingaRESTAPIwithLaravel ,NA,NA
"OAuth2authentication,setting/",NA,NA
SettingOAuth2authentication ,NA,NA
"database,preparing/",NA,NA
Preparingthedatabase ,NA,NA
"models,settingup/",NA,NA
Settingupthemodels ,NA,NA
"endpoints,designing/",NA,NA
Designingendpoints ,NA,NA
"controllers,adding/",NA,NA
Addingthecontrollers ,NA,NA
RESTAPIdeveloper ,NA,NA
toolkit/,NA,NA
ThetoolkitoftheRESTAPIdeveloper ,NA,NA
RESTAPIs ,NA,NA
about/,NA,NA
IntroducingRESTAPIs ,NA,NA
foundations/,NA,NA
ThefoundationsofRESTAPIs ,NA,NA
bestpractices/,NA,NA
BestpracticeswithRESTAPIs ,NA,NA
testing/,NA,NA
TestingyourRESTAPIs ,NA,NA
RESTAPIsecurity ,NA,NA
about/,NA,NA
RESTAPIsecurity ,NA,NA
basicaccessauthentication/,NA,NA
Basicaccessauthentication ,NA,NA
OAuth2.0/,NA,NA
OAuth2.0 ,NA,NA
returnstatement/,NA,NA
Thereturnstatement ,NA,NA
returntype/,NA,NA
Typehintingandreturntypes ,NA,NA
RFC2068standard ,NA,NA
reference/,NA,NA
TheHTTPprotocol ,NA,NA
router ,NA,NA
about/,NA,NA
Therouter ,NA,NA
"URLsmatching,withregularexpressions/",NA,NA
URLsmatchingwithregular ,NA,NA
expressions ,NA,NA
"arguments,extractingofURL/",NA,NA
ExtractingtheargumentsoftheURL ,NA,NA
"controller,executing/",NA,NA
Executingthecontroller,NA,NA
S,NA,NA
scenarios ,NA,NA
defining/,NA,NA
Definingscenarios ,NA,NA
"Given-When-Thentestcases,writing/",NA,NA
WritingGiven-When-Thentestcases ,NA,NA
"parts,reusingof/",NA,NA
Reusingpartsofscenarios ,NA,NA
schemas ,NA,NA
about/,NA,NA
Schemasandtables,NA,NA
",",NA,NA
Understandingschemas,NA,NA
sender ,NA,NA
about/,NA,NA
Asimpleexample ,NA,NA
setter ,NA,NA
about/,NA,NA
Encapsulation ,NA,NA
Silex ,NA,NA
versusLaravel/,NA,NA
SilexversusLaravel ,NA,NA
reference/,NA,NA
SilexversusLaravel ,NA,NA
Silexmicroframework ,NA,NA
about/,NA,NA
TheSilexmicroframework ,NA,NA
installation/,NA,NA
Installation ,NA,NA
projectsetup/,NA,NA
Projectsetup ,NA,NA
"firstendpoint,adding/",NA,NA
Addingthefirstendpoint ,NA,NA
"database,accessing/",NA,NA
Accessingthedatabase ,NA,NA
singletondesignpattern ,NA,NA
about/,NA,NA
Singleton ,NA,NA
spl_autoload_registerfunction ,NA,NA
using/,NA,NA
Usingthespl_autoload_registerfunction ,NA,NA
"standards,PHP ",NA,NA
PSR-0/,NA,NA
AutoloaderwithPSR-4 ,NA,NA
PSR-4/,NA,NA
AutoloaderwithPSR-4 ,NA,NA
staticmethods ,NA,NA
about/,NA,NA
Staticpropertiesandmethods ,NA,NA
staticproperties ,NA,NA
about/,NA,NA
Staticpropertiesandmethods ,NA,NA
statuscodes ,NA,NA
200/,NA,NA
Thestatuscode ,NA,NA
401/,NA,NA
Thestatuscode ,NA,NA
404/,NA,NA
Thestatuscode ,NA,NA
500/,NA,NA
Thestatuscode ,NA,NA
reference/,NA,NA
Statuscodesinresponses ,NA,NA
"statuscodes,inresponses ",NA,NA
about/,NA,NA
Statuscodesinresponses ,NA,NA
2xx-success/,NA,NA
2xx–success ,NA,NA
3xx-redirection/,NA,NA
3xx–redirection ,NA,NA
4xx-clienterror/,NA,NA
4xx–clienterror ,NA,NA
5xx-servererror/,NA,NA
5xx–servererror,NA,NA
stepdefinitions,NA,NA
writing/,NA,NA
Writingstepdefinitions ,NA,NA
steps ,NA,NA
parameterization/,NA,NA
Theparameterizationofsteps ,NA,NA
stringdatatypes ,NA,NA
about/,NA,NA
Stringdatatypes ,NA,NA
strings ,NA,NA
workingwith/,NA,NA
Workingwithstrings,NA,NA
superglobals ,NA,NA
about/,NA,NA
Othersuperglobals ,NA,NA
reference/,NA,NA
Othersuperglobals ,NA,NA
switch…case ,NA,NA
about/,NA,NA
Switch…case ,NA,NA
Symfony ,NA,NA
about/,NA,NA
InstallingMinkwithGoutte,NA,NA
Symfony2 ,NA,NA
about/,NA,NA
Symfony2,NA,NA
T,NA,NA
tables ,NA,NA
about/,NA,NA
Schemasandtables ,NA,NA
managing/,NA,NA
Managingtables ,NA,NA
joining/,NA,NA
Joiningtables ,NA,NA
TDD ,NA,NA
versusBDD/,NA,NA
TDDversusBDD ,NA,NA
test-drivendevelopment(TDD) ,NA,NA
about/,NA,NA
Test-drivendevelopment ,NA,NA
"theory,versuspractice/",NA,NA
Theoryversuspractice ,NA,NA
TestCase ,NA,NA
customizing/,NA,NA
CustomizingTestCase ,NA,NA
tests ,NA,NA
needfor/,NA,NA
Thenecessityfortests ,NA,NA
types/,NA,NA
Typesoftests ,NA,NA
unittests/,NA,NA
Typesoftests ,NA,NA
integrationtests/,NA,NA
Typesoftests ,NA,NA
acceptancetests/,NA,NA
Typesoftests ,NA,NA
about/,NA,NA
Yourfirsttest ,NA,NA
running/,NA,NA
Runningtests ,NA,NA
"tests,features ",NA,NA
automatic/,NA,NA
Typesoftests ,NA,NA
extensive/,NA,NA
Typesoftests ,NA,NA
immediate/,NA,NA
Typesoftests ,NA,NA
open/,NA,NA
Typesoftests ,NA,NA
useful/,NA,NA
Typesoftests ,NA,NA
third-partyAPIs ,NA,NA
using/,NA,NA
Usingthird-partyAPIs ,NA,NA
"application’scredentials,obtaining/",NA,NA
Gettingtheapplication’scredentials ,NA,NA
"application,settingup/",NA,NA
Settinguptheapplication ,NA,NA
"accesstoken,requesting/",NA,NA
Requestinganaccesstoken ,NA,NA
"tweets,fetching/",NA,NA
Fetchingtweets ,NA,NA
timestamps/,NA,NA
Persistingdatawithcookies ,NA,NA
"toolsinstallation,withComposer ",NA,NA
reference/,NA,NA
IntegratingPHPUnit ,NA,NA
traits ,NA,NA
about/,NA,NA
Traits ,NA,NA
transactions ,NA,NA
workingwith/,NA,NA
Workingwithtransactions ,NA,NA
try…catchblock ,NA,NA
about/,NA,NA
Thetry…catchblock ,NA,NA
Twig ,NA,NA
about/,NA,NA
IntroductiontoTwig,NA,NA
Twitter,NA,NA
reference/,NA,NA
Gettingtheapplication’scredentials ,NA,NA
typehinting/,NA,NA
Typehintingandreturntypes ,NA,NA
typejuggling/,NA,NA
Datatypes ,NA,NA
versuscasting/,NA,NA
Gettinginformationfromtheuser,NA,NA
U,NA,NA
uniquekeys ,NA,NA
about/,NA,NA
Uniquekeys ,NA,NA
unittests ,NA,NA
about/,NA,NA
Typesoftests,NA,NA
",",NA,NA
Unittestsandcodecoverage ,NA,NA
writing/,NA,NA
Writingunittests ,NA,NA
start/,NA,NA
Thestartandendofatest,NA,NA
end/,NA,NA
Thestartandendofatest ,NA,NA
versusacceptancetests/,NA,NA
Unittestsversusacceptancetests ,NA,NA
"usermanagement,Laravelframework ",NA,NA
about/,NA,NA
Managingusers ,NA,NA
userregistration/,NA,NA
Userregistration ,NA,NA
userlogin/,NA,NA
Userlogin ,NA,NA
protectedroutes/,NA,NA
Protectedroutes,NA,NA
V,NA,NA
Vagrant ,NA,NA
"environment,settingupwith/",NA,NA
SettinguptheenvironmentwithVagrant ,NA,NA
about/,NA,NA
IntroducingVagrant ,NA,NA
installing/,NA,NA
InstallingVagrant ,NA,NA
downloadpagelink/,NA,NA
InstallingVagrant ,NA,NA
using/,NA,NA
UsingVagrant ,NA,NA
variableexpanding ,NA,NA
about/,NA,NA
Workingwithstrings ,NA,NA
variables ,NA,NA
about/,NA,NA
Variables ,NA,NA
variablescope/,NA,NA
Functiondeclaration ,NA,NA
versioncontrolsystems(VCS) ,NA,NA
about/,NA,NA
Introducingcontinuousintegration ,NA,NA
Vforview ,NA,NA
defining/,NA,NA
Vforview ,NA,NA
"Twig,defining/",NA,NA
IntroductiontoTwig ,NA,NA
bookview/,NA,NA
Thebookview ,NA,NA
layouts/,NA,NA
Layoutsandblocks ,NA,NA
blocks/,NA,NA
Layoutsandblocks ,NA,NA
paginatedbooklist/,NA,NA
Paginatedbooklist ,NA,NA
salesview/,NA,NA
Thesalesview ,NA,NA
errortemplate/,NA,NA
Theerrortemplate ,NA,NA
logintemplate/,NA,NA
Thelogintemplate ,NA,NA
views ,NA,NA
about/,NA,NA
TheMVCpattern ,NA,NA
visibility ,NA,NA
about/,NA,NA
Propertiesandmethodsvisibility ,NA,NA
private/,NA,NA
Propertiesandmethodsvisibility ,NA,NA
protected/,NA,NA
Propertiesandmethodsvisibility ,NA,NA
public/,NA,NA
Propertiesandmethodsvisibility ,NA,NA
working/,NA,NA
Propertiesandmethodsvisibility,NA,NA
W,NA,NA
webapplications ,NA,NA
about/,NA,NA
Webapplications ,NA,NA
webdrivers ,NA,NA
types/,NA,NA
Typesofwebdrivers ,NA,NA
webforms ,NA,NA
submitting/,NA,NA
Amorecomplexexample,NA,NA
webpage ,NA,NA
about/,NA,NA
Webapplications ,NA,NA
webservers ,NA,NA
about/,NA,NA
Webservers ,NA,NA
working/,NA,NA
Howtheywork ,NA,NA
website ,NA,NA
about/,NA,NA
Webapplications ,NA,NA
whileloop/,NA,NA
While,NA,NA
X,NA,NA
2xx-successstatuscodes ,NA,NA
200OK/,NA,NA
2xx–success ,NA,NA
201created/,NA,NA
2xx–success ,NA,NA
202accepted/,NA,NA
2xx–success ,NA,NA
3xx-redirectionstatuscodes ,NA,NA
301movedpermanently/,NA,NA
3xx–redirection,NA,NA
303seeother/,NA,NA
3xx–redirection ,NA,NA
4xx-clienterrorstatuscodes ,NA,NA
400badrequest/,NA,NA
4xx–clienterror ,NA,NA
401unauthorized/,NA,NA
4xx–clienterror ,NA,NA
403forbidden/,NA,NA
4xx–clienterror ,NA,NA
404notfound/,NA,NA
4xx–clienterror ,NA,NA
405methodnotallowed/,NA,NA
4xx–clienterror ,NA,NA
5xx-servererror/,NA,NA
5xx–servererror,NA,NA
Z,NA,NA
ZendFramework2 ,NA,NA
about/,NA,NA
ZendFramework2 ,NA,NA
"ZIPfile,Nginx ",NA,NA
reference/,NA,NA
InstallingNginx,NA,NA
